<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Multivariate analysis</title>

<script src="site_libs/header-attrs-2.21/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/clipboard-2.0.6/clipboard.min.js"></script>
<link href="site_libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.css" rel="stylesheet" />
<script src="site_libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.js"></script>
<script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { color: #585cf6; } /* Constant */
code span.co { color: #4c886b; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.dv { color: #0000cd; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cd; } /* Float */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { color: #687687; } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #036a07; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">OCEAN_5098</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="environment.html">Environment</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Manipulation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="basics.html">Basics</a>
    </li>
    <li>
      <a href="dplyr.html">dplyr</a>
    </li>
    <li>
      <a href="tidyr.html">tidyr</a>
    </li>
  </ul>
</li>
<li>
  <a href="types.html">Types &amp; structures</a>
</li>
<li>
  <a href="graphs.html">Graphics</a>
</li>
<li>
  <a href="maps.html">Mapping</a>
</li>
<li>
  <a href="functions.html">Loop &amp; functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Statistics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="stat_1.html">Initiation</a>
    </li>
    <li>
      <a href="stat_2.html">Linear models</a>
    </li>
    <li>
      <a href="stat_3.html">Multivariates</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Multivariate analysis</h1>

</div>


<a href="data:text/x-markdown;base64,LS0tDQp0aXRsZTogIk11bHRpdmFyaWF0ZSBhbmFseXNpcyINCi0tLQ0KDQoNCmBgYHtyIGV2YWwgPSBUUlVFLCAgbWVzc2FnZT1GLCBpbmNsdWRlPUYsIHdhcm5pbmc9RiwgcHVybD1GLCByZXN1bHRzPSJoaWRlIn0NCmtuaXRyOjpwdXJsKCdzdGF0XzMuUm1kJywgZG9jdW1lbnRhdGlvbiA9IEYpDQpgYGANCg0KYGBge3IgZWNobz1GQUxTRX0NCnhhcmluZ2FuRXh0cmE6OnVzZV9jbGlwYm9hcmQoKQ0KYGBgDQoNCmBgYHtyIGVjaG89RkFMU0UsIHB1cmw9Rn0NCnhmdW46OmVtYmVkX2ZpbGUoJ3N0YXRfMy5SbWQnKQ0KYGBgDQoNCmBgYHtyIGVjaG89RkFMU0UsIHB1cmw9Rn0NCnhmdW46OmVtYmVkX2ZpbGUoJ3N0YXRfMy5SJykNCmBgYA0KDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KDQpgYGB7ciwgbWVzc2FnZT1GLCB3YXJuaW5nPUZ9DQoNCmxpYnJhcnkodmVnYW4pDQpsaWJyYXJ5KHFncmFwaCkNCmxpYnJhcnkoYWRlNCkNCmxpYnJhcnkobXZhYnVuZCkNCmxpYnJhcnkgKHB2Y2x1c3QpDQpsaWJyYXJ5KGZhY3RvZXh0cmEpDQpsaWJyYXJ5KGVjb2Rpc3QpDQpsaWJyYXJ5KHRyZWUpDQpsaWJyYXJ5KHJwYXJ0KQ0KbGlicmFyeShnZ3Bsb3QyKQ0KbGlicmFyeShyYW5kb21Gb3Jlc3QpDQpsaWJyYXJ5KGNhcmV0KQ0KbGlicmFyeShyYXR0bGUpDQoNCiMgdG8gYmUgY2FyZWZ1bA0KbGlicmFyeShtdnBhcnQpICMgZGV2dG9vbHM6Omluc3RhbGxfZ2l0aHViKCJjcmFuL212cGFydCIsIGZvcmNlID0gVCkgDQpsaWJyYXJ5KE1WUEFSVHdyYXApICMgZGV2dG9vbHM6Omluc3RhbGxfZ2l0aHViKCJjcmFuL01WUEFSVHdyYXAiLCBmb3JjZSA9IFQpDQoNCiMgIGZ1bmN0aW9ucyBmcm9tIEJvcmNhcmQgZXQgYWwuIDIwMTENCnNvdXJjZSgnaHR0cHM6Ly93d3cuZGlwaW50b3RoZXJlZWYuY29tL3VwbG9hZHMvMy83LzMvNS8zNzM1OTI0NS9jb2xkaXNzLnInKSANCnNvdXJjZSAoJ2h0dHBzOi8vd3d3LmRpcGludG90aGVyZWVmLmNvbS91cGxvYWRzLzMvNy8zLzUvMzczNTkyNDUvY2xlYW5wbG90LnBjYS5yJykNCg0KDQpgYGANCg0KRWNvbG9naWNhbCBwaGVub21lbmEgYXJlIGluaGVyZW50bHkgY29tcGxleCwgYW5kIGl0IGlzIHJhcmUgdGhhdCBhIHNpbmdsZSB2YXJpYWJsZSBpcyBzdWZmaWNpZW50IHRvIGRlc2NyaWJlIGFuIGVjb2xvZ2ljYWwgc3lzdGVtLCBlbnRpdHksIG9yIGludGVyYWN0aW9uLiBSYXRoZXIsIG11bHRpcGxlIHJlc3BvbnNlIHZhcmlhYmxlcyAtIHN1Y2ggYXMgdGhlIGFidW5kYW5jZXMgb2YgbXVsdGlwbGUgc3BlY2llcyAtIGFyZSBvZnRlbiBtZWFzdXJlZCB0byBnYWluIGVjb2xvZ2ljYWwgaW5zaWdodC4gSW4gYWRkaXRpb24sIGl0IGlzIGNvbW1vbiB0byBhZGQgbXVsdGlwbGUgZXhwbGFuYXRvcnkgdmFyaWFibGVzIHRvIGFuIGFuYWx5c2lzIGluIGFuIGF0dGVtcHQgdG8gZXhwbGFpbiB0aGUgdmFyaWF0aW9uIGluIHRoZSByZXNwb25zZSBkYXRhLiBNdWx0aXZhcmlhdGUgYW5hbHlzZXMgY29udGVuZCB3aXRoIHRoZSBjb21wbGV4aXR5IG9mIHNpbXVsdGFuZW91c2x5IGFuYWx5c2luZyAqKm11bHRpcGxlIHJlc3BvbnNlIHZhcmlhYmxlcyoqLiBHZW5lcmFsbHksIG11bHRpdmFyaWF0ZSBhcHByb2FjaGVzIGFyZSBmYXZvdXJlZCB0byBtdWx0aXBsZSBleGVjdXRpb25zIG9mIHVuaXZhcmlhdGUgbWV0aG9kcyBhcyB0aGV5IHNhdmUgdGltZSBhbmQgY29uc2VydmUgc3RhdGlzdGljYWwgcG93ZXIgd2hpY2ggaXMgcXVpY2tseSBsb3N0IHRocm91Z2ggKm11bHRpcGxlIHRlc3RpbmcqLiBJbiBzb21lIGNhc2VzLCB0YWtpbmcgbXVsdGlwbGUgdmFyaWFibGVzIGludG8gYWNjb3VudCBzaW11bHRhbmVvdXNseSBtYXkgcmV2ZWFsIHBhdHRlcm5zIHRoYXQgd291bGQgbm90IGJlIGRldGVjdGFibGUgYnkgdW5pdmFyaWF0ZSBtZXRob2RzLg0KDQo8Y2VudGVyPg0KIVsqX19Db21wYXJhaXNvbiBiZXR3ZWVuIHVuaXZhcmlhdGUgYW5kIG11bHRpdmFyaWF0ZSBhbmFseXNlc19fOiBVbml2YXJpYXRlIGRhdGEgc2V0cyBmZWF0dXJlIGEgc2luZ2xlIHJlc3BvbnNlIHZhcmlhYmxlIChSMSkuIFRoaXMgbWF5IGJlIGFuYWx5c2VkIGFnYWluc3Qgb25lIG9yIG1vcmUgZXhwbGFuYXRvcnkgdmFyaWFibGVzIChFMS1FMykuIE11bHRpdmFyaWF0ZSBkYXRhIHNldHMgaW5jbHVkZSBtdWx0aXBsZSByZXNwb25zZSB2YXJpYWJsZXMgKFIxLi4uUm4pLiBNdWx0aXZhcmlhdGUgYW5hbHlzaXMgbWV0aG9kcyBhbGxvdyB0aGUgZXZhbHVhdGlvbiBvZiBhbGwgcmVzcG9uc2UgdmFyaWFibGVzIHNpbXVsdGFuZW91c2x5LCByYXRoZXIgdGhhbiByZXF1aXJpbmcgbXVsdGlwbGUgZXhlY3V0aW9ucyBvZiB1bml2YXJpYXRlIG1ldGhvZHMuIEluIHRoZSBsYXR0ZXIgY2FzZSwgbXVsdGlwbGUgdGVzdGluZyBvY2N1cnMsIHdoaWNoIGRlY3JlYXNlcyB0aGUgc3RhdGlzdGljYWwgcG93ZXIgb2YgdGhlIGFuYWx5c2lzLipdKGlsbHVzdHJhdGlvbnMvbXVsdGlfaW50cm8ucG5nKXt3aWR0aD0xMDAlfQ0KPC9jZW50ZXI+DQoNCk11bHRpdmFyaWF0ZSBkYXRhIGFyZSBjb21tb24gaW4gIGVudmlyb25tZW50YWwgc2NpZW5jZXMsIG9jY3VycmluZyB3aGUgZXZlciB3ZSBtZWFzdXJlIHNldmVyYWwgcmVzcG9uc2UgdmFyaWFibGVzIGZyb20gZWFjaCByZXBsaWNhdGUgc2FtcGxlLiBRdWVzdGlvbnMgbGlrZSBob3cgZG9lcyB0aGUgc3BlY2llcyBjb21wb3NpdGlvbiBvZiBhIGNvbW11bml0eSB2YXJ5IGFjcm9zcyBzaXRlcywgb3IgaG93IGRvZXMgdGhlIHNoYXBlIG9mIHRyZWVzIChhcyBtZWFzdXJlZCBieSBzZXZlcmFsIG1vcnBob2xvZ2ljYWwgdHJhaXRzKSB2YXJ5IHdpdGggYWx0aXR1ZGUgYXJlIG11bHRpdmFyaWF0ZSBxdWVzdGlvbnMuDQoNCkpvaG5zb24gYW5kIFdpY2hlcm4gKDIwMDIpIHN1Z2dlc3QgZml2ZSB0eXBlcyBvZiBzY2llbnRpZmljIGlucXVpcnkgbW9zdCBzdWl0ZWQgdG8gdGhlIGFwcGxpY2F0aW9uIG9mIG11bHRpdmFyaWF0ZSBtZXRob2RzLg0KDQorICoqU29ydGluZyBhbmQgZ3JvdXBpbmcqKjogTWFueSBlY29sb2dpY2FsIHF1ZXN0aW9ucyBhcmUgY29uY2VybmVkIHdpdGggdGhlIHNpbWlsYXJpdHkgb3IgZGlzc2ltaWxhcml0eSBvZiBhIGNvbGxlY3Rpb24gb2YgZW50aXRpZXMgYW5kIHRoZWlyIGFzc2lnbm1lbnQgdG8gZ3JvdXBzLiBTZXZlcmFsIG11bHRpdmFyaWF0ZSBtZXRob2RzLCBzdWNoIGFzICpjbHVzdGVyIGFuYWx5c2lzKiBhbmQgKm5vbi1tZXRyaWMgZGltZW5zaW9uYWwgc2NhbGluZyosIGFsbG93IGRldGVjdGlvbiBvZiBwb3RlbnRpYWwgZ3JvdXBzIGluIHRoZSBkYXRhLiBBY3RpdmUgY2xhc3NpZmljYXRpb24gYmFzZWQgb24gbXVsdGl2YXJpYXRlIGRhdGEgbWF5IGFsc28gYmUgcGVyZm9ybWVkIGJ5IG1ldGhvZHMgc3VjaCBhcyBsaW5lYXIgZGlzY3JpbWluYW50IGFuYWx5c2lzLg0KDQorICoqRGF0YSByZWR1Y3Rpb24gb3Igc3RydWN0dXJhbCBzaW1wbGlmaWNhdGlvbioqOiBTZXZlcmFsIG11bHRpdmFyaWF0ZSBtZXRob2RzLCBzdWNoIGFzICpwcmluY2lwYWwgY29tcG9uZW50cyBhbmFseXNpcyosIGFsbG93IHRoZSBzdW1tYXJ5IG9mIG11bHRpcGxlIHZhcmlhYmxlcyB0aHJvdWdoIGEgY29tcGFyYXRpdmVseSBzbWFsbGVyIHNldCBvZiAnc3ludGhldGljJyB2YXJpYWJsZXMgZ2VuZXJhdGVkIGJ5IHRoZSBhbmFseXNlcyB0aGVtc2VsdmVzLiBUaHVzLCBoaWdoLWRpbWVuc2lvbmFsIHBhdHRlcm5zIGFyZSBwcmVzZW50ZWQgaW4gYSBsb3dlci1kaW1lbnNpb25hbCBzcGFjZSwgYWlkaW5nIGludGVycHJldGF0aW9uLg0KDQorICoqSW52ZXN0aWdhdGlvbiBvZiB0aGUgZGVwZW5kZW5jZSBhbW9uZyB2YXJpYWJsZXMqKjogRGVwZW5kZW5jZSBhbW9uZyByZXNwb25zZSB2YXJpYWJsZXMsIGFtb25nIHJlc3BvbnNlIGFuZCBleHBsYW5hdG9yeSB2YXJpYWJsZXMsIG9yIGFtb25nICBleHBsYW5hdG9yeSB2YXJpYWJsZXMgaXMgb2Yga2V5IGludGVyZXN0LiBNZXRob2RzIHRoYXQgZGV0ZWN0IGRlcGVuZGVuY2UsIHN1Y2ggYXMgKnJlZHVuZGFuY3kgYW5hbHlzaXMqLCBhcmUgdmFsdWFibGUgaW4gZGV0ZWN0aW5nIGluZmx1ZW5jZSBvciBjb3ZhcmlhdGlvbi4NCg0KKyAqKkh5cG90aGVzaXMgdGVzdGluZyoqOiBFeHBsb3JhdG9yeSB0ZWNobmlxdWVzIGNhbiByZXZlYWwgcGF0dGVybnMgaW4gZGF0YSBmcm9tIHdoaWNoIGh5cG90aGVzZXMgbWF5IGJlIGNvbnN0cnVjdGVkIChob3dldmVyLCBiZSBjYXJlZnVsIG9mIGRhdGEgZHJlZGdpbmcpLiBTZXZlcmFsIG1ldGhvZHMsIHN1Y2ggYXMgKk1BTk9WQSosICpQRVJNQU5PVkEqLCAqQU5PU0lNKiAgb3IgdGhlICpNYW50ZWwgdGVzdCosIGFsbG93IHRoZSB0ZXN0aW5nIG9mIHN0YXRpc3RpY2FsIGh5cG90aGVzZXMgb24gbXVsdGl2YXJpYXRlIGRhdGEuIEFwcHJvcHJpYXRlbHkgY29uc3RydWN0ZWQgYXNzZXJ0aW9ucyBtYXkgdGh1cyBiZSB0ZXN0ZWQuDQoNCisgKipQcmVkaWN0aW9uKio6IE9uY2UgdGhlIGRlcGVuZGVuY2UgYW1vbmcgdmFyaWFibGVzIGhhcyBiZWVuIGRldGVjdGVkIGFuZCBjaGFyYWN0ZXJpc2VkLCBtdWx0aXZhcmlhdGUgbW9kZWxzIG1heSBiZSBjb25zdHJ1Y3RlZCB0byBhbGxvdyBwcmVkaWN0aW9uLg0KDQpOb3RlIHRoYXQgYWNjb3JkaW5nIHRvIHRoZSBmaWVsZCBvZiByZXNlYXJjaCB0aGVyZSBpcyBhIHRyZW5kIHRvIGZhdm9yIHNvbWUgdG9vbHMgbW9yZSB0aGFuIG90aGVycy4gDQoNCg0KIyBEYXRhIFN0cnVjdHVyZQ0KDQpJbiBlY29sb2d5LCB0aGUndHlwaWNhbCcgZGF0YXNldCB1c2VkIGluIG11bHRpdmFyaWF0ZSBhbmFseXNlcyB3aWxsIGJlIHJlcHJlc2VudGVkIGJ5OiANCg0KKyBvYmplY3RzIGluIHJvdyAoZS5nLiBzYW1wbGVzIGNhbiBiZSBzaXRlcywgdGltZSBwZXJpb2RzLCBldGMuKQ0KDQorIG1lYXN1cmVkIHZhcmlhYmxlcyBmb3IgdGhvc2Ugb2JqZWN0cyBpbiBjb2x1bW5zIChlLmcuIHNwZWNpZXMsIGVudmlyb25tZW50YWwgcGFyYW1ldGVycywgZXRjLikNCg0KPGNlbnRlcj4NCiFbXShpbGx1c3RyYXRpb25zL211bHRpX2RhdGEucG5nKQ0KPC9jZW50ZXI+DQoNCk1lYXN1cmVkIHZhcmlhYmxlcyBjYW4gYmUgYmluYXJ5LCBxdWFudGl0YXRpdmUsIHF1YWxpdGF0aXZlLCByYW5rLW9yZGVyZWQsIG9yIGV2ZW4gYSBtaXh0dXJlIG9mIHRoZW0uIA0KDQojIFRyYW5zZm9ybWF0aW9ucw0KDQpJZiB2YXJpYWJsZXMgZG8gbm90IGhhdmUgdW5pZm9ybSBzY2FsZSAoZS5nLiBlbnZpcm9ubWVudGFsIHBhcmFtZXRlcnMgbWVhc3VyZWQgaW4gZGlmZmVyZW50IHVuaXRzIG9yIHNjYWxlcyksIHRoZXkgdXN1YWxseSBoYXZlIHRvIGJlIHRyYW5zZm9ybWVkIChzdGFuZGFyZGl6ZWQpLk9jY2FzaW9uYWxseSwgdGhlIHZhcmlhYmxlcyBpbiBhICJyYXciIGRhdGEgc2V0IGhhdmUgcHJvcGVydGllcyB0aGF0IHZpb2xhdGUgYW4gYXNzdW1wdGlvbiBvZiBhIHN0YXRpc3RpY2FsIHByb2NlZHVyZSAoZS5nLiBub3JtYWxseSBkaXN0cmlidXRlZCB2YWx1ZXMpIG9yIHdoaWNoIGNhbm5vdCBiZSBjb21wYXJlZCB0byBvdGhlciB2YXJpYWJsZXMgZHVlIHRvIGRpZmZlcmVuY2VzIGluIHNjYWxlIG9yIHZhcmlhYmlsaXR5LiBGb3IgZXhhbXBsZSwgcHJpbmNpcGFsIGNvbXBvbmVudHMgYW5hbHlzaXMgKFBDQSkgcmVxdWlyZXMgdGhhdCB2YXJpYWJsZXMgYmUgbGluZWFybHkgcmVsYXRlZCB0byBvbmUgYW5vdGhlciBhbmQgb24gcm91Z2hseSB0aGUgc2FtZSBzY2FsZSBvciB3aWxsIHBlcmZvcm0gcG9vcmx5LiBBIHRyYW5zZm9ybWF0aW9uIGludm9sdmVzIHRoZSBhcHBsaWNhdGlvbiBvZiBhIG1hdGhlbWF0aWNhbCBwcm9jZWR1cmUgdG8gZXZlcnkgdmFsdWUgb2YgYSBnaXZlbiB2YXJpYWJsZSBvciBzZXQgb2YgdmFyaWFibGVzIHRvIGNyZWF0ZSBhIG5ldyBzZXQgb2YgdmFsdWVzLiBUaGUgbmV3IHZhbHVlcyBvZiB0aGUgdHJhbnNmb3JtZWQgdmFyaWFibGVzIHNob3VsZCBzdGlsbCByZXByZXNlbnQgdGhlIGRhdGEsIGJ1dCB3aWxsIGJlIG1vcmUgYW1lbmFibGUgdG8gYW5hbHlzaXMgb3IgY29tcGFyaXNvbi4gIEEgZmV3IGJhc2ljIGJ1dCBwb3B1bGFyIGRhdGEgdHJhbnNmb3JtYXRpb24gYXJlIGRlc2NyaWJlZCBbaGVyZV0oaHR0cHM6Ly9zaXRlcy5nb29nbGUuY29tL3NpdGUvbWIzZ3VzdGFtZS9yZWZlcmVuY2UvZGF0YS10cmFuc2Zvcm1hdGlvbnMpLiAgVGhlIG1haW4gbW90aXZhdGlvbnMgZm9yIGFwcGx5aW5nIHRoZXNlIHRyYW5zZm9ybWF0aW9ucyBpbmNsdWRlIHBsYWNpbmcgdmFyaWFibGVzIG9uIHNpbWlsYXIgc2NhbGVzLCBzaW1wbGlmeWluZyBjYWxjdWxhdGlvbnMsIG1lZXRpbmcgZGlzdHJpYnV0aW9uYWwgYXNzdW1wdGlvbnMgKHN1Y2ggYXMgbm9ybWFsaXR5KSwgYW5kIGRlYWxpbmcgd2l0aCAqKmhldGVyb3NjZWRhc3RpY2l0eSoqLiBTb21lIHRyYW5zZm9ybWF0aW9ucyAoc2VlICoqRWNvbG9naWNhbGx5IG1vdGl2YXRlZCB0cmFuc2Zvcm1hdGlvbnMqKikgYXJlIG1vdGl2YXRlZCB0byBpbXByb3ZlIGVmZmVjdGl2ZW5lc3Mgb2YgbWFueSBhbmFseXNpcyBpbiByZXByZXNlbnRpbmcgZWNvbG9naWNhbCByZWxhdGlvbnNoaXBzLiBFeGFtcGxlczoNCg0KLSAqKkhlbGxpbmdlcioqIFBhcnRpY3VsYXJseSBzdWl0ZWQgdG8gc3BlY2llcyBhYnVuZGFuY2UgZGF0YSwgdGhpcyB0cmFuc2Zvcm1hdGlvbiBnaXZlcyBsb3cgd2VpZ2h0cyB0byB2YXJpYWJsZXMgd2l0aCBsb3cgY291bnRzIGFuZCBtYW55IHplcm9zLiBUaGUgdHJhbnNmb3JtYXRpb24gaXRzZWxmIGNvbXByaXNlcyBkaXZpZGluZyBlYWNoIHZhbHVlIGluIGEgZGF0YSBtYXRyaXggYnkgaXRzIHJvdyBzdW0sIGFuZCB0YWtpbmcgdGhlIHNxdWFyZSByb290IG9mIHRoZSBxdW90aWVudC4NCg0KLSAqKkNob3JkKiogTGlrZSB0aGUgSGVsbGluZ2VyIHRyYW5zZm9ybWF0aW9uLCB0aGlzIHRyYW5zZm9ybWF0aW9uIGdpdmVzIGxvdyB3ZWlnaHRzIHRvIHZhcmlhYmxlcyB3aXRoIGxvdyBjb3VudHMgYW5kIG1hbnkgemVyb3MuIFRoaXMgdHJhbnNmb3JtYXRpb24gZGl2aWRlcyBlYWNoIHZhbHVlIGluIGEgZGF0YSBtYXRyaXggYnkgdGhlIHNxdWFyZSByb290IG9mIGl0cyBtYXJnaW5hbCBzdW0gb2Ygc3F1YXJlcy4gSXQgdGhlcmVieSBzZXRzIHRoZSBtYXJnaW5hbCAoZWl0aGVyIHJvdyBvciBjb2x1bW4pIHN1bSBvZiBzcXVhcmVzIHRvIG9uZS4NCg0KLSAqKiRcY2hpXjIkIGRpc3RhbmNlKiogVGhpcyB0cmFuc2Zvcm1hdGlvbiBpcyB0aGUgcHJvZHVjdCBvZiB0aGUgdmFsdWVzIHRyYW5zZm9ybWVkIGJ5IHRoZSAkXGNoaV4yJCBtZXRyaWMgYW5kIHRoZSBzcXVhcmUgcm9vdCBvZiB0aGUgc3VtIG9mIGFsbCBjb3VudHMgaW4gdGhlIGRhdGEgbWF0cml4LiBUaGlzIGlzIHRoZSBkaXN0YW5jZSB1c2VkIGluIGNvcnJlc3BvbmRlbmNlIGFuYWx5c2lzIChDQSkgYW5kIGNhbm9uaWNhbCBjb3JyZXNwb25kZW5jZSBhbmFseXNpcyAoQ0NBKSAuIA0KDQoqKkJlZm9yZSB5b3UgIGJlZ2luIHRyYW5zZm9ybWluZyB5b3VyIGRhdGEsIGVuc3VyZSB0aGVyZSBpcyBhIGRlZmluZWQgYW5kIHdlbGwtc3VwcG9ydGVkIHJlYXNvbiB0byBkbyBzby4gQ29tbW9uIHJhdGlvbmFsZSBpbmNsdWRlcyBsaW5lYXJpc2luZywgbm9ybWFsaXNpbmcsIG9yIHN0YW5kYXJkaXNpbmcgZGF0YSBpbiBvcmRlciB0byByZXNwZWN0IGEgbWV0aG9kJ3MgYXNzdW1wdGlvbnMuKioNCg0KVGhlIGZ1bmN0aW9uIGBkZWNvc3RhbmQoKWAgZnJvbSB0aGUgYHZlZ2FuYCBwYWNrYWdlIG9mZmVycyBhbiBlYXN5IHdheSB0byB0cmFuc2Zvcm0geW91ciBkYXRhIChzZWUgYWxzbyBgc2NhbGUoKWAgZnJvbSB0aGUgYmFzZSBwYWNrYWdlIGFuZCBgYm94Y294KClgIGZyb20gdGhlIE1BU1MgcGFja2FnZSkuIA0KDQpUaGUgYHZhcmVzcGVjYCBkYXRhIGZyYW1lIGhhcyAqKjI0IHJvd3MqKiBhbmQgKio0NCBjb2x1bW5zKiouIENvbHVtbnMgYXJlIGVzdGltYXRlZCBjb3ZlciB2YWx1ZXMgb2YgKio0NCBsaWNoZW4gc3BlY2llcyoqLiBUaGUgdmFyaWFibGUgbmFtZXMgYXJlIGZvcm1lZCBmcm9tIHRoZSBzY2llbnRpZmljIG5hbWVzLCBhbmQgYXJlIHNlbGYgZXhwbGFuYXRvcnkgZm9yIGFueWJvZHkgZmFtaWxpYXIgd2l0aCB2ZWdldGF0aW9uIHR5cGUgLyBsaWNoZW4gc3BlY2llcy4gVGhlIGFzc29jaWF0ZSBgdmFyZWNoZW1gIGRhdGEgZnJhbWUgaGFzICoqMjQgcm93KiogYW5kICoqMTQgY29sdW1ucyoqLCBnaXZpbmcgdGhlIHNvaWwgY2hhcmFjdGVyaXN0aWNzIG9mIHRoZSB2ZXJ5IHNhbWUgc2l0ZXMgYXMgaW4gdGhlIHZhcmVzcGVjIGRhdGEgZnJhbWUuIA0KDQpgYGB7ciwgIGV2YWw9VH0NCiMgP3ZhcmVzcGVjDQpkYXRhICh2YXJlc3BlYyk7IGRhdGEodmFyZWNoZW0pDQp2YXJlc3BlY1sxOjUsMTo1XQ0KdmFyZWNoZW1bMTo1LDE6NV0NCmBgYA0KDQoNCi0gQmFzaWMgdHJhbnNmb3JtYXRpb24NCg0KYGBge3IsICBldmFsPVQsIHdhcm5pbmc9Rn0NCiMgVHJhbnNmb3JtaW5nICBwb3NpdGl2ZSAgZGF0YSB0byBhIGxvZ2FyaXRobWljDQojIHNjYWxlIHJlZHVjZXMgdGhlIHJhbmdlIG9mIHRoZSBkYXRhIHNldC4NCnZhcmVzcGVjLmxvZzwtZGVjb3N0YW5kKHZhcmVzcGVjLCdsb2cnKQ0KdmFyZXNwZWMubG9nWzE6NSwxOjVdDQpgYGANCg0KLSBUcmFuc2Zvcm1hdGlvbnMgaW4gYWlkIG9mIGNvbXBhcmFiaWxpdHkNCg0KYGBge3IsICBldmFsPVQsIHdhcm5pbmc9Rn0NCiMgQ2VudHJpbmcgYnkgdHJhbnNsYXRpb24sIHN0YW5kYXJkaXplLg0KIyBPYmogaXMgdG8gcmVtb3ZlIGRpZmZlcmVuY2VzIGluIHNjYWxlIGR1ZQ0KIyBkdWUgdG8gZGlmZiBtYWduaXR1ZGVzIGJldHdlZW4gdmFyaWFibGVzDQp2YXJlY2hlbS5zdGFuZDwtZGVjb3N0YW5kKHZhcmVjaGVtLCdzdGFuZCcpDQp2YXJlY2hlbS5zdGFuZFsxOjUsMTo1XQ0KIyBtYWtpbmcgc3VyZSBgcm93U3VtcyBpcyB0aGUgc2FtZQ0KdmFyZXNwZWM8LWRlY29zdGFuZCh2YXJlc3BlYywndG90YWwnKQ0KYGBgDQoNCi0gRWNvbG9naWNhbGx5IG1vdGl2YXRlZCB0cmFuc29mcm1hdGlvbnMNCg0KYGBge3IsICBldmFsPVQsIHdhcm5pbmc9Rn0NCiMgTG93IHdlaWdodHMgdG8gdmFyaWFibGVzIHdpdGgNCiMgbG93IGNvdW50cyBhbmQgbWFueSB6ZXJvcw0KdmFyZXNwZWMuaGVsbDwtZGVjb3N0YW5kKHZhcmVzcGVjLCdoZWxsaW5nZXInKQ0KdmFyZXNwZWMuaGVsbFsxOjUsMTo1XQ0KYGBgDQoNCiMgKERpcylzaW1pbGFyaXRpZXMNCg0KTW9zdCBtZXRob2RzIG9mIG11bHRpdmFyaWF0ZSBhbmFseXNpcyBhcmUgKipleHBsaWNpdGx5Kiogb3IgKippbXBsaWNpdGx5KiogYmFzZWQgb24gdGhlIGNvbXBhcmlzb24gb2YgYWxsIHBvc3NpYmxlIHBhaXJzIG9mIG9iamVjdHMgb3IgZGVzY3JpcHRvcnMuDQoNCisgQ29tcGFyaXNvbiB0YWtlcyB0aGUgZm9ybSBvZiBhc3NvY2lhdGlvbiBtZWFzdXJlcyB3aGljaCBhcmUgYXNzZW1ibGVkIGluIGEgc3F1YXJlIGFuZCBzeW1tZXRyaWNhbCBhc3NvY2lhdGlvbiBtYXRyaXggb2YgZGltZW5zaW9uICRuJCB4ICRuJCB3aGVuIG9iamVjdHMgYXJlIGNvbXBhcmVkLCBvciAkcCQgeCAkcCQgd2hlbiB2YXJpYWJsZXMgYXJlIGNvbXBhcmVkLiANCg0KKyBXaGVuIHBhaXJzIG9mIG9iamVjdHMgYXJlIGNvbXBhcmVkLCB0aGUgYW5hbHlzaXMgaXMgc2FpZCB0byBiZSBpbiAqKlEgbW9kZSoqLldoZW4gcGFpcnMgb2YgZGVzY3JpcHRvcnMgYXJlIGNvbXBhcmVkLCB0aGUgYW5hbHlzaXMgaXMgc2FpZCB0byBiZSBpbiAqKlIgbW9kZSoqLg0KDQoNCjxjZW50ZXI+DQohW10oaWxsdXN0cmF0aW9ucy9tdWx0aV9tb2Rlcy5wbmcpe3dpZHRoPTUwJX0NCjwvY2VudGVyPg0KDQoNCkluICoqUiBtb2RlKiogY29ycmVsYXRpb24gdHlwZSBjb2VmZmljZW50cyBhcmUgY29tbW9ubHkgdXNlZC4gSW4gKipRKiogbW9kZSwgdGhlIGNob2ljZSBvZiBhIHN1aXRhYmxlICoqYXNzb2NpYXRpb24gY29lZmZpY2llbnQqKiBpcyBjcnVjaWFsIGZvciBmdXJ0aGVyIGFuYWx5c2lzLiBUaGV5IGFyZSAqKk1BTlkqKiBvZiBzdWNoIGNvZWZmaWNpZW50cyB3aXRoIG1hbnkgdmFyaWF0aW9ucy4gV2UgY2FuIGRpc3Rpbmd1aXNoZWQgdHdvIGNsYXNzZXMgb2YgYXNzb2NpYXRpb24gbWVhc3VyZXMgYmFzZWQgb24gaG93IHRoZXkgZGVhbCB3aXRoIHRoZSAqKmRvdWJsZS16ZXJvcyoqIHByb2JsZW0uDQoNCisgVGhlICoqc3ltbWV0cmljYWwgY29lZmZpY2llbnRzKiogd2lsbCBjb25zaWRlciB0aGUgaW5mb3JtYXRpb24gZnJvbSB0aGUgZG91YmxlLXplcm8gKGFsc28gY2FsbGVkICduZWdhdGl2ZSBtYXRjaGVkJykuDQoNClRoZSAqKnplcm8gdmFsdWUqKiBoYXMgdGhlICoqc2FtZSBtZWFuaW5nKiogYXMgYW55IG90aGVyIHZhbHVlcyAoKmUuZy4gMG1nL0wgb2YgTzIgaW4gZGVlcCBhbm94aWMgbGF5ZXIgb2YgYSBsYWtlKikgZHVyaW5nIHRoZSBjb21wYXJpc29uLiANCg0KKyBUaGUgKiphc3ltbWV0cmljYWwgY29lZmZpY2llbnRzKiogd2lsbCBpZ25vcmUgdGhlIGluZm9ybWF0aW9uIHNlbmQgZnJvbSB0aGUgZG91YmxlLXplcm8NCg0KVGhlICoqemVybyB2YWx1ZSoqIGluIG1hdHJpeCBvZiBzcGVjaWVzIGFidW5kYW5jZXMgKG9yIHByZXNlbmNlLWFic2VuY2UpIGNhbiAqKm5vdCoqIGFsd2F5cyBiZSBjb3VudGVkIGFzIGFuIGluZGljYXRpb24gb2YgKipyZXNlbWJsYW5jZSoqIChwcmVzZW5jZSBoYXMgYW4gZWNvbG9naWNhbCBtZWFuaW5nLCBidXQgbm8gY29uY2x1c2lvbnMgb24gdGhlIGFic2VuY2U6IGUuZy4gKmlzIHRoZSBhYnNlbmNlIG9mIGEgZ2l2ZW4gbmF0aW9uYWxpdHkgaW4gdGhpcyBjbGFzcyBtZWFucyB0aGF0IG5vIHN0dWRlbnRzIGZyb20gdGhpcyBzcGVjaWZpYyBjb3VudHJ5IGFyZSBpbiBOVFU/IEFuZCBpcyBpdCBhbiBlbGVtZW50IHRvIGV2YWx1YXRlIHRoZSBzaW1pbGFyaXR5IHdpdGggb3RoZXIgdW5pdmVyc2l0eSAoaGlnaCBzaW1pbGFyaXR5IGJlY2F1c2UgbWFueSBuYXRpb25hbGl0aWVzIHByb2JhYmx5IGFic2VudD8gTm8sIGJ1dCBhdCBzYW1lIHNhbXBsZSBzaXplIDEvMCBtYXkgYmVjb21lIGluZm9ybWF0aXZlKikNCiANCldoZW4gYW5hbHl6aW5nIHNwZWNpZXMgZGF0YSAob3Igb3RoZXIgZGF0YSBzZXQgd2l0aCBtYW55IDApLCBpdCBpcyBvZnRlbiByZWNvbW1lbmRlZCB0byB1c2UgYXN5bW1ldHJpY2FsIGNvZWZmaWNpZW50cyB1bmxlc3MgeW91IGhhdmUgcmVhc29uIHRvIGNvbnNpZGVyIGVhY2ggZG91YmxlIGFic2VuY2UgaW4gdGhlIG1hdHJpeCAoKmUuZy4gY29udHJvbGxlZCBleHBlcmltZW50IHdpdGgga25vd24gY29tbXVuaXR5IGNvbXBvc2l0aW9uIG9yIGVjb2xvZ2ljYWxseSBob21vZ2VuZW91cyBhcmVhcyB3aXRoIGRpc3R1cmJlZCB6b25lcyopDQoNCllvdSBjYW4gZG93bmxvYWQgYSBzcHJlYWRzaGVldCBbaGVyZV0oZG9jdW1lbnRzL2Rpc3RhbmNlLW1ldHJpY3MueGxzeCkgdG8gY2hlY2sgaG93IGEgZmV3IGNvbW1vbiBtZXRyaWNzIChCcmF5LUN1cnRpcywgQ2FuYmVycmEsIE1hbmhhdHRhbiwgRXVjbGlkZWFuICApIGFyZSBjb21wdXRlZC4gTWFueSBvZiB0aGUgY29tbW9uIGRpc3NpbWlsYXJpdHkgaW5kaWNlcyBjYW4gYmUgY29tcHV0ZWQgdXNpbmcgdGhlIGZ1bmN0aW9uIGB2ZWdkaXN0KClgIG9mICB0aGUgYHZlZ2FuYCBwYWNrYWdlLg0KDQojIyBTeW1tZXRyaWNhbCBjb2VmZmljaWVudHMgDQoNCioqRXVjbGlkZWFuIGRpc3RhbmNlKiogaXMgdGhlIG1vc3QgY29tbW9ubHktdXNlZCBvZiBvdXIgZGlzdGFuY2UgbWVhc3VyZXMuIEZvciB0aGlzIHJlYXNvbiwgRXVjbGlkZWFuIGRpc3RhbmNlIGlzIG9mdGVuIGp1c3QgdG8gcmVmZXJyZWQgdG8gYXMg4oCcZGlzdGFuY2XigJ0uIFdoZW4gZGF0YSBpcyBkZW5zZSBvciBjb250aW51b3VzLCB0aGlzIGlzIHRoZSBiZXN0IHByb3hpbWl0eSBtZWFzdXJlLiBUaGUgRXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gdHdvIHBvaW50cyBpcyB0aGUgbGVuZ3RoIG9mIHRoZSBwYXRoIGNvbm5lY3RpbmcgdGhlbS5UaGlzIGRpc3RhbmNlIGJldHdlZW4gdHdvIHBvaW50cyBpcyBnaXZlbiBieSB0aGUgUHl0aGFnb3JlYW4gdGhlb3JlbS4NCg0KJEVfZD1cc3FydHtcc3VtICh4X2kteV9qKV4yfSQNCg0KSGVyZSB0aGUgYWJ1bmRhbmNlIG9mIGEgc3BlY2llcyBmcm9tIG9uZSBzYW1wbGUgaXMgc3VidHJhY3RlZCBmcm9tIGl0cyBjb3VudGVycGFydCBpbiB0aGUgb3RoZXIgc2FtcGxlLiBJbnN0ZWFkIG9mIGlnbm9yaW5nIHRoZSBzaWduLCB0aGUgcmVzdWx0IGlzIHNxdWFyZWQgKHdoaWNoIGdpdmVzIGEgcG9zaXRpdmUgdmFsdWUuDQoNCmBgYHtyfQ0KZW52LmV1YzwtdmVnZGlzdCh2YXJlY2hlbS5zdGFuZCwgbWV0aG9kPSdldWMnKQ0KZW52LmV1Yw0KYGBgDQoNCkhlbGxpbmdlciB0cmFuc2Zvcm1hdGlvbiAoYW5kIENob3JkIHRyYW5zZm9ybWF0aW9uKSBhZGRyZXNzZXMgdGhlICoqZG91YmxlLXplcm9zKiogcHJvYmxlbSwgc28gdGhhdCBFdWNsaWRlYW4gZGlzdGFuY2UgY2FuIGJlIGNvbXB1dGVkIG9uIHNwZWNpZXMgZGF0YSBzZXQ6DQoNCmBgYHtyfQ0Kc3BlLmV1YzwtdmVnZGlzdCh2YXJlc3BlYy5oZWxsLCBtZXRob2Q9J2V1YycpDQpzcGUuZXVjDQpgYGANCg0KQ2hlY2sgeW91IGhhdmUgYSB0cmlhbmd1bGFyIG1hdHJpeC4NCg0KDQojIyBBc3ltbWV0cmljYWwgY29lZmZpY2llbnQNCg0KDQoqKkJyYXktQ3VydGlzKiogZGlzc2ltaWxhcml0eSBpcyB0aGUgKipnb2xkZW4qKiBkaXRhbmNlIG1ldHJpYyBpbiBlY29sb2d5LiBBdCBmaXJzdCwgeW91IHN1YnRyYWN0IHRoZSBhYnVuZGFuY2Ugb2Ygb25lIHNwZWNpZXMgaW4gYSBzYW1wbGUgZnJvbSBpdHMgY291bnRlcnBhcnQgaW4gdGhlIG90aGVyIHNhbXBsZSBidXQgaWdub3JlIHRoZSBzaWduLiBUaGUgc2Vjb25kIGNvbXBvbmVudCBpcyB0aGUgYWJ1bmRhbmNlIG9mIGEgc3BlY2llcyBpbiBvbmUgc2FtcGxlIGFkZGVkIHRvIHRoZSBhYnVuZGFuY2Ugb2YgaXRzIGNvdW50ZXJwYXJ0IGluIHRoZSBzZWNvbmQgc2FtcGxlLiBJZiBhIHNwZWNpZXMgaXMgYWJzZW50LCB0aGVuIGl0cyBhYnVuZGFuY2Ugc2hvdWxkIGJlIHJlY29yZGVkIGFzIDAgKHplcm8pLiANCg0KJEJDX2QgPSAgXGZyYWMge1xzdW0gfHhfaS14X2p8fXtcc3VtKHhfaSt4X2opfSQNCg0KYGBge3J9DQojIGRlZmF1bHQgb3B0aW9uIHVzaW5nIHZlZ2Rpc3QoKQ0Kc3BlLmJjPC12ZWdkaXN0KHZhcmVzcGVjKQ0Kc3BlLmJjDQpgYGANCg0KDQoqKkphY2NhcmQgU2ltaWxhcml0eSoqIGlzIHVzZWQgdG8gZmluZCBzaW1pbGFyaXRpZXMgYmV0d2VlbiBzZXRzIG9uIHRoZSBvbmx5IGJhc2Ugb2YgcHJlc2VuY2UgYW5kIGFic2VuY2UuIFRoZSBKYWNjYXJkIHNpbWlsYXJpdHkgYmV0d2VlbiB0d28gc2V0cyBcKCBBIFwpIGFuZCBcKCBCIFwpIGlzIGRlZmluZWQgYXM6DQoNClxbDQpKKEEsIEIpID0gXGZyYWN7fEEgXGNhcCBCfH17fEEgXGN1cCBCfH0NClxdDQoNCmBgYHtyfQ0KIyBKYWNjYXJkIGRpc3NpbWlsYXJpdHkgbWF0cml4IHVzaW5nIHZlZ2Rpc3QoKQ0Kc3BlLmpkIDwtIHZlZ2Rpc3QodmFyZXNwZWMsJ2phYycsYmluYXJ5PVQpICMgYmluYXJ5IHAvYSANCmBgYA0KDQpUaGlzIG1lYXN1cmUgaXMgIGltcG9ydGFudCB3aGVuIGNvbXBhcmluZyAkXGJldGEkLWRpdmVyc2l0eSBhbW9uZyBzaXRlcyBmb3IgZXhhbXBsZS4gT3RoZXIgZGlzdGFuY2VzIGFwcGx5aW5nIHRvIHByZXNlbmNlLUFic2VuY2UgZGF0YTogU8O4cmVuc2VuLCBPY2hpYWksIGV0Yy4gIA0KDQoNCioqTm90ZSoqOiBGb3IgbWl4ZWQgdHlwZXMgdmFyaWFibGVzLCBpbmNsdWRpbmcgY2F0ZWdvcmljYWwgb3IgcXVhbGl0YXRpdmUgbXVsdGljbGFzcyB2YXJpYWJsZXMgdXNlICoqR293ZXIncyBzaW1pbGFyaXR5KiouIEl0IGlzIGVhc2lseSBjb21wdXRlZCBpbiBSIHVzaW5nIGBkYWlzeWAgZnVuY3Rpb24gYnVpbHQgaW4gdGhlIGBjbHVzdGVyYCBwYWNrYWdlLiBBdm9pZCBgdmVnZGlzdGAgd2l0aCBgbWV0aG9kPSdnb3dlcidgLCB3aGljaCBpcyBhcHByb3ByaWF0ZSBmb3IgcXVhbnRpdGF0aXZlIGFuZCBwcmVzZW5jZS1hYnNlbmNlLCBidXQgbm90IGZvciBtdWx0aWNsYXNzIHZhcmlhYmxlcy4gT3ZlcmFsbCwgYGdvd2Rpc2AgZnJvbSB0aGUgcGFja2FnZSBgRkRgIGlzIHRoZSBtb3N0IGNvbXBsZXRlIGZ1bmN0aW9uIHRvIGNvbXB1dGUgR293ZXIncyBjb2VmZmljaWVudCBpbiBSLCBhbmQgY29tbW9ubHkgdXNlZCBpbiAqKnRyYWl0LWJhc2VkIGFwcHJvYWNoKiogYW5hbHlzZXMuIA0KDQojIyBWaXN1YWxpemF0aW9uDQoNCkFtb25nIHRoZSBtYW55IHdheXMgdG8gdmlzdWFsaXplIHNpbWlsYXJpdHkgbWF0cml4OiAgdGhlIGZ1bmN0aW9uIGBjb2xkaXNzYCAoQm9yY2FyZCBldCBhbC4gMjAxMSkgYW5kIHRoZSBwYWNrYWdlIGBxZ3JhcGhgIG9mZmVyIG5pY2Ugb3B0aW9uczoNCg0KLSBIZWF0IG1hcA0KDQpgYGB7ciwgIGV2YWw9VH0NCmNvbGRpc3Moc3BlLmJjLGJ5cmFuaz1GLGRpYWc9VCkNCmBgYA0KDQotIE5ldHdvcmsNCg0KYGBge3IsICBldmFsPVR9DQpxZ3JhcGgoMS1zcGUuYmMsIGxheW91dD0nc3ByaW5nJywgdnNpemU9NCkNCmBgYA0KDQoNCg0KPHAgY2xhc3M9ImNvbW1lbnQiPg0KKipQcmFjdGljZSA3LjUqKiBVc2luZyB0aGUgYHRpa3VzYCBkYXRhIHNldCBmcm9tIHRoZSBwYWNrYWdlIGBtdmFidW5kYCAtIGNoZWNrIGA/dGlrdXNgLiBTZWxlY3Qgb2JzZXJ2YXRpb24gZm9yIHRoZSB5ZWFyICAxOTgxLCAxOTgzLCBhbmQgMTk4NSBvbmx5IChub3RlZCBgODFgLCBgODNgIGFuZCBgODVgKS4gQnVpbGQgYSAgQnJheS1DdXJ0aXMgZGlzc2ltaWxhcml0eSBtYXRyaXggYW1vbmcgc2VsZWN0ZWQgb2JzZXJ2YXRpb25zLiBQbG90IGhlYXQgbWFwIG9mIHRoaXMgbWF0cml4LiBCdWlsZCBhIG5ldHdvcmsgb2YgKipTUEVDSUVTKiogY28tb2NjdXJyZW5jZSAocHJlc2VuY2UvYWJzZW5jZSkgYmFzZWQgb24geW91ciBzZWxlY3Rpb24gb2YgeWVhcnMuDQo8L3A+DQoNCiMgQ2x1c3RlcmluZw0KDQpXZSBvZnRlbiBhaW0gdG8gcmVjb2duaXplIGRpc2NvbnRpbnVvdXMgKipzdWJzZXRzKiogaW4gYW4gZW52aXJvbm1lbnQgd2hpY2ggaXMgcmVwcmVzZW50ZWQgYnkgZGlzY3JldGUgKGUuZy4gdGF4b25vbWljKSBjaGFuZ2VzIGJ1dCAgcGVyY2VpdmVkIGFzIGNvbnRpbnVvdXMgY2hhbmdlcyBpbiBlY29sb2d5Lg0KDQoqKkNsdXN0ZXJpbmcqKiBjb25zaXN0cyBpbiBwYXJ0aXRpb25pbmcgdGhlIGNvbGxlY3Rpb24gb2Ygb2JqZWN0cyAob3IgZGVzY3JpcHRvcnMgaW4gUi1tb2RlKS4gQ2x1c3RlcmluZyAqKmRvZXMgbm90IHRlc3QqKiBhbnkgaHlwb3RoZXNpcy4NCg0KKipDbHVzdGVyaW5nKiogaXMgYW4gZXhwbGFuYXRvcnkgcHJvY2VkdXJlIHdoaWNoIGhlbHBzIHRvIHVuZGVyc3RhbmQgZGF0YSB3aXRoIGNvbXBsZXggc3RydWN0dXJlIGFuZCBtdWx0aXZhcmlhdGUgcmVsYXRpb25zaGlwcywgYW5kIGlzIGEgdmVyeSB1c2VmdWwgbWV0aG9kIHRvIGV4dHJhY3Qga25vd2xlZGdlIGFuZCBpbmZvcm1hdGlvbiBlc3BlY2lhbGx5IGZyb20gbGFyZ2UgZGF0YXNldHMuDQoNCk1hbnkgKipjbHVzdGVyaW5nKiogYXBwcm9hY2hlcyByZWx5IG9uIGFzc29jaWF0aW9uIG1hdHJpeCwgd2hpY2ggc3RyZXNzZXMgb24gdGhlICoqaW1wb3J0YW5jZSoqIG9mIHRoZSByaWdodCBjaG9pY2Ugb2YgYW4gYXBwcm9wcmlhdGUgYXNzb2NpYXRpb24gY29lZmZpY2llbnQuDQoNClRoZSBkZWZpbml0aW9uIG9mIGEgY2x1c3RlciB2YXJpZXMsIGFuZCBkaWZmZXJlbnQgY2x1c3RlciBhbmFseXNpcyB0ZWNobmlxdWVzIG1heSBhcHByb2FjaCB0aGUgcHJvYmxlbSB2ZXJ5IGRpZmZlcmVudGx5LiBXZSByZWNvZ25pemUgZGlmZmVyZW50IGZhbWlsaWVzIG9mIGNsdXNlcmluZzoNCg0KDQoxLiAqKlNlcXVlbnRpYWwqKiBvciAqKlNpbXVsdGFuZW91cyoqIGFsZ29yaXRobXMgKG1vc3Qgb2YgdGhlIGNsdXN0ZXJpbmcgYWxnb3JpdGhtKQ0KDQoyLiAqKkFnZ2xvbWVyYXRpdmUqKiBvciAqKkRpdmlzaXZlKioNCg0KMy4gKipNb25vdGhldGljKiogKGNsdXN0ZXIgbWVtYmVycyB3aXRoIGNvbW1vbiBwcm9wLikgdmVyc3VzICoqUG9seXRoZXRpYyoqIChkaXN0YW5jZSBiZXR3ZWVuIGVsZW1lbnRzIGRlZmluZXMgbWVtYmVyc2hpcCkNCg0KNC4gKipIaWVyYXJjaGljYWwqKiB2ZXJzdXMgKipOb24taGllcmFyY2hpY2FsKiogKGZsYXQpDQoNCjUuICoqUHJvYmFiaWxpc3RpYyoqIChkZWNpc2lvbiB0cmVlKSB2ZXJzdXMgKipub24tcHJvYmFiaWxpc3RpYyoqIG1ldGhvZHMNCg0KNi4gKipIYXJkKiogYW5kICoqU29mdCoqIChtYXkgb3ZlcmxhcCkNCg0KTnVtZXJpY2FsIGNsYXNzaWZpY2F0aW9uIG9mdGVuIHJlcXVpcmVzIHR3byBhcmd1bWVudHM6IHRoZSBtYXRyaXggb2YgZGlzdGFuY2VzIGFtb25nIHNhbXBsZXMgKGVjb2xvZ2ljYWwgcmVzZW1ibGFuY2UpIGFuZCB0aGUgbWV0aG9kIHRvIHVzICplLmcuKjogbmFtZSBvZiB0aGUgY2x1c3RlcmluZyBhbGdvcml0aG0uICBDbHVzdGVyaW5nIHByb2R1Y2VzIHRyZWUtbGlrZSBzdHJ1Y3R1cmUuIEFnYWluIGJlIGNhcmVmdWwgb2YgKipkYXRhIGRyZWRnaW5nKiouIFlvdSBkb24ndCBjaG9vc2UgY2x1c3RlcmluZyBtZXRob2QgYWNjb3JkaW5nIHRvIGhvdyB5b3VyIHRyZWUgbG9va3MgbGlrZS5UaGUgc3VpdGFibGUgbWV0aG9kIGlzIHVzdWFsbHkgY2FyZWZ1bGx5ICoqc2VsZWN0ZWQqKiBhbmQvb3IgKipldmFsdWF0ZWQqKiBhY2NvcmRpbmcgdG8gdGhlIGRhdGEgc2V0IHlvdSBhcmUgZGVhbGluZyB3aXRoIGFuZCB5b3VyIGluaXRpYWwgaHlwb3RoZXNlcyAoc29tZSBtYXkgbm90IG1ha2Ugc2Vuc2UpLiBCZWxvdyB3ZSB3aWxsIGRlc2NyaWJlIHR3byB3aWRlbHktdXNlZCBhcHByb2FjaGVzIG9mIGNsdXN0ZXJpbmcuIFdlIHdpbGwgYXNsbyBwbGFudCBzb21lIHNlZWRzIC4uLg0KDQojIyBIaWVyYXJjaGljYWwgQ2x1c3RlcmluZw0KDQpIaWVyYXJjaGljYWwgY2x1c3RlciBhbmFseXNpcyBtYXkgYmUgcGVyZm9ybWVkIHVzaW5nIGFuICJvYmplY3QgeCBvYmplY3QiIG1hdHJpeCBvZiAoZGlzKXNpbWlsYXJpdGllcyBvciBkaXN0YW5jZXMuIEl0IGF0dGVtcHRzIHRvIGZpbmQgYSBnb29kLCBhbHRob3VnaCBwZXJoYXBzIG5vdCB0aGUgYmVzdCwgZ3JvdXBpbmcgb2Ygb2JqZWN0cyBiYXNlZCBvbiB0aGUgZGlzdGFuY2VzIHN1cHBsaWVkIGluIGEgaGllcmFyY2hpY2FsIG1hbm5lciwgZmlyc3QgZ3JvdXBpbmcgb2JqZWN0cyB3aXRoIHRoZSBsb3dlc3QgZGlzc2ltaWxhcml0aWVzIGJlZm9yZSBwcm9jZWVkaW5nLiBUaGVyZWZvcmUgZ3JvdXBpbmcgbWF5IGJlIHByZXNlbnRlZCBhcyBhIGRlbmRyb2dyYW0uIE1hbnkgb2YgdGhlc2UgYWxnb3JpdGhtcyBhcmUgZ3JlZWR5IChpLmUuIHRoZSBvcHRpbWFsIGxvY2FsIHNvbHV0aW9uIGlzIGFsd2F5cyB0YWtlbiBpbiB0aGUgaG9wZSBvZiBmaW5kaW5nIGFuIG9wdGltYWwgZ2xvYmFsIHNvbHV0aW9uKSBhbmQgaGV1cmlzdGljLCByZXF1aXJpbmcgdGhlIHJlc3VsdHMgb2YgY2x1c3RlciBhbmFseXNpcyB0byBiZSBldmFsdWF0ZWQgZm9yIHN0YWJpbGl0eSBieSwgZm9yIGV4YW1wbGUsIGJvb3RzdHJhcHBpbmcgcHJvY2VkdXJlcy4NCg0KQWdnbG9tZXJhdGl2ZSBjbHVzdGVyaW5nIGlzIGEgd2lkZXNwcmVhZCBhcHByb2FjaCBpbiBoaWVyYXJjaGljYWwgY2x1c3RlciBhbmFseXNpcy4gQWdnbG9tZXJhdGl2ZSBhbGdvcml0aG1zIHN1Y2Nlc3NpdmVseSBtZXJnZSBpbmRpdmlkdWFsIGVudGl0aWVzIGFuZCBjbHVzdGVycyB0aGF0IGhhdmUgdGhlIGhpZ2hlc3Qgc2ltaWxhcml0eSB2YWx1ZXMuIFRoZXNlIHR5cGljYWxseSB1c2UgYSBsaW5rYWdlIGNyaXRlcmlvbiAgdG8gZGV0ZXJtaW5lIHRoZSAoZGlzKXNpbWlsYXJpdHkgdmFsdWVzIGZvciBjbHVzdGVycyBmb3JtZWQgZHVyaW5nIHRoZSBhbGdvcml0aG0ncyBleGVjdXRpb24uIFRoZXNlIGFyZSB2YWxpZCBib3RoIGZvciB0aGUgY2x1c3RlcmluZyBvZiBvYmplY3RzIGFuZCBvZiB2YXJpYWJsZXMgcHJvdmlkZWQgc29tZSBtZWFzdXJlIG9mIChkaXMpc2ltaWxhcml0eTsgaG93ZXZlciwgbm90ZSBvdGhlciBjbHVzdGVyaW5nIHRlY2huaXF1ZXMgbWF5IG5vdCBzaGFyZSB0aGlzIGZsZXhpYmlsaXR5LiBBZ2dsb21lcmF0aXZlIGFsZ29yaXRobXMgZW5kIHdoZW4gYWxsIHRoZSBpbmRpdmlkdWFsIGVudGl0aWVzIGFuZCBjbHVzdGVycyBoYXZlIGJlZW4gbWVyZ2VkIGludG8gYSBzaW5nbGUgY2x1c3Rlci4gQmVsb3cgc29tZSBjb21tb24gbGlua2FnZSBjcml0ZXJpYSBhcmUgc3VtbWFyaXNlZC4gDQoNCkluIFIsIHRoZSBmdW5jdGlvbiBgaGNsdXN0KClgIGFsbG93cyB0byBpbXBsZW1lbnQgc29tZSBvZiB0aGUgY29tbW9uIGhpZXJhcmNoaWNhbCBjbHVzdGVyaW5nIGFsZ29yaXRobXMuIGBwdmNsdXN0KClgIGZyb20gdGhlIGBwdmNsdXN0YCBhbGxvd3MgYm9vdHN0cmFwcGluZyBhbmQgaW5kaWNhdGlvbiBvZiBoaWdobHkgc3VwcG9ydGVkIGNsdXN0ZXJzIHdpdGggYHB2cmVjdCgpYC4NCg0KIyMjIENvbW1vbiBhbGdvcml0aG1zDQoNCg0KKipTSU5HTEUgTElOS0FHRSBBR0dMT01FUkFUSVZFIENMVVNURVJJTkcqKiAobmVpZ2hib3Igc29ydGluZykNCg0KU2luZ2xlIGxpbmthZ2UgYWxsb3dzIG9iamVjdCB0byBhZ2dsb21lcmF0ZSBlYXNpbHkgdG8gYSBncm91cCBzaW5jZSBhIGxpbmsgdG8gYSBzaW5nbGUgb2JqZWN0IG9mIHRoZSBncm91cCBzdWZmaWNlcyB0byBpbmR1Y2UgZnVzaW9uLiAqKlRoaXMgaXMgdGhlICdjbG9zZXN0JyBmcmllbmQnIHByb2NlZHVyZSoqLg0KDQogIC0gY29tbW9ubHkgcHJvZHVjZWQgY2hhaW4gZGVuZHJvZ3JhbXM6IGEgcGFpciBpcyBsaW5rZWQgdG8gYSB0aGlyZCBvYmplY3QNCiAgDQogIC0gYWdnbG9tZXJhdGVzIG9iamVjdHMgb24gdGhlIGJhc2lzIG9mIHRoZWlyIHNob3J0ZXN0IHBhaXJ3aXNlIGRpc3RhbmNlDQogIA0KICAtIHBhcnRpdGlvbnMgZGlmZmljdWx0IHRvIGludGVycHJldCwgYnV0IGdyYWRpZW50cyBxdWl0ZSBjbGVhcg0KICANCiAgDQpUaGUgYGRvdWJzYCBkYXRhc2V0IChgYWRlNGAgcGFja2FnZSkgZ2l2ZXMgZW52aXJvbm1lbnRhbCB2YXJpYWJsZXMsIGZpc2ggc3BlY2llcyBhbmQgc3BhdGlhbCBjb29yZGluYXRlcyBmb3IgMzAgc2l0ZXMgYWxvbmcgYSByaXZlci4gDQogIA0KYGBge3IgY2xhc3Muc291cmNlID0gImZvbGQtc2hvdyIsIGV2YWw9VCwgd2FybmluZz1GfQ0KIyBTdGVwIDE6IGRhdGFzZXQNCiMgP2RvdWJzDQpkYXRhKGRvdWJzKQ0Kc3BlLmRiPC1kb3VicyRmaXNoDQpzcGEuZGI8LWRvdWJzJHh5DQojIHJlbW92ZSBlbXB0eSBzYW1wbGUgOCBmcm9tIGJvdGggZGF0YXNldHMNCnNwZS5kYiA8LXNwZS5kYlstOCxdDQpzcGEuZGI8LSBzcGEuZGJbLTgsXQ0KIyBTdGVwIDI6IGNob3JkIGRpc3RhbmNlID0gbm9ybWFsaXphdGlvbiArIGV1Y2xpZGVhbg0Kc3BlLmRiLm5vcm08LWRlY29zdGFuZChzcGUuZGIsJ25vcm1hbGl6ZScpIA0Kc3BlLmRiLmNoPC12ZWdkaXN0KHNwZS5kYi5ub3JtLCdldWMnKSANCiMgU3RlcCAzOiBzaW5nbGUgbGlua2FnZSBhZ2dsb21lcmF0aXZlIGNsdXN0ZXJpbmcNCnNwZS5kYi5jaC5zaW5nbGUgPC1oY2x1c3Qoc3BlLmRiLmNoLG1ldGhvZD0nc2luZ2xlJykgDQojIFN0ZXAgNDogcGxvdCBkZW5kcm9ncmFtDQpgYGANCg0KQXBwbHkgd2VsbCBmb3IgZXhhbWluaW5nIGNoYW5nZSBpbiBzcGVjaWVzIGNvbXBvc2l0aW9uIGFsb25nIGVudmlyb25tZW50YWwgZ3JhZGllbnRzLiANCg0KKipDT01QTEVURSBMSU5LQUdFIEFHR0xPTUVSQVRJVkUgQ0xVU1RFUklORyoqIChmdXJ0aGVzdCBuZWlnaGJvciBzb3J0aW5nKQ0KDQpBIGdyb3VwIGFkbWl0cyBhIG5ldyBtZW1iZXIgb25seSBhdCB0aGUgZGlzdGFuY2UgY29ycmVzcG9uZGluZyB0byB0aGUgZnVydGhlc3Qgb2JqZWN0IG9mIHRoZSBncm91cDogKipvbmUgY291bGQgc2F5IHRoYXQgdGhlIGFkbWlzc2lvbiByZXF1aXJlcyB1bmFuaW1pdHkgb2YgdGhlIGdyb3VwKiouDQoNCiAgLSBkZW5kcm9ncmFtcyBsb29rIGEgYml0IGxpa2UgcmFrZXMg4oCTIHNvbWUgY2x1c3RlciBtZXJnZSB0b2dldGhlciBhdCB0aGUgaGlnaGVzdCBkaXNzaW1pbGFyaXR5DQoNCiAgLSBhbGxvdyBhbiBvYmplY3QgKG9yIGEgZ3JvdXApIHRvIGFnZ2xvbWVyYXRlIHdpdGggYW5vdGhlciBncm91cCBvbmx5IGF0IHRoZSBkaXN0YW5jZSBjb3JyZXNwb25kaW5nIHRvIHRoYXQgb2YgdGhlIG1vc3QgZGlzdGFudCBwYWlyIG9mIG9iamVjdHMgDQoNCmBgYHtyIGNsYXNzLnNvdXJjZSA9ICJmb2xkLXNob3ciLCBldmFsPVQsIHdhcm5pbmc9Rn0NCnNwZS5kYi5jaC5jb21wbGV0ZTwtaGNsdXN0KHNwZS5kYi5jaCxtZXRob2Q9J2NvbXBsZXRlJykgDQpgYGANCg0KKipBVkVSQUdFIEFHR0xPTUVSQVRJVkUgQ0xVU1RFUklORyoqIChlLmcuIFVQR01BKQ0KDQpUaGUgKiptb3N0IGNvbW1vbioqIG1ldGhvZCBpbiBlY29sb2d5IChzcGVjaWVzIGRhdGEpLiBJdCBjb21wcmlzZXMgKipmb3VyIHN1Yi1tZXRob2RzKiogdGhhdCBhcmUgYmFzZWQgb24gKiphdmVyYWdlKiogb3IgKiptZWRpYW4qKiBkaXNzaW1pbGFyaXRpZXMgYW1vbmcgb2JqZWN0cywgICoqY2VudHJvaWRzKiogb2YgY2x1c3Rlciwgb3IgKipNY1F1aXR0eSoqJ3MgbWV0aG9kLiANCiAgDQo8Y2VudGVyPg0KIVtdKGlsbHVzdHJhdGlvbnMvbXVsdGlfdXBnbWEucG5nKXt3aWR0aD03NSV9DQo8L2NlbnRlcj4NCg0KYGBge3IgY2xhc3Muc291cmNlID0gImZvbGQtc2hvdyIsIGV2YWw9VCwgd2FybmluZz1GfQ0Kc3BlLmRiLmNoLlVQR01BPC1oY2x1c3Qoc3BlLmRiLmNoLG1ldGhvZD0nYXZlcmFnZScpIA0KYGBgDQoNCioqV0FSRCdTIE1JTklNVU0gVkFSSUFOQ0UgQ0xVU1RFUklORyoqDQoNCioqV2FyZCoqIG1ldGhvZCBpcyBhbHNvIGEgZmF2b3JpdGUgIGNsdXN0ZXJpbmcgbWV0aG9kLiBVbmxpa2UgdGhlIG90aGVycywgaW5zdGVhZCBvZiBtZWFzdXJpbmcgdGhlIGRpc3RhbmNlIGRpcmVjdGx5LCBpdCBhbmFseXplcyB0aGUgdmFyaWFuY2Ugb2YgY2x1c3RlcnMuIFdhcmTigJlzIGlzIHNhaWQgdG8gYmUgdGhlIG1vc3Qgc3VpdGFibGUgbWV0aG9kIGZvciBxdWFudGl0YXRpdmUgdmFyaWFibGVzLiBJdCBpcyBiYXNlZCBvbiBsaW5lYXIgbW9kZWwgY3JpdGVyaW9uIG9mIGxlYXN0IHNxdWFyZTogdGhlIHdpdGhpbi1ncm91cCBzdW0gb2Ygc3F1YXJlIGlzIG1pbmltaXplZC4NCiANCmBgYHtyIGNsYXNzLnNvdXJjZSA9ICJmb2xkLXNob3ciLCBldmFsPVQsIHdhcm5pbmc9Rn0NCnNwZS5kYi5jaC53YXJkPC1oY2x1c3Qoc3BlLmRiLmNoLG1ldGhvZD0nd2FyZC5EJykgDQpgYGANCg0KKipOb3RlKio6IFdhcmQgbWV0aG9kIGlzIGJhc2VkIG9uIEV1Y2xpZGVhbiBtb2RlbC4gSXQgc2hvdWxkIG5vdCBiZSBjb21iaW5lZCB3aXRoIGRpc3RhbmNlIG1lYXN1cmVzLCB3aGljaCBhcmUgbm90IHN0cmljdGx5IG1ldHJpYyBzdWNoIGFzIHRoZSBwb3B1bGFyIEJyYXktQ3VydGlzIGRpc3RhbmNlLg0KDQoNCmBgYHtyIGNsYXNzLnNvdXJjZSA9ICJmb2xkLXNob3ciLCBldmFsPVQsIHdhcm5pbmc9Rn0NCnBhcihtZnJvdyA9IGMoMiwgMikpDQpwbG90KHNwZS5kYi5jaC5zaW5nbGUsIG1haW49J1NpbmdsZSBsaW5rYWdlIGFnZ2xvbWVyYXRpdmUgY2x1c3RlcmluZycgKSANCnBsb3Qoc3BlLmRiLmNoLmNvbXBsZXRlLCBtYWluPSdDb21wbGV0ZSBsaW5rYWdlIGFnZ2xvbWVyYXRpdmUgY2x1c3RlcmluZycpIA0KcGxvdChzcGUuZGIuY2guVVBHTUEsIG1haW49J0F2ZXJhZ2UgKFVQR01BKSBhZ2dsb21lcmF0aXZlIGNsdXN0ZXJpbmcnKSANCnBsb3Qoc3BlLmRiLmNoLndhcmQsIG1haW49J1dhcmQgY2x1c3RlcmluZycpDQpgYGANCg0KIyMjIENsdXN0ZXJpbmcgcXVhbGl0eQ0KDQpUaGVyZSBhcmUgbWFueSB3YXlzIHRvIGV2YWx1YXRlIHRoZSBvdmVyYWxsIHF1YWxpdHkgb2YgdGhlIGNob3NlIGNsdXN0ZXJpbmcgYWxnb3JpdGhtcyBhbmQgdGhlcmVmb3JlIG9mIHRoZWlyIHJlcHJlc2VudGF0aW9ucy4NCg0KKyB0aGUgKipjb3BoZW5ldGljIGNvcnJlbGF0aW9uKiogcmVsYXRlZCBkaXN0YW5jZXMgZXh0cmFjdGVkIGZyb20gdGhlIGRlbmRyb2dyYW0gKGZ1bmN0aW9uIGBjb3BoZW5ldGljYCBvbiBhIGBoY2x1c3RgIG9iamVjdCkgd2l0aCBkaXRhbmNlcyBpbiBvdXIgb3JpZ2luYWwgZGlzdGFuY2UgbWF0cmljZXMuIEEgaGlnaGVyIGNvcnJlbGF0aW9uIG1lYW5zIGEgYmV0dGVyIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBpbml0aWFsIG1hdHJpeC4gDQoNCg0KYGBge3IgY2xhc3Muc291cmNlID0gImZvbGQtc2hvdyIsIGV2YWw9VCwgd2FybmluZz1GfQ0KIyBTaW5nbGUgbGlua2FnZSBjbHVzdGVyaW5nDQpzcGUuZGIuY2guc2luZ2xlLmNvcGggPC0gY29waGVuZXRpYyAoc3BlLmRiLmNoLnNpbmdsZSkNCmNvcihzcGUuZGIuY2gsc3BlLmRiLmNoLnNpbmdsZS5jb3BoKQ0KDQojIGNvbXBsZXRlIGxpbmthZ2UgY2x1c3RlcmluZw0Kc3BlLmRiLmNoLmNvbXBsZXRlLmNvcGggPC0gY29waGVuZXRpYyAoc3BlLmRiLmNoLmNvbXBsZXRlKQ0KY29yKHNwZS5kYi5jaCxzcGUuZGIuY2guY29tcGxldGUuY29waCkNCg0KIyBBdmVyYWdlIGNsdXN0ZXJpbmcNCnNwZS5kYi5jaC5VUEdNQS5jb3BoIDwtIGNvcGhlbmV0aWMgKHNwZS5kYi5jaC5VUEdNQSkNCmNvcihzcGUuZGIuY2gsc3BlLmRiLmNoLlVQR01BLmNvcGgpDQoNCiMgV2FyZCBjbHVzdGVyaW5nDQpzcGUuZGIuY2gud2FyZC5jb3BoIDwtIGNvcGhlbmV0aWMgKHNwZS5kYi5jaC53YXJkKQ0KY29yKHNwZS5kYi5jaCxzcGUuZGIuY2gud2FyZC5jb3BoKQ0KYGBgDQoNClVQR01BIHBlcmZvcm1zIGJldHRlciBhdCByZXRhaW5pbmcgaW5mb3JtYXRpb24gb2Ygb3VyIGluaXRpYWwgY2hvcmQgZGlzdGFuY2UgbWF0cml4Lg0KDQoqIHRoZSAqKnNoZXBhcmQtbGlrZSBkaWFncmFtKiogaXMgYSBwbG90IHRoYXQgcmVwcmVzZW50cyBvcmdpbmFsIGRpc3RhbmNlcyBhZ2FpbnN0IHRoZSBjb3BoZW50aWMgZGlzdGFuY2VzLiBDYW4gYmUgY29tYmluZWQgd2l0aCBjb3Bob25ldGljIGNvcnJlbGF0aW9uIHNlZW4gYWJvdmUuIA0KDQoNCmBgYHtyIGNsYXNzLnNvdXJjZSA9ICJmb2xkLXNob3ciLCBldmFsPVQsIHdhcm5pbmc9Rn0NCnBhcihtZnJvdz1jKDIsMikpDQoNCnBsb3Qoc3BlLmRiLmNoLHNwZS5kYi5jaC5zaW5nbGUuY29waCx4bGFiPSdDaG9yZCBkaXN0YW5jZScseWxhYj0nQ2hvcGhlbmV0aWMgZGlzdGFuY2UnLGFzcD0xLCBtYWluPWMoJ1NpbmdsZSBsaW5rYWdlJyxwYXN0ZSgnQ29waGVuZXRpYyBjb3JyZWxhdGlvbicscm91bmQoY29yKHNwZS5kYi5jaCxzcGUuZGIuY2guc2luZ2xlLmNvcGgpLDMpKSkpDQphYmxpbmUgKDAsMSkNCmxpbmVzKGxvd2VzcyhzcGUuZGIuY2gsc3BlLmRiLmNoLnNpbmdsZS5jb3BoKSxjb2w9J3JlZCcpDQoNCnBsb3Qoc3BlLmRiLmNoLHNwZS5kYi5jaC5jb21wbGV0ZS5jb3BoLHhsYWI9J0Nob3JkIGRpc3RhbmNlJyx5bGFiPSdDaG9waGVuZXRpYyBkaXN0YW5jZScsYXNwPTEsIG1haW49YygnQ29tcGxldGUgbGlua2FnZScscGFzdGUoJ0NvcGhlbmV0aWMgY29ycmVsYXRpb24nLHJvdW5kKGNvcihzcGUuZGIuY2gsIHNwZS5kYi5jaC5jb21wbGV0ZS5jb3BoKSwzKSkpKQ0KYWJsaW5lICgwLDEpDQpsaW5lcyhsb3dlc3Moc3BlLmRiLmNoLCBzcGUuZGIuY2guY29tcGxldGUuY29waCksY29sPSdyZWQnKQ0KDQpwbG90KHNwZS5kYi5jaCxzcGUuZGIuY2guVVBHTUEuY29waCx4bGFiPSdDaG9yZCBkaXN0YW5jZScseWxhYj0nQ2hvcGhlbmV0aWMgZGlzdGFuY2UnLGFzcD0xLCBtYWluPWMoJ1VQR01BJyxwYXN0ZSgnQ29waGVuZXRpYyBjb3JyZWxhdGlvbicscm91bmQoY29yKHNwZS5kYi5jaCxzcGUuZGIuY2guVVBHTUEuY29waCksMykpKSkNCmFibGluZSAoMCwxKQ0KbGluZXMobG93ZXNzKHNwZS5kYi5jaCxzcGUuZGIuY2guVVBHTUEuY29waCksY29sPSdyZWQnKQ0KDQpwbG90KHNwZS5kYi5jaCxzcGUuZGIuY2gud2FyZC5jb3BoLHhsYWI9J0Nob3JkIGRpc3RhbmNlJyx5bGFiPSdDaG9waGVuZXRpYyBkaXN0YW5jZScsYXNwPTEsIG1haW49YygnV2FyZCBjbHVzdGVyaW5nJyxwYXN0ZSgnQ29waGVuZXRpYyBjb3JyZWxhdGlvbicscm91bmQoY29yKHNwZS5kYi5jaCxzcGUuZGIuY2gud2FyZC5jb3BoKSwzKSkpKQ0KYWJsaW5lICgwLDEpDQpsaW5lcyhsb3dlc3Moc3BlLmRiLmNoLHNwZS5kYi5jaC53YXJkLmNvcGgpLGNvbD0ncmVkJykNCmBgYA0KDQojIyMgQ2x1c3RlciBncm91cHMNCg0KQnkgc2ltcGx5IHdhdGNoaW5nIGEgZGVuZHJvZ3JhbSwgdGhlIG51bWJlciBvZiBncm91cHMgb3IgcGFydGl0aW9uIHRvIGludGVycHJldCBpcyBoaWdobHkgc3ViamVjdGl2ZS4gTGV0J3MgcmVwZWF0IHRoZSBzdGVwIGFib3ZlIGZvciB0aGUgYHZhcmVzcGVjYCBkYXRhIHNldC4gVGhlIFVQR00gdHJlZSBhbHNvIGNhbWUgb3V0IGF0IHRoZSBkZW5kcm9nYW1tIHJldGFpbmluZyB0aGUgYmVzdCBpbmZvcm1hdGlvbiBmcm9tIG91ciBicmF5LWN1cnRpcyBkaXNzaW1pbGFyaXR5IG1hdHJpeC4NCg0KYGBge3J9DQpzcGUuYmMuVVBHTUE8LWhjbHVzdChzcGUuYmMsbWV0aG9kPSdhdmVyYWdlJykgDQpwbG90KHNwZS5iYy5VUEdNQSwgbWFpbj0nQXZlcmFnZSAoVVBHTUEpIGFnZ2xvbWVyYXRpdmUgY2x1c3RlcmluZycpIA0KcmVjdC5oY2x1c3Qoc3BlLmJjLlVQR01BLCBrPTMsIGJvcmRlcj0icmVkIikNCnJlY3QuaGNsdXN0KHNwZS5iYy5VUEdNQSwgaz02LCBib3JkZXI9ImJsdWUiKQ0KcmVjdC5oY2x1c3Qoc3BlLmJjLlVQR01BLCBrPTgsIGJvcmRlcj0iZ3JlZW4iKQ0KYGBgDQoNClNvbHV0aW9uIGF0IDMsIDUsIDg/IFRoZXkgYXJlIG1ldGhvZHMgdGhhdCBjYW4gZ3VpZGUgeW91IGF0IHNlbGVjdGluZyBhIHJlbGV2YW50IG51bWJlciBvZiBncm91cHMgLSBhZ2FpbiBkYW5nZXIgb2YgZGF0YSBkcmVkZ2luZyENCg0KKyAqKkZ1c2lvbiBMZXZlbCB2YWx1ZXMqKg0KDQpUaGUgcGxvdCBvZiB0aGUgKipGdXNpb24gTGV2ZWwgVmFsdWVzKiogaXMgZnVydGhlciB1c2VkIGEgZGlhZ25vc3RpYyBvZiBpbnRlcnByZXRhYmxlIGNsdXN0ZXIgZ3JvdXBzLiBJdCBleGFtaW5lcyB2YWx1ZXMgd2hlcmUgYSBmdXNpb24gYmV0d2VlbiB0d28gYnJhbmNoZXMgb2YgYSBkZW5kcm9ncmFtIG9jY3Vycy4gDQoNCmBgYHtyIGNsYXNzLnNvdXJjZSA9ICJmb2xkLXNob3ciLCBldmFsPVQsIHdhcm5pbmc9Rn0NCnBsb3Qoc3BlLmJjLlVQR01BJGhlaWdodCwgbnJvdyh2YXJlc3BlYyk6MiwgDQogICAgIHR5cGU9J1MnLG1haW49J0Z1c2lvbiBsZXZlbHMgLSBicmF5LWN1cnRpcyAtIFVQR01BJywNCiAgICAgeWxhYj0nayAobnVtYmVyIG9mIGNsdXN0ZXJzKScsIHhsYWI9J2ggKG5vZGUgaGVpZ2h0KScsIGNvbD0nZ3JleScpDQp0ZXh0IChzcGUuYmMuVVBHTUEkaGVpZ2h0LG5yb3codmFyZXNwZWMpOjIsIG5yb3codmFyZXNwZWMpOjIsIGNvbD0ncmVkJywgY2V4PTAuOCkNCmBgYA0KDQpUaGUgZ3JhcGggb2YgZnVzaW9uIGxldmVsIHZhbHVlcyBzaG93cyBjbGVhciBqdW1wIG9mIGZ1c2lvbiB2YWx1ZXMgYmV0d2VlbiAzLTQgIGFuZCA2LTcgcGFydGl0aW9ucy4gIA0KDQoNCisgVGhlICoqU2lsaG91ZXR0ZSoqIHdpZHRocyBpbmRpY2F0b3IgKGFsc28gYXBwbHkgZm9yIG5vbi1oaWVyYXJjaGljYWwgY2x1c3RlcmluZykNCg0KVGhlIHNpbGhvdWV0dGUgd2lkdGggaXMgYSBtZWFzdXJlIG9mIHRoZSAqKmRlZ3JlZSBvZiBtZW1iZXJzaGlwIG9mIGFuIG9iamVjdCB0byBpdHMgY2x1c3RlcioqIGJhc2VkIG9uIHRoZSBhdmVyYWdlIGRpc3RhbmNlIGJldHdlZW4gdGhpcyBvYmplY3QNCmFuZCBhbGwgb2JqZWN0cyBvZiB0aGUgY2x1c3RlciB0byB3aGljaCBpcyBiZWxvbmdzLCBjb21wYXJlZCB0byB0aGUgc2FtZSBtZWFzdXJlIGZvciB0aGUgbmV4dCBjbG9zZXN0IGNsdXN0ZXIuIFNpbGhvdWV0dGUgd2lkdGhzIHJhbmdlIGZyb20gLTEgdG8gMSBhbmQgY2FuIGJlIGF2ZXJhZ2VkIG92ZXIgYWxsIG9iamVjdHMgb2YgYSBwYXJ0aXRpb24uIFRoZSBncmVhdGVyIHRoZSB2YWx1ZSBpcywgdGhlIGJldHRlciB0aGUgb2JqZWN0IGlzIGNsdXN0ZXJlZC4gTmVnYXRpdmUgdmFsdWVzIG1lYW4gdGhhdCB0aGUgY29ycmVzcG9uZGluZyBvYmplY3RzIGhhdmUgcHJvYmFibHkgcGxhY2VkIGluIHRoZSB3cm9uZyBjbHVzdGVyIChpbnRyYSBncm91cCB2YXJpYXRpb24gaGlnaGVyIHRoYW4gaW50ZXIgZ3JvdXAgdmFyaWF0aW9uKS4gDQoNCmBgYHtyIGNsYXNzLnNvdXJjZSA9ICJmb2xkLXNob3ciLCBldmFsPVQsIHdhcm5pbmc9Rn0NCiMgc3RlcCAxOiBjdXQgeW91ciB0cmVlDQpjdXRnMTwtY3V0cmVlKHNwZS5iYy5VUEdNQSwgaz02KQ0KIyBzdGVwIDI6IGNhbGN1bGF0ZSBzaWxob3VldHRlIGZvciB0aGUgZGlmZmVyZW50IHBhcnRpdGlvbnMNCnNpbDE8LXNpbGhvdWV0dGUgKGN1dGcxLHNwZS5iYykNCiMgc3RlcCAzOiBwbG90IHNpbGhvdWV0dGUgDQpwbG90KHNpbDEpDQpgYGANCg0KUmVwZWF0IGJ5IGNoYW5naW5nICprKiwgdGhlIG51bWJlciBvZiBwYXJ0aXRpb25zIA0KDQorIHRoZSAqKkVsYm93KiogbWV0aG9kDQoNClRoaXMgbWV0aG9kIGxvb2tzIGF0IHRoZSBwZXJjZW50YWdlIG9mIHZhcmlhbmNlIGV4cGxhaW5lZCAoU1MpIGFzIGEgZnVuY3Rpb24gb2YgdGhlIG51bWJlciBvZiBjbHVzdGVyLiBPbmUgc2hvdWxkIGNob29zZSBhIG51bWJlciBvZiBjbHVzdGVycyBzbyB0aGF0IGFkZGluZyBhbm90aGVyIGNsdXN0ZXIgZG9lc24ndCBnaXZlIG11Y2ggYmV0dGVyIGV4cGxhbmF0aW9uLiBBdCBzb21lIHBvaW50IHRoZSBtYXJnaW5hbCBnYWluIHdpbGwgZHJvcCwgZ2l2aW5nIGFuIGFuZ2xlIGluIHRoZSBncmFwaC4gVGhlIG51bWJlciBvZiBjbHVzdGVycyBpcyBjaG9zZW4gYXQgdGhpcyBwb2ludCwgaGVuY2UgdGhlICJlbGJvdyBjcml0ZXJpb24iICh3c3MpLiBUaGlzIGlzIHZlcnkgY29tbW9uIG1ldGhvZCB0byBzZWxlY3QgYW4gYXBwcm9wcmlhdGUgbnVtYmVyIG9mIGNsdXN0ZXIgdG8gaW50ZXJwcmV0Lg0KDQoNCmBgYHtyIGNsYXNzLnNvdXJjZSA9ICJmb2xkLXNob3ciLCBldmFsPVQsIHdhcm5pbmc9Rn0NCmZ2aXpfbmJjbHVzdCh2YXJlc3BlYyxkaXNzPWJjZGlzdCh2YXJlc3BlYyksIGhjdXQsIG1ldGhvZCA9ICJ3c3MiLCBoY19tZXRob2QgPSAiYXZlcmFnZSIpDQpgYGANCg0KKyBUaGUgKipNYW50ZWwqKiB0ZXN0DQoNCkNvbXBhcmVzIHRoZSBvcmlnaW5hbCBkaXN0YW5jZSBtYXRyaXggdG8gKGJpbmFyeSkgbWF0cmljZXMgY29tcHV0ZWQgZnJvbSBkZW5kcm9ncmFtIGN1dCBhdCB2YXJpb3VzIGxldmVsIGFuZCBjaG9vc2UgdGhlIGxldmVsIHdoZXJlIG1hdHJpeCBjb3JyZWxhdGlvbg0KaXMgdGhlIGhpZ2hlc3QuIFRoZSBNYW50ZWwgY29ycmVsYXRpb24gaXMgaW4gaXRzIHNpbXBsZXN0IHNlbnNlLCBpLmUuIHRoZSBlcXVpdmFsZW50IG9mIGEgUGVhcnNvbiByIGNvcnJlbGF0aW9uIGJ1dCBiZXR3ZWVuIGRpc3RhbmNlIG1hdHJpY2VzLg0KDQpDb21wYXJpc29uIGJldHdlZW4gdGhlIGRpc3RhbmNlIG1hdHJpeCBhbmQgYmluYXJ5IG1hdHJpY2VzIHJlcHJlc2VudGluZyBwYXJ0aXRpb25zDQoNCmBgYHtyIGNsYXNzLnNvdXJjZSA9ICJmb2xkLXNob3ciLCBldmFsPVQsIHdhcm5pbmc9Rn0NCiMjIE1hbnRlbCB0ZXN0DQojIE9wdGltYWwgbnVtYmVyIG9mIGNsdXN0ZXJzDQojIGFjY29yZGluZyB0byBtYW50ZWwgc3RhdGlzdGljIA0KIyBGdW5jdGlvbiB0byBjb21wdXRlIGEgYmluYXJ5IGRpc3RhbmNlIG1hdHJpeCBmcm9tIGdyb3Vwcw0KZ3JwZGlzdDwtZnVuY3Rpb24oeCl7DQogIHJlcXVpcmUgKGNsdXN0ZXIpDQogIGdyPC1hcy5kYXRhLmZyYW1lKGFzLmZhY3Rvcih4KSkNCiAgZGlzdGdyPC1kYWlzeShnciwnZ293ZXInKQ0KICBkaXN0Z3INCn0NCiMgcnVuIGJhc2VkIG9uIHRoZSBVUEdNQSBjbHVzdGVyaW5nDQprdDwtZGF0YS5mcmFtZShrPTE6bnJvdyh2YXJlc3BlYykscj0wKQ0KZm9yIChpIGluIDI6KG5yb3codmFyZXNwZWMpLTEpKXsNCiAgZ3I8LWN1dHJlZShzcGUuYmMuVVBHTUEsaSkNCiAgZGlzdGdyPC1ncnBkaXN0KGdyKQ0KICBtdDwtY29yKHNwZS5iYyxkaXN0Z3IsIG1ldGhvZD0ncGVhcnNvbicpDQogIGt0W2ksMl0gPC0gbXQNCn0NCmsuYmVzdCA8LSB3aGljaC5tYXggKGt0JHIpDQpwbG90KGt0JGssa3QkciwgDQogICAgIHR5cGU9J2gnLCBtYWluPSdNYW50ZWwtb3B0aW1hbCBudW1iZXIgb2YgY2x1c3RlcnMgLSBVUEdNQScsDQogICAgIHhsYWI9J2sgKG51bWJlciBvZiBncm91cHMpJyx5bGFiPSJQZWFyc29uJ3MgY29ycmVsYXRpb24iKQ0KYXhpcygxLGsuYmVzdCwgDQogICAgIHBhc3RlKCdvcHRpbXVtJywgay5iZXN0LCBzZXA9J1xuJyksIGNvbD0ncmVkJyxmb250PTIsIGNvbC5heGlzPSdyZWQnKQ0KcG9pbnRzKGsuYmVzdCxtYXgoa3QkcikscGNoPTE2LGNvbD0ncmVkJyxjZXg9MS41KQ0KYGBgDQoNCisgYE5iQ2x1c3RgIGZvciBtYW55IG90aGVycw0KDQpUaGUgZnVuY3Rpb24gYE5iQ2x1c3QoKWBwcm92aWRlcyAzMCBpbmRpY2VzIGZvciBkZXRlcm1pbmluZyB0aGUgbnVtYmVyIG9mIGNsdXN0ZXJzIGFuZCBwcm9wb3NlcyB0byB1c2VyIHRoZSBiZXN0IGNsdXN0ZXJpbmcgc2NoZW1lIGZyb20gdGhlIGRpZmZlcmVudCByZXN1bHRzIG9idGFpbmVkIGJ5IHZhcnlpbmcgYWxsIGNvbWJpbmF0aW9ucyBvZiBudW1iZXIgb2YgY2x1c3RlcnMsIGRpc3RhbmNlIG1lYXN1cmVzLCBhbmQgY2x1c3RlcmluZyBtZXRob2RzIChDaGFycmFkIGV0IGFsLiAyMDE0KS4NCg0KIyMjIEJvb3RzdHJhcHBpbmcgdHJlZXMNCg0KQSBsaXR0ZSBoYW5kbWFkZSBhZGQtb24gdG8gdXMgdXNlIGBwdmNsdXN0KClgIGZyb20gdGhlIHBhY2thZ2UgYHB2Y2x1c3RgIHdpdGggQnJheS1DdXJ0aXMgZGlzc2ltaWxhcml0eSAobm90ZSB0aGF0IGRhdGEgc2V0IG5lZWQgdG8gYmUgdHJhbnNwb3NlZCBmb3IgdXNpbmcgdGhpcyBmdW5jdGlvbikuDQoNCmBgYHtyfQ0KcHYucmVzdWx0czwtcHZjbHVzdCh0KHZhcmVzcGVjKSwgIyB0byBjbHVzdGVyIHJvd3MgLSBvbWl0IHQoKSB0byBjbHVzdGVyIGNvbHVtbnMsDQogICAgICAgIG1ldGhvZC5oY2x1c3QgPSAiYXZlcmFnZSIsDQogICAgICAgIG1ldGhvZC5kaXN0ID0gZnVuY3Rpb24oeCkgdmVnYW46OnZlZ2Rpc3QodCh4KSwgImJyYXkiKSwNCiAgICAgICAgbiA9IDEwMDApICMgYW5kIG90aGVyIGFyZ3VtZW50cyB5b3UgbmVlZA0KcGxvdChwdi5yZXN1bHRzKQ0KYGBgDQoNCg0KDQpib3N0b24ucHYgPC0gcHZjbHVzdCh2YXJlc3NwZWMsIG1ldGhvZC5kaXN0PSJjb3JyZWxhdGlvbiIsICBuYm9vdD0xMDAsIHBhcmFsbGVsPUZBTFNFKQ0KDQoNCi0tLS0tLS0tLS0tLS0tLS0tLS0NCg0KTGV0J3MgYXBwbHkgdGhpcyBvbiB0aGUgYGRvdWJzYCBkYXRhIHNldDoNCg0KDQpgYGB7ciBjbGFzcy5zb3VyY2UgPSAiZm9sZC1zaG93IiwgZXZhbD1ULCB3YXJuaW5nPUZ9DQojIENhbGN1bGF0ZXMgaGllcmFyY2hpY2FsIGNsdXN0ZXIgYW5hbHlzaXMgb2Ygc3BlY2llcyBkYXRhIA0Kc3BlLmRiLmNoLlVQR01BPC1oY2x1c3Qoc3BlLmRiLmNoLG1ldGhvZD0nYXZlcmFnZScpIA0KZnZpel9uYmNsdXN0KHNwZS5kYiwgaGN1dCwgZGlzcz1kaXN0KHNwZS5kYi5ub3JtLCBtZXRob2Q9J2V1Y2xpZGVhbicpLG1ldGhvZCA9ICJ3c3MiLGhjX21ldGhvZCA9ICJzaW5nbGUiKQ0KIyBEZW5kcm9ncmFtIHdpdGggdGhlIG9ic2VydmVkIGdyb3Vwcw0KcGFyKG1mcm93PWMoMSwyKSkNCnBsb3QgKHNwZS5kYi5jaC5VUEdNQSkNCnJlY3QuaGNsdXN0IChzcGUuZGIuY2guVVBHTUEsIGsgPSA2LCBib3JkZXIgPSAxOjYpDQojIFNwYXRpYWwgZGlzdHJpYnV0aW9uIG9mIHNhbXBsZXMgd2l0aCBwcm9qZWN0aW9uIG9mIGhpZXJhcmNoaWNhbCBjbGFzc2lmaWNhdGlvbg0KVVBHTUEuY2x1c3RlciA8LSBjdXRyZWUgKHNwZS5kYi5jaC5VUEdNQSwgayA9IDYpDQpwbG90ICh5IH4geCwgZGF0YSA9IHNwYS5kYiwgcGNoID0gVVBHTUEuY2x1c3RlciwgY29sID0gVVBHTUEuY2x1c3RlciwgdHlwZSA9ICdiJywgbWFpbiA9ICdDaG9yZCBkaXN0YW5jZSAtIFVQR01BIG1ldGhvZCcpDQpkZXYub2ZmKCkNCmBgYA0KDQpMZXQncyBjb21iaW5lIGhlYXRtYXAgYW5kIGNsdXN0ZXINCg0KDQoqIEhlYXQgbWFwICYgY2x1c3RlcmluZyB2aXN1YWxpemF0aW9uIChleGFtcGxlKQ0KDQpXZSBtdXN0IHJlb3JkZXIgb2JqZWN0cyAoZnVuY3Rpb24gYHJlb3JkZXIuaGNsdXN0YCkgc28gdGhhdCB0aGVpciBvcmRlciBpbiB0aGUgZGlzc2ltaWxhcml0eSBtYXRyaXggaXMgcmVzcGVjdGVkIC4gVGhpcyBkb2VzIG5vdCBhZmZlY3QgdGhlIHRvcG9sb2d5IG9mIHRoZSBkZW5kcm9ncmFtLg0KDQpgYGB7ciBjbGFzcy5zb3VyY2UgPSAiZm9sZC1zaG93IiwgZXZhbD1ULCB3YXJuaW5nPUZ9DQpzcGUuY2h3bzwtcmVvcmRlci5oY2x1c3Qoc3BlLmRiLmNoLlVQR01BLHNwZS5kYi5jaCkNCmRlbmQ8LWFzLmRlbmRyb2dyYW0oc3BlLmNod28pIA0KaGVhdG1hcChhcy5tYXRyaXgoc3BlLmRiLmNoKSxSb3d2PWRlbmQsc3ltbT1UUlVFLCBtYXJnaW49YygzLDMpKQ0KYGBgDQoNCg0KPHAgY2xhc3M9ImNvbW1lbnQiPg0KKipQcmFjdGljZSA3LjYqKiBVc2luZyBgdGlrdXNgIGRhdGEgc2V0IGFuZCBzdWJzZXQgb24geWVhcnMgMTk4MSwgMTk4MyBhbmQgMTk4NTogY29tcHV0ZSB0aGUgdGhyZWUgY29tbW9uIGNsdXN0ZXJpbmcgbWV0aG9kcyAoc2luZ2xlLCBjb21wbGV0ZSwgYXZlcmFnZSkgb24gYSBCcmF5LUN1cnRpcyBkaXNzaW1pbGFyaXRpZXMgbWF0cml4LiBDb21wYXJlIHJlc3VsdGluZyBkZW5kcm9ncmFtcyB1c2luZyBjb3BoZW5ldGljIGNvcnJlbGF0aW9uIGFuZCBTaGVwYXJkLWxpa2UgZGlhZ3JhbS4gQ2hvb3NlIG1ldGhvZCB3aXRoIHRoZSBvbmUgd2l0aCB0aGUgaGlnaGVzdCBjb3BoZW5ldGljIGNvcnJlbGF0aW9uIGFuZCBwcm9kdWNlIGEgaGVhdCBtYXAgb2YgdGhlIHJlb3JkZXJlZCBkaXN0YW5jZSBtYXRyaXggdG9nZXRoZXIgd2l0aCBhIHZpc3VhbGl6YXRpb24gb2YgdGhlIHJlbGF0ZWQgZGVuZHJvZ3JhbS4gDQo8L3A+DQoNCg0KIyMgTm9uLUhpZXJhcmNoaWNhbCBDbHVzdGVyaW5nDQoNCg0KTm9uLWhpZXJhcmNoaWNhbCBjbHVzdGVyaW5nIGNyZWF0ZXMgcGFydGl0aW9ucyBidXQgd2l0aG91dCBoaWVyYXJjaHkgKHRoaW5rIG9mIGNhdGVnb3JpemluZyBmcnVpdHM6IGFwcGxlcywgb3JhbmdlcywgYmFuYW5hcykuIEl0IGRldGVybWluZSBhIHBhcnRpdGlvbiBvZiB0aGUgb2JqZWN0cyBpbnRvIGsgZ3JvdXBzLCBvciBjbHVzdGVycywgc3VjaCBhcyB0aGUgb2JqZWN0cyB3aXRoaW4gZWFjaCBjbHVzdGVyIGFyZSBtb3JlIHNpbWlsYXIgdG8gb25lIG90aGVyIHRoYW4gdG8gb2JqZWN0cyBpbiB0aGUgb3RoZXIgY2x1c3RlcnMuDQoNCkl0IHVzdWFsbHkgcmVxdWlyZXMgYW4gaW5pdGlhbCBjb25maWd1cmF0aW9uICh1c2VyIHVzdWFsbHkgZGV0ZXJtaW5lIHRoZSBudW1iZXIgb2YgZ3JvdXBzLCBfa18pLCB3aGljaCB3aWxsIGJlIG9wdGltaXplZCBpbiBhIHJlY3Vyc2l2ZSBwcm9jZXNzIChvZnRlbiByYW5kb20pLiBJZiByYW5kb20sIHRoZSBpbml0aWFsIGNvbmZpZ3VyYXRpb24gaXMgcnVuIGEgbGFyZ2UgbnVtYmVyIG9mIHRpbWVzIHdpdGggZGlmZmVyZW50IGluaXRpYWwgY29uZmlndXJhdGlvbnMgaW4gb3JkZXIgdG8gZmluZCB0aGUgYmVzdCBzb2x1dGlvbi4NCg0KVGhlIG1vc3Qga25vd24gYW5kIGNvbW1vbmx5IHVzZWQgbm9uLWhpZXJhcmNoaWNhbCAqKnBhcnRpdGlvbmluZyBhbGdvcml0aG1zKiogaXMgKipfa18tbWVhbnMgY2x1c3RlcmluZyoqIChNYWNRdWVlbiwgMTk2NyksIGluIHdoaWNoLCBlYWNoIGNsdXN0ZXIgaXMgcmVwcmVzZW50ZWQgYnkgdGhlIGNlbnRlciBvciBtZWFucyBvZiB0aGUgZGF0YSBwb2ludHMgYmVsb25naW5nIHRvIHRoZSBjbHVzdGVyLg0KDQohW10oaWxsdXN0cmF0aW9ucy9tdWx0aV9rbWVhbi5wbmcpDQoNClRocmVlICBjcml0YWwgc3RlcHM6DQoNCiAgKyAqKkluaXRpYWxpemF0aW9uKio6IF9rXyBvYnNlcnZhdGlvbnMgZnJvbSB0aGUgZGF0YXNldCBhcmUgdXNlZCBhcyB0aGUgaW5pdGlhbCBtZWFucy4gVGhlICoqcmFuZG9tIHBhcnRpdGlvbioqIG1ldGhvZCBmaXJzdCByYW5kb21seSBhc3NpZ25zIGEgY2x1c3RlciB0byBlYWNoIG9ic2VydmF0aW9uIGFuZCB0aGVuIHByb2NlZWRzIHRvIHRoZSB1cGRhdGUgc3RlcCwgdGh1cyBjb21wdXRpbmcgdGhlIGluaXRpYWwgbWVhbiB0byBiZSB0aGUgY2VudHJvaWQgb2YgdGhlIGNsdXN0ZXIncyByYW5kb21seSBhc3NpZ25lZCBwb2ludHMuIA0KDQogICsgKipBc3NpZ25tZW50IHN0ZXAqKiBBc3NpZ24gZWFjaCBvYnNlcnZhdGlvbiB0byB0aGUgY2x1c3RlciB3aXRoIHRoZSBuZWFyZXN0IG1lYW46IHRoYXQgd2l0aCB0aGUgbGVhc3Qgc3F1YXJlZCBFdWNsaWRlYW4gZGlzdGFuY2UgKE1hdGhlbWF0aWNhbGx5LCB0aGlzIG1lYW5zIHBhcnRpdGlvbmluZyB0aGUgb2JzZXJ2YXRpb25zIGFjY29yZGluZyB0byB0aGUgVm9yb25vaSBkaWFncmFtIGdlbmVyYXRlZCBieSB0aGUgbWVhbnMpIA0KICANCiAgKyAqKlVwZGF0ZSBzdGVwKiogUmVjYWxjdWxhdGUgbWVhbnMgKGNlbnRyb2lkcykgZm9yIG9ic2VydmF0aW9ucyBhc3NpZ25lZCB0byBlYWNoIGNsdXN0ZXIuDQogIA0KDQpUaGUgYWxnb3JpdGhtIGhhcyAqKmNvbnZlcmdlZCoqIHdoZW4gdGhlIGFzc2lnbm1lbnRzIG5vIGxvbmdlciBjaGFuZ2UuIFRoZSBhbGdvcml0aG0gaXMgbm90IGFsd2F5cyBndWFyYW50ZWVkIHRvIGZpbmQgdGhlIG9wdGltdW0uDQoNCjxjZW50ZXI+DQohW10oaWxsdXN0cmF0aW9ucy9tdWx0aV9rbWVhbl8yLmdpZil7d2lkdGg9NTAlfQ0KPC9jZW50ZXI+DQoNClRoZSBhaW1zIGlzIHRvIGlkZW50aWZ5ICoqaGlnaC1kZW5zaXR5IHJlZ2lvbnMqKiBpbiB0aGUgZGF0YS4gVG8gZG8gc28sIHRoZSBtZXRob2QgaXRlcmF0aXZlbHkgbWluaW1pemVzIGFuIG9iamVjdGl2ZSBmdW5jdGlvbiB0aGUgKip0b3RhbCBlcnJvciBzdW0gb2Ygc3F1YXJlcyAoVEVTUyBvciBTU0UpKiosIHdoaWNoIGlzIHRoZSBzdW0gb2YgdGhlIHdpdGhpbiBncm91cHMgc3Vtcy1vZiBzcXVhcmVzLiAqSXQgaXMgYmFzaWNhbGx5IHRoZSBzdW0sIG92ZXIgdGhlIF9rXyBncm91cHMsIG9mIHRoZSBzdW1zIG9mIHNxdWFyZWQgZGlzdGFuY2UgYW1vbmcgdGhlIG9iamVjdHMgaW4gdGhlIGdyb3VwLCBlYWNoIGRpdmlkZWQgYnkgdGhlIG51bWJlciBvZiBvYmplY3RzIGluIHRoZSBncm91cC4qIFRoZSBhbGdvcml0aG0gaXMgb2Z0ZW4gcHJlc2VudGVkIGFzIGFzc2lnbmluZyBvYmplY3RzIHRvIHRoZSBuZWFyZXN0IGNsdXN0ZXIgYnkgZGlzdGFuY2UuIFVzaW5nIGEgZGlmZmVyZW50IGRpc3RhbmNlIGZ1bmN0aW9uIG90aGVyIHRoYW4gKHNxdWFyZWQpIEV1Y2xpZGVhbiBkaXN0YW5jZSBtYXkgcHJldmVudCB0aGUgYWxnb3JpdGhtIGZyb20gY29udmVyZ2luZy4gVmFyaW91cyBtb2RpZmljYXRpb25zIG9mIF9rXy1tZWFucyBzdWNoIGFzICoqX2tfLW1lZG9pZHMqKiBbKipQQU0gKFBhcnRpdGlvbmluZyBBcm91bmQgTWVkb2lkcyoqLCBLYXVmbWFuICYgUm91c3NlZXV3LCAxOTkwXSBoYXZlIGJlZW4gcHJvcG9zZWQgdG8gYWxsb3cgdXNpbmcgb3RoZXIgZGlzdGFuY2UgbWVhc3VyZXMuIEluIHRoaXMgY2FzZSwgY2x1c3RlciBpcyByZXByZXNlbnRlZCBieSBvbmUgb2YgdGhlIG9iamVjdHMgaW4gdGhlIGNsdXN0ZXIuDQoNCg0KRGF0YSBtdXN0IGJlIHN0YW5kYXJkaXplZCBwcmlvciB0byBwYXJ0aXRpb25pbmcuIFdpdGggYSBwcmUtZGV0ZXJtaW5lZCBudW1iZXIgb2YgZ3JvdXBzLCByZWNvbW1lbmRlZCBmdW5jdGlvbiBpczogYGttZWFucygpYCBmcm9tIHRoZSBgc3RhdHNgIHBhY2thZ2UuIFRoZSBhcmd1bWVudCBgbnN0YXJ0YCB3aWxsIHJlcGVhdCB0aGUgYW5hbHlzaXMgYSBsYXJnZSBudW1iZXIgb2YgdGltZSB1c2luZyBkaWZmZXJlbnQgaW5pdGlhbCBjb25maWd1cmF0aW9uIHVudGlsIGZpbmRpbmcgdGhlIGJlc3Qgc29sdXRpb24uDQoNCipOb3RlOiBkbyBub3QgZm9yZ2V0IHRvIG5vcm1hbGl6ZWQgeW91ciBkYXRhKg0KDQpgYGB7ciwgIGV2YWw9VCwgbWVzc2FnZT1GfQ0KIyBrLW1lYW5zIHBhcnRpdGlvbmluZyBvZiB0aGUgcHJlLXRyYW5zZm9ybWVkIHNwZWNpZXMgZGF0YQ0Kc3BlLmttZWFucyA8LSBrbWVhbnMoc3BlLmJjLCBjZW50ZXJzPTYsIG5zdGFydD0xMDApDQojIGstbWVhbnMgZ3JvdXAgbnVtYmVyIG9mIGVhY2ggb2JzZXJ2YXRpb24gc3BlLmttZWFucyRjbHVzdGVyIA0Kc3BlLmttZWFucyRjbHVzdGVyDQojIENvbXBhcmlzb24gd2l0aCB0aGUgNS1ncm91cCBjbGFzc2lmaWNhdGlvbiBkZXJpdmVkIGZyb20gVVBHTUEgY2x1c3RlcmluZw0KY29tcGFyaXNvbjwtdGFibGUoc3BlLmttZWFucyRjbHVzdGVyLGN1dGcxKQ0KY29tcGFyaXNvbg0KIyBWaXN1YWxpemUgay1tZWFucyBjbHVzdGVycyANCmZ2aXpfY2x1c3RlcihzcGUua21lYW5zLCBkYXRhID0gdmFyZXNwZWMsZ2VvbSA9ICJwb2ludCIsDQogICAgICAgICAgICAgc3RhbmQgPSBULCBlbGxpcHNlLnR5cGUgPSAibm9ybSIpIA0KYGBgDQoNCg0KVGhlIGZ1bmN0aW9uIGBjYXNjYWRlS01gIGluIGB2ZWdhbmAgcGFja2FnZSBpcyBhIHdyYXBwZXIgZm9yIHRoZSBga21lYW5zYCBmdW5jdGlvbi4gSXQgY3JlYXRlcyBzZXZlcmFsIHBhcnRpdGlvbnMgZm9ybWluZyBhIGNhc2NhZGUgZnJvbSBzbWFsbCAoYXJndW1lbnQgYGluZi5ncmAgdG8gbGFyZ2UgdmFsdWVzIG9mICprKiAoYXJndW1lbnQgYHN1cC5ncmApLiBUaGUgY2FzY2FkZSBwcm9wb3NlcyB0aGUgJ2Jlc3Qgc29sdXRpb24nIGZvciBwYXJ0aXRpb25pbmcgdXNpbmcgdGhlIGBjYWxpbnNraWAgb3IgYHNzaWAgY3JpdGVyaW9uLiBPdGhlciBpbmRpY2F0b3JzIHN1Y2ggYXMgZWxib3cgYW5kIHNpbGhvdWV0dGUgY2FuIGFsc28gYmUgYXBwbGllZCBsb29raW5nIGZvciB0aGUgYmVzdCBwYXJ0aXRpb25pbmcuIA0KDQpgYGB7ciwgIGV2YWw9VCwgbWVzc2FnZT1GfQ0Kc3BlLktNLmNhc2NhZGU8LWNhc2NhZGVLTShzcGUuYmMsaW5mLmdyPTIsc3VwLmdyPTEwLGl0ZXI9MTAwLGNyaXRlcmlvbj0nY2FsaW5za2knKQ0KcGxvdChzcGUuS00uY2FzY2FkZSxzb3J0Zz1UUlVFKQ0KYGBgDQoNCiMjIyAqKkZ1enp5IGNsdXN0ZXJpbmcqKg0KDQpUaGUgKipmdXp6eSBjbHVzdGVyaW5nKiogaXMgY29uc2lkZXJlZCBhcyBzb2Z0IGNsdXN0ZXJpbmcgb3IgKipzb2Z0KiogX2tfLW1lYW5zLCBpbiB3aGljaCBlYWNoIGVsZW1lbnQgaGFzIGEgcHJvYmFiaWxpdHkgb2YgYmVsb25naW5nIHRvIGVhY2ggY2x1c3Rlci4gSW4gb3RoZXIgd29yZHMsIGVhY2ggZWxlbWVudCBoYXMgYSBzZXQgb2YgbWVtYmVyc2hpcCBjb2VmZmljaWVudHMgY29ycmVzcG9uZGluZyB0byB0aGUgZGVncmVlIG9mIGJlaW5nIGluIGEgZ2l2ZW4gY2x1c3Rlci4gSW4gZnV6enkgY2x1c3RlcmluZywgcG9pbnRzIGNsb3NlIHRvIHRoZSBjZW50ZXIgb2YgYSBjbHVzdGVyLCBtYXkgYmUgaW4gdGhlIGNsdXN0ZXIgdG8gYSBoaWdoZXIgZGVncmVlIHRoYW4gcG9pbnRzIGluIHRoZSBlZGdlIG9mIGEgY2x1c3Rlci4gVGhlIGRlZ3JlZSwgdG8gd2hpY2ggYW4gZWxlbWVudCBiZWxvbmdzIHRvIGEgZ2l2ZW4gY2x1c3RlciwgaXMgYSBudW1lcmljYWwgdmFsdWUgdmFyeWluZyBmcm9tIDAgdG8gMS4gVGhpcyBpcyBmdW5kYW1lbnRhbGx5IGRpZmZlcmVudCBmcm9tIF9rXy1tZWFucyBhbmQgX2tfLW1lZG9pZCBjbHVzdGVyaW5nLCB3aGVyZSBlYWNoIG9iamVjdCBpcyBhZmZlY3RlZCBleGFjdGx5IHRvIG9uZSBjbHVzdGVyLiBfa18tbWVhbnMgYW5kIF9rXy1tZWRvaWRzIGNsdXN0ZXJpbmcgYXJlIGtub3duIGFzICoqaGFyZCoqIG9yICoqbm9uLWZ1enp5KiogY2x1c3RlcmluZy4NCg0KSW4gb3RoZXIgd29yZHMsIGluIG5vbi1mdXp6eSBjbHVzdGVyaW5nIGEgZnJ1aXQgY2FuIGJlIGFuIGFwcGxlIG9yIGFuIG9yYW5nZSAoaGFyZCBjbHVzdGVyaW5nKS4gSW4gc29mdCBjbHVzdGVyaW5nLCB0aGUgZnJ1aXQgY2FuIGJlIGFuIGFwcGxlIEFORCBhbiBvcmFuZ2UgYXQgdGhlIHNhbWUgdGltZSBidXQgdG8gY2VydGFpbiBkZWdyZWVzLiANCg0KVGhlICoqZnV6enkgYy1tZWFucyAoRkNNKSoqIGFsZ29yaXRobSBpcyBvbmUgb2YgdGhlIG1vc3Qgd2lkZWx5IHVzZWQgZnV6enkgY2x1c3RlcmluZyBhbGdvcml0aG1zLiBUaGUgY2VudHJvaWQgb2YgYSBjbHVzdGVyIGlzIGNhbGN1bGF0ZWQgYXMgdGhlIG1lYW4gb2YgYWxsIHBvaW50cywgd2VpZ2h0ZWQgYnkgdGhlaXIgZGVncmVlIG9mIGJlbG9uZ2luZyB0byB0aGUgY2x1c3Rlci4gVGhlIGZ1bmN0aW9uIGBmYW5ueWAgW2BjbHVzdGVyYCBwYWNrYWdlXSBjYW4gYmUgdXNlZCB0byBjb21wdXRlIGZ1enp5IGNsdXN0ZXJpbmcuICdGQU5OWScgc3RhbmRzIGZvciAqZnV6enkgYW5hbHlzaXMgY2x1c3RlcmluZyogKHNlZSBgP2Zhbm55YCkuDQoNCjxwIGNsYXNzPSJjb21tZW50Ij4NCioqUHJhY3RpY2UgNy43KiogVXNpbmcgYGlyaXNgIGRhdGEgc2V0OiAoMSkgbWFrZSBhIEstbWVhbnMgY2FzY2FkZSBhbmQgdXNlIHRoZSBzaWxob3VldHRlIHdpZHRoIGluZGljYXRvciB0byBkZXRlcm1pbmUgdGhlIG9wdGltYWwgbnVtYmVyIG9mIGNsdXN0ZXJzLiAoMikgIHNpbmNlIHdlIGtub3cgdGhhdCAzIHNwZWNpZXMgYXJlIGludm9sdmVkLCBncm91cCB0aGUgZGF0YSBpbnRvIDMgY2x1c3RlcnMgKGNvbW1vbiBzZW5zZSkgdXNpbmcgdGhlIGBrbWVhbnNgIGZ1bmN0aW9uLiBIb3cgbWFueSBwb2ludHMgYXJlIHdyb25nbHkgY2xhc3NpZmllZD8gUGxvdCBib3RoIHNvbHV0aW9ucyBhbmQgY29uY2x1ZGUuDQo8L3A+DQoNCmBgYHtyLCAgZXZhbD1ULCBtZXNzYWdlPUZ9DQpteV9jb2xzIDwtIGMoIiMwMEFGQkIiLCAiI0U3QjgwMCIsICIjRkM0RTA3IikgIA0KcGFpcnMoaXJpc1ssMTo0XSwgcGNoID0gMTksICBjZXggPSAwLjUsDQogICAgICBjb2wgPSBteV9jb2xzW2lyaXMkU3BlY2llc10sDQogICAgICBsb3dlci5wYW5lbD1OVUxMKQ0KYGBgDQoNCmBgYHtyLCBjbGFzcy5zb3VyY2UgPSAiZm9sZC1oaWRlIiwgIGV2YWw9Rn0NCmZ2aXpfbmJjbHVzdChpcmlzWywgMTo0XSwga21lYW5zLCBtZXRob2QgPSAic2lsaG91ZXR0ZSIpDQpzcGUuS00uY2FzY2FkZTwtY2FzY2FkZUtNKGlyaXNbLDE6NF0saW5mLmdyPTIsIHN1cC5ncj0xMCwgaXRlcj0xMDAsIGNyaXRlcmlvbj0nY2FsaW5za2knKQ0KcGxvdChzcGUuS00uY2FzY2FkZSxzb3J0Zz1UUlVFKQ0Kc2V0LnNlZWQoMSkNCmlyaXNDbHVzdGVyPC1rbWVhbnMoaXJpc1ssIDE6NF0sIDMsIG5zdGFydD0gMjApDQp0YWJsZShpcmlzQ2x1c3RlciRjbHVzdGVyLCBpcmlzJFNwZWNpZXMpDQppcmlzQ2x1c3RlciRjbHVzdGVyPC1hcy5mYWN0b3IoaXJpc0NsdXN0ZXIkY2x1c3RlcikNCnBsb3Q3PC1nZ3Bsb3QoaXJpcywgYWVzKFBldGFsLkxlbmd0aCwgUGV0YWwuV2lkdGgsIGNvbG9yID0gaXJpc0NsdXN0ZXIkY2x1c3RlcikpICsgZ2VvbV9wb2ludCgpDQpwbG90ODwtZ2dwbG90KGlyaXMsIGFlcyhQZXRhbC5MZW5ndGgsIFBldGFsLldpZHRoLCBjb2xvciA9IFNwZWNpZXMpKSArIGdlb21fcG9pbnQoKQ0KZ3JpZC5hcnJhbmdlKHBsb3Q3LCBwbG90OCwgbmNvbD0yKQ0KIyBjb25jbHVzaW9ucz8NCmBgYA0KDQojIyBEZWNpc2lvbiB0cmVlcw0KDQpNdWx0aXBsZSB2YXJpYWJsZXMgYXJlIHVzZSB0byBtYWtlIGEgZGVjaXNpb24sIGJ1dCB0aGV5IGNhbiBiZSBtYWRlIGludG8gbXVsdGl2YXJpYXRlLiBbSGVyZV0oaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj03VmVVUHVGR0pIayZhYl9jaGFubmVsPVN0YXRRdWVzdHdpdGhKb3NoU3Rhcm1lcikgZm9yIGEgYmFzaWMgdW5kZXJzdGFuZGluZyBvZiBkZWNpc2lvbiB0cmVlcy4gDQoNCiMjIyBDbGFzc2lmaWNhdGlvbiBBbmQgUmVncmVzc2lvbiBUcmVlcyAoQ0FSVCkNCg0KVGhlIGZ1bmN0aW9ucyBgdHJlZWAgYW5kIGBjdHJlZWAgYnVpbGRzIGRlY2lzaW9uIHRyZWVzIChbcmVjdXJzaXZlIHBhcnRpdGlvbmluZyBhbGdvcml0aG1dKGh0dHBzOi8vY3Jhbi5yLXByb2plY3Qub3JnL3dlYi9wYWNrYWdlcy9wYXJ0eWtpdC92aWduZXR0ZXMvY3RyZWUucGRmKSkuIFRoZSBmaXJzdCBwYXJhbWV0ZXIgaXMgYSBmb3JtdWxhLCB3aGljaCBkZWZpbmVzIGEgdGFyZ2V0IHZhcmlhYmxlIGFuZCBhIGxpc3Qgb2YgaW5kZXBlbmRlbnQgdmFyaWFibGVzLg0KDQpgYGB7ciBjbGFzcy5zb3VyY2UgPSAiZm9sZC1zaG93IiwgIGV2YWw9VH0NCnRyZWUxPC10cmVlKFNwZWNpZXN+U2VwYWwuTGVuZ3RoICsgU2VwYWwuV2lkdGggKyBQZXRhbC5MZW5ndGggKyBQZXRhbC5XaWR0aCwgZGF0YT1pcmlzKQ0Kc3VtbWFyeSh0cmVlMSApDQpwbG90KHRyZWUxKQ0KdGV4dCh0cmVlMSkNCmBgYA0KDQpBbm90aGVyIGZhbmNpZXIgb3B0aW9uIHdpdGggdGhlIHBhY2thZ2UgYHJwYXJ0YDoNCg0KYGBge3IgY2xhc3Muc291cmNlID0gImZvbGQtc2hvdyIsICBldmFsPVR9DQp0cmVlMiA8LSBycGFydChTcGVjaWVzIH4gLiwgZGF0YT1pcmlzLCBtZXRob2Q9ImNsYXNzIikNCmZhbmN5UnBhcnRQbG90KHRyZWUyLCBtYWluPSJJcmlzIikgIyBwYWNrYWdlIHJhdHRsZQ0KYGBgDQoNCk9uZSBvZiB0aGUgZGlzYWR2YW50YWdlcyBvZiBkZWNpc2lvbiB0cmVlcyBtYXkgYmUgKipvdmVyZml0dGluZyoqIGkuZS4gY29udGludWFsbHkgY3JlYXRpbmcgcGFydGl0aW9ucyB0byBhY2hpZXZlIGEgcmVsYXRpdmVseSBob21vZ2VuZW91cyBwb3B1bGF0aW9uLiBUaGlzIHByb2JsZW0gY2FuIGJlIGFsbGV2aWF0ZWQgYnkgKipwcnVuaW5nKiogdGhlIHRyZWUgKENBUlQpLCB3aGljaCBpcyBiYXNpY2FsbHkgcmVtb3ZpbmcgdGhlIGRlY2lzaW9ucyBmcm9tIHRoZSBib3R0b20gdG8gdXAuIEFub3RoZXIgd2F5IGlzIHRvICoqY29tYmluZSBzZXZlcmFsIHRyZWVzKiogYW5kIG9idGFpbiBhIGNvbnNlbnN1cywgd2hpY2ggY2FuIGJlIGRvbmUgdmlhIGEgcHJvY2VzcyBjYWxsZWQgKipyYW5kb20gZm9yZXN0cyoqIChib290c3RyYXBwZWQgdmVyc2lvbiBvZiBDQVJUIC0gbWFueSB0cmVlcyBidWlsdCBiYXNlZCBvbiBzdWJzZXRzIG9mIHRoZSBkYXRhLCBpbiBhZGRpdGlvbiBub3QgYWxsIHByZWRpY3RvciB2YXJpYWJsZXMgYXJlIHVzZWQgZXZlcnkgdGltZSwgcmF0aGVyIGEgcmFuZG9tIHN1YnNldCkuIChleHRyYSkNCg0KYGBge3IgY2xhc3Muc291cmNlID0gImZvbGQtc2hvdyIsICBldmFsPVR9DQojIEV4dHJhIHRvIGV4Y2l0aW5nIHlvdXIgY3VyaW9zaXR5DQppcmlzLnJmPXJhbmRvbUZvcmVzdChTcGVjaWVzfi4sIGRhdGE9aXJpcywgaW1wb3J0YW5jZT1UUlVFLCBwcm94aW1pdHk9VFJVRSwgbnRyZWU9NTAwKQ0KIyBSZXF1aXJlZCBudW1iZXIgb2YgdHJlZXMgZ2l2ZXMgZXJyb3JzIGZvciBlYWNoIHNwZWNpZXMgYW5kIHRoZSBhdmVyYWdlIGZvciBhbGwgc3BlY2llcyAoYmxhY2spOg0KcGxvdChpcmlzLnJmLGx0eT0yKQ0KIyBNaXNjbGFzc2lmaWNhdGlvbiBlcnJvciByYXRlczoNCmlyaXMucmYkY29uZnVzaW9uDQojIEltcG9ydGFuY2Ugb2YgaW5kaXZpZHVhbCBwcmVkaWN0b3IgdmFyaWFibGVzIGZvciBjbGFzc2lmaWNhdGlvbiAodGhlIGZ1cnRoZXIgdGhlIHZhbHVlIGlzIG9uIHRoZSByaWdodCBvZiB0aGUgcGxvdCwgdGhlIG1vcmUgaW1wb3J0YW50KToNCnZhckltcFBsb3QoaXJpcy5yZikNCiMgVGhlIG1lbWJlcnNoaXAgb2YgYSBwYXJ0aWN1bGFyIGNsYXNzIGFzIGEgZnVuY3Rpb24gb2YgYSB2YXJpYWJsZSB2YWx1ZSBjYW4gYmUgZGlzcGxheWVkIHdpdGggdGhpcw0KcGFydGlhbFBsb3QoaXJpcy5yZixpcmlzLFBldGFsLldpZHRoLCJzZXRvc2EiKQ0KIyB3ZSBjYW4gcHJlZGljdCB1bmNsYXNzaWZpZWQgb2JzZXJ2YXRpb25zLiBXZSBtYWtlIHVwIHNvbWUgc2FtcGxlIG5ldyBvYnNlcnZhdGlvbnMgZnJvbSB0aGUgb3JpZ2luYWwgZGF0YXNldCB0byBzYXZlIHNvbWUgdGltZSBpbXBvcnRpbmcgKHRoZSBmaXJzdCB0aHJlZSByb3dzIGFyZSBQLiBzZXRvc2EsIGxldHMgc2VlIGlmIFJhbmRvbUZvcmVzdCBnZXRzIHRoYXQgcmlnaHQ6DQpuZXdvYnM9aXJpc1sxOjMsMTo0XQ0KcHJlZGljdChpcmlzLnJmLG5ld29icykNCiMgVGhpcyBsYXN0IHBsb3QgY29udmV5cyB0aGUgY29uZmlkZW5jZSBpbiB5b3VyIHByZWRpY3Rpb25zIGZvciBlYWNoIGluZGl2aWR1YWwgc2FtcGxlLiBDb2xvcnMgcmVwcmVzZW50IHNwZWNpZXMgYW5kIHBvaW50cyBhcmUgc2FtcGxlcy4gSW4gdGhpcyBjYXNlLCBtYW55IHNhbXBsZXMgY2FuIGJlIHByZWRpY3RlZCB3aXRoIGdyZWF0IGNlcnRhaW50eSAoMSkgYW5kIG9ubHkgZmV3IGNsYXNzaWZpY2F0aW9ucyBhcmUgcXVlc3Rpb25hYmxlIChhcHByb2FjaGluZyAwKQ0KcGxvdChtYXJnaW4oaXJpcy5yZikpDQpgYGANCg0KIyMgTXVsdGl2YXJpYXRlIFJlZ3Jlc3Npb24gVHJlZXM6IGNvbnN0cmFpbmVkIGNsdXN0ZXJpbmcgKGV4dHJhKQ0KDQoqKk11bHRpdmFyaWF0ZSByZWdyZXNzaW9uIHRyZWVzKiogKE1SVDsgRGXigJlhdGggMjAwMikgYXJlIGFuIGV4dGVuc2lvbiBvZiB1bml2YXJpYXRlIHJlZ3Jlc3Npb24gdHJlZXMsIGEgbWV0aG9kIGFsbG93aW5nIHRoZSByZWN1cnNpdmUgcGFydGl0aW9uaW5nIG9mIGEgcXVhbnRpdGF0aXZlIHJlc3BvbnNlIHZhcmlhYmxlIHVuZGVyIHRoZSBjb250cm9sIG9mIGEgc2V0IG9mIHF1YW50aXRhdGl2ZSBvciBjYXRlZ29yaWNhbCBleHBsYW5hdG9yeSB2YXJpYWJsZXMgKEJyZWltYW4gZXQgYWwuIDE5ODQpLiBTdWNoIGEgcHJvY2VkdXJlIGlzIHNvbWV0aW1lcyBjYWxsZWQgKipjb25zdHJhaW5lZCoqIG9yICoqc3VwZXJ2aXNlZCoqIGNsdXN0ZXJpbmcuVGhlIHJlc3VsdCBpcyBhIHRyZWUgd2hvc2Ug4oCcbGVhdmVz4oCdICh0ZXJtaW5hbCBncm91cHMgb2Ygc2l0ZXMpIGFyZSBjb21wb3NlZCBvZiBzdWJzZXRzIG9mICdzaXRlcycgY2hvc2VuIHRvIG1pbmltaXplIHRoZSB3aXRoaW4tZ3JvdXAgc3VtcyBvZiBzcXVhcmVzIChhcyBpbiBhIF9rXy1tZWFucyBjbHVzdGVyaW5nKSwgYnV0IHdoZXJlIGVhY2ggc3VjY2Vzc2l2ZSBwYXJ0aXRpb24gaXMgZGVmaW5lZCBieSBhIHRocmVzaG9sZCB2YWx1ZSBvciBhIHN0YXRlIG9mIG9uZSBvZiB0aGUgZXhwbGFuYXRvcnkgdmFyaWFibGVzLg0KDQoNClRoZSBvbmx5IHBhY2thZ2UgaW1wbGVtZW50aW5nIGEgY29tcGxldGUgYW5kIGhhbmR5IHZlcnNpb24gb2YgTVJUIHdhcyBgbXZwYXJ0YC4gVW5mb3J0dW5hdGVseSwgdGhpcyBwYWNrYWdlIGlzIG5vIGxvbmdlciBpbiBDUkFOLCBzbyBubyB1cGRhdGUgaXMgYXZhaWxhYmxlIGZvciBSIHZlcnNpb25zIHBvc3RlcmlvciB0byBSIDMuMC4zICsgcG90ZW50aWFsIGVycm9yLiBOZXZlcnRoZWxlc3MsIGBtdnBhcnRgIGNhbiBzdGlsbCBiZSBpbnN0YWxsZWQgdmlhIGdpdGh1YiAtIGxldCBtZSBrbm93IGlmIHlvdSBoYXZlIGEgYmV0dGVyIG9wdGlvbiA6KQ0KDQoNCmBgYHtyIGNsYXNzLnNvdXJjZSA9ICJmb2xkLXNob3ciLCAgZXZhbD1UfQ0KZGF0YShkb3VicykNCnNwZS5ub3JtPC1kZWNvc3RhbmQoZG91YnMkZmlzaFstOCxdLCAnbm9yJykNCmVudjwtZG91YnMkZW52Wy04LF0NCg0KIyBwYXIobWZyb3c9YygxLDIpKQ0Kc3BlLmNoLm12cGFydCA8LQ0KICBtdnBhcnQoZGF0YS5tYXRyaXgoc3BlLm5vcm0pfi4sDQogICAgICAgICBlbnYsDQogICAgICAgICBtYXJnaW4gPSAwLjA4LA0KICAgICAgICAgY3A9MCwNCiAgICAgICAgIHh2PSdtaW4nLCAjIHRyeSAncGljaycgYmVzdCBudW1iZXIsICcxc2UnDQogICAgICAgICB4dmFsPW5yb3coZG91YnMkZmlzaCksDQogICAgICAgICB4dm11bHQgPSAxMDANCiAgICAgICAgICkNCmBgYA0KDQojIE9yZGluYXRpb25zDQoNClRoZSBhaW0gb2Ygb3JkaW5hdGlvbiBtZXRob2RzIGlzIHRvIHJlcHJlc2VudCB0aGUgZGF0YSBhbG9uZyBhIHJlZHVjZWQgbnVtYmVyIG9mIG9ydGhvZ29uYWwgYXhlcywgY29uc3RydWN0ZWQgaW4gc3VjaCB3YXkgdGhhdCB0aGV5IHJlcHJlc2VudCwgaW4gZGVjcmVhc2luZyBvcmRlciwgdGhlICoqbWFpbiB0cmVuZHMgb2YgdGhlIGRhdGEqKi4gSW4gZmFjdCwgd2UgYWxyZWFkeSB1c2VkIHNvbWUgdHlwZSBvZiBvcmRpbmF0aW9ucyB0byB2aXN1YWxpemUgbm9uLWhpZXJhcmNoaWNhbCBjbHVzdGVycy4NCg0KICsgVGhlIHJlbmRlcnMgY2FuIGJlICoqaW50ZXJwcmV0ZWQgdmlzdWFsbHkgb3IgaW4gYXNzb2NpYXRpb24gd2l0aCBvdGhlciBtZXRob2RzKiogc3VjaCBhcyBjbHVzdGVyaW5nIG9yIHJlZ3Jlc3Npb24NCg0KICsgTW9zdCBvcmRpbmF0aW9uIG1ldGhvZHMgKGV4Y2VwdCBuTURTKSBhcmUgYmFzZWQgb24gdGhlIGV4dHJhY3Rpb24gb2YgdGhlICoqZWlnZW52ZWN0b3JzKiogb2YgYW4gYXNzb2NpYXRpb24gbWF0cml4DQogDQpUd28gZmFtaWxpZXMgb2Ygb3JkaW5hdGlvbiBhbmFseXNlcyBleGlzdCBhY2NvcmRpbmcgdG8gaG93IHRoZXkgYXJlIGRlYWxpbmcgd2l0aCBlbnZpcm9ubWVudGFsIG1hdHJpeCAoaWYgYW55KToNCg0KICArICoqdW5jb25zdHJhaW5lZCBvcmRpbmF0aW9uKiogKGluZGlyZWN0IGdyYWRpZW50IGFuYWx5c2lzLCBvcmRpbmF0aW9uIG5vdCBjb25zdHJhaW5lZCBieSBlbnZpcm9ubWVudGFsIGZhY3RvcnMpLlRoZXkgYXJlIGRlc2NyaXB0aXZlIG1ldGhvZG9sb2dpZXMgYW5kIGRlc2NyaWJlIHBhdHRlcm5zLiBJdCBnZW5lcmF0ZXMgaHlwb3RoZXNlcyBidXQgY2Fubm90IHRlc3QgdGhlbS4NCg0KICAgICogdW5jb3ZlciBtYWluIGNvbXBvc2l0aW9uYWwgZ3JhZGllbnRzIGluIHRoZSBzcGVjaWVzIGRhdGEsIAlzdHJ1Y3R1cmluZyB0aGUgY29tbXVuaXR5LCBhbmQgdGhlc2UgZ3JhZGllbnRzIGNhbiBiZSAJaW50ZXJwcmV0ZWQgYnkga25vd24gKGVzdGltYXRlZCBvciBtZWFzdXJlZCkgCWVudmlyb25tZW50YWwgZmFjdG9ycw0KICAgIA0KICAgICogZW52aXJvbm1lbnRhbCB2YXJpYWJsZXMgY2FuIGJlIHVzZWQgYSBwb3N0ZXJpb3JpLCBhZnRlciB0aGUgYW5hbHlzaXMNCiAgICANCisgKipjb25zdHJhaW5lZCBvcmRpbmF0aW9uKiogKGRpcmVjdCBncmFkaWVudCBhbmFseXNpcywgb3JkaW5hdGlvbiBheGVzIGFyZSBjb25zdHJhaW5lZCBieSBlbnZpcm9ubWVudGFsIGZhY3RvcnMpLiBJdCB0ZXN0cyBkaXJlY3RseSAgaHlwb3RoZXNlcyBhYm91dCB0aGUgaW5mbHVlbmNlIG9mIGVudmlyb25tZW50YWwgZmFjdG9ycyBvbiBzcGVjaWVzIGNvbXBvc2l0aW9uKg0KDQogICAgKiByZWxhdGVzIHRoZSAqKnNwZWNpZXMgY29tcG9zaXRpb24gZGlyZWN0bHkgdG8gdGhlIAllbnZpcm9ubWVudGFsIHZhcmlhYmxlcyoqIGFuZCBleHRyYWN0cyB0aGUgdmFyaWFuY2UgaW4gc3BlY2llcyAJY29tcG9zaXRpb24gd2hpY2ggaXMgZGlyZWN0bHkgcmVsYXRlZCB0byB0aGVzZSB2YXJpYWJsZSoNCg0KICAgICogcmVnYXJkaW5nIGVudmlyb25tZW50YWwgZmFjdG9ycywgaXQgb2ZmZXJzIHNldmVyYWwgaW50ZXJlc3Rpbmcgb3B0aW9ucyBzdWNoIGFzICoqc3RlcC13aXNlIHNlbGVjdGlvbioqIG9mIGltcG9ydGFudCBlbnZpcm9ubWVudGFsIAl2YXJpYWJsZXMgKGFuZCBleGNsdWRpbmcgdGhvc2Ugd2hpY2ggYXJlIG5vdCByZWxldmFudCBmb3Igc3BlY2llcyBjb21wb3NpdGlvbiksIHRlc3Qgb2YgKipzaWduaWZpY2FuY2Ugb2YgdGhlIHZhcmlhbmNlIAlleHBsYWluZWQgYnkgZW52aXJvbm1lbnRhbCBmYWN0b3JzKioJYW5kICoqcGFydGl0aW9uaW5nIHZhcmlhbmNlIGV4cGxhaW5lZCBieSBwYXJ0aWN1bGFyIGVudmlyb25tZW50YWwgdmFyaWFibGVzKioNCg0KSW4gYWRkaXRpb24sIGJhc2VkIG9uIGRhdGEgaW5wdXQsIHR3byB0eXBlcyBvZiBvcmRpbmF0aW9uIGFuYWx5c2VzIGV4aXN0LiANCg0KICArICoqcmF3IGRhdGEqKjogYmFzZWQgb24gYW5hbHlzaXMgb2YgcmF3IHNhbXBsZS1zcGVjaWVzIG1hdHJpY2VzIHdpdGggYWJ1bmRhbmNlIG9yIHByZXNlbmNlL2Fic2VuY2UgZGF0YS4gVHdvIGNhdGVnb3JpZXMgcmVjb2duaXplZCwgZGlmZmVyaW5nIGJ5IGFzc3VtcHRpb24gb2Ygc3BlY2llcyByZXNwb25zZSBhbG9uZyBlbnZpcm9ubWVudGFsIGdyYWRpZW50Og0KICANCiAgICAqICoqbGluZWFyKiosIHNwZWNpZXMgcmVzcG9uc2UgbGluZWFybHkgYWxvbmcgZW52LiBncmFkaWVudCwgd2hpY2ggY291bGQgYmUgdHJ1ZSBmb3IgcmF0aGVyIGhvbW9nZW5vdXMgZWNvbG9naWNhbCBkYXRhLCB3aGVyZSBlY29sb2dpY2FsIGdyYWRpZW50cyBhcmUgbm90IHRvbyBsb25nLiAqKlNob3J0IGdyYWRpZW50KiouDQoNCiAgICAqICoqdW5pbW9kYWwqKiwgc3BlY2llcyByZXNwb25zZSB1bmltb2RhbGx5IGFsb25nIGdyYWRpZW50LCBoYXZpbmcgaXRzIG9wdGltYSBhdCBjZXJ0YWluIGdyYWRpZW50IHBvc2l0aW9uLiBNb3JlIGNsb3NlIHRvIHJlYWxpdHkgb2YgZWNvbG9naWNhbCBkYXRhLCBtb3JlIHN1aXRhYmxlIGZvciBoZXRlcm9nZW5vdXMgZGF0YXNldCAobG9uZyBncmFkaWVudHMgKyBtYW55IHplcm9zIGFuZCB0dXJub3ZlcikuICoqTG9uZyBncmFkaWVudCoqLg0KICAgIA0KICAgIA0KDQoNCmBgYHtyLCBlY2hvPUZBTFNFLCBmaWcuYWxpZ249J2NlbnRlcicsIGZpZy5jYXA9IkxpbmVhciB2cy4gdW5pbW9kYWwiLCBvdXQud2lkdGggPSAnNzUlJ30NCmtuaXRyOjppbmNsdWRlX2dyYXBoaWNzKCJpbGx1c3RyYXRpb25zL211bHRpX2xpbnVuaS5wbmciKQ0KYGBgDQogICAgDQoNCg0KICArICoqZGlzdGFuY2VzKio6IGRpc3RhbmNlIG1hdHJpeCAgY29tcHV0ZWQgYnkgc2ltaWxhcml0eS9kaXNzaW1pbGFyaXR5IG1lYXN1cmVzLCBhbmQgcHJvamVjdGluZyB0aGVzZSBkaXN0YW5jZXMgaW50byB0d28gb3IgbW9yZSBkaW1lbnNpb25hbCBkaWFncmFtczwvc3Bhbj4NCg0KDQpgYGB7ciwgZWNobz1GQUxTRSwgZmlnLmFsaWduPSdjZW50ZXInLCBmaWcuY2FwPSJPcmRpbmF0aW9uOiBnZW5lcmFsIGZyYW1ld29yayIsIG91dC53aWR0aCA9ICc3NSUnfQ0Ka25pdHI6OmluY2x1ZGVfZ3JhcGhpY3MoImlsbHVzdHJhdGlvbnMvbXVsdGlfb3JkaS5wbmciKQ0KYGBgDQoNClRoZSBzZWxlY3Rpb24gdG93YXJkIGxpbmVhciBvciB1bmltb2RhbCBvcmRpbmF0aW9uIGFwcHJvYWNoIGlzIGNvbW1vbmx5IGRldGVybWluZWQgYnkgYSBydWxlIG9mIHRodW1iIGJ5IHBlcmZvcm1pbmcgYSAqKkRldHJlbmRlZCBDb3JyZXNwb25kZW5jZSBBbmFseXNpcyAoRENBKSoqIHVzaW5nIGBkZWNvcmFuYSgpYCBvbiB0aGUgZGF0YXNldCwgdGhlbiB0byBjaGVjayB0aGUgbGVuZ3RoIG9mIHRoZSAxc3QgRENBIGF4aXMuIFR5cGljYWxseSwgaXQgc2F5czogDQoNCisgKipsZW5ndGg+NCoqLCBkYXRhIGFyZSBoZXRlcm9nZW5vdXMgYW5kIHlvdSBzaG91bGQgdXNlIHVuaW1vZGFsIG1ldGhvZHMNCg0KKyAqKmxlbmd0aDwzKiosIGRhdGEgYXJlIGhvbW9nZW5vdXMgYW5kIHlvdSBzaG91bGQgdXNlIGxpbmVhciBtZXRob2RzDQoNClRoZXJlIGlzIGEgKipncmV5IHpvbmUqKiBiZXR3ZWVuICoqMyBhbmQgNCoqIHdoZXJlIGJvdGggbWV0aG9kcyBhcmUgb2theSAtIGluIGFkZGl0aW9uIGlmIHlvdXIgZGF0YSBhcmUgaGV0ZXJvZ2Vub3VzLCB5b3Ugc3RpbGwgY2FuIHVzZSBQQ0EvUkRBIHVzaW5nIEhlbGxpbmdlcidzIHRyYW5zZm9ybWF0aW9uIG9mIHNwZWNpZXMgZGF0YSogKHRiUENBKQ0KDQoNCmBgYHtyLCAgZXZhbD1ULCBtZXNzYWdlPUZ9DQpkZWNvcmFuYSh2YXJlc3BlYykNCmBgYA0KDQpUb2RheSwgd2Ugd2lsbCBpbGx1c3RyYXRlIHRoZSBtb3N0IGNvbW1vbiB1bmNvbnN0cmFpbmVkIG9yZGluYXRpb24gbWV0aG9kLCBQQ0EsIGFzIHdlbGwgYXMgaXQgY29uc3RyYWluZWQgY291bnRlcnBhcnQsIFJEQS4gSW4gYWRkaXRpb24sIHdlIHdpbGwgbWVudGlvbiBpbGx1c3RyYXRlIHRoZSB1c2Ugb2Ygbm9uLW1ldHJpYyBNdWx0aS1EaW1lbnNpb25hbCBTY2FsaW5nIChuTURTKS4gbk1EUyBpcyBhbiBpbmRpcmVjdCBncmFkaWVudCBhbmFseXNpcyBhcHByb2FjaCB3aGljaCBwcm9kdWNlcyBhbiBvcmRpbmF0aW9uIGJhc2VkIG9uIGEgKipkaXN0YW5jZSoqIG9yICoqZGlzc2ltaWxhcml0eSoqIG1hdHJpeC4gVW5saWtlIHByZXZpb3VzIG1ldGhvZHMgd2hpY2ggYXR0ZW1wdCB0byBtYXhpbWlzZSB0aGUgdmFyaWFuY2Ugb3IgY29ycmVzcG9uZGVuY2UgYmV0d2VlbiBvYmplY3RzIGluIGFuIG9yZGluYXRpb24sIG5NRFMgYXR0ZW1wdHMgdG8gcmVwcmVzZW50LCBhcyBjbG9zZWx5IGFzIHBvc3NpYmxlLCB0aGUgcGFpcndpc2UgZGlzc2ltaWxhcml0eSBiZXR3ZWVuIG9iamVjdHMgaW4gYSBsb3ctZGltZW5zaW9uYWwgc3BhY2UuIEFueSBkaXNzaW1pbGFyaXR5IGNvZWZmaWNpZW50IG9yIGRpc3RhbmNlIG1lYXN1cmUgbWF5IGJlIHVzZWQgdG8gYnVpbGQgdGhlIGRpc3RhbmNlIG1hdHJpeCB1c2VkIGFzIGlucHV0Lg0KDQojIyBQQ0ENCg0KQSBQcmluY2lwYWwgQ29tcG9uZW50IEFuYWx5c2lzIChQQ0EpIGNhcnJpZXMgb3V0IGEgKipyb3RhdGlvbiBzeXN0ZW0gb2YgYXhlcyoqIGRlZmluZWQgYnkgdGhlIHZhcmlhYmxlcywgc3VjaCBhcyBuZXcgYXhlcyAoY2FsbGVkIHByaW5jaXBhbCBjb21wb25lbnQpIGFyZSBvcnRob2dvbmFsIHRvIG9uZSBhbm90aGVyLCBhbmQgY29ycmVzcG9uZCB0byB0aGUgc3VjY2Vzc2l2ZSBkaW1lbnNpb25zIG9mIG1heGltdW0gdmFyaWFuY2Ugb2YgdGhlIHNjYXR0ZXIgcGxvdC4NCg0KQSBQQ0Egd2lsbCBmaW5kIHRoZSAiYmVzdCIgbGluZSAoZmlyc3QgcHJpbmNpcGFsIGNvbXBvbmVudCkgYWNjb3JkaW5nIHRvIHR3byBkaWZmZXJlbnQgY3JpdGVyaWEgb2Ygd2hhdCBpcyB0aGUgImJlc3QiOiBtYXhpbWl6ZSB0aGUgdmFyaWFuY2UgJiBtaW5pbWl6ZSB0aGUgZXJyb3IuDQoNCkFwcGxpZWQgdG8gYSAyRCBleGFtcGxlIG9uIHdpbmUgdGVzdGluZywgdGhpcyBpcyBsaWtlIHRvIGlkZW50aWZ5IGEgbmV3IHByb3BlcnR5IG9mIHdpbmUgYnkgYSBjb21iaW5hdGlvbiBvZiB0d28gdmFyaWFibGVzIChhbGNvaG9sIGNvbnRlbnQgYW5kIHdpbmUgZGFya25lc3MpIGJ5ICdkcmF3aW5nJyBhIGxpbmUgdGhyb3VnaCB0aGUgY2VudGVyIG9mIHRoZSB3aW5lIGNsb3VkLiANCg0KDQpgYGB7ciwgZWNobz1GQUxTRSwgZmlnLmFsaWduPSdjZW50ZXInLCBmaWcuY2FwPSJTY2F0dGVycGxvdCB3aW5lIHByb3BlcnRpZXM6IE1heGltaXppbmcgVmFyaWFuY2UgYW5kIG1pbmltaXppbmcgZXJyb3JzIiwgb3V0LndpZHRoID0gJzc1JSd9DQprbml0cjo6aW5jbHVkZV9ncmFwaGljcygiaWxsdXN0cmF0aW9ucy9tdWx0aV93aW5lLmdpZiIpDQpgYGANCg0KDQpJdCBjb3JyZXNwb25kcyB0byBhIHNpbXBsZSBhcHBsaWNhdGlvbiBvZiB0aGUgUHl0aGFnb3JhIHRoZW9yZW0uDQoNCg0KYGBge3IsIGVjaG89RkFMU0UsIGZpZy5hbGlnbj0nY2VudGVyJywgZmlnLmNhcD0iIiwgb3V0LndpZHRoID0gJzc1JSd9DQprbml0cjo6aW5jbHVkZV9ncmFwaGljcygiaWxsdXN0cmF0aW9ucy9tdWx0aV9QQ0ExLnBuZyIpDQpgYGANCg0KVGhlIGRpcmVjdGlvbiBpcyBnaXZlbiBieSBlaWdlbnZlY3RvciwgYW5kIHRoZSBzdHJlbmd0aCBieSB0aGUgZWlnZW52YWx1ZXMuIA0KDQoNCmBgYHtyLCBlY2hvPUZBTFNFLCBmaWcuYWxpZ249J2NlbnRlcicsIGZpZy5jYXA9IiIsIG91dC53aWR0aCA9ICc3NSUnfQ0Ka25pdHI6OmluY2x1ZGVfZ3JhcGhpY3MoImlsbHVzdHJhdGlvbnMvbXVsdGlfUENBMi5wbmciKQ0KYGBgDQoNCg0KQ2hlY2sgaXQgIFtoZXJlXShodHRwOi8vc2V0b3NhLmlvL2V2L3ByaW5jaXBhbC1jb21wb25lbnQtYW5hbHlzaXMvKSBmb3IgYSB2ZXJ5IHNpbXBsZSBleHBsYW5hdGlvbiBvZiBob3cgUENBIHdvcmtzLCBhbmQgW2hlcmVdKGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9UzUxYlR5SXd4RnMpIGZvciBhDQphIG1vcmUgZGV0YWlsZWQgZXhhbXBsZS4gQnkgdGhlIHdheSAqVGlsZVN0YXRzKiBjaGFubmVsIGlzIHZlcnkgZ29vZCBpZiB5b3UgYXJlIGxvb2tpbmcgYXQgc29tZSBzaW1wbGUgZXhwbGFuYXRpb24gYWJvdXQgc3RhdGlzdGljcy4gSXQgY29tcGxlbWVudHMgdmVyeSB3ZWxsICpTdGF0UXVlc3QqIGV4cGxhbmF0aW9uIG9uIFtQQ0FdKGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9Rmdha1p3NksxUVEpIGZvciANCg0KDQojIyMgQ29tcHV0YXRpb24NCg0KSW4gUiwgYSAqKlBDQSoqIGNhbiBiZSBjb21wdXRlZCB3aXRoIHRoZSBmdW5jdGlvbiBgcmRhKClgIGZyb20gdGhlIGB2ZWdhbmBhbW9uZyBtYW55IG90aGVyIG9wdGlvbnMuDQoNCg0KYGBge3IsICBldmFsPVQsIG1lc3NhZ2U9Rn0NCiMgUENBIG9uIHZhcmVjaGVtIA0KIyBZb3UgY2FuIHN0YW5kYXJkaXplIHVzaW5nIHNjYWxlID1UDQplbnYucGNhPC1yZGEodmFyZWNoZW0sIHNjYWxlPVQpIA0KZW52LnBjYQ0Kc3VtbWFyeShlbnYucGNhKSAjIGRlZmF1bHQgc2NhbGluZyAyDQpgYGANCg0KKipJbmVydGlhKio6IGluIGB2ZWdhbmDigJlzIGxhbmd1YWdlLCB0aGlzIGlzIHRoZSBnZW5lcmFsIHRlcm0gZm9yIOKAnHZhcmlhdGlvbuKAnSBpbiB0aGUgZGF0YQ0KDQoqKkNvbnN0cmFpbmVkIGFuZCB1bmNvbnN0cmFpbmVkKio6IEluIFBDQSwgdGhlIGFuYWx5c2lzIGlzIHVuY29uc3RyYWluZWQsIGkuZS4gbm90IGNvbnN0cmFpbmVkIGJ5IGEgc2V0IG9mIGV4cGxhbmF0b3J5IHZhcmlhYmxlcywgYW5kIHNvIGFyZSB0aGUgcmVzdWx0cw0KDQoqKkVpZ2VudmFsdWVzKiosIHN5bWJvbGl6ZWQgJFxsYW1iZGFfaiQ6IHRoZXNlIGFyZSBtZWFzdXJlcyBvZiB0aGUgaW1wb3J0YW5jZSAodmFyaWFuY2UpIG9mIHRoZSBQQ0EgYXhlcy4gVGhleSBjYW4gYmUgZXhwcmVzc2VkIGFzIHRoZSAqKlByb3BvcnRpb25zIEV4cGxhaW5lZCoqLCBvciBwcm9wb3J0aW9ucyBvZiB2YXJpYXRpb24gYWNjb3VudGVkIGZvciBieSB0aGUgYXhlcy4gSXQgaXMgb2J0YWluZWQgYnkgZGl2aWRpbmcgZWFjaCBlaWdlbnZhbHVlIGJ5IHRoZSDigJx0b3RhbCBpbmVydGlh4oCdLg0KDQoqKlNjYWxpbmcqKjogbm90IHRvIGJlIGNvbmZ1c2VkIHdpdGggdGhlIGFyZ3VtZW50IOKAnHNjYWxl4oCdIGNhbGxpbmcgZm9yIHN0YW5kYXJkaXphdGlvbiBvZiB2YXJpYWJsZXMuIOKAnFNjYWxpbmfigJ0gcmVmZXJzIHRvIHRoZSB3YXkgb3JkaW5hdGlvbiByZXN1bHRzIGFyZSBwcm9qZWN0ZWQgaW4gdGhlIHJlZHVjZWQgc3BhY2UgZm9yIGdyYXBoaWNhbCBkaXNwbGF5LiBUaGVyZSBpcyBubyBzaW5nbGUgd2F5IG9mIG9wdGltYWxseSBkaXNwbGF5aW5nIG9iamVjdHMgYW5kIHZhcmlhYmxlcyB0b2dldGhlciBpbiBhIFBDQSBiaXBsb3QsIGkuZS4sIGEgcGxvdCBzaG93aW5nIHR3byB0eXBlcyBvZiByZXN1bHRzLCBoZXJlIHRoZSBzaXRlcyBhbmQgdGhlIHZhcmlhYmxlcy4gVHdvIG1haW4gdHlwZXMgb2Ygc2NhbGluZyBhcmUgZ2VuZXJhbGx5IHVzZWQuIEVhY2ggb2YgdGhlbSBoYXMgcHJvcGVydGllcyB0aGF0IG11c3QgYmUga2VwdCBpbiBtaW5kIGZvciBwcm9wZXIgaW50ZXJwcmV0YXRpb24gb2YgdGhlIGJpcGxvdHMuIEhlcmUgd2UgZ2l2ZSB0aGUgZXNzZW50aWFsIGZlYXR1cmVzIG9mIGVhY2ggc2NhbGluZy4gUGxlYXNlIHJlZmVyIHRvIExlZ2VuZHJlIGFuZCBMZWdlbmRyZSAoMjAxMikgZm9yIGEgY29tcGxldGUgZGVzY3JpcHRpb24uDQoNCisgKipTY2FsaW5nIDEqKiA9IGRpc3RhbmNlIGJpcGxvdDogdGhlIGVpZ2VudmVjdG9ycyBhcmUgc2NhbGVkIHRvIHVuaXQgbGVuZ3RoLiAoMSkgKipEaXN0YW5jZXMgYW1vbmcgb2JqZWN0cyBpbiB0aGUgYmlwbG90IGFyZSBhcHByb3hpbWF0aW9ucyBvZiB0aGVpciBFdWNsaWRlYW4gZGlzdGFuY2VzIGluIG11bHRpZGltZW5zaW9uYWwgc3BhY2UqKi4gKDIpIFRoZSBhbmdsZXMgYW1vbmcgZGVzY3JpcHRvciB2ZWN0b3JzIGRvIG5vdCByZWZsZWN0IHRoZWlyIGNvcnJlbGF0aW9ucy4NCg0KKyAqKlNjYWxpbmcgMioqID0gY29ycmVsYXRpb24gYmlwbG90OiBlYWNoIGVpZ2VudmVjdG9yIGlzIHNjYWxlZCB0byB0aGUgc3F1YXJlIHJvb3Qgb2YgaXRzIGVpZ2VudmFsdWUuICgxKSBEaXN0YW5jZXMgYW1vbmcgb2JqZWN0cyBpbiB0aGUgYmlwbG90IGFyZSBub3QgYXBwcm94aW1hdGlvbnMgb2YgdGhlaXIgRXVjbGlkZWFuIGRpc3RhbmNlcyBpbiBtdWx0aWRpbWVuc2lvbmFsIHNwYWNlLiAoMikgKipUaGUgYW5nbGVzIGJldHdlZW4gZGVzY3JpcHRvcnMgaW4gdGhlIGJpcGxvdCByZWZsZWN0IHRoZWlyIGNvcnJlbGF0aW9ucy4qKg0KDQorIFRoZSBjb21wcm9taXNlICoqU2NhbGluZyAzKiogaGFzIG5vIGNsZWFyIGludGVycHJldGF0aW9uIHJ1bGVzLCBhbmQgdGhlcmVmb3JlIHdlIHdpbGwgbm90IGRpc2N1c3MgaXQgZnVydGhlci4NCg0KQm90dG9tIGxpbmU6IGlmIHRoZSBtYWluIGludGVyZXN0IG9mIHRoZSBhbmFseXNpcyBpcyB0byBpbnRlcnByZXQgdGhlIHJlbGF0aW9uc2hpcHMgYW1vbmcgKipvYmplY3RzKiosIGNob29zZSAqKnNjYWxpbmcgMSoqLiBJZiB0aGUgbWFpbiBpbnRlcmVzdCBmb2N1c2VzIG9uIHRoZSByZWxhdGlvbnNoaXBzIGFtb25nIGRlc2NyaXB0b3JzLCBjaG9vc2UgKipzY2FsaW5nIDIqKi4NCg0KYGBge3IsICBldmFsPVQsIG1lc3NhZ2U9Rn0NCiMgUGxvdHMgdXNpbmcgYmlwbG90DQojIFRvIGhlbHAgbWVtb3JpemUgdGhlIG1lYW5pbmcgb2YgdGhlIHNjYWxpbmdzLCB2ZWdhbiBub3cgYWNjZXB0cyBhcmd1bWVudCBzY2FsaW5nID0gInNpdGVzIiBmb3Igc2NhbGluZyAxIGFuZCBzY2FsaW5nPSJzcGVjaWVzIiBmb3Igc2NhbGluZyAyLiBUaGlzIGlzIHRydWUgZm9yIGFsbCB2ZWdhbiBmdW5jdGlvbnMgaW52b2x2aW5nIHNjYWxpbmdzDQpwYXIobWZyb3cgPSBjKDEsIDIpKQ0KYmlwbG90KGVudi5wY2EsIHNjYWxpbmcgPSAic2l0ZXMiLCBtYWluID0gInNjYWxpbmcgMSAvIHNpdGVzIikNCmJpcGxvdChlbnYucGNhLCBzY2FsaW5nID0gInNwZWNpZXMiLCBtYWluID0gInNjYWxpbmcgMiAvIHNwZWNpZXMiKSAjIERlZmF1bHQgc2NhbGluZyAyDQpgYGANCg0KKipTcGVjaWVzIHNjb3JlcyoqOiBjb29yZGluYXRlcyBvZiB0aGUgYXJyb3doZWFkcyBvZiB0aGUgdmFyaWFibGVzLiBGb3IgaGlzdG9yaWNhbCByZWFzb25zLCByZXNwb25zZSB2YXJpYWJsZXMgYXJlIGFsd2F5cyBjYWxsZWQg4oCcc3BlY2llc+KAnSBpbiB2ZWdhbiwgbm8gbWF0dGVyIHdoYXQgdGhleSByZXByZXNlbnQsIGJlY2F1c2UgYHZlZ2FuYCBpcyBidWlsdCBmb3IgdmVnZXRhdGlvbiBhbmFseXNpcy4NCg0KYGBge3IsICBldmFsPVQsIG1lc3NhZ2U9Rn0NCnN1bW1hcnkoZW52LnBjYSkkc3BlY2llcw0KYGBgDQoNCioqU2l0ZSBzY29yZXMqKjogY29vcmRpbmF0ZXMgb2YgdGhlIHNpdGVzIGluIHRoZSBvcmRpbmF0aW9uIGRpYWdyYW0uIE9iamVjdHMgYXJlIGFsd2F5cyBjYWxsZWQg4oCcU2l0ZXPigJ0gaW4gdmVnYW4gb3V0cHV0IGZpbGVzLg0KDQpgYGB7ciwgIGV2YWw9VCwgbWVzc2FnZT1GfQ0Kc3VtbWFyeShlbnYucGNhKSRzaXRlDQpgYGANCg0KIyMjIEVpZ2VudmFsdWVzDQoNCkV4YW1pbmUgZWlnZW52YWx1ZXMgaXMgaW1wb3J0YW50IHRvIGRlY2lkZSBob3cgbWFueSBheGVzIHRvIHJldGFpbi4gVXN1YWxseSwgd2UgZXhhbWluZSB0aGUgZWlnZW52YWx1ZXMgYW5kIGRlY2lkZSBob3cgbWFueSBheGVzIGFyZSB3b3J0aCByZXByZXNlbnRpbmcgYW5kIGRpc3BsYXlpbmcgb24gdGhlIGJhc2lzIG9mIHRoZSBhbW91bnQgb2YgdmFyaWFuY2UgZXhwbGFpbmVkLiBUaGUgZGVjaXNpb24gY2FuIGJlIGNvbXBsZXRlbHkgYXJiaXRyYXJ5IChmb3INCmluc3RhbmNlLCBpbnRlcnByZXQgdGhlIG51bWJlciBvZiBheGVzIG5lY2Vzc2FyeSB0byByZXByZXNlbnQgNzUlIG9mIHRoZSB2YXJpYW5jZSBvZiB0aGUgZGF0YSksIG9yIGFzc2lzdGVkIGJ5IG9uZSBvZiBzZXZlcmFsIHByb2NlZHVyZXMgcHJvcG9zZWQgdG8gc2V0IGEgbGltaXQgYmV0d2VlbiB0aGUgYXhlcyB0aGF0IHJlcHJlc2VudCBpbnRlcmVzdGluZyB2YXJpYXRpb24gb2YgdGhlIGRhdGEgYW5kIGF4ZXMgdGhhdCBtZXJlbHkgZGlzcGxheSB0aGUgcmVtYWluaW5nLCBlc3NlbnRpYWxseSByYW5kb20gdmFyaWFuY2UuIA0KDQoNCk9uZSBvZiB0aGVzZSBwcm9jZWR1cmVzIGNvbnNpc3RzIGluIGNvbXB1dGluZyBhICoqYnJva2VuIHN0aWNrIG1vZGVsKiosIHdoaWNoIHJhbmRvbWx5IGRpdmlkZXMgYSBzdGljayBvZiB1bml0IGxlbmd0aCBpbnRvIHRoZSBzYW1lIG51bWJlciBvZiBwaWVjZXMgYXMgdGhlcmUgYXJlIFBDQSBlaWdlbnZhbHVlcy4gT25lIGludGVycHJldHMgb25seSB0aGUgYXhlcyB3aG9zZSBlaWdlbnZhbHVlcyBhcmUgbGFyZ2VyIHRoYW4gdGhlIGxlbmd0aCBvZiB0aGUgY29ycmVzcG9uZGluZyBwaWVjZSBvZiB0aGUgc3RpY2ssIG9yLCBhbHRlcm5hdGVseSwgb25lIG1heSBjb21wYXJlIHRoZSBzdW0gb2YgZWlnZW52YWx1ZXMsIGZyb20gMSB0byBrLCB0byB0aGUgc3VtIG9mIHRoZSB2YWx1ZXMgZnJvbSAxIHRvIGsgcHJlZGljdGVkIGJ5IHRoZSBicm9rZW4gc3RpY2sgbW9kZWwuDQoNCmBgYHtyLCAgZXZhbD1ULCBtZXNzYWdlPUZ9DQpzY3JlZXBsb3QoZW52LnBjYSwgYnN0aWNrID0gVFJVRSwgbnBjcyA9IGxlbmd0aChlbnYucGNhJENBJGVpZykpDQpgYGANCg0KIyMjIEludGVwcmV0YXRpb24NCg0KVGhlIHByb3BvcnRpb24gb2YgdmFyaWFuY2UgYWNjb3VudGVkIGZvciBieSB0aGUgdHdvIGF4ZXMgaXMgYWJvdXQgNjAgJTogcmVsYXRpdmUgaGlnaCB2YWx1ZSBtYWtlcyB1cyBjb25maWRlbnQgdGhhdCBvdXIgaW50ZXJwcmV0YXRpb24gb2YgdGhlIGZpcnN0IHBhaXIgb2YgYXhlcyBleHRyYWN0cyBtb3N0IHJlbGV2YW50IGluZm9ybWF0aW9uIG9mIHRoZSBkYXRhIHNldC4NCg0KKipTY2FsaW5nIDEqKjogR3JhZGllbnQgZnJvbSBsZWZ0IHRvIHJpZ2h0IHdpdGggYSBncm91cCBvZiBzaXRlcyBkaXNwbGF5aW5nIGhpZ2hlciB2YWx1ZXMgb2YgQ2EsIE1nLCBLLCBabiwgUy4gR3JhZGllbnQgZnJvbSB0b3AgdG8gZG93biB3aXRoIGh1bXBkZXB0aCBhbmQgYmFyZXNvaWwuDQoNCioqU2NhbGluZyAyKio6IEh1bWRlcHRoLCBCYXJlc29pbCBhcmUgdmVyeSBoaWdobHkgcG9zaXRpdmVseSBjb3JyZWxhdGVkLiBUaG9zZSB0d28gdmFyaWFibGVzIGFyZSB2ZXJ5IGhpZ2hseSBuZWdhdGl2ZWx5IGNvcnJlbGF0ZWQgd2l0aCBwSCBhbmQgRmUuDQoNCmBgYHtyLCAgZXZhbD1ULCBtZXNzYWdlPUZ9DQojIGNvbWJpbmluZyBjbHVzdGVyaW5nIGFuZCBvcmRpbmF0aW9uIHJlc3VsdHMNCmJpcGxvdChlbnYucGNhLCBtYWluPSdQQ0EgLSBzY2FsaW5nIDEnLHNjYWxpbmc9MSkgDQpvcmRpY2x1c3RlcihlbnYucGNhLCANCiAgICAgICAgICAgIGhjbHVzdChkaXN0KHNjYWxlKHZhcmVjaGVtKSksICd3YXJkLkQnKSwgDQogICAgICAgICAgICBwcnVuZT0zLCBjb2wgPSAiYmx1ZSIsIHNjYWxpbmc9MSkNCmBgYA0KDQojIyMgdGItUENBDQoNClBDQSBiZWluZyBhIGxpbmVhciBtZXRob2QgcHJlc2VydmluZyB0aGUgRXVjbGlkZWFuIGRpc3RhbmNlIGFtb25nIHNpdGVzLCBpdCBpcyBub3QgbmF0dXJhbGx5IGFkYXB0ZWQgdG8gdGhlIGFuYWx5c2lzIG9mIHNwZWNpZXMgYWJ1bmRhbmNlIGRhdGEuIEhlbGxpbmdlciB0cmFuc2Zvcm1hdGlvbiBhbiB0aGUgdXNlIG9mIGEgdHJhbnNmb3JtYXRpb24gYmFzZWQgUENBIHNvbHZlcyB0aGlzIHByb2JsZW0uIA0KDQoNCmBgYHtyLCAgZXZhbD1ULCBtZXNzYWdlPUYsIHdhcm5pbmdzPUZ9DQpkZWNvcmFuYSAodmFyZXNwZWMuaGVsbCkNCnNwZS5oLnBjYTwtcmRhKHZhcmVzcGVjLmhlbGwpDQpzY3JlZXBsb3Qoc3BlLmgucGNhLGJzdGljayA9IFRSVUUsIG5wY3MgPSBsZW5ndGgoc3BlLmgucGNhJENBJGVpZykpIA0KYGBgDQoNCiMjIyBLZXkgcG9pbnRzIG9uIFBDQQ0KDQorIFBDQSBtdXN0IGJlIGNvbXB1dGVkIG9uICoqZGltZW5zaW9uYWxseSBob21vZ2Vub3VzKiogdmFyaWFibGVzDQoNCisgZGF0YSBtYXRyaXggKipub3QgdHJhbnNwb3NlZCoqIHNpbmNlIGNvdmFyaWFuY2Ugb3IgY29ycmVsYXRpb25zIGFtb25nIG9iamVjdHMgYXJlIG1lYW5pbmdsZXNzDQoNCisgUENBIGNhbiBiZSBhcHBsaWVkIHRvICoqYmluYXJ5KiogZGF0YQ0KDQorIFNwZWNpZXMgUHJlc2VuY2UtQWJzZW5jZSBkYXRhIGNhbiBiZSBzdWJqZWN0IHRvIGEgKipIZWxsaW5nZXIgb3IgY2hvcmQgdHJhbnNmb3JtYXRpb24qKiBwcmlvciBQQ0EgDQoNCisgSW50ZXJwcmV0YXRpb24gcmVsYXRpb25zaGlwIHZhcmlhYmxlIGJhc2VkIG9uICoqYW5nbGVzKioNCg0KKipOb3RlKio6IEFsdGhvdWdoIHRoZXJlIGFyZSBtZWFucyBvZiBpbmNvcnBvcmF0aW5nIGV4cGxhbmF0b3J5IHZhcmlhYmxlcyBkaXJlY3RseSBpbiB0aGUgb3JkaW5hdGlvbiBwcm9jZXNzIChjYW5vbmljYWwgb3JkaW5hdGlvbiksIG9uZSBtYXkgYmUgaW50ZXJlc3RlZCBpbiBpbnRlcnByZXRpbmcgYSBzaW1wbGUgb3JkaW5hdGlvbiBieSBtZWFucyBvZiBleHRlcm5hbCB2YXJpYWJsZXMuIEl0IGlzIHBvc3NpYmxlIHRvIGdldCBhIHBhc3NpdmUgKCpwb3N0LWhvYyopIGV4cGxhbmF0aW9uIG9mIGF4ZXMgdXNpbmcgZW52aXJvbm1lbnRhbCB2YXJpYWJsZXMgd2l0aCBgZW52LmZpdCgpYC4gDQoNCmBlbnZmaXQoKWAgIHByb3Bvc2VzIHBlcm11dGF0aW9uIHRlc3RzIHRvIGFzc2VzcyB0aGUgc2lnbmlmaWNhbmNlIG9mIHRoZSBSXjJeIG9mIGVhY2ggZXhwbGFuYXRvcnkgdmFyaWFibGUgcmVncmVzc2VkIG9uIHRoZSB0d28gYXhlcyBvZiB0aGUgYmlwbG90LiBCdXQgdGhpcyBpcyBub3QsIGJ5IGZhciwgdGhlIGJlc3Qgd2F5IHRvIHRlc3QgdGhlIGVmZmVjdCBvZiBleHBsYW5hdG9yeSB2YXJpYWJsZXMgb24gYSB0YWJsZSBvZiByZXNwb25zZSB2YXJpYWJsZXMuDQoNCg0KYGBge3IsICBldmFsPVQsIG1lc3NhZ2U9Rn0NCiMgYWRkaW5nIGNvcnJlbGF0aW9uIGNpcmNsZQ0KY2xlYW5wbG90LnBjYSAoc3BlLmgucGNhKSANCiMgU2NhbGluZyAyIGlzIGRlZmF1bHQNCihzcGUuaC5wY2EuZW52IDwtIGVudmZpdChzcGUuaC5wY2EsIHZhcmVjaGVtLCBzY2FsaW5nID0gMikpDQojIHBsb3Qgc2lnbmlmaWNhbnQgdmFyaWFibGVzIHdpdGggYSB1c2VyIC1zZWxlY3RlZCBjb2xvdXINCnBsb3Qoc3BlLmgucGNhLmVudiwgcC5tYXggPSAwLjA1LCBjb2wgPSAzKQ0KIyBUaGlzIGhhcyBhZGRlZCB0aGUgc2lnbmlmaWNhbnQgZW52aXJvbm1lbnRhbCB2YXJpYWJsZXMgdG8gdGhlDQojIGxhc3QgYmlwbG90IGRyYXduIGJ5IFIuDQojIEJFV0FSRTogZW52Zml0KCkgbXVzdCBiZSBnaXZlbiB0aGUgc2FtZSBzY2FsaW5nIGFzIHRoZSBwbG90IHRvIA0KIyB3aGljaCBpdHMgcmVzdWx0IGlzIGFkZGVkIQ0KYGBgDQoNCiMjIFJEQSAmIHRiLVJEQSANCg0KUmVkdW5kYW5jeSBBbmFseXNpcyAoUkRBICYgdGItUkRBKSB1c2UgdGhlIHNhbWUga2luZCBvZiBmb3JtdWxhIGFzIHVzZWQgaW4gYGxtYCBhbmQgb3RoZXIgUiBmdW5jdGlvbnMgZGV2b3RlZCB0byByZWdyZXNzaW9uLiBDaGVjayBgP3JkYWAgZm9yIGRldGFpbHMuIFdlIHdpbGwgYmFzZSBvdXIgZXhhbXBsZSBvbiBhIEhlbGxpbmdlciB0cmFuc2Zvcm1lZCBkYXRhIHNldCBzdWNoIGlsbHVzdHJhdGluZyB0aGUgY2FzZSBvZiBhICoqdHJhbnNmb3JtYXRpb24tYmFzZWQgUkRBKioNCg0KIyMjIENvbXB1dGF0aW9uDQoNCmBgYHtyLCAgZXZhbD1ULCBtZXNzYWdlPUZ9DQpzcGUucmRhIDwtIHJkYSh2YXJlc3BlYy5oZWxsfi4sdmFyZWNoZW0uc3RhbmQpIA0Kc3VtbWFyeSAoc3BlLnJkYSkgIyBzY2FsaW5nIDIgKGRlZmF1bHQpDQpgYGANCg0KDQorICoqUGFydGl0aW9uaW5nIG9mIHZhcmlhbmNlKio6IHZhcmlhbmNlIG9mIFkgZXhwbGFpbmVkIGJ5IHRoZSBYIHZhcmlhYmxlcyAoY29uc3RyYWluZWQgcHJvcG9ydGlvbiwgNzIuNzElIGhlcmUpLCB0aGUgdW5leHBsYWluZWQgdmFyaWFuY2Ugb2YgWSAodW5jb25zdHJhaW5lZCBwcm9wb3J0aW9uLCAyNy4yOSUgaGVyZSkuIFRoaXMgUl4yXiBpcyBiaWFzZWQuIA0KDQorICoqRWlnZW52YWx1ZXMgYW5kIHRoZWlyIGNvbnRyaWJ1dGlvbioqOiBTdW1tYXJpemUgdGhlIGVpZ2VudmFsdWVzLCB0aGUgcHJvcG9ydGlvbnMgZXhwbGFpbmVkIGFuZCB0aGUgY3VtdWxhdGl2ZSBwcm9wb3J0aW9uIG9mIGVhY2ggY2Fub25pY2FsIGF4aXMgKGVhY2ggY2Fub25pY2FsIGF4aXMgPSBlYWNoIGNvbnN0cmFpbmluZyB2YXJpYWJsZSwgaW4gdGhpcyBjYXNlLCB0aGUgZW52aXJvbm1lbnRhbCB2YXJpYWJsZXMgZnJvbSBlbnYpLiBDdW11bGF0aXZlIHByb3BvcnRpb24gZ2l2ZSB0aGUgYmlhc2VkIFJeMl4uDQoNCisgKipBY2N1bXVsYXRlZCBjb25zdHJhaW5lZCBlaWdlbnZhbHVlcyoqOiB0aGVzZSBhcmUgY3VtdWxhdGl2ZSBhbW91bnRzIG9mIHZhcmlhbmNlIGV4cHJlc3NlZCBhcyBwcm9wb3J0aW9ucyBvZiB0aGUgdG90YWwgKmV4cGxhaW5lZCogdmFyaWFuY2UsIGFzIG9wcG9zZWQgdG8gdGhlaXIgY29udHJpYnV0aW9uIHRvIHRoZSAqdG90YWwqIHZhcmlhbmNlIGRlc2NyaWJlZCBiZWZvcmUNCg0KKyAqKlNwZWNpZXMgc2NvcmVzKio6IGNvb3JkaW5hdGVzIG9mIHRoZSB0aXBzIG9mIHRoZSB2ZWN0b3IgcmVwcmVzZW50aW5nIHRoZSByZXNwb25zZSB2YXJpYWJsZXMgaW4gdGhlIGJpLSBvciB0cmktIHBsb3RzLiBEZXBlbmRpbmcgb24gdGhlIHNjYWxpbmcgY2hvc2VuDQoNCisgKipTaXRlIHNjb3JlcyoqOiBjb29yZGluYXRlcyBvZiB0aGUgc2l0ZXMgYXMgZXhwcmVzc2VkIGluIHRoZSBzcGFjZSBvZiB0aGUgcmVzcG9uc2UgdmFyaWFibGVzIFkNCg0KKyAqKlNpdGUgY29uc3RyYWludHMqKjogY29vcmRpbmF0ZXMgb2YgdGhlIHNpdGVzIGluIHRoZSBzcGFjZSBvZiB0aGUgZXhwbGFuYXRvcnkgdmFyaWFibGUgWC4gRml0dGVkIHNpdGUgc2NvcmVzDQoNCisgKipCaXBsb3Qgc2NvcmVzKio6ICBjb29yZGluYXRlcyBvZiB0aGUgdGlwcyBvZiB0aGUgdmVjdG9ycyByZXByZXNlbnRpbmcgZXhwbGFuYXRvcnkgdmFyaWFibGVzLiBDb3JyZWxhdGlvbnMgYmFzZWQuIEZvciBmYWN0b3JzLCByZXByZXNlbnRhdGlvbiBvZiB0aGUgY2VudHJvaWRzIG9mIHRoZSBsZXZlbHMgaXMgcHJlZmVyYWJsZS4NCg0KKyAqKkNlbnRyb2lkcyBmb3IgZmFjdG9yIGNvbnN0cmFpbnRzKio6IGNvb3JkaW5hdGVzIG9mIGNlbnRyb2lkcyBvZiBsZXZlbHMgb2YgZmFjdG9yIHZhcmlhYmxlcywgaS5lLiBtZWFucyBvZiB0aGUgc2NvcmVzIG9mIHRoZSBzaXRlcyBwb3NzZXNzaW5nIHN0YXRlICcxJyBmb3IgYSBnaXZlbiBsZXZlbC4NCg0KDQpJbiB0aGUgYHJkYWAgb3V0cHV0LCBhbiBpbnRlcmVzdGluZyBpbmZvcm1hdGlvbiBpcyBtaXNzaW5nOiB0aGUgY2Fub25pY2FsIGNvZWZmaWNpZW50cywgKmkuZS4qIHRoZSAqKmVxdWl2YWxlbnQgb2YgcmVncmVzc2lvbiBjb2VmZmljaWVudHMgZm9yIGVhY2ggZXhwbGFuYXRvcnkgdmFyaWFibGUgb24gZWFjaCBjYW5vbmljYWwgYXhpcyoqLiBUaGV5IGNhbiBiZSByZXRyaWV2ZWQgdXNpbmcgYGNvZWZgOg0KDQpgYGB7ciwgIGV2YWw9VCwgbWVzc2FnZT1GfQ0KY29lZihzcGUucmRhKQ0KYGBgDQoNCkluIGFkZGl0aW9uIGxpa2UgdGhlIG9yZGluYXJ5IFJeMl4gZnJvbSBtdWx0aXBsZSByZWdyZXNzaW9uIHRoZSBSXjJeIGlzIGJpYXNlZC4gSXQgY2FuIGJlIGN1cmUgYnkgYWRqdXN0aW5nIHRoZSBSXjJeIHVzaW5nIEV6ZWtpZWwncyBmb3JtdWxhIChFemVraWVsIDE5MzApLiBBbiBhZGp1c3RlZCBSXjJeICBuZWFyIDAgaW5kaWNhdGVzIHRoYXQgWCBkb2VzIG5vdCBleHBsYWluIG1vcmUgb2YgdGhlIHZhcmlhdGlvbiBvZiBZIHRoYW4gcmFuZG9tIG5vcm1hbCB2YXJpYWJsZXMgd291bGQgZG8uIEl0IGNhbiBiZSBuZWdhdGl2ZSwgaW5kaWNhdGluZyB0aGF0IHRoZSBleHBsYW5hdG9yeSB2YXJpYWJsZXMgWCBkbyB3b3JzZSB0aGFuIHJhbmRvbSBub3JtYWwgdmFyaWFibGUgd291bGQuIFRoZSBSXjJeIGFuZCBhZGp1c3RlZC1SXjJeIGNhbiBiZSBjb21wdXRlZCB1c2luZyB2ZWdhbidzIGZ1bmN0aW9uIGBSc3F1YXJlQWRqYCANCg0KYGBge3IsICBldmFsPVQsIG1lc3NhZ2U9Rn0NCiNSZXRyaWV2YWwgb2YgdGhlIGFkanVzdGVkIFIyDQojIFVuYWRqdXN0ZWQgUjIgcmV0cmlldmUgZnJvbSBSREEgcmVzdWx0cw0KUjI8LVJzcXVhcmVBZGooc3BlLnJkYSkkci5zcXVhcmVkDQojIEFkanVzdGVkIFIyIHJldHJpZXZlIGZyb20gUkRBIG9iamVjdA0KUjJhZGo8LVJzcXVhcmVBZGooc3BlLnJkYSkkYWRqLnIuc3F1YXJlZA0KYGBgDQoNCiMjIyB0Yi1SREEgcGxvdHMNCg0KV2UgY2FuIGNhbGwgdGhpcyBhIHRyaXBsb3Qgc2luY2UgdGhlcmUgYXJlIHRocmVlIGRpZmZlcmVudCBlbnRpdGllcyBpbiB0aGUgcGxvdDogc2l0ZXMsIHJlc3BvbnNlIHZhcmlhYmxlcyBhbmQgZXhwbGFuYXRvcnkgdmFyaWFibGVzLiBUbyBkaWZmZXJlbnRpYXRlIHRoZSBsYXR0ZXIgdHdvLCBpdCBpcyBnb29kIHRvIGRyYXcgYXJyb3doZWFkIG9ubHkgb24gdGhlIHZlY3RvciBvZiB0aGUgcXVhbnRpdGF0aXZlIGV4cGxhbmF0b3J5IHZhcmlhYmxlcywgbm90IG9uIHRoZSByZXNwb25zZSB2YXJpYWJsZSB2ZWN0b3JzDQoNCmBgYHtyLCAgZXZhbD1ULCBtZXNzYWdlPUZ9DQojIHRyaXBsb3Qgb2YgdGhlIHJkYSByZXN1bHRzDQpwYXIobWZyb3cgPSBjKDIsIDIpKQ0KDQojIHNpdGUgc2NvcmVzIGFyZSB3ZWlnaHRlZCBieSBzdW0gb2Ygc3BlY2llcw0KIyBzY2FsaW5nIDE6IGRpc3RhbmNlIHRyaXBsb3QNCnBsb3QgKHNwZS5yZGEsIHNjYWxpbmc9MSwgbWFpbj0nVHJpcGxvdCBSREEgc3BlLmhlbCB+IGVudiDigJMgc2NhbGluZyAxIOKAkyB3YSBzY29yZXMnKQ0Kc3BlLnNjIDwtIHNjb3JlcyAoc3BlLnJkYSwgY2hvaWNlcz0xOjIsIHNjYWxpbmc9MSwgZGlzcGxheT0nc3AnKSANCmFycm93cyAoMCwwLCBzcGUuc2NbLDFdLHNwZS5zY1ssMl0sbGVuZ3RoPTAsbHR5PTEsY29sPSdyZWQnKSANCg0KIyBzY2FsaW5nIDIgKGRlZmF1bHQpDQpwbG90IChzcGUucmRhLG1haW49J1RyaXBsb3QgUkRBIHNwZS5oZWwgfiBlbnYg4oCTIHNjYWxpbmcgMiDigJMgd2Egc2NvcmVzJykNCnNwZTIuc2MgPC0gc2NvcmVzIChzcGUucmRhLCBjaG9pY2VzPTE6MiwgZGlzcGxheT0nc3AnKQ0KYXJyb3dzICgwLDAsIHNwZTIuc2NbLDFdLHNwZTIuc2NbLDJdLGxlbmd0aD0wLGx0eT0xLGNvbD0ncmVkJykNCg0KIyBzaXRlIHNjb3JlcyBhcmUgbGluZWFyIGNvbWJpbmF0aW9ucyBvZiB0aGUgZW52aXJvbm1lbnRhbCB2YXJpYWJsZXMNCiMgc2NhbGluZyAxDQpwbG90IChzcGUucmRhLHNjYWxpbmc9MSxkaXNwbGF5PWMoJ3NwJywnbGMnLCdjbicpLG1haW49J1RyaXBsb3QgUkRBIHNwZS5oZWwgfiBlbnYg4oCTIHNjYWxpbmcgMSDigJMgbGMgc2NvcmVzJykNCmFycm93cyAoMCwwLCBzcGUuc2NbLDFdLHNwZS5zY1ssMl0sbGVuZ3RoPTAsbHR5PTEsY29sPSdyZWQnKQ0KIyBzY2FsaW5nIDINCnBsb3QgKHNwZS5yZGEsZGlzcGxheT1jKCdzcCcsJ2xjJywnY24nKSxtYWluPSdUcmlwbG90IFJEQSBzcGUuaGVsIH4gZW52IOKAkyBzY2FsaW5nIDIg4oCTIGxjIHNjb3JlcycpICMgY24gZm9yIGNlbnRyb2lkcw0KYXJyb3dzICgwLDAsIHNwZTIuc2NbLDFdLHNwZTIuc2NbLDJdLGxlbmd0aD0wLGx0eT0xLGNvbD0ncmVkJykNCmBgYA0KDQojIyMgSW50ZXJwcmV0YXRpb24NCg0KKipPcmRpbmF0aW9uKioNCg0KKyBJbnRlcnByZXRhdGlvbiBvZiB0aGUgdHdvIHNjYWxpbmcNCg0KICArIEZvciB0aGUgc3BlY2llcyBhbmQgdGhlIHNpdGVzIHRoZSBpbnRlcnByZXRhdGlvbiBvZiB0aGUgdHdvIHNjYWxpbmdzIGFyZSB0aGUgc2FtZSBhcyBpbiBhIFBDQQ0KICANCiAgKyBQcmVzZW5jZSBvZiB2ZWN0b3JzIGFuZCBjZW50cm9pZHMgb2YgZXhwbGFuYXRvcnkgdmFyaWFibGVzIGNhbGwgZm9yIGFkZGl0aW9uYWwgcnVsZXMNCiAgDQorIExldCBpbnRlcnByZXQgb3VyIHR3byBsYXN0IHRyaXBsb3RzOg0KDQogICsgRmlyc3QgdHdvIGNhbm9uaWNhbCBheGlzIGFsb25lIGV4cGxhaW5pbmcgNTguMyUgb2YgdGhlIHRvdGFsIHZhcmlhbmNlIG9mIHRoZSBkYXRhLCB0aGUgZmlyc3QgYXhpcyBhbG9uZSBleHBsYWluaW5nIDQ3LjYlICh1bmFkanVzdGVkIHZhbHVlcykNCg0KICArIFNpbmNlIFJeMl4tYWRqICA9IDAuNTMyMCwgdGhlIHBlcmNlbnRhZ2VzIG9mIGFjY3VtdWxhdGVkIGNvbnN0cmFpbmVkIGVpZ2VudmFsdWVzIHNob3cgdGhhdCB0aGUgZmlyc3QgYXhpcyBhbG9uZSBleHBsYWlucyAwLjUyMjQgeCAwLjY0MyA9IDAuMzM2ICBvciAzMy42JSB2YXJpYW5jZSwgYW5kIHRoZSB0d28gZmlyc3QgMC41MjI0IHggMC43ODggPSAwLjQxMiBvciA0MS4yJQ0KICANCiAgKyBNYWpvciB0cmVuZHMgaGF2ZSBiZWVuIG1vZGVsbGVkIGluIHRoaXMgYW5hbHlzaXMgISBJbiBlY29sb2d5LCBkYXRhIGFyZSBxdWl0ZSBub2lzeSwgc28geW91IHNob3VsZCBuZXZlciBleHBlY3QgYSB2ZXJ5IGhpZ2ggdmFsdWUgb2YgUjIgYWRqIGJ1dCB0aGVyZSBpcyBhIHdheSB0byB0ZXN0IGZvciB0aGUgb3ZlcmFsbCBzaWduaWZpY2FuY2Ugb2YgdGhlIG1vZGVsIGFuZCBSREEgYXhlcy4NCiAgDQoNCioqUkRBIG1vZGVsIHRlc3QqKg0KDQpUaGUgb3ZlcmFsbCB0ZXN0IGZ1bmN0aW9uIGlzIGNhbGxlZCBgYW5vdmEuY2NhYC4gVGhpcyBuYW1lIGlzIHVuZm9ydHVuYXRlLCBzaW5jZSBpdCBsZWFkcyB0byBjb25mdXNpb24gd2l0aCB0aGUgY2xhc3NpY2FsIEFOT1ZBIHRlc3QsIHdoaWNoIGl0IGlzIG5vdCAhDQoNCmBgYHtyLCAgZXZhbD1ULCBtZXNzYWdlPUZ9DQojIEdsb2JhbCB0ZXN0IG9mIHRoZSBSREEgcmVzdWx0cw0KYW5vdmEuY2NhKHNwZS5yZGEsc3RlcD0xMDAwKQ0KYGBgDQoNClRoZSB0ZXN0IG9mIHRoZSBheGVzIGNhbiBvbmx5IGJlIHJ1biB3aXRoIHRoZSBmb3JtdWxhIHN5bnRoYXguIEhvdyBtYW55IGNhbm9uaWNhbCBheGVzIGFyZSBzaWduaWZpY2FudD8NCg0KYGBge3IsICBldmFsPVQsIG1lc3NhZ2U9Rn0NCiMgVGVzdCBvZiBhbGwgY2Fub25pY2FsIGF4ZXMNCmFub3ZhLmNjYShzcGUucmRhLGJ5PSdheGlzJyxzdGVwPTEwMDApDQpgYGANCiMjIyAgVmFyaWFibGVzIHNlbGVjdGlvbg0KDQpJdCBoYXBwZW5zIHdlIHdpc2ggdG8gcmVkdWNlIHRoZSBudW1iZXIgb2YgZXhwbGFuYXRvcnkgdmFyaWFibGVzLiBUaGUgcmVhc29ucyB2YXJ5OiBzZWFyY2ggZm9yIHBhcnNpbW9ueSwgcmljaCBkYXRhIHNldCBidXQgcG9vciBhdCBwcmlvcmkgaHlwb3RoZXNlcywgb3IgYSBtZXRob2QgcHJvZHVjaW5nIGEgbGFyZ2Ugc2V0IG9mIGV4cGxhbmF0b3J5IHZhcmlhYmxlcyB3aGljaCBtdXN0IGJlIHJlZHVjZWQgYWZ0ZXJ3YXJkcy4gDQoNCkxpbmVhciBkZXBlbmRlbmNpZXMgY2FuIGJlIGV4cGxvcmVkIGJ5IGNvbXB1dGluZyB0aGUgdmFyaWFibGVzJyB2YXJpYW5jZSBpbmZsYXRpb24gZmFjdG9yLiBWSUZzIGFib3ZlIDIwIGluZGljYXRlcyBzdHJvbmcgY29sbGluZWFyaXR5LiBJZGVhbGx5LCBWSUZzIGFib3ZlIDEwIHNob3VsZCBiZSBhdCBsZWFzdCBleGFtaW5lZCwgYW5kIGF2b2lkIGlmIHBvc3NpYmxlLiBWSUZzIGNhbiBiZSBjb21wdXRlZCBpbiBgdmVnYW5gIGFmdGVyIGByZGFgIHVzaW5nIHRoZSBmdW5jdGlvbiBgdmlmLmNjYWANCg0KYGBge3IsICBldmFsPVQsIG1lc3NhZ2U9Rn0NCnZpZi5jY2Eoc3BlLnJkYSkNCmBgYA0KDQpBIHJlZHVjdGlvbiBpcyBqdXN0aWZpZWQgdG8gZmluZCBhIHBhcnNpbW9uaW91cyBSREEgISEhIFRvIHNlbGVjdCB0aGUgc2lnbmlmaWNhbnQgZXhwbGFuYXRvcnkgdmFyaWFibGVzLCB5b3UgY2FuIHRoZW4gcGVyZm9ybSBhIHN0ZXB3aXNlIHNlbGVjdGlvbiAoZm9yd2FyZCBvciBiYWNrd2FyZCksIHVzaW5nIHRoZSBgb3JkaXN0ZXBgIG9yIGBvcmRpUjJzdGVwYCBmdW5jdGlvbiAob3IgdXNpbmcgdGhlIGBmb3J3YXJkLnNlbGAgZnVuY3Rpb24gb2YgcGFja2FnZSBgcGFja2ZvcmApIA0KDQojIyMgUGFydGlhbCBgcmRhYA0KDQoqKlBhcnRpYWwgY2Fub25pY2FsIG9yZGluYXRpb24qKiBpcyB0aGUgbXVsdGl2YXJpYXRlIGVxdWl2YWxlbnQgb2YgcGFydGlhbCBsaW5lYXIgcmVncmVzc2lvbjogaXQgaXMgcG9zc2libGUgdG8gcnVuIGEgUkRBIG9mIGEgKHRyYW5zZm9ybWVkKSBzcGVjaWVzIGRhdGEgbWF0cml4ICoqWSoqLCBleHBsYWluZWQgYnkgYSBtYXRyaXggb2YgZW52aXJvbm1lbnRhbCB2YXJpYWJsZXMgKipYKiosIGluIHRoZSBwcmVzZW5jZSBvZiBjb3ZhcmlhYmxlcyAqKlcqKiAoZS5nLiBEaXNwbGF5IHRoZSBwYXR0ZXJucyBvZiB0aGUgc3BlY2llcyBkYXRhIHVuaXF1ZWx5IGV4cGxhaW5lZCBieSBhIGxpbmVhciBtb2RlbCBvZiB0aGUgZW52IHZhcmlhYmxlcyB3aGVuIHRoZSBlZmZlY3Qgb2YgYW5vdGhlciB2YXJpYWJsZSBpcyBoZWxkIGNvbnN0YW50KS4NCg0KU2VlIFtoZXJlXShodHRwczovL3IucWNicy5jYS93b3Jrc2hvcDEwL2Jvb2stZW4vcGFydGlhbC1yZWR1bmRhbmN5LWFuYWx5c2lzLmh0bWwpIGZvciBtb3JlIGRldGFpbHMgYW5kIGV4YW1wbGUgb24gYGRvdWJzYCBkYXRhLg0KDQojIyBub24tbWV0cmljIE11bHRpZGltZW5zaW9uYWwgU2NhbGluZyAobk1EUykNCg0Kbk1EUyBpcyBhbiBpbmRpcmVjdCBncmFkaWVudCBhbmFseXNpcyBhcHByb2FjaCB3aGljaCBwcm9kdWNlcyBhbiBvcmRpbmF0aW9uIGJhc2VkIG9uIGEgZGlzdGFuY2Ugb3IgZGlzc2ltaWxhcml0eSBtYXRyaXgubk1EUyBpcyBhIHJhbmstYmFzZWQgYXBwcm9hY2guIFRoaXMgbWVhbnMgdGhhdCB0aGUgb3JpZ2luYWwgZGlzdGFuY2UgZGF0YSBpcyBzdWJzdGl0dXRlZCB3aXRoIHJhbmtzLiAgDQoNCisgcmVwcmVzZW50IGFzIHdlbGwgYXMgcG9zc2libGUgdGhlIG9yZGVyaW5nIHJlbGF0aW9uc2hpcCBhbW9uZyBvYmplY3RzIGluIGEgc21hbGwgYW5kIHNwZWNpZmllZCBudW1iZXIgb2YgYXhlcw0KDQorIG5NRFMgKGxpa2UgUENvQSAtIGFsc28gY2FsbGVkIE1ldHJpYyBNdWx0aWRpbWVuc2lvbmFsIFNjYWxpbmcpIGNhbiBwcm9kdWNlIG9yZGluYXRpb25zIG9mIG9iamVjdHMgZnJvbSBhbnkgZGlzdGFuY2UgbWF0cml4DQoNCisgbk1EUyBjYW4gY29wZSB3aXRoIG1pc3NpbmcgZGlzdGFuY2VzLCBhcyBsb25nICBhcyB0aGVyZSBhcmUgZW5vdWdoIG1lYXN1cmVzIGxlZnQgdG8gcG9zaXRpb24gZWFjaCBvYmplY3Qgd2l0aCByZXNwZWN0IHRvIGVhY2ggb3RoZXIuDQoNCm5NRFMgaXMgKipOT1QqKiBhIGVpZ2VudmFsdWUgYmFzZWQgb3JkaW5hdGlvbiBtZXRob2QgKHVubGlrZSBNRFMpLCBhbmQgZG9lcyBub3QgbWF4aW1pemUgdGhlIHZhcmlhYmlsaXR5IGFzc29jaWF0ZWQgd2l0aCBpbmRpdmlkdWFsIGF4ZXMgb2YgdGhlIG9yZGluYXRpb24uDQoNCiMjIyBQcm9jZWR1cmUNCg0KUXVpZXQgc3RyYWlnaHRmb3J3YXJkOg0KDQorIHNwZWNpZnkgdGhlIG51bWJlciBtIG9mIGF4ZXMgKGRpbWVuc2lvbnMpIOKAkyB1c3VhbGx5IDIgIQ0KDQorIGNvbnN0cnVjdCBhbiBpbml0aWFsIGNvbmZpZ3VyYXRpb24gb2YgdGhlIG9iamVjdHMgaW4gdGhlIG0gZGltZW5zaW9ucywgdG8gYmUgdXNlZCBhcyBhIHN0YXJ0aW5nIHBvaW50IG9mIGFuIGl0ZXJhdGl2ZSBhZGp1c3RtZW50IHByb2Nlc3MuIFRoaXMgaXMgYSB0cmlja3kgc3RlcCwgc2luY2UgdGhlIGVuZC1yZXN1bHRzIG1heSBkZXBlbmQgb24gdGhlIHN0YXJ0aW5nIGNvbmZpZ3VyYXRpb24uDQoNCisgYW4gaXRlcmF0aXZlIHByb2NlZHVyZSB0cmllcyB0byBwb3NpdGlvbiB0aGUgb2JqZWN0cyBpbiB0aGUgcmVxdWVzdGVkIG51bWJlciBvZiBkaW1lbnNpb25zIGluIHN1Y2ggd2FzIGFzIHRvIG1pbmltaXplIGEgc3RyZXNzIGZ1bmN0aW9uIChzY2FsZWQgZnJvbSAwIHRvIDEpLCB3aGljaCBtZWFzdXJlcyBob3cgZmFyIHRoZSBkaXN0YW5jZXMgaW4gdGhlIHJlZHVjZWQtc3BhY2UgY29uZmlndXJhdGlvbiBhcmUgZnJvbSBiZWluZyBtb25vdG9uaWMgdG8gdGhlIG9yaWdpbmFsIGRpc3RhbmNlIGluIHRoZSBhc3NvY2lhdGlvbiBtYXRyaXgNCg0KKyB0aGUgYWRqdXN0bWVudCBnb2VzIG9uIHVudGlsIHRoZSBzdHJlc3MgdmFsdWUgY2FuIG5vIG1vcmUgYmUgbG93ZXJlZCwgb3IgcHJlZGV0ZXJtaW5lZCB2YWx1ZSAoc29tZXRpbWVzIG5ldmVyIHJlYWNoZWQpDQoNCiMjIyBDb21wdXRhdGlvbg0KDQpGdW5jdGlvbnM6DQoNCisgYG1ldGFNRFNgIChsaWJyYXJ5IGB2ZWdhbmApIOKAkyBhZHZhbmNlZCBmdW5jdGlvbiwgY29tcG9zZWQgb2YgbWFueSBzdWItcm91dGluZSAgc3RlcHMuIFNwZWNpZXMgcG9pbnRzIGFyZSBhZGRlZCB0byB0aGUgb3JkaW5hdGlvbiBwbG90IHVzaW5nIGB3YXNjb3Jlc2ANCg0KKyBgaXNvTURTYCAobGlicmFyeSBgTUFTU2ApIGlmIG1pc3NpbmcgdmFsdWVzIGluIHRoZSBkaXN0YW5jZSBtYXRyaXggYW5kIGBiZXN0bm1kc2AgcGFja2FnZSBgbGFiZHN2YA0KDQpgYGB7ciwgIGV2YWw9VCwgbWVzc2FnZT1GfQ0Kc3BlLm5tZHM8LW1ldGFNRFModmFyZXNwZWMsZGlzdGFuY2U9J2JyYXknLHRyeW1heD05OTkpDQpzcGUubm1kcw0Kc3BlLm5tZHMkc3RyZXNzDQpwbG90KHNwZS5ubWRzLHR5cGU9J3QnLG1haW49cGFzdGUoJ05NRFMvQnJheeKAk1N0cmVzcyA9Jyxyb3VuZChzcGUubm1kcyRzdHJlc3MsMykpKQ0KYGBgDQoNCiMjIyBuTURTIHF1YWxpdHkNCg0KKyBBIHVzZWZ1bCB3YXkgdG8gYXNzZXNzIHRoZSBhcHByb3ByaWF0ZW5lc3Mgb2YgYW4gbk1EUyBpcyB0byBjb21wYXJlLCBpbiBhICpTaGVwYXJkIGRpYWdyYW0qLCB0aGUgZGlzdGFuY2UgYW1vbmcgb2JqZWN0cyBpbiB0aGUgb3JkaW5hdGlvbiB3aXRoIHRoZSBvcmlnaW5hbCBkaXN0YW5jZXMuDQoNCisgYHN0cmVzc3Bsb3QoKWAg4oCTIGRyYXdzIHN1Y2ggYSAqU2hlcGFyZCBzdHJlc3MqIHBsb3QsIHdoaWNoIGlzIHRoZSByZWxhdGlvbnNoaXAgYmV0d2VlbiByZWFsIGRpc3RhbmNlcyBiZXR3ZWVuIHNhbXBsZXMgaW4gcmVzdWx0aW5nICptKiBkaW1lbnNpb25hbCBvcmRpbmF0aW9uIHNvbHV0aW9uLCBhbmQgdGhlaXIgcGFydGljdWxhciBkaXNzaW1pbGFyaXRpZXMuDQoNCmBgYHtyLCAgZXZhbD1ULCBtZXNzYWdlPUZ9DQpzdHJlc3NwbG90KHNwZS5ubWRzLCBtYWluPSdTaGVwYXJkIHBsb3QnKQ0KYGBgDQoNCisgSW4gYWRkaXRpb24sIHRoZSBnb29kbmVzcy1vZi1maXQgb2YgdGhlIG9yZGluYXRpb24gaXMgbWVhc3VyZWQgYXMgdGhlIFJeMl4gIG9mIGVpdGhlciBhIGxpbmVhciBvciBhIG5vbi1saW5lYXIgcmVncmVzc2lvbiBvZiB0aGUgTk1EUyBkaXN0YW5jZXMgb24gdGhlIG9yaWdpbmFsIG9uZXMNCg0KYGBge3IsICBldmFsPVQsIG1lc3NhZ2U9Rn0NCiMgZ29vZG5lc3Mgb2YgZml0DQpnb2Y8LWdvb2RuZXNzKHNwZS5ubWRzKQ0KcGxvdChzcGUubm1kcyx0eXBlPSd0JyxtYWluPSdHb29kbmVzcyBvZiBmaXQnKQ0KcG9pbnRzKHNwZS5ubWRzLCBkaXNwbGF5PSdzaXRlcycsIGNleD1nb2YqOTApDQpgYGANCg0KIyMjIEFkZGluZyBjbHVzdGVyDQoNCmBgYHtyLCAgZXZhbD1ULCBtZXNzYWdlPUZ9DQojIFVQR01BDQpzcGUuYnJheS51cGdtYSA8LSBoY2x1c3Qoc3BlLmJjLCdhdmVyYWdlJykNCiMgbk1EUyB3aXRoIGxhYmVscw0KcGxvdChzcGUubm1kcywgZGlzcGxheT0ic2l0ZXMiKQ0Kb3JkaXRvcnAoc3BlLm5tZHMsIGRpc3BsYXk9InNpdGVzIikgIyBhZGQgdGV4dCAvIHBvaW50cyB0byBvcmRpbmF0aW9uDQojIGFkZCBhbmQgcHJ1bmUgdHJlZQ0Kb3JkaWNsdXN0ZXIoc3BlLm5tZHMsIHNwZS5icmF5LnVwZ21hLCBwcnVuZT01LCBjb2wgPSBjdXRyZWUoc3BlLmJyYXkudXBnbWEsIDYpLGx3ZD0yKQ0KYGBgDQoNCiMjIyBgb3JkaXN1cmZgDQoNCkZpdHMgYSBzbW9vdGggc3VyZmFjZSBmb3IgZ2l2ZW4gdmFyaWFibGUgYW5kIHBsb3RzIHRoZSByZXN1bHQgb24gb3JkaW5hdGlvbiBkaWFncmFtIChHZW5lcmFsaXplZCBBZGRpdGl2ZSBNb2RlbCkNCg0KYGBge3IsICBldmFsPVQsIG1lc3NhZ2U9Rn0NCm9yZGlzdXJmKHNwZS5ubWRzIH4gQmFyZXNvaWwsIHZhcmVjaGVtLCBidWJibGUgPSA1LCBtYWluPSJCYXJlc29pbCBHQU0iKQ0KYGBgDQoNCiMjIyBgb3JkaWh1bGxgICYgYG9yZGlzcGlkZXJgDQoNCmBgYHtyLCAgZXZhbD1ULCBtZXNzYWdlPUZ9DQpkYXRhKGR1bmUpDQpkYXRhKGR1bmUuZW52KQ0KYXR0YWNoKGR1bmUuZW52KQ0KTk1EUy5kdW5lPC1tZXRhTURTKGR1bmUsZGlzdGFuY2U9J2JyYXknKQ0KcGxvdChOTURTLmR1bmUsdHlwZT0ndCcsbWFpbj1wYXN0ZSgnTk1EUy9CcmF5IOKAkyBTdHJlc3MgPScscm91bmQoTk1EUy5kdW5lJHN0cmVzcywzKSkpDQpwbDwtb3JkaWh1bGwoTk1EUy5kdW5lLCBNYW5hZ2VtZW50LCBzY2FsaW5nID0gMywgZHJhdz0ncG9seWdvbicsY29sPSdncmV5JykNCm9yZGlzcGlkZXIocGwsIGNvbD0icmVkIiwgbHR5PTMsIGxhYmVsID0gVFJVRSkNCmBgYA0KDQojIEh5cG90aGVzaXMgdGVzdGluZw0KDQojIyBQRVJNQU5PVkENCg0KQW5hbHlzaXMgb2YgdmFyaWFuY2UgdXNpbmcgZGlzdGFuY2UgbWF0cmljZXMg4oCUIGZvciBwYXJ0aXRpb25pbmcgZGlzdGFuY2UgbWF0cmljZXMgYW1vbmcgc291cmNlcyBvZiB2YXJpYXRpb24gYW5kIGZpdHRpbmcgbGluZWFyIG1vZGVscyAoZS5nLiwgZmFjdG9ycywgcG9seW5vbWlhbCByZWdyZXNzaW9uKSB0byBkaXN0YW5jZSBtYXRyaWNlczsgdXNlcyBhIHBlcm11dGF0aW9uIHRlc3Qgd2l0aCBwc2V1ZG8tRiByYXRpb3MuDQoNClRlc3RpbmcgbWFuYWdlbWVudCBlZmZlY3Q6DQoNCmBgYHtyfQ0KIyMgZGVmYXVsdCBpcyBvdmVyYWxsIChvbW5pYnVzKSB0ZXN0DQphZG9uaXMyKGR1bmUgfiBNYW5hZ2VtZW50KkExLCBtZXRob2Q9J2JyYXknLCBkYXRhID0gZHVuZS5lbnYpDQojIyBzZXF1ZW50aWFsIHRlc3RzDQphZG9uaXMyKGR1bmUgfiBNYW5hZ2VtZW50KkExLCBtZXRob2Q9J2JyYXknLCBkYXRhID0gZHVuZS5lbnYsIGJ5ID0gInRlcm1zIikNCmBgYA0KDQpQRVJNQU5PVkEgaXMgYSByb2J1c3QgYWx0ZXJuYXRpdmUgdG8gYm90aCBwYXJhbWV0cmljIE1BTk9WQSBhbmQgdG8gb3JkaW5hdGlvbiBtZXRob2RzIGZvciBkZXNjcmliaW5nIGhvdyB2YXJpYXRpb24gaXMgYXR0cmlidXRlZCB0byBkaWZmZXJlbnQgZXhwZXJpbWVudGFsIHRyZWF0bWVudHMgb3IgdW5jb250cm9sbGVkIGNvdmFyaWF0ZXMuIEl0IGlzIGFsc28gYW5hbG9nb3VzIHRvIHJlZHVuZGFuY3kgYW5hbHlzaXMuIA0KDQojIyBBTk9TSU0NCg0KQW5hbHlzaXMgb2Ygc2ltaWxhcml0aWVzIChBTk9TSU0pIHByb3ZpZGVzIGEgd2F5IHRvIHRlc3Qgc3RhdGlzdGljYWxseSB3aGV0aGVyIHRoZXJlIGlzIGEgc2lnbmlmaWNhbnQgZGlmZmVyZW5jZSBiZXR3ZWVuIHR3byBvciBtb3JlIGdyb3VwcyBvZiBzYW1wbGluZyB1bml0cy4NCg0KYGBge3J9DQpkdW5lLmRpc3QgPC0gdmVnZGlzdChkdW5lKQ0KZHVuZS5hbm8gPC0gd2l0aChkdW5lLmVudiwgYW5vc2ltKGR1bmUuZGlzdCwgTWFuYWdlbWVudCkpDQpzdW1tYXJ5KGR1bmUuYW5vKQ0KcGxvdChkdW5lLmFubykNCmBgYA0KDQpGdW5jdGlvbiBgYWRvbmlzMmAgaXMgYSBtb3JlIHJvYnVzdCBhbHRlcm5hdGl2ZSB0aGF0IHNob3VsZCBwcmVmZXJyZWQuRm9yIGNvbXBhcmluZyBkaXNzaW1pbGFyaXRpZXMgYWdhaW5zdCBjb250aW51b3VzIHZhcmlhYmxlcywgc2VlIGA/dmVnYW46Om1hbnRlbGAuDQoNCiMgUHJlZGljdGlvbnMgKGV4dHJhKQ0KDQpUaGUgcHJvY2VzcyBvZiBjb25zdHJ1Y3RpbmcsIGV2YWx1YXRpbmcsIGFuZCB2YWxpZGF0aW5nICBjbGFzc2lmaWNhdGlvbiBtb2RlbHMsIHByb3ZpZGVzIGJhc2lzIGZvciBtYWNoaW5lIGxlYXJuaW5nIG1vZGVscy4gQmVsb3cgd2UgZXhwbG9yZSBhbmQgY29tcGFyZSBwZXJmb21hbmNlIGZvdXIgYWxnb3JpdGhtcyB0byBjbGFzc2lmeSBhbmQgKipwcmVkaWN0KiogYGlyaXNgIHNwZWNpZXMgKHNlZSBgY2FyZXRgIHBhY2thZ2UpLg0KDQoqKktleSBzdGVwcyoqOg0KDQoxLSAqKlZhbGlkYXRpb24gRGF0YXNldCoqIA0KDQpUaGUgZGF0YXNldCBpcyBzcGxpdCBpbnRvIDgwJSB0cmFpbmluZyBkYXRhIChgaWRhdGFzZXRgKSBhbmQgMjAlIHZhbGlkYXRpb24gZGF0YSAoYHZhbGlkYXRpb25gKS4NCg0KYGBge3IgY2xhc3Muc291cmNlID0gImZvbGQtc2hvdyIsICBldmFsPVR9DQojIGNyZWF0ZSBhIGxpc3Qgb2YgODAlIG9mIHRoZSByb3dzIGluIHRoZSBvcmlnaW5hbCBkYXRhc2V0IHRoYXQgd2UgY2FuIHVzZSBmb3IgdHJhaW5pbmcNCnZhbGlkYXRpb25faW5kZXggPC0gY3JlYXRlRGF0YVBhcnRpdGlvbihpcmlzJFNwZWNpZXMsIHA9MC44MCwgbGlzdD1GQUxTRSkNCiMgc2VsZWN0IDIwJSBvZiB0aGUgZGF0YSBmb3IgdmFsaWRhdGlvbg0KdmFsaWRhdGlvbiA8LSBpcmlzWy12YWxpZGF0aW9uX2luZGV4LF0NCiMgdXNlIHRoZSByZW1haW5pbmcgODAlIG9mIGRhdGEgdG8gdHJhaW5pbmcgYW5kIHRlc3RpbmcgdGhlIG1vZGVscw0KaWRhdGFzZXQgPC0gaXJpc1t2YWxpZGF0aW9uX2luZGV4LF0NCmBgYA0KDQpZb3Ugbm93IGhhdmUgdHJhaW5pbmcgZGF0YSBpbiB0aGUgZGF0YXNldCB2YXJpYWJsZSBhbmQgYSB2YWxpZGF0aW9uIHNldCB3ZSB3aWxsIHVzZSBsYXRlciBpbiB0aGUgdmFsaWRhdGlvbiB2YXJpYWJsZS4NCg0KMi0gKipFdmFsdWF0aW9uIE1ldGhvZCoqIA0KDQpTZXQgZXZhbHVhdGlvbiBhcyAxMC1mb2xkIGNyb3NzIHZhbGlkYXRpb24uIFRoaXMgd2lsbCBzcGxpdCBvdXIgZGF0YXNldCBpbnRvIDEwIHBhcnRzLCB0cmFpbiBpbiA5IGFuZCB0ZXN0IG9uIDEgYW5kIHJlbGVhc2UgZm9yIGFsbCBjb21iaW5hdGlvbnMgb2YgdHJhaW4tdGVzdCBzcGxpdHMuIFdlIHdpbGwgYWxzbyByZXBlYXQgdGhlIHByb2Nlc3MgMyB0aW1lcyBmb3IgZWFjaCBhbGdvcml0aG0gd2l0aCBkaWZmZXJlbnQgc3BsaXRzIG9mIHRoZSBkYXRhIGludG8gMTAgZ3JvdXBzLCBpbiBhbiBlZmZvcnQgdG8gZ2V0IGEgbW9yZSBhY2N1cmF0ZSBlc3RpbWF0ZQ0KDQpgYGB7ciBjbGFzcy5zb3VyY2UgPSAiZm9sZC1zaG93IiwgIGV2YWw9VH0NCiMgUnVuIGFsZ29yaXRobXMgdXNpbmcgMTAtZm9sZCBjcm9zcyB2YWxpZGF0aW9uDQpjb250cm9sIDwtIHRyYWluQ29udHJvbChtZXRob2Q9ImN2IiwgbnVtYmVyPTEwKQ0KbWV0cmljIDwtICJBY2N1cmFjeSINCmBgYA0KDQpXZSBhcmUgdXNpbmcgdGhlIG1ldHJpYyBvZiDigJxBY2N1cmFjeeKAnSB0byBldmFsdWF0ZSBtb2RlbHMuIFRoaXMgd2lsbCBiZSB0aGUgcmF0aW8gb2YgdGhlIG51bWJlciBvZiBjb3JyZWN0bHkgcHJlZGljdGVkIGluc3RhbmNlcyBpbiBkaXZpZGVkIGJ5IHRoZSB0b3RhbCBudW1iZXIgb2YgaW5zdGFuY2VzIGluIHRoZSBkYXRhc2V0IG11bHRpcGxpZWQgYnkgMTAwIHRvIGdpdmUgYSBwZXJjZW50YWdlIChlLmcuIFtYWF0lIGFjY3VyYXRlKS4gV2Ugd2lsbCBiZSB1c2luZyB0aGUgbWV0cmljIHZhcmlhYmxlIHdoZW4gd2UgcnVuIGJ1aWxkIGFuZCBldmFsdWF0ZSBlYWNoIG1vZGVsIG5leHQuDQoNCjMtICoqQnVpbGQgTW9kZWxzKiogDQoNCldlIGRvbuKAmXQga25vdyB3aGljaCBhbGdvcml0aG1zIHdvdWxkIGJlIGdvb2Qgb24gdGhpcyBwcm9ibGVtIG9yIHdoYXQgY29uZmlndXJhdGlvbnMgdG8gdXNlLCBsZXQncyBldmFsdWF0ZSBmb3VyIGRpZmZlcmVudCBhbGdvcml0aG1zOg0KDQoNCiAgICAqIENsYXNzaWZpY2F0aW9uIGFuZCBSZWdyZXNzaW9uIFRyZWVzIChDQVJUKQ0KICAgICogUmFuZG9tIEZvcmVzdA0KICAgICogTGluZWFyIERpc2NyaW1pbmFudCBBbmFseXNpcyAoTERBKSAvc3VwZXJ2aXNlZCBtYWNoaW5lIGxlYXJuaW5nIHRvIHNvbHZlIG11bHRpLWNsYXNzIGNsYXNzaWZpY2F0aW9uIHByb2JsZW1zDQogICAgKiBrLU5lYXJlc3QgTmVpZ2hib3JzIChrTk4pIC8gY2xhc3NpZmljYXRpb24gKG9yIHJlZ3Jlc3Npb24pIGFsZ29yaXRobSANCg0KDQoNCkNoZWNrIHRoaXMsIGJlZm9yZSBgc3BlY2llc2Agd2FzIG91ciBwcmVkaWN0b3IuIFdlIHVzZSBtdWx0aXBsZXMgcHJlZGljdG9yIHRvIG1vZGVsIHRoZSByZXNwb25zZS4gDQoNCmBgYHtyIGNsYXNzLnNvdXJjZSA9ICJmb2xkLXNob3ciLCBldmFsPVQsIGNhY2hlPVR9DQojIFJhbmRvbSBGb3Jlc3QNCnNldC5zZWVkKDEwKQ0KZml0LnJmIDwtIHRyYWluKFNwZWNpZXN+LiwgZGF0YT1pZGF0YXNldCwgbWV0aG9kPSJyZiIsIG1ldHJpYz1tZXRyaWMsIHRyQ29udHJvbD1jb250cm9sKQ0KIyBDQVJUDQpzZXQuc2VlZCgxMCkNCmZpdC5jYXJ0IDwtIHRyYWluKFNwZWNpZXN+LiwgZGF0YT1pZGF0YXNldCwgbWV0aG9kPSJycGFydCIsIG1ldHJpYz1tZXRyaWMsIHRyQ29udHJvbD1jb250cm9sKQ0KIyBrTk4NCnNldC5zZWVkKDEwKQ0KZml0LmtubiA8LSB0cmFpbihTcGVjaWVzfi4sIGRhdGE9aWRhdGFzZXQsIG1ldGhvZD0ia25uIiwgbWV0cmljPW1ldHJpYywgdHJDb250cm9sPWNvbnRyb2wpDQojIGxkYQ0Kc2V0LnNlZWQoMTApDQpmaXQubGRhIDwtIHRyYWluKFNwZWNpZXN+LiwgZGF0YT1pZGF0YXNldCwgbWV0aG9kPSJsZGEiLCBtZXRyaWM9bWV0cmljLCB0ckNvbnRyb2w9Y29udHJvbCkNCmBgYA0KDQo0LSAqKkNvbXBhcmUgTW9kZWxzKiogDQoNCldlIG5vdyBoYXZlIDQgbW9kZWxzIGFuZCBhY2N1cmFjeSBlc3RpbWF0aW9ucyBmb3IgZWFjaC4gV2UgbmVlZCB0byBjb21wYXJlIHRoZSBtb2RlbHMgdG8gZWFjaCBvdGhlciBhbmQgc2VsZWN0IHRoZSBtb3N0IGFjY3VyYXRlLiBXZSBjYW4gcmVwb3J0IG9uIHRoZSBhY2N1cmFjeSBvZiBlYWNoIG1vZGVsIGJ5IGZpcnN0IGNyZWF0aW5nIGEgbGlzdCBvZiB0aGUgY3JlYXRlZCBtb2RlbHMgYW5kIHVzaW5nIHRoZSBzdW1tYXJ5IGZ1bmN0aW9uLg0KDQpgYGB7ciBjbGFzcy5zb3VyY2UgPSAiZm9sZC1zaG93IiwgIGV2YWw9VH0NCiMgc3VtbWFyaXplIGFjY3VyYWN5IG9mIG1vZGVscw0KcmVzdWx0cyA8LSByZXNhbXBsZXMobGlzdChsZGE9Zml0LmxkYSwgY2FydD1maXQuY2FydCwga25uPWZpdC5rbm4sIHJmPWZpdC5yZikpDQpzdW1tYXJ5KHJlc3VsdHMpJHN0YXRpc3RpY3MkQWNjdXJhY3kNCmBgYA0KDQpUaGV5IGFyZSBhbGwgdmVyeSBnb29kLCBidXQgV2UgY2FuIHNlZSB0aGF0IHRoZSBtb3N0IGFjY3VyYXRlIG1vZGVsIGluIHRoaXMgY2FzZSBpcyBMREEgYW5kIGtubjoNCg0KDQpgYGB7ciBjbGFzcy5zb3VyY2UgPSAiZm9sZC1zaG93IiwgIGV2YWw9VH0NCiMgc3VtbWFyaXplIEJlc3QgTW9kZWwNCnByaW50KGZpdC5sZGEpDQpgYGANCg0KVGhpcyBnaXZlcyBhIG5pY2Ugc3VtbWFyeSBvZiB3aGF0IHdhcyB1c2VkIHRvIHRyYWluIHRoZSBtb2RlbCBhbmQgdGhlIG1lYW4gYW5kIHN0YW5kYXJkIGRldmlhdGlvbiAoU0QpIGFjY3VyYWN5IGFjaGlldmVkLCBzcGVjaWZpY2FsbHkgWFguWCUgYWNjdXJhY3kgKy8tIFglDQoNCjUtICoqTWFrZSBQcmVkaWN0aW9uKiogDQoNClRoZSBMREEgd2FzIHRoZSBtb3N0IGFjY3VyYXRlIG1vZGVsLiBOb3cgd2Ugd2FudCB0byBnZXQgYW4gaWRlYSBvZiB0aGUgYWNjdXJhY3kgb2YgdGhlIG1vZGVsIG9uIG91ciB2YWxpZGF0aW9uIHNldC4gVGhpcyB3aWxsIGdpdmUgdXMgYW4gaW5kZXBlbmRlbnQgZmluYWwgY2hlY2sgb24gdGhlIGFjY3VyYWN5IG9mIHRoZSBiZXN0IG1vZGVsLiBJdCBpcyB2YWx1YWJsZSB0byBrZWVwIGEgdmFsaWRhdGlvbiBzZXQganVzdCBpbiBjYXNlIHlvdSBtYWRlIGEgc2xpcCBkdXJpbmcgc3VjaCBhcyBvdmVyZml0dGluZyB0byB0aGUgdHJhaW5pbmcgc2V0IG9yIGEgZGF0YSBsZWFrLiBCb3RoIHdpbGwgcmVzdWx0IGluIGFuIG92ZXJseSBvcHRpbWlzdGljIHJlc3VsdC4NCg0KV2UgY2FuIHJ1biB0aGUgTERBIG1vZGVsIGRpcmVjdGx5IG9uIHRoZSB2YWxpZGF0aW9uIHNldCBhbmQgc3VtbWFyaXplIHRoZSByZXN1bHRzIGluIGEgY29uZnVzaW9uIG1hdHJpeC4NCg0KYGBge3IsIGNsYXNzLnNvdXJjZSA9ICJmb2xkLXNob3ciLCBldmFsPVR9DQojIGVzdGltYXRlIHNraWxsIG9mIExEQSBvbiB0aGUgdmFsaWRhdGlvbiBkYXRhc2V0DQpwcmVkaWN0aW9ucyA8LSBwcmVkaWN0KGZpdC5sZGEsIHZhbGlkYXRpb24pDQpjb25mdXNpb25NYXRyaXgocHJlZGljdGlvbnMsIHZhbGlkYXRpb24kU3BlY2llcykNCmBgYA0KDQpXZSBjYW4gc2VlIHRoYXQgdGhlIGFjY3VyYWN5IGlzIDEwMCUgYnV0IG9uIGEgc21hbGwgdmFsaWRhdGlvbiBkYXRhc2V0ICgyMCUpLiA5NSUgQ0kgOiAoMC44ODQzLCAxKSBzdWdnZXN0aW5nIHdlIG1heSBoYXZlIGFuIGFjY3VyYXRlIGFuZCBhIHJlbGlhYmx5IGFjY3VyYXRlIG1vZGVsLiBZb3UgaGF2ZSBvbmUgKipuZXVyb25lKiogaW4gYSBuZXR3b3JrLCBidXQgeW91IGFyZSBhdCBvbmUgc3RlcCB0b3dhcmQgRGVlcCBMZWFybmluZy4gICANCg0KDQohW01hY2hpbmUgTGVhcm5pbmcgdnMuIERlZXAgTGVhcm5pbmddKGlsbHVzdHJhdGlvbnMvbXVsdGlfTUxETC5wbmcpDQoNCg0KIyBSZWZlcmVuY2VzDQoNCkNoYXJyYWQgTS4sIEdoYXp6YWxpIE4uLCBCb2l0ZWF1IFYuLCAmIE5pa25hZnMgQS4gKDIwMTQpLiBOYkNsdXN0OiBBbiBSIFBhY2thZ2UgZm9yIERldGVybWluaW5nIHRoZSBSZWxldmFudCBOdW1iZXIgb2YgQ2x1c3RlcnMgaW4gYSBEYXRhIFNldC4gSm91cm5hbCBvZiBTdGF0aXN0aWNhbCBTb2Z0d2FyZSwgNjEoNiksIDHigJMzNi4gaHR0cHM6Ly9kb2kub3JnLzEwLjE4NjM3L2pzcy52MDYxLmkwNg0KDQpKb2huc29uIFIuQS4sIFdpY2hlcm4gRC5XLiAoMjAwNykgQXBwbGllZCBNdWx0aXZhcmlhdGUgU3RhdGlzdGljYWwgQW5hbHlzaXMuIDZ0aCBlZC4gVXBwZXIgU2FkZGxlIFJpdmVyOiBQZWFyc29uLg0KDQpRQ0JTIFIgV29ya3Nob3AgU2VyaWVzICgyMDIzKSBodHRwczovL3IucWNicy5jYS93b3Jrc2hvcDEwL2Jvb2stZW4vaW5kZXguaHRtbA0K" download="stat_3.Rmd">Download stat_3.Rmd</a>
<a href="data:text/plain;base64,eGFyaW5nYW5FeHRyYTo6dXNlX2NsaXBib2FyZCgpDQoNCg0KDQoNCg0KDQpsaWJyYXJ5KHZlZ2FuKQ0KbGlicmFyeShxZ3JhcGgpDQpsaWJyYXJ5KGFkZTQpDQpsaWJyYXJ5KG12YWJ1bmQpDQpsaWJyYXJ5IChwdmNsdXN0KQ0KbGlicmFyeShmYWN0b2V4dHJhKQ0KbGlicmFyeShlY29kaXN0KQ0KbGlicmFyeSh0cmVlKQ0KbGlicmFyeShycGFydCkNCmxpYnJhcnkoZ2dwbG90MikNCmxpYnJhcnkocmFuZG9tRm9yZXN0KQ0KbGlicmFyeShjYXJldCkNCmxpYnJhcnkocmF0dGxlKQ0KDQojIHRvIGJlIGNhcmVmdWwNCmxpYnJhcnkobXZwYXJ0KSAjIGRldnRvb2xzOjppbnN0YWxsX2dpdGh1YigiY3Jhbi9tdnBhcnQiLCBmb3JjZSA9IFQpIA0KbGlicmFyeShNVlBBUlR3cmFwKSAjIGRldnRvb2xzOjppbnN0YWxsX2dpdGh1YigiY3Jhbi9NVlBBUlR3cmFwIiwgZm9yY2UgPSBUKQ0KDQojICBmdW5jdGlvbnMgZnJvbSBCb3JjYXJkIGV0IGFsLiAyMDExDQpzb3VyY2UoJ2h0dHBzOi8vd3d3LmRpcGludG90aGVyZWVmLmNvbS91cGxvYWRzLzMvNy8zLzUvMzczNTkyNDUvY29sZGlzcy5yJykgDQpzb3VyY2UgKCdodHRwczovL3d3dy5kaXBpbnRvdGhlcmVlZi5jb20vdXBsb2Fkcy8zLzcvMy81LzM3MzU5MjQ1L2NsZWFucGxvdC5wY2EucicpDQoNCg0KDQojID92YXJlc3BlYw0KZGF0YSAodmFyZXNwZWMpOyBkYXRhKHZhcmVjaGVtKQ0KdmFyZXNwZWNbMTo1LDE6NV0NCnZhcmVjaGVtWzE6NSwxOjVdDQoNCiMgVHJhbnNmb3JtaW5nICBwb3NpdGl2ZSAgZGF0YSB0byBhIGxvZ2FyaXRobWljDQojIHNjYWxlIHJlZHVjZXMgdGhlIHJhbmdlIG9mIHRoZSBkYXRhIHNldC4NCnZhcmVzcGVjLmxvZzwtZGVjb3N0YW5kKHZhcmVzcGVjLCdsb2cnKQ0KdmFyZXNwZWMubG9nWzE6NSwxOjVdDQoNCiMgQ2VudHJpbmcgYnkgdHJhbnNsYXRpb24sIHN0YW5kYXJkaXplLg0KIyBPYmogaXMgdG8gcmVtb3ZlIGRpZmZlcmVuY2VzIGluIHNjYWxlIGR1ZQ0KIyBkdWUgdG8gZGlmZiBtYWduaXR1ZGVzIGJldHdlZW4gdmFyaWFibGVzDQp2YXJlY2hlbS5zdGFuZDwtZGVjb3N0YW5kKHZhcmVjaGVtLCdzdGFuZCcpDQp2YXJlY2hlbS5zdGFuZFsxOjUsMTo1XQ0KIyBtYWtpbmcgc3VyZSBgcm93U3VtcyBpcyB0aGUgc2FtZQ0KdmFyZXNwZWM8LWRlY29zdGFuZCh2YXJlc3BlYywndG90YWwnKQ0KDQojIExvdyB3ZWlnaHRzIHRvIHZhcmlhYmxlcyB3aXRoDQojIGxvdyBjb3VudHMgYW5kIG1hbnkgemVyb3MNCnZhcmVzcGVjLmhlbGw8LWRlY29zdGFuZCh2YXJlc3BlYywnaGVsbGluZ2VyJykNCnZhcmVzcGVjLmhlbGxbMTo1LDE6NV0NCg0KZW52LmV1YzwtdmVnZGlzdCh2YXJlY2hlbS5zdGFuZCwgbWV0aG9kPSdldWMnKQ0KZW52LmV1Yw0KDQpzcGUuZXVjPC12ZWdkaXN0KHZhcmVzcGVjLmhlbGwsIG1ldGhvZD0nZXVjJykNCnNwZS5ldWMNCg0KIyBkZWZhdWx0IG9wdGlvbiB1c2luZyB2ZWdkaXN0KCkNCnNwZS5iYzwtdmVnZGlzdCh2YXJlc3BlYykNCnNwZS5iYw0KDQojIEphY2NhcmQgZGlzc2ltaWxhcml0eSBtYXRyaXggdXNpbmcgdmVnZGlzdCgpDQpzcGUuamQgPC0gdmVnZGlzdCh2YXJlc3BlYywnamFjJyxiaW5hcnk9VCkgIyBiaW5hcnkgcC9hIA0KDQpjb2xkaXNzKHNwZS5iYyxieXJhbms9RixkaWFnPVQpDQoNCnFncmFwaCgxLXNwZS5iYywgbGF5b3V0PSdzcHJpbmcnLCB2c2l6ZT00KQ0KDQojIFN0ZXAgMTogZGF0YXNldA0KIyA/ZG91YnMNCmRhdGEoZG91YnMpDQpzcGUuZGI8LWRvdWJzJGZpc2gNCnNwYS5kYjwtZG91YnMkeHkNCiMgcmVtb3ZlIGVtcHR5IHNhbXBsZSA4IGZyb20gYm90aCBkYXRhc2V0cw0Kc3BlLmRiIDwtc3BlLmRiWy04LF0NCnNwYS5kYjwtIHNwYS5kYlstOCxdDQojIFN0ZXAgMjogY2hvcmQgZGlzdGFuY2UgPSBub3JtYWxpemF0aW9uICsgZXVjbGlkZWFuDQpzcGUuZGIubm9ybTwtZGVjb3N0YW5kKHNwZS5kYiwnbm9ybWFsaXplJykgDQpzcGUuZGIuY2g8LXZlZ2Rpc3Qoc3BlLmRiLm5vcm0sJ2V1YycpIA0KIyBTdGVwIDM6IHNpbmdsZSBsaW5rYWdlIGFnZ2xvbWVyYXRpdmUgY2x1c3RlcmluZw0Kc3BlLmRiLmNoLnNpbmdsZSA8LWhjbHVzdChzcGUuZGIuY2gsbWV0aG9kPSdzaW5nbGUnKSANCiMgU3RlcCA0OiBwbG90IGRlbmRyb2dyYW0NCg0Kc3BlLmRiLmNoLmNvbXBsZXRlPC1oY2x1c3Qoc3BlLmRiLmNoLG1ldGhvZD0nY29tcGxldGUnKSANCg0Kc3BlLmRiLmNoLlVQR01BPC1oY2x1c3Qoc3BlLmRiLmNoLG1ldGhvZD0nYXZlcmFnZScpIA0KDQpzcGUuZGIuY2gud2FyZDwtaGNsdXN0KHNwZS5kYi5jaCxtZXRob2Q9J3dhcmQuRCcpIA0KDQpwYXIobWZyb3cgPSBjKDIsIDIpKQ0KcGxvdChzcGUuZGIuY2guc2luZ2xlLCBtYWluPSdTaW5nbGUgbGlua2FnZSBhZ2dsb21lcmF0aXZlIGNsdXN0ZXJpbmcnICkgDQpwbG90KHNwZS5kYi5jaC5jb21wbGV0ZSwgbWFpbj0nQ29tcGxldGUgbGlua2FnZSBhZ2dsb21lcmF0aXZlIGNsdXN0ZXJpbmcnKSANCnBsb3Qoc3BlLmRiLmNoLlVQR01BLCBtYWluPSdBdmVyYWdlIChVUEdNQSkgYWdnbG9tZXJhdGl2ZSBjbHVzdGVyaW5nJykgDQpwbG90KHNwZS5kYi5jaC53YXJkLCBtYWluPSdXYXJkIGNsdXN0ZXJpbmcnKQ0KDQojIFNpbmdsZSBsaW5rYWdlIGNsdXN0ZXJpbmcNCnNwZS5kYi5jaC5zaW5nbGUuY29waCA8LSBjb3BoZW5ldGljIChzcGUuZGIuY2guc2luZ2xlKQ0KY29yKHNwZS5kYi5jaCxzcGUuZGIuY2guc2luZ2xlLmNvcGgpDQoNCiMgY29tcGxldGUgbGlua2FnZSBjbHVzdGVyaW5nDQpzcGUuZGIuY2guY29tcGxldGUuY29waCA8LSBjb3BoZW5ldGljIChzcGUuZGIuY2guY29tcGxldGUpDQpjb3Ioc3BlLmRiLmNoLHNwZS5kYi5jaC5jb21wbGV0ZS5jb3BoKQ0KDQojIEF2ZXJhZ2UgY2x1c3RlcmluZw0Kc3BlLmRiLmNoLlVQR01BLmNvcGggPC0gY29waGVuZXRpYyAoc3BlLmRiLmNoLlVQR01BKQ0KY29yKHNwZS5kYi5jaCxzcGUuZGIuY2guVVBHTUEuY29waCkNCg0KIyBXYXJkIGNsdXN0ZXJpbmcNCnNwZS5kYi5jaC53YXJkLmNvcGggPC0gY29waGVuZXRpYyAoc3BlLmRiLmNoLndhcmQpDQpjb3Ioc3BlLmRiLmNoLHNwZS5kYi5jaC53YXJkLmNvcGgpDQoNCnBhcihtZnJvdz1jKDIsMikpDQoNCnBsb3Qoc3BlLmRiLmNoLHNwZS5kYi5jaC5zaW5nbGUuY29waCx4bGFiPSdDaG9yZCBkaXN0YW5jZScseWxhYj0nQ2hvcGhlbmV0aWMgZGlzdGFuY2UnLGFzcD0xLCBtYWluPWMoJ1NpbmdsZSBsaW5rYWdlJyxwYXN0ZSgnQ29waGVuZXRpYyBjb3JyZWxhdGlvbicscm91bmQoY29yKHNwZS5kYi5jaCxzcGUuZGIuY2guc2luZ2xlLmNvcGgpLDMpKSkpDQphYmxpbmUgKDAsMSkNCmxpbmVzKGxvd2VzcyhzcGUuZGIuY2gsc3BlLmRiLmNoLnNpbmdsZS5jb3BoKSxjb2w9J3JlZCcpDQoNCnBsb3Qoc3BlLmRiLmNoLHNwZS5kYi5jaC5jb21wbGV0ZS5jb3BoLHhsYWI9J0Nob3JkIGRpc3RhbmNlJyx5bGFiPSdDaG9waGVuZXRpYyBkaXN0YW5jZScsYXNwPTEsIG1haW49YygnQ29tcGxldGUgbGlua2FnZScscGFzdGUoJ0NvcGhlbmV0aWMgY29ycmVsYXRpb24nLHJvdW5kKGNvcihzcGUuZGIuY2gsIHNwZS5kYi5jaC5jb21wbGV0ZS5jb3BoKSwzKSkpKQ0KYWJsaW5lICgwLDEpDQpsaW5lcyhsb3dlc3Moc3BlLmRiLmNoLCBzcGUuZGIuY2guY29tcGxldGUuY29waCksY29sPSdyZWQnKQ0KDQpwbG90KHNwZS5kYi5jaCxzcGUuZGIuY2guVVBHTUEuY29waCx4bGFiPSdDaG9yZCBkaXN0YW5jZScseWxhYj0nQ2hvcGhlbmV0aWMgZGlzdGFuY2UnLGFzcD0xLCBtYWluPWMoJ1VQR01BJyxwYXN0ZSgnQ29waGVuZXRpYyBjb3JyZWxhdGlvbicscm91bmQoY29yKHNwZS5kYi5jaCxzcGUuZGIuY2guVVBHTUEuY29waCksMykpKSkNCmFibGluZSAoMCwxKQ0KbGluZXMobG93ZXNzKHNwZS5kYi5jaCxzcGUuZGIuY2guVVBHTUEuY29waCksY29sPSdyZWQnKQ0KDQpwbG90KHNwZS5kYi5jaCxzcGUuZGIuY2gud2FyZC5jb3BoLHhsYWI9J0Nob3JkIGRpc3RhbmNlJyx5bGFiPSdDaG9waGVuZXRpYyBkaXN0YW5jZScsYXNwPTEsIG1haW49YygnV2FyZCBjbHVzdGVyaW5nJyxwYXN0ZSgnQ29waGVuZXRpYyBjb3JyZWxhdGlvbicscm91bmQoY29yKHNwZS5kYi5jaCxzcGUuZGIuY2gud2FyZC5jb3BoKSwzKSkpKQ0KYWJsaW5lICgwLDEpDQpsaW5lcyhsb3dlc3Moc3BlLmRiLmNoLHNwZS5kYi5jaC53YXJkLmNvcGgpLGNvbD0ncmVkJykNCg0Kc3BlLmJjLlVQR01BPC1oY2x1c3Qoc3BlLmJjLG1ldGhvZD0nYXZlcmFnZScpIA0KcGxvdChzcGUuYmMuVVBHTUEsIG1haW49J0F2ZXJhZ2UgKFVQR01BKSBhZ2dsb21lcmF0aXZlIGNsdXN0ZXJpbmcnKSANCnJlY3QuaGNsdXN0KHNwZS5iYy5VUEdNQSwgaz0zLCBib3JkZXI9InJlZCIpDQpyZWN0LmhjbHVzdChzcGUuYmMuVVBHTUEsIGs9NiwgYm9yZGVyPSJibHVlIikNCnJlY3QuaGNsdXN0KHNwZS5iYy5VUEdNQSwgaz04LCBib3JkZXI9ImdyZWVuIikNCg0KcGxvdChzcGUuYmMuVVBHTUEkaGVpZ2h0LCBucm93KHZhcmVzcGVjKToyLCANCiAgICAgdHlwZT0nUycsbWFpbj0nRnVzaW9uIGxldmVscyAtIGJyYXktY3VydGlzIC0gVVBHTUEnLA0KICAgICB5bGFiPSdrIChudW1iZXIgb2YgY2x1c3RlcnMpJywgeGxhYj0naCAobm9kZSBoZWlnaHQpJywgY29sPSdncmV5JykNCnRleHQgKHNwZS5iYy5VUEdNQSRoZWlnaHQsbnJvdyh2YXJlc3BlYyk6MiwgbnJvdyh2YXJlc3BlYyk6MiwgY29sPSdyZWQnLCBjZXg9MC44KQ0KDQojIHN0ZXAgMTogY3V0IHlvdXIgdHJlZQ0KY3V0ZzE8LWN1dHJlZShzcGUuYmMuVVBHTUEsIGs9NikNCiMgc3RlcCAyOiBjYWxjdWxhdGUgc2lsaG91ZXR0ZSBmb3IgdGhlIGRpZmZlcmVudCBwYXJ0aXRpb25zDQpzaWwxPC1zaWxob3VldHRlIChjdXRnMSxzcGUuYmMpDQojIHN0ZXAgMzogcGxvdCBzaWxob3VldHRlIA0KcGxvdChzaWwxKQ0KDQpmdml6X25iY2x1c3QodmFyZXNwZWMsZGlzcz1iY2Rpc3QodmFyZXNwZWMpLCBoY3V0LCBtZXRob2QgPSAid3NzIiwgaGNfbWV0aG9kID0gImF2ZXJhZ2UiKQ0KDQojIyBNYW50ZWwgdGVzdA0KIyBPcHRpbWFsIG51bWJlciBvZiBjbHVzdGVycw0KIyBhY2NvcmRpbmcgdG8gbWFudGVsIHN0YXRpc3RpYyANCiMgRnVuY3Rpb24gdG8gY29tcHV0ZSBhIGJpbmFyeSBkaXN0YW5jZSBtYXRyaXggZnJvbSBncm91cHMNCmdycGRpc3Q8LWZ1bmN0aW9uKHgpew0KICByZXF1aXJlIChjbHVzdGVyKQ0KICBncjwtYXMuZGF0YS5mcmFtZShhcy5mYWN0b3IoeCkpDQogIGRpc3RncjwtZGFpc3koZ3IsJ2dvd2VyJykNCiAgZGlzdGdyDQp9DQojIHJ1biBiYXNlZCBvbiB0aGUgVVBHTUEgY2x1c3RlcmluZw0Ka3Q8LWRhdGEuZnJhbWUoaz0xOm5yb3codmFyZXNwZWMpLHI9MCkNCmZvciAoaSBpbiAyOihucm93KHZhcmVzcGVjKS0xKSl7DQogIGdyPC1jdXRyZWUoc3BlLmJjLlVQR01BLGkpDQogIGRpc3RncjwtZ3JwZGlzdChncikNCiAgbXQ8LWNvcihzcGUuYmMsZGlzdGdyLCBtZXRob2Q9J3BlYXJzb24nKQ0KICBrdFtpLDJdIDwtIG10DQp9DQprLmJlc3QgPC0gd2hpY2gubWF4IChrdCRyKQ0KcGxvdChrdCRrLGt0JHIsIA0KICAgICB0eXBlPSdoJywgbWFpbj0nTWFudGVsLW9wdGltYWwgbnVtYmVyIG9mIGNsdXN0ZXJzIC0gVVBHTUEnLA0KICAgICB4bGFiPSdrIChudW1iZXIgb2YgZ3JvdXBzKScseWxhYj0iUGVhcnNvbidzIGNvcnJlbGF0aW9uIikNCmF4aXMoMSxrLmJlc3QsIA0KICAgICBwYXN0ZSgnb3B0aW11bScsIGsuYmVzdCwgc2VwPSdcbicpLCBjb2w9J3JlZCcsZm9udD0yLCBjb2wuYXhpcz0ncmVkJykNCnBvaW50cyhrLmJlc3QsbWF4KGt0JHIpLHBjaD0xNixjb2w9J3JlZCcsY2V4PTEuNSkNCg0KcHYucmVzdWx0czwtcHZjbHVzdCh0KHZhcmVzcGVjKSwgIyB0byBjbHVzdGVyIHJvd3MgLSBvbWl0IHQoKSB0byBjbHVzdGVyIGNvbHVtbnMsDQogICAgICAgIG1ldGhvZC5oY2x1c3QgPSAiYXZlcmFnZSIsDQogICAgICAgIG1ldGhvZC5kaXN0ID0gZnVuY3Rpb24oeCkgdmVnYW46OnZlZ2Rpc3QodCh4KSwgImJyYXkiKSwNCiAgICAgICAgbiA9IDEwMDApICMgYW5kIG90aGVyIGFyZ3VtZW50cyB5b3UgbmVlZA0KcGxvdChwdi5yZXN1bHRzKQ0KDQojIENhbGN1bGF0ZXMgaGllcmFyY2hpY2FsIGNsdXN0ZXIgYW5hbHlzaXMgb2Ygc3BlY2llcyBkYXRhIA0Kc3BlLmRiLmNoLlVQR01BPC1oY2x1c3Qoc3BlLmRiLmNoLG1ldGhvZD0nYXZlcmFnZScpIA0KZnZpel9uYmNsdXN0KHNwZS5kYiwgaGN1dCwgZGlzcz1kaXN0KHNwZS5kYi5ub3JtLCBtZXRob2Q9J2V1Y2xpZGVhbicpLG1ldGhvZCA9ICJ3c3MiLGhjX21ldGhvZCA9ICJzaW5nbGUiKQ0KIyBEZW5kcm9ncmFtIHdpdGggdGhlIG9ic2VydmVkIGdyb3Vwcw0KcGFyKG1mcm93PWMoMSwyKSkNCnBsb3QgKHNwZS5kYi5jaC5VUEdNQSkNCnJlY3QuaGNsdXN0IChzcGUuZGIuY2guVVBHTUEsIGsgPSA2LCBib3JkZXIgPSAxOjYpDQojIFNwYXRpYWwgZGlzdHJpYnV0aW9uIG9mIHNhbXBsZXMgd2l0aCBwcm9qZWN0aW9uIG9mIGhpZXJhcmNoaWNhbCBjbGFzc2lmaWNhdGlvbg0KVVBHTUEuY2x1c3RlciA8LSBjdXRyZWUgKHNwZS5kYi5jaC5VUEdNQSwgayA9IDYpDQpwbG90ICh5IH4geCwgZGF0YSA9IHNwYS5kYiwgcGNoID0gVVBHTUEuY2x1c3RlciwgY29sID0gVVBHTUEuY2x1c3RlciwgdHlwZSA9ICdiJywgbWFpbiA9ICdDaG9yZCBkaXN0YW5jZSAtIFVQR01BIG1ldGhvZCcpDQpkZXYub2ZmKCkNCg0Kc3BlLmNod288LXJlb3JkZXIuaGNsdXN0KHNwZS5kYi5jaC5VUEdNQSxzcGUuZGIuY2gpDQpkZW5kPC1hcy5kZW5kcm9ncmFtKHNwZS5jaHdvKSANCmhlYXRtYXAoYXMubWF0cml4KHNwZS5kYi5jaCksUm93dj1kZW5kLHN5bW09VFJVRSwgbWFyZ2luPWMoMywzKSkNCg0KIyBrLW1lYW5zIHBhcnRpdGlvbmluZyBvZiB0aGUgcHJlLXRyYW5zZm9ybWVkIHNwZWNpZXMgZGF0YQ0Kc3BlLmttZWFucyA8LSBrbWVhbnMoc3BlLmJjLCBjZW50ZXJzPTYsIG5zdGFydD0xMDApDQojIGstbWVhbnMgZ3JvdXAgbnVtYmVyIG9mIGVhY2ggb2JzZXJ2YXRpb24gc3BlLmttZWFucyRjbHVzdGVyIA0Kc3BlLmttZWFucyRjbHVzdGVyDQojIENvbXBhcmlzb24gd2l0aCB0aGUgNS1ncm91cCBjbGFzc2lmaWNhdGlvbiBkZXJpdmVkIGZyb20gVVBHTUEgY2x1c3RlcmluZw0KY29tcGFyaXNvbjwtdGFibGUoc3BlLmttZWFucyRjbHVzdGVyLGN1dGcxKQ0KY29tcGFyaXNvbg0KIyBWaXN1YWxpemUgay1tZWFucyBjbHVzdGVycyANCmZ2aXpfY2x1c3RlcihzcGUua21lYW5zLCBkYXRhID0gdmFyZXNwZWMsZ2VvbSA9ICJwb2ludCIsDQogICAgICAgICAgICAgc3RhbmQgPSBULCBlbGxpcHNlLnR5cGUgPSAibm9ybSIpIA0KDQpzcGUuS00uY2FzY2FkZTwtY2FzY2FkZUtNKHNwZS5iYyxpbmYuZ3I9MixzdXAuZ3I9MTAsaXRlcj0xMDAsY3JpdGVyaW9uPSdjYWxpbnNraScpDQpwbG90KHNwZS5LTS5jYXNjYWRlLHNvcnRnPVRSVUUpDQoNCm15X2NvbHMgPC0gYygiIzAwQUZCQiIsICIjRTdCODAwIiwgIiNGQzRFMDciKSAgDQpwYWlycyhpcmlzWywxOjRdLCBwY2ggPSAxOSwgIGNleCA9IDAuNSwNCiAgICAgIGNvbCA9IG15X2NvbHNbaXJpcyRTcGVjaWVzXSwNCiAgICAgIGxvd2VyLnBhbmVsPU5VTEwpDQoNCiMjIGZ2aXpfbmJjbHVzdChpcmlzWywgMTo0XSwga21lYW5zLCBtZXRob2QgPSAic2lsaG91ZXR0ZSIpDQojIyBzcGUuS00uY2FzY2FkZTwtY2FzY2FkZUtNKGlyaXNbLDE6NF0saW5mLmdyPTIsIHN1cC5ncj0xMCwgaXRlcj0xMDAsIGNyaXRlcmlvbj0nY2FsaW5za2knKQ0KIyMgcGxvdChzcGUuS00uY2FzY2FkZSxzb3J0Zz1UUlVFKQ0KIyMgc2V0LnNlZWQoMSkNCiMjIGlyaXNDbHVzdGVyPC1rbWVhbnMoaXJpc1ssIDE6NF0sIDMsIG5zdGFydD0gMjApDQojIyB0YWJsZShpcmlzQ2x1c3RlciRjbHVzdGVyLCBpcmlzJFNwZWNpZXMpDQojIyBpcmlzQ2x1c3RlciRjbHVzdGVyPC1hcy5mYWN0b3IoaXJpc0NsdXN0ZXIkY2x1c3RlcikNCiMjIHBsb3Q3PC1nZ3Bsb3QoaXJpcywgYWVzKFBldGFsLkxlbmd0aCwgUGV0YWwuV2lkdGgsIGNvbG9yID0gaXJpc0NsdXN0ZXIkY2x1c3RlcikpICsgZ2VvbV9wb2ludCgpDQojIyBwbG90ODwtZ2dwbG90KGlyaXMsIGFlcyhQZXRhbC5MZW5ndGgsIFBldGFsLldpZHRoLCBjb2xvciA9IFNwZWNpZXMpKSArIGdlb21fcG9pbnQoKQ0KIyMgZ3JpZC5hcnJhbmdlKHBsb3Q3LCBwbG90OCwgbmNvbD0yKQ0KIyMgIyBjb25jbHVzaW9ucz8NCg0KdHJlZTE8LXRyZWUoU3BlY2llc35TZXBhbC5MZW5ndGggKyBTZXBhbC5XaWR0aCArIFBldGFsLkxlbmd0aCArIFBldGFsLldpZHRoLCBkYXRhPWlyaXMpDQpzdW1tYXJ5KHRyZWUxICkNCnBsb3QodHJlZTEpDQp0ZXh0KHRyZWUxKQ0KDQp0cmVlMiA8LSBycGFydChTcGVjaWVzIH4gLiwgZGF0YT1pcmlzLCBtZXRob2Q9ImNsYXNzIikNCmZhbmN5UnBhcnRQbG90KHRyZWUyLCBtYWluPSJJcmlzIikgIyBwYWNrYWdlIHJhdHRsZQ0KDQojIEV4dHJhIHRvIGV4Y2l0aW5nIHlvdXIgY3VyaW9zaXR5DQppcmlzLnJmPXJhbmRvbUZvcmVzdChTcGVjaWVzfi4sIGRhdGE9aXJpcywgaW1wb3J0YW5jZT1UUlVFLCBwcm94aW1pdHk9VFJVRSwgbnRyZWU9NTAwKQ0KIyBSZXF1aXJlZCBudW1iZXIgb2YgdHJlZXMgZ2l2ZXMgZXJyb3JzIGZvciBlYWNoIHNwZWNpZXMgYW5kIHRoZSBhdmVyYWdlIGZvciBhbGwgc3BlY2llcyAoYmxhY2spOg0KcGxvdChpcmlzLnJmLGx0eT0yKQ0KIyBNaXNjbGFzc2lmaWNhdGlvbiBlcnJvciByYXRlczoNCmlyaXMucmYkY29uZnVzaW9uDQojIEltcG9ydGFuY2Ugb2YgaW5kaXZpZHVhbCBwcmVkaWN0b3IgdmFyaWFibGVzIGZvciBjbGFzc2lmaWNhdGlvbiAodGhlIGZ1cnRoZXIgdGhlIHZhbHVlIGlzIG9uIHRoZSByaWdodCBvZiB0aGUgcGxvdCwgdGhlIG1vcmUgaW1wb3J0YW50KToNCnZhckltcFBsb3QoaXJpcy5yZikNCiMgVGhlIG1lbWJlcnNoaXAgb2YgYSBwYXJ0aWN1bGFyIGNsYXNzIGFzIGEgZnVuY3Rpb24gb2YgYSB2YXJpYWJsZSB2YWx1ZSBjYW4gYmUgZGlzcGxheWVkIHdpdGggdGhpcw0KcGFydGlhbFBsb3QoaXJpcy5yZixpcmlzLFBldGFsLldpZHRoLCJzZXRvc2EiKQ0KIyB3ZSBjYW4gcHJlZGljdCB1bmNsYXNzaWZpZWQgb2JzZXJ2YXRpb25zLiBXZSBtYWtlIHVwIHNvbWUgc2FtcGxlIG5ldyBvYnNlcnZhdGlvbnMgZnJvbSB0aGUgb3JpZ2luYWwgZGF0YXNldCB0byBzYXZlIHNvbWUgdGltZSBpbXBvcnRpbmcgKHRoZSBmaXJzdCB0aHJlZSByb3dzIGFyZSBQLiBzZXRvc2EsIGxldHMgc2VlIGlmIFJhbmRvbUZvcmVzdCBnZXRzIHRoYXQgcmlnaHQ6DQpuZXdvYnM9aXJpc1sxOjMsMTo0XQ0KcHJlZGljdChpcmlzLnJmLG5ld29icykNCiMgVGhpcyBsYXN0IHBsb3QgY29udmV5cyB0aGUgY29uZmlkZW5jZSBpbiB5b3VyIHByZWRpY3Rpb25zIGZvciBlYWNoIGluZGl2aWR1YWwgc2FtcGxlLiBDb2xvcnMgcmVwcmVzZW50IHNwZWNpZXMgYW5kIHBvaW50cyBhcmUgc2FtcGxlcy4gSW4gdGhpcyBjYXNlLCBtYW55IHNhbXBsZXMgY2FuIGJlIHByZWRpY3RlZCB3aXRoIGdyZWF0IGNlcnRhaW50eSAoMSkgYW5kIG9ubHkgZmV3IGNsYXNzaWZpY2F0aW9ucyBhcmUgcXVlc3Rpb25hYmxlIChhcHByb2FjaGluZyAwKQ0KcGxvdChtYXJnaW4oaXJpcy5yZikpDQoNCmRhdGEoZG91YnMpDQpzcGUubm9ybTwtZGVjb3N0YW5kKGRvdWJzJGZpc2hbLTgsXSwgJ25vcicpDQplbnY8LWRvdWJzJGVudlstOCxdDQoNCiMgcGFyKG1mcm93PWMoMSwyKSkNCnNwZS5jaC5tdnBhcnQgPC0NCiAgbXZwYXJ0KGRhdGEubWF0cml4KHNwZS5ub3JtKX4uLA0KICAgICAgICAgZW52LA0KICAgICAgICAgbWFyZ2luID0gMC4wOCwNCiAgICAgICAgIGNwPTAsDQogICAgICAgICB4dj0nbWluJywgIyB0cnkgJ3BpY2snIGJlc3QgbnVtYmVyLCAnMXNlJw0KICAgICAgICAgeHZhbD1ucm93KGRvdWJzJGZpc2gpLA0KICAgICAgICAgeHZtdWx0ID0gMTAwDQogICAgICAgICApDQoNCmtuaXRyOjppbmNsdWRlX2dyYXBoaWNzKCJpbGx1c3RyYXRpb25zL211bHRpX2xpbnVuaS5wbmciKQ0KDQprbml0cjo6aW5jbHVkZV9ncmFwaGljcygiaWxsdXN0cmF0aW9ucy9tdWx0aV9vcmRpLnBuZyIpDQoNCmRlY29yYW5hKHZhcmVzcGVjKQ0KDQprbml0cjo6aW5jbHVkZV9ncmFwaGljcygiaWxsdXN0cmF0aW9ucy9tdWx0aV93aW5lLmdpZiIpDQoNCmtuaXRyOjppbmNsdWRlX2dyYXBoaWNzKCJpbGx1c3RyYXRpb25zL211bHRpX1BDQTEucG5nIikNCg0Ka25pdHI6OmluY2x1ZGVfZ3JhcGhpY3MoImlsbHVzdHJhdGlvbnMvbXVsdGlfUENBMi5wbmciKQ0KDQojIFBDQSBvbiB2YXJlY2hlbSANCiMgWW91IGNhbiBzdGFuZGFyZGl6ZSB1c2luZyBzY2FsZSA9VA0KZW52LnBjYTwtcmRhKHZhcmVjaGVtLCBzY2FsZT1UKSANCmVudi5wY2ENCnN1bW1hcnkoZW52LnBjYSkgIyBkZWZhdWx0IHNjYWxpbmcgMg0KDQojIFBsb3RzIHVzaW5nIGJpcGxvdA0KIyBUbyBoZWxwIG1lbW9yaXplIHRoZSBtZWFuaW5nIG9mIHRoZSBzY2FsaW5ncywgdmVnYW4gbm93IGFjY2VwdHMgYXJndW1lbnQgc2NhbGluZyA9ICJzaXRlcyIgZm9yIHNjYWxpbmcgMSBhbmQgc2NhbGluZz0ic3BlY2llcyIgZm9yIHNjYWxpbmcgMi4gVGhpcyBpcyB0cnVlIGZvciBhbGwgdmVnYW4gZnVuY3Rpb25zIGludm9sdmluZyBzY2FsaW5ncw0KcGFyKG1mcm93ID0gYygxLCAyKSkNCmJpcGxvdChlbnYucGNhLCBzY2FsaW5nID0gInNpdGVzIiwgbWFpbiA9ICJzY2FsaW5nIDEgLyBzaXRlcyIpDQpiaXBsb3QoZW52LnBjYSwgc2NhbGluZyA9ICJzcGVjaWVzIiwgbWFpbiA9ICJzY2FsaW5nIDIgLyBzcGVjaWVzIikgIyBEZWZhdWx0IHNjYWxpbmcgMg0KDQpzdW1tYXJ5KGVudi5wY2EpJHNwZWNpZXMNCg0Kc3VtbWFyeShlbnYucGNhKSRzaXRlDQoNCnNjcmVlcGxvdChlbnYucGNhLCBic3RpY2sgPSBUUlVFLCBucGNzID0gbGVuZ3RoKGVudi5wY2EkQ0EkZWlnKSkNCg0KIyBjb21iaW5pbmcgY2x1c3RlcmluZyBhbmQgb3JkaW5hdGlvbiByZXN1bHRzDQpiaXBsb3QoZW52LnBjYSwgbWFpbj0nUENBIC0gc2NhbGluZyAxJyxzY2FsaW5nPTEpIA0Kb3JkaWNsdXN0ZXIoZW52LnBjYSwgDQogICAgICAgICAgICBoY2x1c3QoZGlzdChzY2FsZSh2YXJlY2hlbSkpLCAnd2FyZC5EJyksIA0KICAgICAgICAgICAgcHJ1bmU9MywgY29sID0gImJsdWUiLCBzY2FsaW5nPTEpDQoNCmRlY29yYW5hICh2YXJlc3BlYy5oZWxsKQ0Kc3BlLmgucGNhPC1yZGEodmFyZXNwZWMuaGVsbCkNCnNjcmVlcGxvdChzcGUuaC5wY2EsYnN0aWNrID0gVFJVRSwgbnBjcyA9IGxlbmd0aChzcGUuaC5wY2EkQ0EkZWlnKSkgDQoNCiMgYWRkaW5nIGNvcnJlbGF0aW9uIGNpcmNsZQ0KY2xlYW5wbG90LnBjYSAoc3BlLmgucGNhKSANCiMgU2NhbGluZyAyIGlzIGRlZmF1bHQNCihzcGUuaC5wY2EuZW52IDwtIGVudmZpdChzcGUuaC5wY2EsIHZhcmVjaGVtLCBzY2FsaW5nID0gMikpDQojIHBsb3Qgc2lnbmlmaWNhbnQgdmFyaWFibGVzIHdpdGggYSB1c2VyIC1zZWxlY3RlZCBjb2xvdXINCnBsb3Qoc3BlLmgucGNhLmVudiwgcC5tYXggPSAwLjA1LCBjb2wgPSAzKQ0KIyBUaGlzIGhhcyBhZGRlZCB0aGUgc2lnbmlmaWNhbnQgZW52aXJvbm1lbnRhbCB2YXJpYWJsZXMgdG8gdGhlDQojIGxhc3QgYmlwbG90IGRyYXduIGJ5IFIuDQojIEJFV0FSRTogZW52Zml0KCkgbXVzdCBiZSBnaXZlbiB0aGUgc2FtZSBzY2FsaW5nIGFzIHRoZSBwbG90IHRvIA0KIyB3aGljaCBpdHMgcmVzdWx0IGlzIGFkZGVkIQ0KDQpzcGUucmRhIDwtIHJkYSh2YXJlc3BlYy5oZWxsfi4sdmFyZWNoZW0uc3RhbmQpIA0Kc3VtbWFyeSAoc3BlLnJkYSkgIyBzY2FsaW5nIDIgKGRlZmF1bHQpDQoNCmNvZWYoc3BlLnJkYSkNCg0KI1JldHJpZXZhbCBvZiB0aGUgYWRqdXN0ZWQgUjINCiMgVW5hZGp1c3RlZCBSMiByZXRyaWV2ZSBmcm9tIFJEQSByZXN1bHRzDQpSMjwtUnNxdWFyZUFkaihzcGUucmRhKSRyLnNxdWFyZWQNCiMgQWRqdXN0ZWQgUjIgcmV0cmlldmUgZnJvbSBSREEgb2JqZWN0DQpSMmFkajwtUnNxdWFyZUFkaihzcGUucmRhKSRhZGouci5zcXVhcmVkDQoNCiMgdHJpcGxvdCBvZiB0aGUgcmRhIHJlc3VsdHMNCnBhcihtZnJvdyA9IGMoMiwgMikpDQoNCiMgc2l0ZSBzY29yZXMgYXJlIHdlaWdodGVkIGJ5IHN1bSBvZiBzcGVjaWVzDQojIHNjYWxpbmcgMTogZGlzdGFuY2UgdHJpcGxvdA0KcGxvdCAoc3BlLnJkYSwgc2NhbGluZz0xLCBtYWluPSdUcmlwbG90IFJEQSBzcGUuaGVsIH4gZW52IOKAkyBzY2FsaW5nIDEg4oCTIHdhIHNjb3JlcycpDQpzcGUuc2MgPC0gc2NvcmVzIChzcGUucmRhLCBjaG9pY2VzPTE6Miwgc2NhbGluZz0xLCBkaXNwbGF5PSdzcCcpIA0KYXJyb3dzICgwLDAsIHNwZS5zY1ssMV0sc3BlLnNjWywyXSxsZW5ndGg9MCxsdHk9MSxjb2w9J3JlZCcpIA0KDQojIHNjYWxpbmcgMiAoZGVmYXVsdCkNCnBsb3QgKHNwZS5yZGEsbWFpbj0nVHJpcGxvdCBSREEgc3BlLmhlbCB+IGVudiDigJMgc2NhbGluZyAyIOKAkyB3YSBzY29yZXMnKQ0Kc3BlMi5zYyA8LSBzY29yZXMgKHNwZS5yZGEsIGNob2ljZXM9MToyLCBkaXNwbGF5PSdzcCcpDQphcnJvd3MgKDAsMCwgc3BlMi5zY1ssMV0sc3BlMi5zY1ssMl0sbGVuZ3RoPTAsbHR5PTEsY29sPSdyZWQnKQ0KDQojIHNpdGUgc2NvcmVzIGFyZSBsaW5lYXIgY29tYmluYXRpb25zIG9mIHRoZSBlbnZpcm9ubWVudGFsIHZhcmlhYmxlcw0KIyBzY2FsaW5nIDENCnBsb3QgKHNwZS5yZGEsc2NhbGluZz0xLGRpc3BsYXk9Yygnc3AnLCdsYycsJ2NuJyksbWFpbj0nVHJpcGxvdCBSREEgc3BlLmhlbCB+IGVudiDigJMgc2NhbGluZyAxIOKAkyBsYyBzY29yZXMnKQ0KYXJyb3dzICgwLDAsIHNwZS5zY1ssMV0sc3BlLnNjWywyXSxsZW5ndGg9MCxsdHk9MSxjb2w9J3JlZCcpDQojIHNjYWxpbmcgMg0KcGxvdCAoc3BlLnJkYSxkaXNwbGF5PWMoJ3NwJywnbGMnLCdjbicpLG1haW49J1RyaXBsb3QgUkRBIHNwZS5oZWwgfiBlbnYg4oCTIHNjYWxpbmcgMiDigJMgbGMgc2NvcmVzJykgIyBjbiBmb3IgY2VudHJvaWRzDQphcnJvd3MgKDAsMCwgc3BlMi5zY1ssMV0sc3BlMi5zY1ssMl0sbGVuZ3RoPTAsbHR5PTEsY29sPSdyZWQnKQ0KDQojIEdsb2JhbCB0ZXN0IG9mIHRoZSBSREEgcmVzdWx0cw0KYW5vdmEuY2NhKHNwZS5yZGEsc3RlcD0xMDAwKQ0KDQojIFRlc3Qgb2YgYWxsIGNhbm9uaWNhbCBheGVzDQphbm92YS5jY2Eoc3BlLnJkYSxieT0nYXhpcycsc3RlcD0xMDAwKQ0KDQp2aWYuY2NhKHNwZS5yZGEpDQoNCnNwZS5ubWRzPC1tZXRhTURTKHZhcmVzcGVjLGRpc3RhbmNlPSdicmF5Jyx0cnltYXg9OTk5KQ0Kc3BlLm5tZHMNCnNwZS5ubWRzJHN0cmVzcw0KcGxvdChzcGUubm1kcyx0eXBlPSd0JyxtYWluPXBhc3RlKCdOTURTL0JyYXnigJNTdHJlc3MgPScscm91bmQoc3BlLm5tZHMkc3RyZXNzLDMpKSkNCg0Kc3RyZXNzcGxvdChzcGUubm1kcywgbWFpbj0nU2hlcGFyZCBwbG90JykNCg0KIyBnb29kbmVzcyBvZiBmaXQNCmdvZjwtZ29vZG5lc3Moc3BlLm5tZHMpDQpwbG90KHNwZS5ubWRzLHR5cGU9J3QnLG1haW49J0dvb2RuZXNzIG9mIGZpdCcpDQpwb2ludHMoc3BlLm5tZHMsIGRpc3BsYXk9J3NpdGVzJywgY2V4PWdvZio5MCkNCg0KIyBVUEdNQQ0Kc3BlLmJyYXkudXBnbWEgPC0gaGNsdXN0KHNwZS5iYywnYXZlcmFnZScpDQojIG5NRFMgd2l0aCBsYWJlbHMNCnBsb3Qoc3BlLm5tZHMsIGRpc3BsYXk9InNpdGVzIikNCm9yZGl0b3JwKHNwZS5ubWRzLCBkaXNwbGF5PSJzaXRlcyIpICMgYWRkIHRleHQgLyBwb2ludHMgdG8gb3JkaW5hdGlvbg0KIyBhZGQgYW5kIHBydW5lIHRyZWUNCm9yZGljbHVzdGVyKHNwZS5ubWRzLCBzcGUuYnJheS51cGdtYSwgcHJ1bmU9NSwgY29sID0gY3V0cmVlKHNwZS5icmF5LnVwZ21hLCA2KSxsd2Q9MikNCg0Kb3JkaXN1cmYoc3BlLm5tZHMgfiBCYXJlc29pbCwgdmFyZWNoZW0sIGJ1YmJsZSA9IDUsIG1haW49IkJhcmVzb2lsIEdBTSIpDQoNCmRhdGEoZHVuZSkNCmRhdGEoZHVuZS5lbnYpDQphdHRhY2goZHVuZS5lbnYpDQpOTURTLmR1bmU8LW1ldGFNRFMoZHVuZSxkaXN0YW5jZT0nYnJheScpDQpwbG90KE5NRFMuZHVuZSx0eXBlPSd0JyxtYWluPXBhc3RlKCdOTURTL0JyYXkg4oCTIFN0cmVzcyA9Jyxyb3VuZChOTURTLmR1bmUkc3RyZXNzLDMpKSkNCnBsPC1vcmRpaHVsbChOTURTLmR1bmUsIE1hbmFnZW1lbnQsIHNjYWxpbmcgPSAzLCBkcmF3PSdwb2x5Z29uJyxjb2w9J2dyZXknKQ0Kb3JkaXNwaWRlcihwbCwgY29sPSJyZWQiLCBsdHk9MywgbGFiZWwgPSBUUlVFKQ0KDQojIyBkZWZhdWx0IGlzIG92ZXJhbGwgKG9tbmlidXMpIHRlc3QNCmFkb25pczIoZHVuZSB+IE1hbmFnZW1lbnQqQTEsIG1ldGhvZD0nYnJheScsIGRhdGEgPSBkdW5lLmVudikNCiMjIHNlcXVlbnRpYWwgdGVzdHMNCmFkb25pczIoZHVuZSB+IE1hbmFnZW1lbnQqQTEsIG1ldGhvZD0nYnJheScsIGRhdGEgPSBkdW5lLmVudiwgYnkgPSAidGVybXMiKQ0KDQpkdW5lLmRpc3QgPC0gdmVnZGlzdChkdW5lKQ0KZHVuZS5hbm8gPC0gd2l0aChkdW5lLmVudiwgYW5vc2ltKGR1bmUuZGlzdCwgTWFuYWdlbWVudCkpDQpzdW1tYXJ5KGR1bmUuYW5vKQ0KcGxvdChkdW5lLmFubykNCg0KIyBjcmVhdGUgYSBsaXN0IG9mIDgwJSBvZiB0aGUgcm93cyBpbiB0aGUgb3JpZ2luYWwgZGF0YXNldCB0aGF0IHdlIGNhbiB1c2UgZm9yIHRyYWluaW5nDQp2YWxpZGF0aW9uX2luZGV4IDwtIGNyZWF0ZURhdGFQYXJ0aXRpb24oaXJpcyRTcGVjaWVzLCBwPTAuODAsIGxpc3Q9RkFMU0UpDQojIHNlbGVjdCAyMCUgb2YgdGhlIGRhdGEgZm9yIHZhbGlkYXRpb24NCnZhbGlkYXRpb24gPC0gaXJpc1stdmFsaWRhdGlvbl9pbmRleCxdDQojIHVzZSB0aGUgcmVtYWluaW5nIDgwJSBvZiBkYXRhIHRvIHRyYWluaW5nIGFuZCB0ZXN0aW5nIHRoZSBtb2RlbHMNCmlkYXRhc2V0IDwtIGlyaXNbdmFsaWRhdGlvbl9pbmRleCxdDQoNCiMgUnVuIGFsZ29yaXRobXMgdXNpbmcgMTAtZm9sZCBjcm9zcyB2YWxpZGF0aW9uDQpjb250cm9sIDwtIHRyYWluQ29udHJvbChtZXRob2Q9ImN2IiwgbnVtYmVyPTEwKQ0KbWV0cmljIDwtICJBY2N1cmFjeSINCg0KIyBSYW5kb20gRm9yZXN0DQpzZXQuc2VlZCgxMCkNCmZpdC5yZiA8LSB0cmFpbihTcGVjaWVzfi4sIGRhdGE9aWRhdGFzZXQsIG1ldGhvZD0icmYiLCBtZXRyaWM9bWV0cmljLCB0ckNvbnRyb2w9Y29udHJvbCkNCiMgQ0FSVA0Kc2V0LnNlZWQoMTApDQpmaXQuY2FydCA8LSB0cmFpbihTcGVjaWVzfi4sIGRhdGE9aWRhdGFzZXQsIG1ldGhvZD0icnBhcnQiLCBtZXRyaWM9bWV0cmljLCB0ckNvbnRyb2w9Y29udHJvbCkNCiMga05ODQpzZXQuc2VlZCgxMCkNCmZpdC5rbm4gPC0gdHJhaW4oU3BlY2llc34uLCBkYXRhPWlkYXRhc2V0LCBtZXRob2Q9ImtubiIsIG1ldHJpYz1tZXRyaWMsIHRyQ29udHJvbD1jb250cm9sKQ0KIyBsZGENCnNldC5zZWVkKDEwKQ0KZml0LmxkYSA8LSB0cmFpbihTcGVjaWVzfi4sIGRhdGE9aWRhdGFzZXQsIG1ldGhvZD0ibGRhIiwgbWV0cmljPW1ldHJpYywgdHJDb250cm9sPWNvbnRyb2wpDQoNCiMgc3VtbWFyaXplIGFjY3VyYWN5IG9mIG1vZGVscw0KcmVzdWx0cyA8LSByZXNhbXBsZXMobGlzdChsZGE9Zml0LmxkYSwgY2FydD1maXQuY2FydCwga25uPWZpdC5rbm4sIHJmPWZpdC5yZikpDQpzdW1tYXJ5KHJlc3VsdHMpJHN0YXRpc3RpY3MkQWNjdXJhY3kNCg0KIyBzdW1tYXJpemUgQmVzdCBNb2RlbA0KcHJpbnQoZml0LmxkYSkNCg0KIyBlc3RpbWF0ZSBza2lsbCBvZiBMREEgb24gdGhlIHZhbGlkYXRpb24gZGF0YXNldA0KcHJlZGljdGlvbnMgPC0gcHJlZGljdChmaXQubGRhLCB2YWxpZGF0aW9uKQ0KY29uZnVzaW9uTWF0cml4KHByZWRpY3Rpb25zLCB2YWxpZGF0aW9uJFNwZWNpZXMpDQo=" download="stat_3.R">Download stat_3.R</a>
<hr />
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(vegan)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(qgraph)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(ade4)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(mvabund)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span> (pvclust)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(ecodist)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">library</span>(tree)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="fu">library</span>(rattle)</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co"># to be careful</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="fu">library</span>(mvpart) <span class="co"># devtools::install_github(&quot;cran/mvpart&quot;, force = T) </span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="fu">library</span>(MVPARTwrap) <span class="co"># devtools::install_github(&quot;cran/MVPARTwrap&quot;, force = T)</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="co">#  functions from Borcard et al. 2011</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;https://www.dipintothereef.com/uploads/3/7/3/5/37359245/coldiss.r&#39;</span>) </span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="fu">source</span> (<span class="st">&#39;https://www.dipintothereef.com/uploads/3/7/3/5/37359245/cleanplot.pca.r&#39;</span>)</span></code></pre></div>
<p>Ecological phenomena are inherently complex, and it is rare that a
single variable is sufficient to describe an ecological system, entity,
or interaction. Rather, multiple response variables - such as the
abundances of multiple species - are often measured to gain ecological
insight. In addition, it is common to add multiple explanatory variables
to an analysis in an attempt to explain the variation in the response
data. Multivariate analyses contend with the complexity of
simultaneously analysing <strong>multiple response variables</strong>.
Generally, multivariate approaches are favoured to multiple executions
of univariate methods as they save time and conserve statistical power
which is quickly lost through <em>multiple testing</em>. In some cases,
taking multiple variables into account simultaneously may reveal
patterns that would not be detectable by univariate methods.</p>
<center>
<div class="float">
<img src="illustrations/multi_intro.png" style="width:100.0%"
alt="Comparaison between univariate and multivariate analyses: Univariate data sets feature a single response variable (R1). This may be analysed against one or more explanatory variables (E1-E3). Multivariate data sets include multiple response variables (R1…Rn). Multivariate analysis methods allow the evaluation of all response variables simultaneously, rather than requiring multiple executions of univariate methods. In the latter case, multiple testing occurs, which decreases the statistical power of the analysis." />
<div class="figcaption"><em><strong>Comparaison between univariate and
multivariate analyses</strong>: Univariate data sets feature a single
response variable (R1). This may be analysed against one or more
explanatory variables (E1-E3). Multivariate data sets include multiple
response variables (R1…Rn). Multivariate analysis methods allow the
evaluation of all response variables simultaneously, rather than
requiring multiple executions of univariate methods. In the latter case,
multiple testing occurs, which decreases the statistical power of the
analysis.</em></div>
</div>
</center>
<p>Multivariate data are common in environmental sciences, occurring whe
ever we measure several response variables from each replicate sample.
Questions like how does the species composition of a community vary
across sites, or how does the shape of trees (as measured by several
morphological traits) vary with altitude are multivariate questions.</p>
<p>Johnson and Wichern (2002) suggest five types of scientific inquiry
most suited to the application of multivariate methods.</p>
<ul>
<li><p><strong>Sorting and grouping</strong>: Many ecological questions
are concerned with the similarity or dissimilarity of a collection of
entities and their assignment to groups. Several multivariate methods,
such as <em>cluster analysis</em> and <em>non-metric dimensional
scaling</em>, allow detection of potential groups in the data. Active
classification based on multivariate data may also be performed by
methods such as linear discriminant analysis.</p></li>
<li><p><strong>Data reduction or structural simplification</strong>:
Several multivariate methods, such as <em>principal components
analysis</em>, allow the summary of multiple variables through a
comparatively smaller set of ‘synthetic’ variables generated by the
analyses themselves. Thus, high-dimensional patterns are presented in a
lower-dimensional space, aiding interpretation.</p></li>
<li><p><strong>Investigation of the dependence among variables</strong>:
Dependence among response variables, among response and explanatory
variables, or among explanatory variables is of key interest. Methods
that detect dependence, such as <em>redundancy analysis</em>, are
valuable in detecting influence or covariation.</p></li>
<li><p><strong>Hypothesis testing</strong>: Exploratory techniques can
reveal patterns in data from which hypotheses may be constructed
(however, be careful of data dredging). Several methods, such as
<em>MANOVA</em>, <em>PERMANOVA</em>, <em>ANOSIM</em> or the <em>Mantel
test</em>, allow the testing of statistical hypotheses on multivariate
data. Appropriately constructed assertions may thus be tested.</p></li>
<li><p><strong>Prediction</strong>: Once the dependence among variables
has been detected and characterised, multivariate models may be
constructed to allow prediction.</p></li>
</ul>
<p>Note that according to the field of research there is a trend to
favor some tools more than others.</p>
<div id="data-structure" class="section level1">
<h1>Data Structure</h1>
<p>In ecology, the’typical’ dataset used in multivariate analyses will
be represented by:</p>
<ul>
<li><p>objects in row (e.g. samples can be sites, time periods,
etc.)</p></li>
<li><p>measured variables for those objects in columns (e.g. species,
environmental parameters, etc.)</p></li>
</ul>
<center>
<img src="illustrations/multi_data.png" />
</center>
<p>Measured variables can be binary, quantitative, qualitative,
rank-ordered, or even a mixture of them.</p>
</div>
<div id="transformations" class="section level1">
<h1>Transformations</h1>
<p>If variables do not have uniform scale (e.g. environmental parameters
measured in different units or scales), they usually have to be
transformed (standardized).Occasionally, the variables in a “raw” data
set have properties that violate an assumption of a statistical
procedure (e.g. normally distributed values) or which cannot be compared
to other variables due to differences in scale or variability. For
example, principal components analysis (PCA) requires that variables be
linearly related to one another and on roughly the same scale or will
perform poorly. A transformation involves the application of a
mathematical procedure to every value of a given variable or set of
variables to create a new set of values. The new values of the
transformed variables should still represent the data, but will be more
amenable to analysis or comparison. A few basic but popular data
transformation are described <a
href="https://sites.google.com/site/mb3gustame/reference/data-transformations">here</a>.
The main motivations for applying these transformations include placing
variables on similar scales, simplifying calculations, meeting
distributional assumptions (such as normality), and dealing with
<strong>heteroscedasticity</strong>. Some transformations (see
<strong>Ecologically motivated transformations</strong>) are motivated
to improve effectiveness of many analysis in representing ecological
relationships. Examples:</p>
<ul>
<li><p><strong>Hellinger</strong> Particularly suited to species
abundance data, this transformation gives low weights to variables with
low counts and many zeros. The transformation itself comprises dividing
each value in a data matrix by its row sum, and taking the square root
of the quotient.</p></li>
<li><p><strong>Chord</strong> Like the Hellinger transformation, this
transformation gives low weights to variables with low counts and many
zeros. This transformation divides each value in a data matrix by the
square root of its marginal sum of squares. It thereby sets the marginal
(either row or column) sum of squares to one.</p></li>
<li><p><strong><span class="math inline">\(\chi^2\)</span>
distance</strong> This transformation is the product of the values
transformed by the <span class="math inline">\(\chi^2\)</span> metric
and the square root of the sum of all counts in the data matrix. This is
the distance used in correspondence analysis (CA) and canonical
correspondence analysis (CCA) .</p></li>
</ul>
<p><strong>Before you begin transforming your data, ensure there is a
defined and well-supported reason to do so. Common rationale includes
linearising, normalising, or standardising data in order to respect a
method’s assumptions.</strong></p>
<p>The function <code>decostand()</code> from the <code>vegan</code>
package offers an easy way to transform your data (see also
<code>scale()</code> from the base package and <code>boxcox()</code>
from the MASS package).</p>
<p>The <code>varespec</code> data frame has <strong>24 rows</strong> and
<strong>44 columns</strong>. Columns are estimated cover values of
<strong>44 lichen species</strong>. The variable names are formed from
the scientific names, and are self explanatory for anybody familiar with
vegetation type / lichen species. The associate <code>varechem</code>
data frame has <strong>24 row</strong> and <strong>14 columns</strong>,
giving the soil characteristics of the very same sites as in the
varespec data frame.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># ?varespec</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">data</span> (varespec); <span class="fu">data</span>(varechem)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>varespec[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##    Callvulg Empenigr Rhodtome Vaccmyrt Vaccviti
## 18     0.55    11.13     0.00     0.00    17.80
## 15     0.67     0.17     0.00     0.35    12.13
## 24     0.10     1.55     0.00     0.00    13.47
## 27     0.00    15.13     2.42     5.92    15.97
## 23     0.00    12.68     0.00     0.00    23.73</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>varechem[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##       N    P     K    Ca    Mg
## 18 19.8 42.1 139.9 519.4  90.0
## 15 13.4 39.1 167.3 356.7  70.7
## 24 20.2 67.7 207.1 973.3 209.1
## 27 20.6 60.8 233.7 834.0 127.2
## 23 23.8 54.5 180.6 777.0 125.8</code></pre>
<ul>
<li>Basic transformation</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Transforming  positive  data to a logarithmic</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co"># scale reduces the range of the data set.</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>varespec.log<span class="ot">&lt;-</span><span class="fu">decostand</span>(varespec,<span class="st">&#39;log&#39;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>varespec.log[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##    Callvulg  Empenigr Rhodtome Vaccmyrt Vaccviti
## 18 5.781360 10.120238 0.000000 0.000000 10.79766
## 15 6.066089  4.087463 0.000000 5.129283 10.24436
## 24 3.321928  7.276124 0.000000 0.000000 10.39553
## 27 0.000000 10.563196 7.918863 9.209453 10.64115
## 23 0.000000 10.308339 0.000000 0.000000 11.21250</code></pre>
<ul>
<li>Transformations in aid of comparability</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># Centring by translation, standardize.</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co"># Obj is to remove differences in scale due</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co"># due to diff magnitudes between variables</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>varechem.stand<span class="ot">&lt;-</span><span class="fu">decostand</span>(varechem,<span class="st">&#39;stand&#39;</span>)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>varechem.stand[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##             N          P           K         Ca          Mg
## 18 -0.4673108 -0.1993234 -0.35515620 -0.2063474  0.06197472
## 15 -1.6250357 -0.4000407  0.06740707 -0.8742950 -0.40862677
## 24 -0.3949530  1.5134640  0.68120335  1.6570911  2.96604924
## 27 -0.3225952  1.0518143  1.09142901  1.0852097  0.96904082
## 23  0.2562672  0.6303080  0.27251990  0.8512022  0.93490392</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># making sure `rowSums is the same</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>varespec<span class="ot">&lt;-</span><span class="fu">decostand</span>(varespec,<span class="st">&#39;total&#39;</span>)</span></code></pre></div>
<ul>
<li>Ecologically motivated transofrmations</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Low weights to variables with</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co"># low counts and many zeros</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>varespec.hell<span class="ot">&lt;-</span><span class="fu">decostand</span>(varespec,<span class="st">&#39;hellinger&#39;</span>)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>varespec.hell[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##      Callvulg   Empenigr Rhodtome   Vaccmyrt  Vaccviti
## 18 0.07852337 0.35323616 0.000000 0.00000000 0.4467120
## 15 0.08636760 0.04350488 0.000000 0.06242341 0.3674886
## 24 0.03258003 0.12826771 0.000000 0.00000000 0.3781249
## 27 0.00000000 0.34706223 0.138802 0.21709446 0.3565663
## 23 0.00000000 0.37439612 0.000000 0.00000000 0.5121776</code></pre>
</div>
<div id="dissimilarities" class="section level1">
<h1>(Dis)similarities</h1>
<p>Most methods of multivariate analysis are <strong>explicitly</strong>
or <strong>implicitly</strong> based on the comparison of all possible
pairs of objects or descriptors.</p>
<ul>
<li><p>Comparison takes the form of association measures which are
assembled in a square and symmetrical association matrix of dimension
<span class="math inline">\(n\)</span> x <span
class="math inline">\(n\)</span> when objects are compared, or <span
class="math inline">\(p\)</span> x <span
class="math inline">\(p\)</span> when variables are compared.</p></li>
<li><p>When pairs of objects are compared, the analysis is said to be in
<strong>Q mode</strong>.When pairs of descriptors are compared, the
analysis is said to be in <strong>R mode</strong>.</p></li>
</ul>
<center>
<img src="illustrations/multi_modes.png" style="width:50.0%" />
</center>
<p>In <strong>R mode</strong> correlation type coefficents are commonly
used. In <strong>Q</strong> mode, the choice of a suitable
<strong>association coefficient</strong> is crucial for further
analysis. They are <strong>MANY</strong> of such coefficients with many
variations. We can distinguished two classes of association measures
based on how they deal with the <strong>double-zeros</strong>
problem.</p>
<ul>
<li>The <strong>symmetrical coefficients</strong> will consider the
information from the double-zero (also called ‘negative matched’).</li>
</ul>
<p>The <strong>zero value</strong> has the <strong>same meaning</strong>
as any other values (<em>e.g. 0mg/L of O2 in deep anoxic layer of a
lake</em>) during the comparison.</p>
<ul>
<li>The <strong>asymmetrical coefficients</strong> will ignore the
information send from the double-zero</li>
</ul>
<p>The <strong>zero value</strong> in matrix of species abundances (or
presence-absence) can <strong>not</strong> always be counted as an
indication of <strong>resemblance</strong> (presence has an ecological
meaning, but no conclusions on the absence: e.g. <em>is the absence of a
given nationality in this class means that no students from this
specific country are in NTU? And is it an element to evaluate the
similarity with other university (high similarity because many
nationalities probably absent? No, but at same sample size 1/0 may
become informative</em>)</p>
<p>When analyzing species data (or other data set with many 0), it is
often recommended to use asymmetrical coefficients unless you have
reason to consider each double absence in the matrix
(<em>e.g. controlled experiment with known community composition or
ecologically homogeneous areas with disturbed zones</em>)</p>
<p>You can download a spreadsheet <a
href="documents/distance-metrics.xlsx">here</a> to check how a few
common metrics (Bray-Curtis, Canberra, Manhattan, Euclidean ) are
computed. Many of the common dissimilarity indices can be computed using
the function <code>vegdist()</code> of the <code>vegan</code>
package.</p>
<div id="symmetrical-coefficients" class="section level2">
<h2>Symmetrical coefficients</h2>
<p><strong>Euclidean distance</strong> is the most commonly-used of our
distance measures. For this reason, Euclidean distance is often just to
referred to as “distance”. When data is dense or continuous, this is the
best proximity measure. The Euclidean distance between two points is the
length of the path connecting them.This distance between two points is
given by the Pythagorean theorem.</p>
<p><span class="math inline">\(E_d=\sqrt{\sum (x_i-y_j)^2}\)</span></p>
<p>Here the abundance of a species from one sample is subtracted from
its counterpart in the other sample. Instead of ignoring the sign, the
result is squared (which gives a positive value.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>env.euc<span class="ot">&lt;-</span><span class="fu">vegdist</span>(varechem.stand, <span class="at">method=</span><span class="st">&#39;euc&#39;</span>)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>env.euc</span></code></pre></div>
<pre><code>##          18       15       24       27       23       19       22       16
## 15 2.076795                                                               
## 24 6.881455 6.902911                                                      
## 27 4.472930 4.640031 5.480141                                             
## 23 2.508157 3.725441 5.714228 3.485496                                    
## 19 3.580362 4.230579 5.444585 3.963974 2.090646                           
## 22 2.659129 3.322366 6.211287 3.144598 2.350078 2.915506                  
## 16 2.295538 2.523272 7.578978 5.597915 3.844376 4.536930 3.035372         
## 28 4.711717 5.135626 5.727870 2.251989 3.379820 4.167968 3.197171 5.425819
## 13 5.163051 5.143758 5.503478 5.183118 4.829489 4.703184 4.780313 5.538243
## 14 2.214261 2.508627 6.052150 4.547412 2.613444 2.795418 2.417533 2.216285
## 20 3.929612 4.722576 5.137563 3.710586 3.082121 3.794574 3.596080 4.915697
## 25 3.133990 3.438813 6.817505 2.697976 3.398260 4.233353 2.128549 3.768984
## 7  4.902707 4.851508 8.765682 7.825045 6.340833 6.525625 5.467040 3.669583
## 5  5.494762 5.503429 9.044446 7.614066 6.780440 7.282166 5.337012 3.759681
## 6  4.240836 3.522221 8.339925 7.133815 5.988268 6.159191 4.960431 3.090877
## 3  6.114415 5.874919 9.114128 8.443844 7.368183 7.483323 6.448263 5.164238
## 4  6.056153 5.490663 5.675037 6.710881 6.292292 6.296010 6.363818 6.193482
## 2  4.952230 4.272081 6.946933 6.359101 5.933650 6.135478 5.330507 4.670076
## 9  4.210905 3.152702 5.301315 5.180014 4.740011 4.679232 4.286254 4.112046
## 12 2.859399 1.748190 6.857408 5.238196 4.168750 4.453430 3.303346 2.129211
## 10 4.971930 4.123743 5.532590 4.709422 5.191931 5.908087 4.946672 5.207166
## 11 6.555175 6.159317 6.307815 6.463291 6.605497 7.125631 6.312777 6.647700
## 21 2.541018 3.350502 7.842843 5.887089 3.751708 4.297416 3.586107 2.404075
##          28       13       14       20       25        7        5        6
## 15                                                                        
## 24                                                                        
## 27                                                                        
## 23                                                                        
## 19                                                                        
## 22                                                                        
## 16                                                                        
## 28                                                                        
## 13 4.787319                                                               
## 14 4.504796 4.677466                                                      
## 20 3.386708 4.080519 3.675366                                             
## 25 3.206937 5.633416 3.508540 3.675065                                    
## 7  7.426831 6.139937 4.890801 6.731633 6.073600                           
## 5  7.345700 7.712800 5.299028 7.185358 5.552826 3.955814                  
## 6  7.170158 6.720173 4.055417 6.600159 5.287531 2.890701 4.044360         
## 3  7.980027 6.714928 6.114734 7.505396 6.864594 2.005845 5.012284 3.642568
## 4  6.415616 4.331136 5.234877 4.983238 6.608737 6.416942 8.119472 6.018705
## 2  6.212418 4.446846 4.870891 5.960714 5.631457 3.980541 5.862950 4.262119
## 9  5.396570 4.824086 3.218064 4.633718 4.562550 5.121769 5.991261 3.826538
## 12 5.541108 5.617684 2.374512 5.210211 3.808624 4.254957 4.589606 2.563051
## 10 5.157768 5.262302 5.090947 5.335147 4.742350 6.426056 6.611317 5.894445
## 11 6.851687 6.549927 6.739702 6.703751 6.393673 6.843533 7.403817 6.822555
## 21 6.105741 6.428456 3.034526 5.028912 4.141141 4.644876 4.840212 4.233115
##           3        4        2        9       12       10       11
## 15                                                               
## 24                                                               
## 27                                                               
## 23                                                               
## 19                                                               
## 22                                                               
## 16                                                               
## 28                                                               
## 13                                                               
## 14                                                               
## 20                                                               
## 25                                                               
## 7                                                                
## 5                                                                
## 6                                                                
## 3                                                                
## 4  6.605012                                                      
## 2  3.940559 4.585946                                             
## 9  5.632169 3.553283 3.905153                                    
## 12 5.301066 5.545040 4.280278 2.657423                           
## 10 6.831129 5.614997 4.386353 3.851042 4.281034                  
## 11 6.803213 6.828622 5.390366 5.573175 5.866142 3.337215         
## 21 6.053964 7.243058 6.018877 5.083938 3.278880 5.886786 6.743400</code></pre>
<p>Hellinger transformation (and Chord transformation) addresses the
<strong>double-zeros</strong> problem, so that Euclidean distance can be
computed on species data set:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>spe.euc<span class="ot">&lt;-</span><span class="fu">vegdist</span>(varespec.hell, <span class="at">method=</span><span class="st">&#39;euc&#39;</span>)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>spe.euc</span></code></pre></div>
<pre><code>##           18        15        24        27        23        19        22
## 15 0.6885085                                                            
## 24 0.8832262 0.6510691                                                  
## 27 0.7910534 0.6375933 0.7940364                                        
## 23 0.5081880 0.5086377 0.7408735 0.6271162                              
## 19 0.6243167 0.6933916 0.8323611 0.6007214 0.6098096                    
## 22 0.7884443 0.5023435 0.8842105 0.6161528 0.6837140 0.8000232          
## 16 0.6891088 0.4711067 0.8179679 0.6893387 0.6194974 0.7885046 0.3705829
## 28 1.0695865 0.7418770 0.8263419 0.4560429 0.8694615 0.8258045 0.7873319
## 13 0.5778679 0.7456913 0.9664977 0.9388940 0.8094553 0.7353812 0.8109562
## 14 0.7629536 0.6167549 0.8470347 0.9156971 0.7033679 0.8705452 0.6380148
## 20 0.5015733 0.4883031 0.5844143 0.5902462 0.4137370 0.6718956 0.6631752
## 25 0.8205461 0.5929722 0.5952999 0.7237625 0.6146184 0.7903998 0.6863306
## 7  0.4300117 0.8908551 1.0387277 1.0219158 0.7803477 0.9133439 0.9886714
## 5  0.6685566 0.9351727 1.0927175 1.1318043 0.8941397 0.9866085 1.1184278
## 6  0.4229041 0.8550120 1.0019788 1.0154041 0.7692241 0.7496268 0.9759759
## 3  0.6862552 1.0506689 1.1446854 1.0511938 0.9908644 0.6935852 1.1008011
## 4  0.6904660 0.9400679 1.0764631 1.0510837 0.9564543 0.7252940 1.0477732
## 2  0.8254764 1.1144072 1.1432947 1.0149059 1.0174019 0.6575977 1.1434747
## 9  0.8853145 1.0518246 1.0894975 0.9718277 0.9874184 0.5826872 1.0827697
## 12 0.6986821 0.9424660 0.9771750 0.8755972 0.8538765 0.4746625 0.9984029
## 10 0.8453086 1.1073720 1.1401871 1.0233948 1.0035372 0.6206193 1.1211180
## 11 0.5929664 0.7000506 0.8416860 0.8104208 0.7311443 0.4897586 0.8911256
## 21 0.8348124 1.0084494 1.0041300 0.7974464 0.8002867 0.6931377 0.9195848
##           16        28        13        14        20        25         7
## 15                                                                      
## 24                                                                      
## 27                                                                      
## 23                                                                      
## 19                                                                      
## 22                                                                      
## 16                                                                      
## 28 0.8651196                                                            
## 13 0.6868519 1.1276956                                                  
## 14 0.6355864 1.0632806 0.7621527                                        
## 20 0.5800131 0.8261883 0.7598172 0.6239459                              
## 25 0.6418272 0.8386606 0.9749686 0.8008885 0.6257771                    
## 7  0.8709735 1.2401937 0.7234806 0.9181760 0.7123701 1.0075616          
## 5  0.9433809 1.2907516 0.7643290 1.0330193 0.8683251 1.1151073 0.4875320
## 6  0.8448554 1.2529995 0.5412746 0.8066733 0.6965889 1.0154715 0.4341785
## 3  1.0289198 1.2910911 0.7030126 1.0834102 0.9495672 1.1496109 0.7667576
## 4  0.9552775 1.2394221 0.5553063 0.9692510 0.9189013 1.1101797 0.7596461
## 2  1.0868402 1.2550752 0.8247355 1.1625459 0.9961091 1.1714913 0.9818356
## 9  1.1031053 1.1637131 0.8972488 1.1250918 1.0049397 1.1137489 1.1117257
## 12 0.9589885 1.1293982 0.7308159 0.9969037 0.8276797 1.0178014 0.9370430
## 10 1.0973935 1.2513249 0.8461219 1.1141905 1.0135505 1.1498831 1.0408385
## 11 0.8133014 1.0137148 0.5284663 0.8867857 0.6932719 0.9295287 0.7947845
## 21 0.9534487 0.9838784 0.9620969 1.0548296 0.8789273 1.0033420 1.0322018
##            5         6         3         4         2         9        12
## 15                                                                      
## 24                                                                      
## 27                                                                      
## 23                                                                      
## 19                                                                      
## 22                                                                      
## 16                                                                      
## 28                                                                      
## 13                                                                      
## 14                                                                      
## 20                                                                      
## 25                                                                      
## 7                                                                       
## 5                                                                       
## 6  0.5422481                                                            
## 3  0.7834206 0.5632560                                                  
## 4  0.7209618 0.5498198 0.4745660                                        
## 2  0.9676165 0.7519117 0.3327985 0.6421022                              
## 9  1.1303276 0.8842728 0.5387671 0.7147272 0.3903159                    
## 12 0.9772972 0.6880630 0.4171877 0.6166016 0.2871988 0.3345441          
## 10 1.0539527 0.8009789 0.4240141 0.6520573 0.2542151 0.2506173 0.2730400
## 11 0.7575263 0.5893188 0.5358943 0.5263155 0.5804940 0.6162229 0.4585293
## 21 1.1237297 0.9296524 0.9171831 1.0127395 0.8497142 0.7919298 0.7722441
##           10        11
## 15                    
## 24                    
## 27                    
## 23                    
## 19                    
## 22                    
## 16                    
## 28                    
## 13                    
## 14                    
## 20                    
## 25                    
## 7                     
## 5                     
## 6                     
## 3                     
## 4                     
## 2                     
## 9                     
## 12                    
## 10                    
## 11 0.6228418          
## 21 0.8209725 0.8595703</code></pre>
<p>Check you have a triangular matrix.</p>
</div>
<div id="asymmetrical-coefficient" class="section level2">
<h2>Asymmetrical coefficient</h2>
<p><strong>Bray-Curtis</strong> dissimilarity is the
<strong>golden</strong> ditance metric in ecology. At first, you
subtract the abundance of one species in a sample from its counterpart
in the other sample but ignore the sign. The second component is the
abundance of a species in one sample added to the abundance of its
counterpart in the second sample. If a species is absent, then its
abundance should be recorded as 0 (zero).</p>
<p><span class="math inline">\(BC_d = \frac {\sum
|x_i-x_j|}{\sum(x_i+x_j)}\)</span></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># default option using vegdist()</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>spe.bc<span class="ot">&lt;-</span><span class="fu">vegdist</span>(varespec)</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>spe.bc</span></code></pre></div>
<pre><code>##           18        15        24        27        23        19        22
## 15 0.5319661                                                            
## 24 0.6734223 0.3663630                                                  
## 27 0.5724901 0.3370702 0.4299930                                        
## 23 0.3732068 0.3655490 0.5029341 0.4270900                              
## 19 0.4953762 0.4290101 0.4828032 0.3690329 0.3491125                    
## 22 0.6402091 0.3885902 0.5282766 0.4415089 0.4804766 0.4621729          
## 16 0.5326273 0.3966699 0.5852581 0.5225031 0.4062716 0.4656792 0.2218188
## 28 0.8470134 0.4870578 0.5526456 0.3317757 0.6862121 0.6127170 0.5977598
## 13 0.3355118 0.6013429 0.7577905 0.7486106 0.6193583 0.5830224 0.6940324
## 14 0.5325101 0.4858051 0.6513873 0.7043458 0.5572642 0.6335312 0.5045794
## 20 0.3207002 0.3646462 0.4243156 0.4212449 0.1935377 0.3861712 0.4685331
## 25 0.6372691 0.3520742 0.3364774 0.4326993 0.4259456 0.4268344 0.3874100
## 7  0.3334867 0.6619036 0.7919020 0.7736910 0.6360640 0.6929678 0.7479339
## 5  0.4955288 0.7124711 0.8559962 0.8774613 0.7255857 0.7820381 0.8654101
## 6  0.2993194 0.6200608 0.7459463 0.7460287 0.6202565 0.5803845 0.7245927
## 3  0.5196235 0.7615230 0.8339976 0.8106431 0.7190895 0.4904688 0.8024773
## 4  0.4586977 0.6896931 0.8326408 0.8493322 0.7163218 0.5098318 0.7994110
## 2  0.5908303 0.8194098 0.8384232 0.7561022 0.7334173 0.5032985 0.8323197
## 9  0.6694425 0.7665353 0.7485010 0.7421684 0.7110145 0.4791854 0.7678474
## 12 0.5106661 0.6641018 0.6851745 0.6257228 0.5669163 0.3483178 0.7003953
## 10 0.6627995 0.7879708 0.7900651 0.7080509 0.7048449 0.4445282 0.7890540
## 11 0.4289045 0.4956042 0.5857713 0.6223598 0.4956293 0.2803481 0.5805660
## 21 0.5408593 0.7579060 0.7247121 0.5760192 0.4898847 0.5229447 0.6890447
##           16        28        13        14        20        25         7
## 15                                                                      
## 24                                                                      
## 27                                                                      
## 23                                                                      
## 19                                                                      
## 22                                                                      
## 16                                                                      
## 28 0.6737634                                                            
## 13 0.5343909 0.8568502                                                  
## 14 0.4740722 0.8053676 0.5431428                                        
## 20 0.3436226 0.6604601 0.5442714 0.5125245                              
## 25 0.4310525 0.5916702 0.7431139 0.5497397 0.4512263                    
## 7  0.6422017 0.8990358 0.4495556 0.6277723 0.5608034 0.7581174          
## 5  0.7116385 0.9523825 0.5146308 0.7297675 0.6684507 0.8599138 0.3322992
## 6  0.6243634 0.9013571 0.3335109 0.5927910 0.5171754 0.7389265 0.1705519
## 3  0.6686124 0.9233027 0.4911727 0.8044696 0.6415434 0.8166456 0.5225602
## 4  0.6491265 0.9330336 0.3546025 0.6787727 0.6461156 0.8413350 0.5168000
## 2  0.6994655 0.9023620 0.5918868 0.8336489 0.6602936 0.8164407 0.6601582
## 9  0.8263480 0.8657290 0.7185052 0.8270307 0.7121001 0.7792214 0.8303301
## 12 0.6382774 0.8527890 0.5866597 0.7405848 0.5418122 0.6897064 0.7000682
## 10 0.7583198 0.8972695 0.7070855 0.8067438 0.7059382 0.7749324 0.7652915
## 11 0.5027300 0.7552225 0.4091291 0.6675810 0.4247147 0.6132484 0.5384601
## 21 0.7426973 0.7208253 0.7197618 0.7984976 0.5800524 0.7417949 0.7950997
##            5         6         3         4         2         9        12
## 15                                                                      
## 24                                                                      
## 27                                                                      
## 23                                                                      
## 19                                                                      
## 22                                                                      
## 16                                                                      
## 28                                                                      
## 13                                                                      
## 14                                                                      
## 20                                                                      
## 25                                                                      
## 7                                                                       
## 5                                                                       
## 6  0.4060208                                                            
## 3  0.5823691 0.4451619                                                  
## 4  0.5132154 0.4175720 0.3006833                                        
## 2  0.7454050 0.5599848 0.1887205 0.4162876                              
## 9  0.9006322 0.7159260 0.3542673 0.5585814 0.2237425                    
## 12 0.7938323 0.5731427 0.2383698 0.4451089 0.1859789 0.2214144          
## 10 0.8567748 0.6487949 0.3060963 0.5275663 0.1361378 0.1123608 0.1768576
## 11 0.5838320 0.4093075 0.3095142 0.2997939 0.4210529 0.5016651 0.3633741
## 21 0.8891536 0.6794069 0.7477696 0.7724904 0.6785879 0.6084939 0.5653481
##           10        11
## 15                    
## 24                    
## 27                    
## 23                    
## 19                    
## 22                    
## 16                    
## 28                    
## 13                    
## 14                    
## 20                    
## 25                    
## 7                     
## 5                     
## 6                     
## 3                     
## 4                     
## 2                     
## 9                     
## 12                    
## 10                    
## 11 0.5012480          
## 21 0.6200462 0.6682173</code></pre>
<p><strong>Jaccard Similarity</strong> is used to find similarities
between sets on the only base of presence and absence. The Jaccard
similarity between two sets <span class="math inline">\(A\)</span> and
<span class="math inline">\(B\)</span> is defined as:</p>
<p><span class="math display">\[
J(A, B) = \frac{|A \cap B|}{|A \cup B|}
\]</span></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># Jaccard dissimilarity matrix using vegdist()</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>spe.jd <span class="ot">&lt;-</span> <span class="fu">vegdist</span>(varespec,<span class="st">&#39;jac&#39;</span>,<span class="at">binary=</span>T) <span class="co"># binary p/a </span></span></code></pre></div>
<p>This measure is important when comparing <span
class="math inline">\(\beta\)</span>-diversity among sites for example.
Other distances applying to presence-Absence data: Sørensen, Ochiai,
etc.</p>
<p><strong>Note</strong>: For mixed types variables, including
categorical or qualitative multiclass variables use <strong>Gower’s
similarity</strong>. It is easily computed in R using <code>daisy</code>
function built in the <code>cluster</code> package. Avoid
<code>vegdist</code> with <code>method='gower'</code>, which is
appropriate for quantitative and presence-absence, but not for
multiclass variables. Overall, <code>gowdis</code> from the package
<code>FD</code> is the most complete function to compute Gower’s
coefficient in R, and commonly used in <strong>trait-based
approach</strong> analyses.</p>
</div>
<div id="visualization" class="section level2">
<h2>Visualization</h2>
<p>Among the many ways to visualize similarity matrix: the function
<code>coldiss</code> (Borcard et al. 2011) and the package
<code>qgraph</code> offer nice options:</p>
<ul>
<li>Heat map</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">coldiss</span>(spe.bc,<span class="at">byrank=</span>F,<span class="at">diag=</span>T)</span></code></pre></div>
<pre><code>## Loading required package: gclus</code></pre>
<pre><code>## Warning: package &#39;gclus&#39; was built under R version 4.2.3</code></pre>
<pre><code>## Loading required package: cluster</code></pre>
<pre><code>## Registered S3 method overwritten by &#39;gclus&#39;:
##   method         from 
##   reorder.hclust vegan</code></pre>
<p><img src="stat_3_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<ul>
<li>Network</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">qgraph</span>(<span class="dv">1</span><span class="sc">-</span>spe.bc, <span class="at">layout=</span><span class="st">&#39;spring&#39;</span>, <span class="at">vsize=</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p class="comment">
<strong>Practice 7.5</strong> Using the <code>tikus</code> data set from
the package <code>mvabund</code> - check <code>?tikus</code>. Select
observation for the year 1981, 1983, and 1985 only (noted
<code>81</code>, <code>83</code> and <code>85</code>). Build a
Bray-Curtis dissimilarity matrix among selected observations. Plot heat
map of this matrix. Build a network of <strong>SPECIES</strong>
co-occurrence (presence/absence) based on your selection of years.
</p>
</div>
</div>
<div id="clustering" class="section level1">
<h1>Clustering</h1>
<p>We often aim to recognize discontinuous <strong>subsets</strong> in
an environment which is represented by discrete (e.g. taxonomic) changes
but perceived as continuous changes in ecology.</p>
<p><strong>Clustering</strong> consists in partitioning the collection
of objects (or descriptors in R-mode). Clustering <strong>does not
test</strong> any hypothesis.</p>
<p><strong>Clustering</strong> is an explanatory procedure which helps
to understand data with complex structure and multivariate
relationships, and is a very useful method to extract knowledge and
information especially from large datasets.</p>
<p>Many <strong>clustering</strong> approaches rely on association
matrix, which stresses on the <strong>importance</strong> of the right
choice of an appropriate association coefficient.</p>
<p>The definition of a cluster varies, and different cluster analysis
techniques may approach the problem very differently. We recognize
different families of clusering:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Sequential</strong> or <strong>Simultaneous</strong>
algorithms (most of the clustering algorithm)</p></li>
<li><p><strong>Agglomerative</strong> or
<strong>Divisive</strong></p></li>
<li><p><strong>Monothetic</strong> (cluster members with common prop.)
versus <strong>Polythetic</strong> (distance between elements defines
membership)</p></li>
<li><p><strong>Hierarchical</strong> versus
<strong>Non-hierarchical</strong> (flat)</p></li>
<li><p><strong>Probabilistic</strong> (decision tree) versus
<strong>non-probabilistic</strong> methods</p></li>
<li><p><strong>Hard</strong> and <strong>Soft</strong> (may
overlap)</p></li>
</ol>
<p>Numerical classification often requires two arguments: the matrix of
distances among samples (ecological resemblance) and the method to us
<em>e.g.</em>: name of the clustering algorithm. Clustering produces
tree-like structure. Again be careful of <strong>data dredging</strong>.
You don’t choose clustering method according to how your tree looks
like.The suitable method is usually carefully <strong>selected</strong>
and/or <strong>evaluated</strong> according to the data set you are
dealing with and your initial hypotheses (some may not make sense).
Below we will describe two widely-used approaches of clustering. We will
aslo plant some seeds …</p>
<div id="hierarchical-clustering" class="section level2">
<h2>Hierarchical Clustering</h2>
<p>Hierarchical cluster analysis may be performed using an “object x
object” matrix of (dis)similarities or distances. It attempts to find a
good, although perhaps not the best, grouping of objects based on the
distances supplied in a hierarchical manner, first grouping objects with
the lowest dissimilarities before proceeding. Therefore grouping may be
presented as a dendrogram. Many of these algorithms are greedy (i.e. the
optimal local solution is always taken in the hope of finding an optimal
global solution) and heuristic, requiring the results of cluster
analysis to be evaluated for stability by, for example, bootstrapping
procedures.</p>
<p>Agglomerative clustering is a widespread approach in hierarchical
cluster analysis. Agglomerative algorithms successively merge individual
entities and clusters that have the highest similarity values. These
typically use a linkage criterion to determine the (dis)similarity
values for clusters formed during the algorithm’s execution. These are
valid both for the clustering of objects and of variables provided some
measure of (dis)similarity; however, note other clustering techniques
may not share this flexibility. Agglomerative algorithms end when all
the individual entities and clusters have been merged into a single
cluster. Below some common linkage criteria are summarised.</p>
<p>In R, the function <code>hclust()</code> allows to implement some of
the common hierarchical clustering algorithms. <code>pvclust()</code>
from the <code>pvclust</code> allows bootstrapping and indication of
highly supported clusters with <code>pvrect()</code>.</p>
<div id="common-algorithms" class="section level3">
<h3>Common algorithms</h3>
<p><strong>SINGLE LINKAGE AGGLOMERATIVE CLUSTERING</strong> (neighbor
sorting)</p>
<p>Single linkage allows object to agglomerate easily to a group since a
link to a single object of the group suffices to induce fusion.
<strong>This is the ‘closest’ friend’ procedure</strong>.</p>
<ul>
<li><p>commonly produced chain dendrograms: a pair is linked to a third
object</p></li>
<li><p>agglomerates objects on the basis of their shortest pairwise
distance</p></li>
<li><p>partitions difficult to interpret, but gradients quite
clear</p></li>
</ul>
<p>The <code>doubs</code> dataset (<code>ade4</code> package) gives
environmental variables, fish species and spatial coordinates for 30
sites along a river.</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co"># Step 1: dataset</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="co"># ?doubs</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="fu">data</span>(doubs)</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>spe.db<span class="ot">&lt;-</span>doubs<span class="sc">$</span>fish</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>spa.db<span class="ot">&lt;-</span>doubs<span class="sc">$</span>xy</span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a><span class="co"># remove empty sample 8 from both datasets</span></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>spe.db <span class="ot">&lt;-</span>spe.db[<span class="sc">-</span><span class="dv">8</span>,]</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>spa.db<span class="ot">&lt;-</span> spa.db[<span class="sc">-</span><span class="dv">8</span>,]</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a><span class="co"># Step 2: chord distance = normalization + euclidean</span></span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>spe.db.norm<span class="ot">&lt;-</span><span class="fu">decostand</span>(spe.db,<span class="st">&#39;normalize&#39;</span>) </span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>spe.db.ch<span class="ot">&lt;-</span><span class="fu">vegdist</span>(spe.db.norm,<span class="st">&#39;euc&#39;</span>) </span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a><span class="co"># Step 3: single linkage agglomerative clustering</span></span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a>spe.db.ch.single <span class="ot">&lt;-</span><span class="fu">hclust</span>(spe.db.ch,<span class="at">method=</span><span class="st">&#39;single&#39;</span>) </span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a><span class="co"># Step 4: plot dendrogram</span></span></code></pre></div>
<p>Apply well for examining change in species composition along
environmental gradients.</p>
<p><strong>COMPLETE LINKAGE AGGLOMERATIVE CLUSTERING</strong> (furthest
neighbor sorting)</p>
<p>A group admits a new member only at the distance corresponding to the
furthest object of the group: <strong>one could say that the admission
requires unanimity of the group</strong>.</p>
<ul>
<li><p>dendrograms look a bit like rakes – some cluster merge together
at the highest dissimilarity</p></li>
<li><p>allow an object (or a group) to agglomerate with another group
only at the distance corresponding to that of the most distant pair of
objects</p></li>
</ul>
<div class="sourceCode" id="cb27"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>spe.db.ch.complete<span class="ot">&lt;-</span><span class="fu">hclust</span>(spe.db.ch,<span class="at">method=</span><span class="st">&#39;complete&#39;</span>) </span></code></pre></div>
<p><strong>AVERAGE AGGLOMERATIVE CLUSTERING</strong> (e.g. UPGMA)</p>
<p>The <strong>most common</strong> method in ecology (species data). It
comprises <strong>four sub-methods</strong> that are based on
<strong>average</strong> or <strong>median</strong> dissimilarities
among objects, <strong>centroids</strong> of cluster, or
<strong>McQuitty</strong>’s method.</p>
<center>
<img src="illustrations/multi_upgma.png" style="width:75.0%" />
</center>
<div class="sourceCode" id="cb28"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>spe.db.ch.UPGMA<span class="ot">&lt;-</span><span class="fu">hclust</span>(spe.db.ch,<span class="at">method=</span><span class="st">&#39;average&#39;</span>) </span></code></pre></div>
<p><strong>WARD’S MINIMUM VARIANCE CLUSTERING</strong></p>
<p><strong>Ward</strong> method is also a favorite clustering method.
Unlike the others, instead of measuring the distance directly, it
analyzes the variance of clusters. Ward’s is said to be the most
suitable method for quantitative variables. It is based on linear model
criterion of least square: the within-group sum of square is
minimized.</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>spe.db.ch.ward<span class="ot">&lt;-</span><span class="fu">hclust</span>(spe.db.ch,<span class="at">method=</span><span class="st">&#39;ward.D&#39;</span>) </span></code></pre></div>
<p><strong>Note</strong>: Ward method is based on Euclidean model. It
should not be combined with distance measures, which are not strictly
metric such as the popular Bray-Curtis distance.</p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="fu">plot</span>(spe.db.ch.single, <span class="at">main=</span><span class="st">&#39;Single linkage agglomerative clustering&#39;</span> ) </span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a><span class="fu">plot</span>(spe.db.ch.complete, <span class="at">main=</span><span class="st">&#39;Complete linkage agglomerative clustering&#39;</span>) </span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="fu">plot</span>(spe.db.ch.UPGMA, <span class="at">main=</span><span class="st">&#39;Average (UPGMA) agglomerative clustering&#39;</span>) </span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="fu">plot</span>(spe.db.ch.ward, <span class="at">main=</span><span class="st">&#39;Ward clustering&#39;</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
</div>
<div id="clustering-quality" class="section level3">
<h3>Clustering quality</h3>
<p>There are many ways to evaluate the overall quality of the chose
clustering algorithms and therefore of their representations.</p>
<ul>
<li>the <strong>cophenetic correlation</strong> related distances
extracted from the dendrogram (function <code>cophenetic</code> on a
<code>hclust</code> object) with ditances in our original distance
matrices. A higher correlation means a better representation of the
initial matrix.</li>
</ul>
<div class="sourceCode" id="cb31"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="co"># Single linkage clustering</span></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>spe.db.ch.single.coph <span class="ot">&lt;-</span> <span class="fu">cophenetic</span> (spe.db.ch.single)</span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a><span class="fu">cor</span>(spe.db.ch,spe.db.ch.single.coph)</span></code></pre></div>
<pre><code>## [1] 0.599193</code></pre>
<div class="sourceCode" id="cb33"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># complete linkage clustering</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>spe.db.ch.complete.coph <span class="ot">&lt;-</span> <span class="fu">cophenetic</span> (spe.db.ch.complete)</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a><span class="fu">cor</span>(spe.db.ch,spe.db.ch.complete.coph)</span></code></pre></div>
<pre><code>## [1] 0.7655628</code></pre>
<div class="sourceCode" id="cb35"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co"># Average clustering</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>spe.db.ch.UPGMA.coph <span class="ot">&lt;-</span> <span class="fu">cophenetic</span> (spe.db.ch.UPGMA)</span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a><span class="fu">cor</span>(spe.db.ch,spe.db.ch.UPGMA.coph)</span></code></pre></div>
<pre><code>## [1] 0.8608326</code></pre>
<div class="sourceCode" id="cb37"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="co"># Ward clustering</span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>spe.db.ch.ward.coph <span class="ot">&lt;-</span> <span class="fu">cophenetic</span> (spe.db.ch.ward)</span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a><span class="fu">cor</span>(spe.db.ch,spe.db.ch.ward.coph)</span></code></pre></div>
<pre><code>## [1] 0.7593934</code></pre>
<p>UPGMA performs better at retaining information of our initial chord
distance matrix.</p>
<ul>
<li>the <strong>shepard-like diagram</strong> is a plot that represents
orginal distances against the cophentic distances. Can be combined with
cophonetic correlation seen above.</li>
</ul>
<div class="sourceCode" id="cb39"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a><span class="fu">plot</span>(spe.db.ch,spe.db.ch.single.coph,<span class="at">xlab=</span><span class="st">&#39;Chord distance&#39;</span>,<span class="at">ylab=</span><span class="st">&#39;Chophenetic distance&#39;</span>,<span class="at">asp=</span><span class="dv">1</span>, <span class="at">main=</span><span class="fu">c</span>(<span class="st">&#39;Single linkage&#39;</span>,<span class="fu">paste</span>(<span class="st">&#39;Cophenetic correlation&#39;</span>,<span class="fu">round</span>(<span class="fu">cor</span>(spe.db.ch,spe.db.ch.single.coph),<span class="dv">3</span>))))</span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a><span class="fu">abline</span> (<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(spe.db.ch,spe.db.ch.single.coph),<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" tabindex="-1"></a><span class="fu">plot</span>(spe.db.ch,spe.db.ch.complete.coph,<span class="at">xlab=</span><span class="st">&#39;Chord distance&#39;</span>,<span class="at">ylab=</span><span class="st">&#39;Chophenetic distance&#39;</span>,<span class="at">asp=</span><span class="dv">1</span>, <span class="at">main=</span><span class="fu">c</span>(<span class="st">&#39;Complete linkage&#39;</span>,<span class="fu">paste</span>(<span class="st">&#39;Cophenetic correlation&#39;</span>,<span class="fu">round</span>(<span class="fu">cor</span>(spe.db.ch, spe.db.ch.complete.coph),<span class="dv">3</span>))))</span>
<span id="cb39-8"><a href="#cb39-8" tabindex="-1"></a><span class="fu">abline</span> (<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb39-9"><a href="#cb39-9" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(spe.db.ch, spe.db.ch.complete.coph),<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb39-10"><a href="#cb39-10" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" tabindex="-1"></a><span class="fu">plot</span>(spe.db.ch,spe.db.ch.UPGMA.coph,<span class="at">xlab=</span><span class="st">&#39;Chord distance&#39;</span>,<span class="at">ylab=</span><span class="st">&#39;Chophenetic distance&#39;</span>,<span class="at">asp=</span><span class="dv">1</span>, <span class="at">main=</span><span class="fu">c</span>(<span class="st">&#39;UPGMA&#39;</span>,<span class="fu">paste</span>(<span class="st">&#39;Cophenetic correlation&#39;</span>,<span class="fu">round</span>(<span class="fu">cor</span>(spe.db.ch,spe.db.ch.UPGMA.coph),<span class="dv">3</span>))))</span>
<span id="cb39-12"><a href="#cb39-12" tabindex="-1"></a><span class="fu">abline</span> (<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb39-13"><a href="#cb39-13" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(spe.db.ch,spe.db.ch.UPGMA.coph),<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb39-14"><a href="#cb39-14" tabindex="-1"></a></span>
<span id="cb39-15"><a href="#cb39-15" tabindex="-1"></a><span class="fu">plot</span>(spe.db.ch,spe.db.ch.ward.coph,<span class="at">xlab=</span><span class="st">&#39;Chord distance&#39;</span>,<span class="at">ylab=</span><span class="st">&#39;Chophenetic distance&#39;</span>,<span class="at">asp=</span><span class="dv">1</span>, <span class="at">main=</span><span class="fu">c</span>(<span class="st">&#39;Ward clustering&#39;</span>,<span class="fu">paste</span>(<span class="st">&#39;Cophenetic correlation&#39;</span>,<span class="fu">round</span>(<span class="fu">cor</span>(spe.db.ch,spe.db.ch.ward.coph),<span class="dv">3</span>))))</span>
<span id="cb39-16"><a href="#cb39-16" tabindex="-1"></a><span class="fu">abline</span> (<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb39-17"><a href="#cb39-17" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(spe.db.ch,spe.db.ch.ward.coph),<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
</div>
<div id="cluster-groups" class="section level3">
<h3>Cluster groups</h3>
<p>By simply watching a dendrogram, the number of groups or partition to
interpret is highly subjective. Let’s repeat the step above for the
<code>varespec</code> data set. The UPGM tree also came out at the
dendrogamm retaining the best information from our bray-curtis
dissimilarity matrix.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a>spe.bc.UPGMA<span class="ot">&lt;-</span><span class="fu">hclust</span>(spe.bc,<span class="at">method=</span><span class="st">&#39;average&#39;</span>) </span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a><span class="fu">plot</span>(spe.bc.UPGMA, <span class="at">main=</span><span class="st">&#39;Average (UPGMA) agglomerative clustering&#39;</span>) </span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a><span class="fu">rect.hclust</span>(spe.bc.UPGMA, <span class="at">k=</span><span class="dv">3</span>, <span class="at">border=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a><span class="fu">rect.hclust</span>(spe.bc.UPGMA, <span class="at">k=</span><span class="dv">6</span>, <span class="at">border=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a><span class="fu">rect.hclust</span>(spe.bc.UPGMA, <span class="at">k=</span><span class="dv">8</span>, <span class="at">border=</span><span class="st">&quot;green&quot;</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>Solution at 3, 5, 8? They are methods that can guide you at selecting
a relevant number of groups - again danger of data dredging!</p>
<ul>
<li><strong>Fusion Level values</strong></li>
</ul>
<p>The plot of the <strong>Fusion Level Values</strong> is further used
a diagnostic of interpretable cluster groups. It examines values where a
fusion between two branches of a dendrogram occurs.</p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="fu">plot</span>(spe.bc.UPGMA<span class="sc">$</span>height, <span class="fu">nrow</span>(varespec)<span class="sc">:</span><span class="dv">2</span>, </span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>     <span class="at">type=</span><span class="st">&#39;S&#39;</span>,<span class="at">main=</span><span class="st">&#39;Fusion levels - bray-curtis - UPGMA&#39;</span>,</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&#39;k (number of clusters)&#39;</span>, <span class="at">xlab=</span><span class="st">&#39;h (node height)&#39;</span>, <span class="at">col=</span><span class="st">&#39;grey&#39;</span>)</span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a><span class="fu">text</span> (spe.bc.UPGMA<span class="sc">$</span>height,<span class="fu">nrow</span>(varespec)<span class="sc">:</span><span class="dv">2</span>, <span class="fu">nrow</span>(varespec)<span class="sc">:</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&#39;red&#39;</span>, <span class="at">cex=</span><span class="fl">0.8</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>The graph of fusion level values shows clear jump of fusion values
between 3-4 and 6-7 partitions.</p>
<ul>
<li>The <strong>Silhouette</strong> widths indicator (also apply for
non-hierarchical clustering)</li>
</ul>
<p>The silhouette width is a measure of the <strong>degree of membership
of an object to its cluster</strong> based on the average distance
between this object and all objects of the cluster to which is belongs,
compared to the same measure for the next closest cluster. Silhouette
widths range from -1 to 1 and can be averaged over all objects of a
partition. The greater the value is, the better the object is clustered.
Negative values mean that the corresponding objects have probably placed
in the wrong cluster (intra group variation higher than inter group
variation).</p>
<div class="sourceCode" id="cb42"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="co"># step 1: cut your tree</span></span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a>cutg1<span class="ot">&lt;-</span><span class="fu">cutree</span>(spe.bc.UPGMA, <span class="at">k=</span><span class="dv">6</span>)</span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a><span class="co"># step 2: calculate silhouette for the different partitions</span></span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>sil1<span class="ot">&lt;-</span><span class="fu">silhouette</span> (cutg1,spe.bc)</span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a><span class="co"># step 3: plot silhouette </span></span>
<span id="cb42-6"><a href="#cb42-6" tabindex="-1"></a><span class="fu">plot</span>(sil1)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Repeat by changing <em>k</em>, the number of partitions</p>
<ul>
<li>the <strong>Elbow</strong> method</li>
</ul>
<p>This method looks at the percentage of variance explained (SS) as a
function of the number of cluster. One should choose a number of
clusters so that adding another cluster doesn’t give much better
explanation. At some point the marginal gain will drop, giving an angle
in the graph. The number of clusters is chosen at this point, hence the
“elbow criterion” (wss). This is very common method to select an
appropriate number of cluster to interpret.</p>
<div class="sourceCode" id="cb43"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(varespec,<span class="at">diss=</span><span class="fu">bcdist</span>(varespec), hcut, <span class="at">method =</span> <span class="st">&quot;wss&quot;</span>, <span class="at">hc_method =</span> <span class="st">&quot;average&quot;</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<ul>
<li>The <strong>Mantel</strong> test</li>
</ul>
<p>Compares the original distance matrix to (binary) matrices computed
from dendrogram cut at various level and choose the level where matrix
correlation is the highest. The Mantel correlation is in its simplest
sense, i.e. the equivalent of a Pearson r correlation but between
distance matrices.</p>
<p>Comparison between the distance matrix and binary matrices
representing partitions</p>
<div class="sourceCode" id="cb44"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="do">## Mantel test</span></span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a><span class="co"># Optimal number of clusters</span></span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a><span class="co"># according to mantel statistic </span></span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a><span class="co"># Function to compute a binary distance matrix from groups</span></span>
<span id="cb44-5"><a href="#cb44-5" tabindex="-1"></a>grpdist<span class="ot">&lt;-</span><span class="cf">function</span>(x){</span>
<span id="cb44-6"><a href="#cb44-6" tabindex="-1"></a>  <span class="fu">require</span> (cluster)</span>
<span id="cb44-7"><a href="#cb44-7" tabindex="-1"></a>  gr<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">as.factor</span>(x))</span>
<span id="cb44-8"><a href="#cb44-8" tabindex="-1"></a>  distgr<span class="ot">&lt;-</span><span class="fu">daisy</span>(gr,<span class="st">&#39;gower&#39;</span>)</span>
<span id="cb44-9"><a href="#cb44-9" tabindex="-1"></a>  distgr</span>
<span id="cb44-10"><a href="#cb44-10" tabindex="-1"></a>}</span>
<span id="cb44-11"><a href="#cb44-11" tabindex="-1"></a><span class="co"># run based on the UPGMA clustering</span></span>
<span id="cb44-12"><a href="#cb44-12" tabindex="-1"></a>kt<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">k=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(varespec),<span class="at">r=</span><span class="dv">0</span>)</span>
<span id="cb44-13"><a href="#cb44-13" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>(<span class="fu">nrow</span>(varespec)<span class="sc">-</span><span class="dv">1</span>)){</span>
<span id="cb44-14"><a href="#cb44-14" tabindex="-1"></a>  gr<span class="ot">&lt;-</span><span class="fu">cutree</span>(spe.bc.UPGMA,i)</span>
<span id="cb44-15"><a href="#cb44-15" tabindex="-1"></a>  distgr<span class="ot">&lt;-</span><span class="fu">grpdist</span>(gr)</span>
<span id="cb44-16"><a href="#cb44-16" tabindex="-1"></a>  mt<span class="ot">&lt;-</span><span class="fu">cor</span>(spe.bc,distgr, <span class="at">method=</span><span class="st">&#39;pearson&#39;</span>)</span>
<span id="cb44-17"><a href="#cb44-17" tabindex="-1"></a>  kt[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> mt</span>
<span id="cb44-18"><a href="#cb44-18" tabindex="-1"></a>}</span>
<span id="cb44-19"><a href="#cb44-19" tabindex="-1"></a>k.best <span class="ot">&lt;-</span> <span class="fu">which.max</span> (kt<span class="sc">$</span>r)</span>
<span id="cb44-20"><a href="#cb44-20" tabindex="-1"></a><span class="fu">plot</span>(kt<span class="sc">$</span>k,kt<span class="sc">$</span>r, </span>
<span id="cb44-21"><a href="#cb44-21" tabindex="-1"></a>     <span class="at">type=</span><span class="st">&#39;h&#39;</span>, <span class="at">main=</span><span class="st">&#39;Mantel-optimal number of clusters - UPGMA&#39;</span>,</span>
<span id="cb44-22"><a href="#cb44-22" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&#39;k (number of groups)&#39;</span>,<span class="at">ylab=</span><span class="st">&quot;Pearson&#39;s correlation&quot;</span>)</span>
<span id="cb44-23"><a href="#cb44-23" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>,k.best, </span>
<span id="cb44-24"><a href="#cb44-24" tabindex="-1"></a>     <span class="fu">paste</span>(<span class="st">&#39;optimum&#39;</span>, k.best, <span class="at">sep=</span><span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>), <span class="at">col=</span><span class="st">&#39;red&#39;</span>,<span class="at">font=</span><span class="dv">2</span>, <span class="at">col.axis=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb44-25"><a href="#cb44-25" tabindex="-1"></a><span class="fu">points</span>(k.best,<span class="fu">max</span>(kt<span class="sc">$</span>r),<span class="at">pch=</span><span class="dv">16</span>,<span class="at">col=</span><span class="st">&#39;red&#39;</span>,<span class="at">cex=</span><span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<ul>
<li><code>NbClust</code> for many others</li>
</ul>
<p>The function <code>NbClust()</code>provides 30 indices for
determining the number of clusters and proposes to user the best
clustering scheme from the different results obtained by varying all
combinations of number of clusters, distance measures, and clustering
methods (Charrad et al. 2014).</p>
</div>
<div id="bootstrapping-trees" class="section level3">
<h3>Bootstrapping trees</h3>
<p>A litte handmade add-on to us use <code>pvclust()</code> from the
package <code>pvclust</code> with Bray-Curtis dissimilarity (note that
data set need to be transposed for using this function).</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a>pv.results<span class="ot">&lt;-</span><span class="fu">pvclust</span>(<span class="fu">t</span>(varespec), <span class="co"># to cluster rows - omit t() to cluster columns,</span></span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>        <span class="at">method.hclust =</span> <span class="st">&quot;average&quot;</span>,</span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a>        <span class="at">method.dist =</span> <span class="cf">function</span>(x) vegan<span class="sc">::</span><span class="fu">vegdist</span>(<span class="fu">t</span>(x), <span class="st">&quot;bray&quot;</span>),</span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a>        <span class="at">n =</span> <span class="dv">1000</span>) <span class="co"># and other arguments you need</span></span></code></pre></div>
<pre><code>## Bootstrap (r = 0.5)... Done.
## Bootstrap (r = 0.59)... Done.
## Bootstrap (r = 0.68)... Done.
## Bootstrap (r = 0.8)... Done.
## Bootstrap (r = 0.89)... Done.
## Bootstrap (r = 1.0)... Done.
## Bootstrap (r = 1.09)... Done.
## Bootstrap (r = 1.18)... Done.
## Bootstrap (r = 1.3)... Done.
## Bootstrap (r = 1.39)... Done.</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="fu">plot</span>(pv.results)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>boston.pv &lt;- pvclust(varesspec, method.dist=“correlation”,
nboot=100, parallel=FALSE)</p>
<hr />
<p>Let’s apply this on the <code>doubs</code> data set:</p>
<div class="sourceCode" id="cb48"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a><span class="co"># Calculates hierarchical cluster analysis of species data </span></span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a>spe.db.ch.UPGMA<span class="ot">&lt;-</span><span class="fu">hclust</span>(spe.db.ch,<span class="at">method=</span><span class="st">&#39;average&#39;</span>) </span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(spe.db, hcut, <span class="at">diss=</span><span class="fu">dist</span>(spe.db.norm, <span class="at">method=</span><span class="st">&#39;euclidean&#39;</span>),<span class="at">method =</span> <span class="st">&quot;wss&quot;</span>,<span class="at">hc_method =</span> <span class="st">&quot;single&quot;</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<div class="sourceCode" id="cb49"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a><span class="co"># Dendrogram with the observed groups</span></span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb49-3"><a href="#cb49-3" tabindex="-1"></a><span class="fu">plot</span> (spe.db.ch.UPGMA)</span>
<span id="cb49-4"><a href="#cb49-4" tabindex="-1"></a><span class="fu">rect.hclust</span> (spe.db.ch.UPGMA, <span class="at">k =</span> <span class="dv">6</span>, <span class="at">border =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb49-5"><a href="#cb49-5" tabindex="-1"></a><span class="co"># Spatial distribution of samples with projection of hierarchical classification</span></span>
<span id="cb49-6"><a href="#cb49-6" tabindex="-1"></a>UPGMA.cluster <span class="ot">&lt;-</span> <span class="fu">cutree</span> (spe.db.ch.UPGMA, <span class="at">k =</span> <span class="dv">6</span>)</span>
<span id="cb49-7"><a href="#cb49-7" tabindex="-1"></a><span class="fu">plot</span> (y <span class="sc">~</span> x, <span class="at">data =</span> spa.db, <span class="at">pch =</span> UPGMA.cluster, <span class="at">col =</span> UPGMA.cluster, <span class="at">type =</span> <span class="st">&#39;b&#39;</span>, <span class="at">main =</span> <span class="st">&#39;Chord distance - UPGMA method&#39;</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-29-2.png" width="672" /></p>
<div class="sourceCode" id="cb50"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>## null device 
##           1</code></pre>
<p>Let’s combine heatmap and cluster</p>
<ul>
<li>Heat map &amp; clustering visualization (example)</li>
</ul>
<p>We must reorder objects (function <code>reorder.hclust</code>) so
that their order in the dissimilarity matrix is respected . This does
not affect the topology of the dendrogram.</p>
<div class="sourceCode" id="cb52"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a>spe.chwo<span class="ot">&lt;-</span><span class="fu">reorder.hclust</span>(spe.db.ch.UPGMA,spe.db.ch)</span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a>dend<span class="ot">&lt;-</span><span class="fu">as.dendrogram</span>(spe.chwo) </span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a><span class="fu">heatmap</span>(<span class="fu">as.matrix</span>(spe.db.ch),<span class="at">Rowv=</span>dend,<span class="at">symm=</span><span class="cn">TRUE</span>, <span class="at">margin=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>))</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p class="comment">
<strong>Practice 7.6</strong> Using <code>tikus</code> data set and
subset on years 1981, 1983 and 1985: compute the three common clustering
methods (single, complete, average) on a Bray-Curtis dissimilarities
matrix. Compare resulting dendrograms using cophenetic correlation and
Shepard-like diagram. Choose method with the one with the highest
cophenetic correlation and produce a heat map of the reordered distance
matrix together with a visualization of the related dendrogram.
</p>
</div>
</div>
<div id="non-hierarchical-clustering" class="section level2">
<h2>Non-Hierarchical Clustering</h2>
<p>Non-hierarchical clustering creates partitions but without hierarchy
(think of categorizing fruits: apples, oranges, bananas). It determine a
partition of the objects into k groups, or clusters, such as the objects
within each cluster are more similar to one other than to objects in the
other clusters.</p>
<p>It usually requires an initial configuration (user usually determine
the number of groups, <em>k</em>), which will be optimized in a
recursive process (often random). If random, the initial configuration
is run a large number of times with different initial configurations in
order to find the best solution.</p>
<p>The most known and commonly used non-hierarchical
<strong>partitioning algorithms</strong> is <strong><em>k</em>-means
clustering</strong> (MacQueen, 1967), in which, each cluster is
represented by the center or means of the data points belonging to the
cluster.</p>
<p><img src="illustrations/multi_kmean.png" /></p>
<p>Three crital steps:</p>
<ul>
<li><p><strong>Initialization</strong>: <em>k</em> observations from the
dataset are used as the initial means. The <strong>random
partition</strong> method first randomly assigns a cluster to each
observation and then proceeds to the update step, thus computing the
initial mean to be the centroid of the cluster’s randomly assigned
points.</p></li>
<li><p><strong>Assignment step</strong> Assign each observation to the
cluster with the nearest mean: that with the least squared Euclidean
distance (Mathematically, this means partitioning the observations
according to the Voronoi diagram generated by the means)</p></li>
<li><p><strong>Update step</strong> Recalculate means (centroids) for
observations assigned to each cluster.</p></li>
</ul>
<p>The algorithm has <strong>converged</strong> when the assignments no
longer change. The algorithm is not always guaranteed to find the
optimum.</p>
<center>
<img src="illustrations/multi_kmean_2.gif" style="width:50.0%" />
</center>
<p>The aims is to identify <strong>high-density regions</strong> in the
data. To do so, the method iteratively minimizes an objective function
the <strong>total error sum of squares (TESS or SSE)</strong>, which is
the sum of the within groups sums-of squares. <em>It is basically the
sum, over the <em>k</em> groups, of the sums of squared distance among
the objects in the group, each divided by the number of objects in the
group.</em> The algorithm is often presented as assigning objects to the
nearest cluster by distance. Using a different distance function other
than (squared) Euclidean distance may prevent the algorithm from
converging. Various modifications of <em>k</em>-means such as
<strong><em>k</em>-medoids</strong> [<strong>PAM (Partitioning Around
Medoids</strong>, Kaufman &amp; Rousseeuw, 1990] have been proposed to
allow using other distance measures. In this case, cluster is
represented by one of the objects in the cluster.</p>
<p>Data must be standardized prior to partitioning. With a
pre-determined number of groups, recommended function is:
<code>kmeans()</code> from the <code>stats</code> package. The argument
<code>nstart</code> will repeat the analysis a large number of time
using different initial configuration until finding the best
solution.</p>
<p><em>Note: do not forget to normalized your data</em></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="co"># k-means partitioning of the pre-transformed species data</span></span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a>spe.kmeans <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(spe.bc, <span class="at">centers=</span><span class="dv">6</span>, <span class="at">nstart=</span><span class="dv">100</span>)</span>
<span id="cb53-3"><a href="#cb53-3" tabindex="-1"></a><span class="co"># k-means group number of each observation spe.kmeans$cluster </span></span>
<span id="cb53-4"><a href="#cb53-4" tabindex="-1"></a>spe.kmeans<span class="sc">$</span>cluster</span></code></pre></div>
<pre><code>## 18 15 24 27 23 19 22 16 28 13 14 20 25  7  5  6  3  4  2  9 12 10 11 21 
##  1  5  6  6  5  3  5  5  6  1  5  5  6  1  1  1  2  1  2  2  2  2  3  4</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="co"># Comparison with the 5-group classification derived from UPGMA clustering</span></span>
<span id="cb55-2"><a href="#cb55-2" tabindex="-1"></a>comparison<span class="ot">&lt;-</span><span class="fu">table</span>(spe.kmeans<span class="sc">$</span>cluster,cutg1)</span>
<span id="cb55-3"><a href="#cb55-3" tabindex="-1"></a>comparison</span></code></pre></div>
<pre><code>##    cutg1
##     1 2 3 4 5 6
##   1 6 0 0 0 0 0
##   2 0 0 0 0 5 0
##   3 0 2 0 0 0 0
##   4 0 0 0 0 0 1
##   5 0 5 0 1 0 0
##   6 0 2 2 0 0 0</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="co"># Visualize k-means clusters </span></span>
<span id="cb57-2"><a href="#cb57-2" tabindex="-1"></a><span class="fu">fviz_cluster</span>(spe.kmeans, <span class="at">data =</span> varespec,<span class="at">geom =</span> <span class="st">&quot;point&quot;</span>,</span>
<span id="cb57-3"><a href="#cb57-3" tabindex="-1"></a>             <span class="at">stand =</span> T, <span class="at">ellipse.type =</span> <span class="st">&quot;norm&quot;</span>) </span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>The function <code>cascadeKM</code> in <code>vegan</code> package is
a wrapper for the <code>kmeans</code> function. It creates several
partitions forming a cascade from small (argument <code>inf.gr</code> to
large values of <em>k</em> (argument <code>sup.gr</code>). The cascade
proposes the ‘best solution’ for partitioning using the
<code>calinski</code> or <code>ssi</code> criterion. Other indicators
such as elbow and silhouette can also be applied looking for the best
partitioning.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a>spe.KM.cascade<span class="ot">&lt;-</span><span class="fu">cascadeKM</span>(spe.bc,<span class="at">inf.gr=</span><span class="dv">2</span>,<span class="at">sup.gr=</span><span class="dv">10</span>,<span class="at">iter=</span><span class="dv">100</span>,<span class="at">criterion=</span><span class="st">&#39;calinski&#39;</span>)</span>
<span id="cb58-2"><a href="#cb58-2" tabindex="-1"></a><span class="fu">plot</span>(spe.KM.cascade,<span class="at">sortg=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<div id="fuzzy-clustering" class="section level3">
<h3><strong>Fuzzy clustering</strong></h3>
<p>The <strong>fuzzy clustering</strong> is considered as soft
clustering or <strong>soft</strong> <em>k</em>-means, in which each
element has a probability of belonging to each cluster. In other words,
each element has a set of membership coefficients corresponding to the
degree of being in a given cluster. In fuzzy clustering, points close to
the center of a cluster, may be in the cluster to a higher degree than
points in the edge of a cluster. The degree, to which an element belongs
to a given cluster, is a numerical value varying from 0 to 1. This is
fundamentally different from <em>k</em>-means and <em>k</em>-medoid
clustering, where each object is affected exactly to one cluster.
<em>k</em>-means and <em>k</em>-medoids clustering are known as
<strong>hard</strong> or <strong>non-fuzzy</strong> clustering.</p>
<p>In other words, in non-fuzzy clustering a fruit can be an apple or an
orange (hard clustering). In soft clustering, the fruit can be an apple
AND an orange at the same time but to certain degrees.</p>
<p>The <strong>fuzzy c-means (FCM)</strong> algorithm is one of the most
widely used fuzzy clustering algorithms. The centroid of a cluster is
calculated as the mean of all points, weighted by their degree of
belonging to the cluster. The function <code>fanny</code>
[<code>cluster</code> package] can be used to compute fuzzy clustering.
‘FANNY’ stands for <em>fuzzy analysis clustering</em> (see
<code>?fanny</code>).</p>
<p class="comment">
<strong>Practice 7.7</strong> Using <code>iris</code> data set: (1) make
a K-means cascade and use the silhouette width indicator to determine
the optimal number of clusters. (2) since we know that 3 species are
involved, group the data into 3 clusters (common sense) using the
<code>kmeans</code> function. How many points are wrongly classified?
Plot both solutions and conclude.
</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a>my_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#00AFBB&quot;</span>, <span class="st">&quot;#E7B800&quot;</span>, <span class="st">&quot;#FC4E07&quot;</span>)  </span>
<span id="cb59-2"><a href="#cb59-2" tabindex="-1"></a><span class="fu">pairs</span>(iris[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="at">pch =</span> <span class="dv">19</span>,  <span class="at">cex =</span> <span class="fl">0.5</span>,</span>
<span id="cb59-3"><a href="#cb59-3" tabindex="-1"></a>      <span class="at">col =</span> my_cols[iris<span class="sc">$</span>Species],</span>
<span id="cb59-4"><a href="#cb59-4" tabindex="-1"></a>      <span class="at">lower.panel=</span><span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<div class="sourceCode" id="cb60"><pre
class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], kmeans, <span class="at">method =</span> <span class="st">&quot;silhouette&quot;</span>)</span>
<span id="cb60-2"><a href="#cb60-2" tabindex="-1"></a>spe.KM.cascade<span class="ot">&lt;-</span><span class="fu">cascadeKM</span>(iris[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>],<span class="at">inf.gr=</span><span class="dv">2</span>, <span class="at">sup.gr=</span><span class="dv">10</span>, <span class="at">iter=</span><span class="dv">100</span>, <span class="at">criterion=</span><span class="st">&#39;calinski&#39;</span>)</span>
<span id="cb60-3"><a href="#cb60-3" tabindex="-1"></a><span class="fu">plot</span>(spe.KM.cascade,<span class="at">sortg=</span><span class="cn">TRUE</span>)</span>
<span id="cb60-4"><a href="#cb60-4" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb60-5"><a href="#cb60-5" tabindex="-1"></a>irisCluster<span class="ot">&lt;-</span><span class="fu">kmeans</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">3</span>, <span class="at">nstart=</span> <span class="dv">20</span>)</span>
<span id="cb60-6"><a href="#cb60-6" tabindex="-1"></a><span class="fu">table</span>(irisCluster<span class="sc">$</span>cluster, iris<span class="sc">$</span>Species)</span>
<span id="cb60-7"><a href="#cb60-7" tabindex="-1"></a>irisCluster<span class="sc">$</span>cluster<span class="ot">&lt;-</span><span class="fu">as.factor</span>(irisCluster<span class="sc">$</span>cluster)</span>
<span id="cb60-8"><a href="#cb60-8" tabindex="-1"></a>plot7<span class="ot">&lt;-</span><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Petal.Length, Petal.Width, <span class="at">color =</span> irisCluster<span class="sc">$</span>cluster)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb60-9"><a href="#cb60-9" tabindex="-1"></a>plot8<span class="ot">&lt;-</span><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Petal.Length, Petal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb60-10"><a href="#cb60-10" tabindex="-1"></a><span class="fu">grid.arrange</span>(plot7, plot8, <span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb60-11"><a href="#cb60-11" tabindex="-1"></a><span class="co"># conclusions?</span></span></code></pre></div>
</div>
</div>
<div id="decision-trees" class="section level2">
<h2>Decision trees</h2>
<p>Multiple variables are use to make a decision, but they can be made
into multivariate. <a
href="https://www.youtube.com/watch?v=7VeUPuFGJHk&amp;ab_channel=StatQuestwithJoshStarmer">Here</a>
for a basic understanding of decision trees.</p>
<div id="classification-and-regression-trees-cart"
class="section level3">
<h3>Classification And Regression Trees (CART)</h3>
<p>The functions <code>tree</code> and <code>ctree</code> builds
decision trees (<a
href="https://cran.r-project.org/web/packages/partykit/vignettes/ctree.pdf">recursive
partitioning algorithm</a>). The first parameter is a formula, which
defines a target variable and a list of independent variables.</p>
<div class="sourceCode" id="cb61"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a>tree1<span class="ot">&lt;-</span><span class="fu">tree</span>(Species<span class="sc">~</span>Sepal.Length <span class="sc">+</span> Sepal.Width <span class="sc">+</span> Petal.Length <span class="sc">+</span> Petal.Width, <span class="at">data=</span>iris)</span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a><span class="fu">summary</span>(tree1 )</span></code></pre></div>
<pre><code>## 
## Classification tree:
## tree(formula = Species ~ Sepal.Length + Sepal.Width + Petal.Length + 
##     Petal.Width, data = iris)
## Variables actually used in tree construction:
## [1] &quot;Petal.Length&quot; &quot;Petal.Width&quot;  &quot;Sepal.Length&quot;
## Number of terminal nodes:  6 
## Residual mean deviance:  0.1253 = 18.05 / 144 
## Misclassification error rate: 0.02667 = 4 / 150</code></pre>
<div class="sourceCode" id="cb63"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a><span class="fu">plot</span>(tree1)</span>
<span id="cb63-2"><a href="#cb63-2" tabindex="-1"></a><span class="fu">text</span>(tree1)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p>Another fancier option with the package <code>rpart</code>:</p>
<div class="sourceCode" id="cb64"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a>tree2 <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Species <span class="sc">~</span> ., <span class="at">data=</span>iris, <span class="at">method=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb64-2"><a href="#cb64-2" tabindex="-1"></a><span class="fu">fancyRpartPlot</span>(tree2, <span class="at">main=</span><span class="st">&quot;Iris&quot;</span>) <span class="co"># package rattle</span></span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>One of the disadvantages of decision trees may be
<strong>overfitting</strong> i.e. continually creating partitions to
achieve a relatively homogeneous population. This problem can be
alleviated by <strong>pruning</strong> the tree (CART), which is
basically removing the decisions from the bottom to up. Another way is
to <strong>combine several trees</strong> and obtain a consensus, which
can be done via a process called <strong>random forests</strong>
(bootstrapped version of CART - many trees built based on subsets of the
data, in addition not all predictor variables are used every time,
rather a random subset). (extra)</p>
<div class="sourceCode" id="cb65"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a><span class="co"># Extra to exciting your curiosity</span></span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a>iris.rf<span class="ot">=</span><span class="fu">randomForest</span>(Species<span class="sc">~</span>., <span class="at">data=</span>iris, <span class="at">importance=</span><span class="cn">TRUE</span>, <span class="at">proximity=</span><span class="cn">TRUE</span>, <span class="at">ntree=</span><span class="dv">500</span>)</span>
<span id="cb65-3"><a href="#cb65-3" tabindex="-1"></a><span class="co"># Required number of trees gives errors for each species and the average for all species (black):</span></span>
<span id="cb65-4"><a href="#cb65-4" tabindex="-1"></a><span class="fu">plot</span>(iris.rf,<span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<div class="sourceCode" id="cb66"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a><span class="co"># Misclassification error rates:</span></span>
<span id="cb66-2"><a href="#cb66-2" tabindex="-1"></a>iris.rf<span class="sc">$</span>confusion</span></code></pre></div>
<pre><code>##            setosa versicolor virginica class.error
## setosa         50          0         0        0.00
## versicolor      0         47         3        0.06
## virginica       0          4        46        0.08</code></pre>
<div class="sourceCode" id="cb68"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a><span class="co"># Importance of individual predictor variables for classification (the further the value is on the right of the plot, the more important):</span></span>
<span id="cb68-2"><a href="#cb68-2" tabindex="-1"></a><span class="fu">varImpPlot</span>(iris.rf)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-37-2.png" width="672" /></p>
<div class="sourceCode" id="cb69"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a><span class="co"># The membership of a particular class as a function of a variable value can be displayed with this</span></span>
<span id="cb69-2"><a href="#cb69-2" tabindex="-1"></a><span class="fu">partialPlot</span>(iris.rf,iris,Petal.Width,<span class="st">&quot;setosa&quot;</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-37-3.png" width="672" /></p>
<div class="sourceCode" id="cb70"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a><span class="co"># we can predict unclassified observations. We make up some sample new observations from the original dataset to save some time importing (the first three rows are P. setosa, lets see if RandomForest gets that right:</span></span>
<span id="cb70-2"><a href="#cb70-2" tabindex="-1"></a>newobs<span class="ot">=</span>iris[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb70-3"><a href="#cb70-3" tabindex="-1"></a><span class="fu">predict</span>(iris.rf,newobs)</span></code></pre></div>
<pre><code>##      1      2      3 
## setosa setosa setosa 
## Levels: setosa versicolor virginica</code></pre>
<div class="sourceCode" id="cb72"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a><span class="co"># This last plot conveys the confidence in your predictions for each individual sample. Colors represent species and points are samples. In this case, many samples can be predicted with great certainty (1) and only few classifications are questionable (approaching 0)</span></span>
<span id="cb72-2"><a href="#cb72-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">margin</span>(iris.rf))</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-37-4.png" width="672" /></p>
</div>
</div>
<div id="multivariate-regression-trees-constrained-clustering-extra"
class="section level2">
<h2>Multivariate Regression Trees: constrained clustering (extra)</h2>
<p><strong>Multivariate regression trees</strong> (MRT; De’ath 2002) are
an extension of univariate regression trees, a method allowing the
recursive partitioning of a quantitative response variable under the
control of a set of quantitative or categorical explanatory variables
(Breiman et al. 1984). Such a procedure is sometimes called
<strong>constrained</strong> or <strong>supervised</strong>
clustering.The result is a tree whose “leaves” (terminal groups of
sites) are composed of subsets of ‘sites’ chosen to minimize the
within-group sums of squares (as in a <em>k</em>-means clustering), but
where each successive partition is defined by a threshold value or a
state of one of the explanatory variables.</p>
<p>The only package implementing a complete and handy version of MRT was
<code>mvpart</code>. Unfortunately, this package is no longer in CRAN,
so no update is available for R versions posterior to R 3.0.3 +
potential error. Nevertheless, <code>mvpart</code> can still be
installed via github - let me know if you have a better option :)</p>
<div class="sourceCode" id="cb73"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a><span class="fu">data</span>(doubs)</span>
<span id="cb73-2"><a href="#cb73-2" tabindex="-1"></a>spe.norm<span class="ot">&lt;-</span><span class="fu">decostand</span>(doubs<span class="sc">$</span>fish[<span class="sc">-</span><span class="dv">8</span>,], <span class="st">&#39;nor&#39;</span>)</span>
<span id="cb73-3"><a href="#cb73-3" tabindex="-1"></a>env<span class="ot">&lt;-</span>doubs<span class="sc">$</span>env[<span class="sc">-</span><span class="dv">8</span>,]</span>
<span id="cb73-4"><a href="#cb73-4" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" tabindex="-1"></a><span class="co"># par(mfrow=c(1,2))</span></span>
<span id="cb73-6"><a href="#cb73-6" tabindex="-1"></a>spe.ch.mvpart <span class="ot">&lt;-</span></span>
<span id="cb73-7"><a href="#cb73-7" tabindex="-1"></a>  <span class="fu">mvpart</span>(<span class="fu">data.matrix</span>(spe.norm)<span class="sc">~</span>.,</span>
<span id="cb73-8"><a href="#cb73-8" tabindex="-1"></a>         env,</span>
<span id="cb73-9"><a href="#cb73-9" tabindex="-1"></a>         <span class="at">margin =</span> <span class="fl">0.08</span>,</span>
<span id="cb73-10"><a href="#cb73-10" tabindex="-1"></a>         <span class="at">cp=</span><span class="dv">0</span>,</span>
<span id="cb73-11"><a href="#cb73-11" tabindex="-1"></a>         <span class="at">xv=</span><span class="st">&#39;min&#39;</span>, <span class="co"># try &#39;pick&#39; best number, &#39;1se&#39;</span></span>
<span id="cb73-12"><a href="#cb73-12" tabindex="-1"></a>         <span class="at">xval=</span><span class="fu">nrow</span>(doubs<span class="sc">$</span>fish),</span>
<span id="cb73-13"><a href="#cb73-13" tabindex="-1"></a>         <span class="at">xvmult =</span> <span class="dv">100</span></span>
<span id="cb73-14"><a href="#cb73-14" tabindex="-1"></a>         )</span></code></pre></div>
<pre><code>## X-Val rep : 1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98  99  100
## Minimum tree sizes
## tabmins
##  2  3  4  6  7  8  9 10 11 
##  3  5  5  2  1 22 11 39 12</code></pre>
<p><img src="stat_3_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
</div>
</div>
<div id="ordinations" class="section level1">
<h1>Ordinations</h1>
<p>The aim of ordination methods is to represent the data along a
reduced number of orthogonal axes, constructed in such way that they
represent, in decreasing order, the <strong>main trends of the
data</strong>. In fact, we already used some type of ordinations to
visualize non-hierarchical clusters.</p>
<ul>
<li><p>The renders can be <strong>interpreted visually or in association
with other methods</strong> such as clustering or regression</p></li>
<li><p>Most ordination methods (except nMDS) are based on the extraction
of the <strong>eigenvectors</strong> of an association matrix</p></li>
</ul>
<p>Two families of ordination analyses exist according to how they are
dealing with environmental matrix (if any):</p>
<ul>
<li><p><strong>unconstrained ordination</strong> (indirect gradient
analysis, ordination not constrained by environmental factors).They are
descriptive methodologies and describe patterns. It generates hypotheses
but cannot test them.</p>
<ul>
<li><p>uncover main compositional gradients in the species data,
structuring the community, and these gradients can be interpreted by
known (estimated or measured) environmental factors</p></li>
<li><p>environmental variables can be used a posteriori, after the
analysis</p></li>
</ul></li>
<li><p><strong>constrained ordination</strong> (direct gradient
analysis, ordination axes are constrained by environmental factors). It
tests directly hypotheses about the influence of environmental factors
on species composition*</p>
<ul>
<li><p>relates the <strong>species composition directly to the
environmental variables</strong> and extracts the variance in species
composition which is directly related to these variable*</p></li>
<li><p>regarding environmental factors, it offers several interesting
options such as <strong>step-wise selection</strong> of important
environmental variables (and excluding those which are not relevant for
species composition), test of <strong>significance of the variance
explained by environmental factors</strong> and <strong>partitioning
variance explained by particular environmental
variables</strong></p></li>
</ul></li>
</ul>
<p>In addition, based on data input, two types of ordination analyses
exist.</p>
<ul>
<li><p><strong>raw data</strong>: based on analysis of raw
sample-species matrices with abundance or presence/absence data. Two
categories recognized, differing by assumption of species response along
environmental gradient:</p>
<ul>
<li><p><strong>linear</strong>, species response linearly along env.
gradient, which could be true for rather homogenous ecological data,
where ecological gradients are not too long. <strong>Short
gradient</strong>.</p></li>
<li><p><strong>unimodal</strong>, species response unimodally along
gradient, having its optima at certain gradient position. More close to
reality of ecological data, more suitable for heterogenous dataset (long
gradients + many zeros and turnover). <strong>Long
gradient</strong>.</p></li>
</ul></li>
</ul>
<div class="figure" style="text-align: center">
<img src="illustrations/multi_linuni.png" alt="Linear vs. unimodal" width="75%" />
<p class="caption">
Linear vs. unimodal
</p>
</div>
<ul>
<li><strong>distances</strong>: distance matrix computed by
similarity/dissimilarity measures, and projecting these distances into
two or more dimensional diagrams</span></li>
</ul>
<div class="figure" style="text-align: center">
<img src="illustrations/multi_ordi.png" alt="Ordination: general framework" width="75%" />
<p class="caption">
Ordination: general framework
</p>
</div>
<p>The selection toward linear or unimodal ordination approach is
commonly determined by a rule of thumb by performing a <strong>Detrended
Correspondence Analysis (DCA)</strong> using <code>decorana()</code> on
the dataset, then to check the length of the 1st DCA axis. Typically, it
says:</p>
<ul>
<li><p><strong>length&gt;4</strong>, data are heterogenous and you
should use unimodal methods</p></li>
<li><p><strong>length&lt;3</strong>, data are homogenous and you should
use linear methods</p></li>
</ul>
<p>There is a <strong>grey zone</strong> between <strong>3 and
4</strong> where both methods are okay - in addition if your data are
heterogenous, you still can use PCA/RDA using Hellinger’s transformation
of species data* (tbPCA)</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a><span class="fu">decorana</span>(varespec)</span></code></pre></div>
<pre><code>## 
## Call:
## decorana(veg = varespec) 
## 
## Detrended correspondence analysis with 26 segments.
## Rescaling of axes with 4 iterations.
## Total inertia (scaled Chi-square): 2.0574 
## 
##                        DCA1   DCA2    DCA3    DCA4
## Eigenvalues          0.5076 0.3144 0.15739 0.18724
## Additive Eigenvalues 0.5076 0.3136 0.14555 0.17770
## Decorana values      0.5103 0.1422 0.08878 0.05722
## Axis lengths         2.7797 2.1539 1.71886 1.55664</code></pre>
<p>Today, we will illustrate the most common unconstrained ordination
method, PCA, as well as it constrained counterpart, RDA. In addition, we
will mention illustrate the use of non-metric Multi-Dimensional Scaling
(nMDS). nMDS is an indirect gradient analysis approach which produces an
ordination based on a <strong>distance</strong> or
<strong>dissimilarity</strong> matrix. Unlike previous methods which
attempt to maximise the variance or correspondence between objects in an
ordination, nMDS attempts to represent, as closely as possible, the
pairwise dissimilarity between objects in a low-dimensional space. Any
dissimilarity coefficient or distance measure may be used to build the
distance matrix used as input.</p>
<div id="pca" class="section level2">
<h2>PCA</h2>
<p>A Principal Component Analysis (PCA) carries out a <strong>rotation
system of axes</strong> defined by the variables, such as new axes
(called principal component) are orthogonal to one another, and
correspond to the successive dimensions of maximum variance of the
scatter plot.</p>
<p>A PCA will find the “best” line (first principal component) according
to two different criteria of what is the “best”: maximize the variance
&amp; minimize the error.</p>
<p>Applied to a 2D example on wine testing, this is like to identify a
new property of wine by a combination of two variables (alcohol content
and wine darkness) by ‘drawing’ a line through the center of the wine
cloud.</p>
<div class="figure" style="text-align: center">
<img src="illustrations/multi_wine.gif" alt="Scatterplot wine properties: Maximizing Variance and minimizing errors" width="75%" />
<p class="caption">
Scatterplot wine properties: Maximizing Variance and minimizing errors
</p>
</div>
<p>It corresponds to a simple application of the Pythagora theorem.</p>
<p><img src="illustrations/multi_PCA1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>The direction is given by eigenvector, and the strength by the
eigenvalues.</p>
<p><img src="illustrations/multi_PCA2.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Check it <a
href="http://setosa.io/ev/principal-component-analysis/">here</a> for a
very simple explanation of how PCA works, and <a
href="https://www.youtube.com/watch?v=S51bTyIwxFs">here</a> for a a more
detailed example. By the way <em>TileStats</em> channel is very good if
you are looking at some simple explanation about statistics. It
complements very well <em>StatQuest</em> explanation on <a
href="https://www.youtube.com/watch?v=FgakZw6K1QQ">PCA</a> for</p>
<div id="computation" class="section level3">
<h3>Computation</h3>
<p>In R, a <strong>PCA</strong> can be computed with the function
<code>rda()</code> from the <code>vegan</code>among many other
options.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a><span class="co"># PCA on varechem </span></span>
<span id="cb77-2"><a href="#cb77-2" tabindex="-1"></a><span class="co"># You can standardize using scale =T</span></span>
<span id="cb77-3"><a href="#cb77-3" tabindex="-1"></a>env.pca<span class="ot">&lt;-</span><span class="fu">rda</span>(varechem, <span class="at">scale=</span>T) </span>
<span id="cb77-4"><a href="#cb77-4" tabindex="-1"></a>env.pca</span></code></pre></div>
<pre><code>## Call: rda(X = varechem, scale = T)
## 
##               Inertia Rank
## Total              14     
## Unconstrained      14   14
## Inertia is correlations 
## 
## Eigenvalues for unconstrained axes:
##   PC1   PC2   PC3   PC4   PC5   PC6   PC7   PC8   PC9  PC10  PC11  PC12  PC13 
## 5.192 3.193 1.686 1.069 0.816 0.706 0.436 0.369 0.171 0.150 0.085 0.070 0.035 
##  PC14 
## 0.024</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a><span class="fu">summary</span>(env.pca) <span class="co"># default scaling 2</span></span></code></pre></div>
<pre><code>## 
## Call:
## rda(X = varechem, scale = T) 
## 
## Partitioning of correlations:
##               Inertia Proportion
## Total              14          1
## Unconstrained      14          1
## 
## Eigenvalues, and their contribution to the correlations 
## 
## Importance of components:
##                          PC1    PC2    PC3     PC4     PC5     PC6     PC7
## Eigenvalue            5.1916 3.1928 1.6855 1.06899 0.81599 0.70581 0.43641
## Proportion Explained  0.3708 0.2281 0.1204 0.07636 0.05829 0.05042 0.03117
## Cumulative Proportion 0.3708 0.5989 0.7193 0.79564 0.85392 0.90434 0.93551
##                           PC8    PC9    PC10    PC11    PC12     PC13     PC14
## Eigenvalue            0.36884 0.1707 0.14953 0.08526 0.06986 0.035057 0.023615
## Proportion Explained  0.02635 0.0122 0.01068 0.00609 0.00499 0.002504 0.001687
## Cumulative Proportion 0.96185 0.9740 0.98473 0.99082 0.99581 0.998313 1.000000
## 
## Scaling 2 for species and site scores
## * Species are scaled proportional to eigenvalues
## * Sites are unscaled: weighted dispersion equal on all dimensions
## * General scaling constant of scores:  4.236078 
## 
## 
## Species scores
## 
##              PC1     PC2      PC3      PC4       PC5      PC6
## N         0.2441  0.2516 -0.23818  0.92846 -0.359554  0.30319
## P        -0.9181 -0.4194  0.13356  0.09649  0.224909  0.07938
## K        -0.9369 -0.3272 -0.06261  0.25051  0.180899 -0.28683
## Ca       -0.9280 -0.1711  0.47982 -0.02138 -0.241479 -0.09536
## Mg       -0.9087 -0.1978  0.12446 -0.04430 -0.497428 -0.10781
## S        -0.8576 -0.6002 -0.31620 -0.01652  0.071629 -0.08779
## Al        0.2980 -0.9720 -0.39009  0.09092  0.005386 -0.19467
## Fe        0.5236 -0.7748 -0.23063  0.37187 -0.023377 -0.32292
## Mn       -0.7418  0.3908  0.13114  0.44346  0.501064  0.06776
## Zn       -0.8926 -0.3277  0.06142 -0.06121 -0.153677  0.51653
## Mo       -0.1072 -0.4625 -0.85720 -0.27258 -0.030063  0.39721
## Baresoil -0.4218  0.6387 -0.40089 -0.07389 -0.416610 -0.31060
## Humdepth -0.6070  0.6825 -0.41674  0.02975 -0.047738 -0.15923
## pH        0.4286 -0.6517  0.66384  0.07599 -0.265374  0.05070
## 
## 
## Site scores (weighted sums of species scores)
## 
##         PC1      PC2       PC3      PC4       PC5      PC6
## 18  0.05126  0.84085 -0.190142 -0.40431  0.101518 -1.01997
## 15  0.20452  0.37397  0.002978 -1.06030  1.175734 -0.92257
## 24 -1.53647 -1.25830 -0.012170 -0.86690 -1.854372  1.74375
## 27 -1.25643  0.51345  0.743928  0.63835  1.097881  0.15631
## 23 -0.71203  0.86247 -0.203389 -0.05971 -0.786196 -0.80080
## 19 -0.76179  0.73785 -0.761645 -0.31728 -1.303297 -0.62264
## 22 -0.30340  0.86304  0.188484  0.54758 -0.078064  0.24567
## 16  0.62797  0.76436 -0.124301 -0.26047  0.009044 -0.02807
## 28 -1.13923  0.44909  0.229104  1.61582  0.842871  0.60852
## 13 -0.62483 -0.85407 -1.259755  1.38195 -0.157593 -1.04794
## 14 -0.04206  0.60916 -0.719743 -0.73109 -0.230147  0.25505
## 20 -0.93747  0.20753 -0.689713  0.62198 -0.282188  0.33232
## 25 -0.34451  0.90128  0.710714  0.64127  1.214897  0.48173
## 7   1.50502 -0.22114 -0.495604  0.87068 -0.769266 -0.25733
## 5   1.40889  0.60035  0.911463  0.71133 -0.488111  2.45195
## 6   1.30776  0.03604 -0.243884 -0.87792  0.543259  0.46876
## 3   1.64967 -0.82755 -0.343406  1.40028 -0.546374 -0.19580
## 4  -0.26711 -1.65198 -1.744251 -0.60763  0.947492  0.46203
## 2   0.59653 -1.21610 -0.200030  0.72815  0.799208 -0.76013
## 9   0.03271 -0.69445 -0.350028 -1.35247  0.717140  0.82965
## 12  0.47944  0.26377  0.184677 -1.27744  0.573929  0.07253
## 10 -0.32993 -0.95483  1.670469 -0.51343  0.819138 -0.48682
## 11 -0.09921 -1.52318  2.493913 -0.09044 -1.092296 -1.10654
## 21  0.49069  1.17838  0.202333 -0.73801 -1.254205 -0.85966</code></pre>
<p><strong>Inertia</strong>: in <code>vegan</code>’s language, this is
the general term for “variation” in the data</p>
<p><strong>Constrained and unconstrained</strong>: In PCA, the analysis
is unconstrained, i.e. not constrained by a set of explanatory
variables, and so are the results</p>
<p><strong>Eigenvalues</strong>, symbolized <span
class="math inline">\(\lambda_j\)</span>: these are measures of the
importance (variance) of the PCA axes. They can be expressed as the
<strong>Proportions Explained</strong>, or proportions of variation
accounted for by the axes. It is obtained by dividing each eigenvalue by
the “total inertia”.</p>
<p><strong>Scaling</strong>: not to be confused with the argument
“scale” calling for standardization of variables. “Scaling” refers to
the way ordination results are projected in the reduced space for
graphical display. There is no single way of optimally displaying
objects and variables together in a PCA biplot, i.e., a plot showing two
types of results, here the sites and the variables. Two main types of
scaling are generally used. Each of them has properties that must be
kept in mind for proper interpretation of the biplots. Here we give the
essential features of each scaling. Please refer to Legendre and
Legendre (2012) for a complete description.</p>
<ul>
<li><p><strong>Scaling 1</strong> = distance biplot: the eigenvectors
are scaled to unit length. (1) <strong>Distances among objects in the
biplot are approximations of their Euclidean distances in
multidimensional space</strong>. (2) The angles among descriptor vectors
do not reflect their correlations.</p></li>
<li><p><strong>Scaling 2</strong> = correlation biplot: each eigenvector
is scaled to the square root of its eigenvalue. (1) Distances among
objects in the biplot are not approximations of their Euclidean
distances in multidimensional space. (2) <strong>The angles between
descriptors in the biplot reflect their correlations.</strong></p></li>
<li><p>The compromise <strong>Scaling 3</strong> has no clear
interpretation rules, and therefore we will not discuss it
further.</p></li>
</ul>
<p>Bottom line: if the main interest of the analysis is to interpret the
relationships among <strong>objects</strong>, choose <strong>scaling
1</strong>. If the main interest focuses on the relationships among
descriptors, choose <strong>scaling 2</strong>.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" tabindex="-1"></a><span class="co"># Plots using biplot</span></span>
<span id="cb81-2"><a href="#cb81-2" tabindex="-1"></a><span class="co"># To help memorize the meaning of the scalings, vegan now accepts argument scaling = &quot;sites&quot; for scaling 1 and scaling=&quot;species&quot; for scaling 2. This is true for all vegan functions involving scalings</span></span>
<span id="cb81-3"><a href="#cb81-3" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb81-4"><a href="#cb81-4" tabindex="-1"></a><span class="fu">biplot</span>(env.pca, <span class="at">scaling =</span> <span class="st">&quot;sites&quot;</span>, <span class="at">main =</span> <span class="st">&quot;scaling 1 / sites&quot;</span>)</span>
<span id="cb81-5"><a href="#cb81-5" tabindex="-1"></a><span class="fu">biplot</span>(env.pca, <span class="at">scaling =</span> <span class="st">&quot;species&quot;</span>, <span class="at">main =</span> <span class="st">&quot;scaling 2 / species&quot;</span>) <span class="co"># Default scaling 2</span></span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p><strong>Species scores</strong>: coordinates of the arrowheads of the
variables. For historical reasons, response variables are always called
“species” in vegan, no matter what they represent, because
<code>vegan</code> is built for vegetation analysis.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" tabindex="-1"></a><span class="fu">summary</span>(env.pca)<span class="sc">$</span>species</span></code></pre></div>
<pre><code>##                 PC1        PC2         PC3         PC4          PC5         PC6
## N         0.2440979  0.2515733 -0.23818234  0.92845641 -0.359553527  0.30318540
## P        -0.9180524 -0.4193826  0.13356210  0.09648767  0.224909353  0.07938380
## K        -0.9368729 -0.3271677 -0.06260980  0.25051247  0.180899487 -0.28683242
## Ca       -0.9280154 -0.1710871  0.47981561 -0.02137797 -0.241479006 -0.09536341
## Mg       -0.9087391 -0.1977676  0.12445939 -0.04429598 -0.497428380 -0.10781462
## S        -0.8576285 -0.6001923 -0.31619893 -0.01651531  0.071628806 -0.08778905
## Al        0.2979981 -0.9719998 -0.39009263  0.09092398  0.005385911 -0.19467254
## Fe        0.5236461 -0.7748245 -0.23063499  0.37187022 -0.023377408 -0.32291739
## Mn       -0.7417951  0.3908124  0.13113707  0.44346463  0.501064410  0.06775658
## Zn       -0.8926155 -0.3276820  0.06141777 -0.06121484 -0.153676876  0.51653200
## Mo       -0.1071693 -0.4625158 -0.85719968 -0.27258226 -0.030062540  0.39721211
## Baresoil -0.4217537  0.6386581 -0.40088872 -0.07388829 -0.416609754 -0.31059907
## Humdepth -0.6070224  0.6824708 -0.41673807  0.02975285 -0.047737672 -0.15923057
## pH        0.4285669 -0.6517311  0.66384419  0.07599465 -0.265373616  0.05070435</code></pre>
<p><strong>Site scores</strong>: coordinates of the sites in the
ordination diagram. Objects are always called “Sites” in vegan output
files.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" tabindex="-1"></a><span class="fu">summary</span>(env.pca)<span class="sc">$</span>site</span></code></pre></div>
<pre><code>##            PC1         PC2          PC3         PC4          PC5         PC6
## 18  0.05125774  0.84085141 -0.190142229 -0.40430510  0.101517981 -1.01996800
## 15  0.20451664  0.37396845  0.002978186 -1.06030207  1.175734141 -0.92256629
## 24 -1.53646532 -1.25829807 -0.012169567 -0.86689800 -1.854371921  1.74375441
## 27 -1.25642818  0.51344912  0.743928187  0.63834616  1.097880596  0.15630775
## 23 -0.71203013  0.86246533 -0.203389168 -0.05971047 -0.786196338 -0.80080062
## 19 -0.76179163  0.73785383 -0.761645009 -0.31728175 -1.303296913 -0.62264463
## 22 -0.30339881  0.86303581  0.188484225  0.54758062 -0.078063726  0.24567029
## 16  0.62797317  0.76435889 -0.124301252 -0.26047338  0.009043821 -0.02806617
## 28 -1.13922500  0.44909361  0.229104347  1.61582083  0.842870639  0.60852025
## 13 -0.62483096 -0.85407334 -1.259754975  1.38195362 -0.157592594 -1.04794437
## 14 -0.04205762  0.60916369 -0.719742729 -0.73108738 -0.230147385  0.25504547
## 20 -0.93747058  0.20753216 -0.689713110  0.62197912 -0.282187780  0.33232127
## 25 -0.34450969  0.90128283  0.710713830  0.64127030  1.214896913  0.48172601
## 7   1.50502072 -0.22114340 -0.495603913  0.87068106 -0.769266148 -0.25732850
## 5   1.40888836  0.60035498  0.911462530  0.71133424 -0.488110924  2.45194953
## 6   1.30776410  0.03603859 -0.243884429 -0.87792010  0.543258504  0.46875839
## 3   1.64966903 -0.82755080 -0.343406202  1.40028095 -0.546373879 -0.19580193
## 4  -0.26710838 -1.65197820 -1.744251364 -0.60762599  0.947491698  0.46203382
## 2   0.59652585 -1.21609676 -0.200030393  0.72814752  0.799207666 -0.76013198
## 9   0.03271338 -0.69445160 -0.350028314 -1.35246903  0.717139959  0.82965192
## 12  0.47943679  0.26377399  0.184676644 -1.27743600  0.573929142  0.07253206
## 10 -0.32992544 -0.95482574  1.670469377 -0.51343047  0.819137833 -0.48681948
## 11 -0.09921276 -1.52318433  2.493912634 -0.09044412 -1.092296157 -1.10653970
## 21  0.49068874  1.17837957  0.202332694 -0.73801055 -1.254205128 -0.85965950</code></pre>
</div>
<div id="eigenvalues" class="section level3">
<h3>Eigenvalues</h3>
<p>Examine eigenvalues is important to decide how many axes to retain.
Usually, we examine the eigenvalues and decide how many axes are worth
representing and displaying on the basis of the amount of variance
explained. The decision can be completely arbitrary (for instance,
interpret the number of axes necessary to represent 75% of the variance
of the data), or assisted by one of several procedures proposed to set a
limit between the axes that represent interesting variation of the data
and axes that merely display the remaining, essentially random
variance.</p>
<p>One of these procedures consists in computing a <strong>broken stick
model</strong>, which randomly divides a stick of unit length into the
same number of pieces as there are PCA eigenvalues. One interprets only
the axes whose eigenvalues are larger than the length of the
corresponding piece of the stick, or, alternately, one may compare the
sum of eigenvalues, from 1 to k, to the sum of the values from 1 to k
predicted by the broken stick model.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" tabindex="-1"></a><span class="fu">screeplot</span>(env.pca, <span class="at">bstick =</span> <span class="cn">TRUE</span>, <span class="at">npcs =</span> <span class="fu">length</span>(env.pca<span class="sc">$</span>CA<span class="sc">$</span>eig))</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
</div>
<div id="intepretation" class="section level3">
<h3>Intepretation</h3>
<p>The proportion of variance accounted for by the two axes is about 60
%: relative high value makes us confident that our interpretation of the
first pair of axes extracts most relevant information of the data
set.</p>
<p><strong>Scaling 1</strong>: Gradient from left to right with a group
of sites displaying higher values of Ca, Mg, K, Zn, S. Gradient from top
to down with humpdepth and baresoil.</p>
<p><strong>Scaling 2</strong>: Humdepth, Baresoil are very highly
positively correlated. Those two variables are very highly negatively
correlated with pH and Fe.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" tabindex="-1"></a><span class="co"># combining clustering and ordination results</span></span>
<span id="cb87-2"><a href="#cb87-2" tabindex="-1"></a><span class="fu">biplot</span>(env.pca, <span class="at">main=</span><span class="st">&#39;PCA - scaling 1&#39;</span>,<span class="at">scaling=</span><span class="dv">1</span>) </span>
<span id="cb87-3"><a href="#cb87-3" tabindex="-1"></a><span class="fu">ordicluster</span>(env.pca, </span>
<span id="cb87-4"><a href="#cb87-4" tabindex="-1"></a>            <span class="fu">hclust</span>(<span class="fu">dist</span>(<span class="fu">scale</span>(varechem)), <span class="st">&#39;ward.D&#39;</span>), </span>
<span id="cb87-5"><a href="#cb87-5" tabindex="-1"></a>            <span class="at">prune=</span><span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">scaling=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
</div>
<div id="tb-pca" class="section level3">
<h3>tb-PCA</h3>
<p>PCA being a linear method preserving the Euclidean distance among
sites, it is not naturally adapted to the analysis of species abundance
data. Hellinger transformation an the use of a transformation based PCA
solves this problem.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" tabindex="-1"></a><span class="fu">decorana</span> (varespec.hell)</span></code></pre></div>
<pre><code>## 
## Call:
## decorana(veg = varespec.hell) 
## 
## Detrended correspondence analysis with 26 segments.
## Rescaling of axes with 4 iterations.
## Total inertia (scaled Chi-square): 1.0785 
## 
##                        DCA1   DCA2    DCA3    DCA4
## Eigenvalues          0.2460 0.1503 0.09661 0.06645
## Additive Eigenvalues 0.2460 0.1503 0.09487 0.06150
## Decorana values      0.2538 0.1232 0.06096 0.02942
## Axis lengths         2.0513 1.6141 1.28896 0.98323</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" tabindex="-1"></a>spe.h.pca<span class="ot">&lt;-</span><span class="fu">rda</span>(varespec.hell)</span>
<span id="cb90-2"><a href="#cb90-2" tabindex="-1"></a><span class="fu">screeplot</span>(spe.h.pca,<span class="at">bstick =</span> <span class="cn">TRUE</span>, <span class="at">npcs =</span> <span class="fu">length</span>(spe.h.pca<span class="sc">$</span>CA<span class="sc">$</span>eig)) </span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
</div>
<div id="key-points-on-pca" class="section level3">
<h3>Key points on PCA</h3>
<ul>
<li><p>PCA must be computed on <strong>dimensionally homogenous</strong>
variables</p></li>
<li><p>data matrix <strong>not transposed</strong> since covariance or
correlations among objects are meaningless</p></li>
<li><p>PCA can be applied to <strong>binary</strong> data</p></li>
<li><p>Species Presence-Absence data can be subject to a
<strong>Hellinger or chord transformation</strong> prior PCA</p></li>
<li><p>Interpretation relationship variable based on
<strong>angles</strong></p></li>
</ul>
<p><strong>Note</strong>: Although there are means of incorporating
explanatory variables directly in the ordination process (canonical
ordination), one may be interested in interpreting a simple ordination
by means of external variables. It is possible to get a passive
(<em>post-hoc</em>) explanation of axes using environmental variables
with <code>env.fit()</code>.</p>
<p><code>envfit()</code> proposes permutation tests to assess the
significance of the R<sup>2</sup> of each explanatory variable regressed
on the two axes of the biplot. But this is not, by far, the best way to
test the effect of explanatory variables on a table of response
variables.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" tabindex="-1"></a><span class="co"># adding correlation circle</span></span>
<span id="cb91-2"><a href="#cb91-2" tabindex="-1"></a><span class="fu">cleanplot.pca</span> (spe.h.pca) </span>
<span id="cb91-3"><a href="#cb91-3" tabindex="-1"></a><span class="co"># Scaling 2 is default</span></span>
<span id="cb91-4"><a href="#cb91-4" tabindex="-1"></a>(spe.h.pca.env <span class="ot">&lt;-</span> <span class="fu">envfit</span>(spe.h.pca, varechem, <span class="at">scaling =</span> <span class="dv">2</span>))</span></code></pre></div>
<pre><code>## 
## ***VECTORS
## 
##               PC1      PC2     r2 Pr(&gt;r)   
## N         0.42906  0.90328 0.1921  0.101   
## P         0.41543 -0.90962 0.2817  0.030 * 
## K         0.60351 -0.79736 0.2128  0.086 . 
## Ca        0.59845 -0.80116 0.3463  0.011 * 
## Mg        0.62282 -0.78237 0.2600  0.037 * 
## S         0.09264 -0.99570 0.1182  0.260   
## Al       -0.96386  0.26642 0.4964  0.003 **
## Fe       -0.94350  0.33136 0.4364  0.003 **
## Mn        0.87295 -0.48782 0.4638  0.002 **
## Zn        0.65563 -0.75508 0.1872  0.111   
## Mo       -0.64250  0.76629 0.0498  0.613   
## Baresoil  0.99472  0.10260 0.2582  0.042 * 
## Humdepth  0.83492 -0.55037 0.4671  0.002 **
## pH       -0.99555  0.09422 0.2569  0.034 * 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## Permutation: free
## Number of permutations: 999</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" tabindex="-1"></a><span class="co"># plot significant variables with a user -selected colour</span></span>
<span id="cb93-2"><a href="#cb93-2" tabindex="-1"></a><span class="fu">plot</span>(spe.h.pca.env, <span class="at">p.max =</span> <span class="fl">0.05</span>, <span class="at">col =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" tabindex="-1"></a><span class="co"># This has added the significant environmental variables to the</span></span>
<span id="cb94-2"><a href="#cb94-2" tabindex="-1"></a><span class="co"># last biplot drawn by R.</span></span>
<span id="cb94-3"><a href="#cb94-3" tabindex="-1"></a><span class="co"># BEWARE: envfit() must be given the same scaling as the plot to </span></span>
<span id="cb94-4"><a href="#cb94-4" tabindex="-1"></a><span class="co"># which its result is added!</span></span></code></pre></div>
</div>
</div>
<div id="rda-tb-rda" class="section level2">
<h2>RDA &amp; tb-RDA</h2>
<p>Redundancy Analysis (RDA &amp; tb-RDA) use the same kind of formula
as used in <code>lm</code> and other R functions devoted to regression.
Check <code>?rda</code> for details. We will base our example on a
Hellinger transformed data set such illustrating the case of a
<strong>transformation-based RDA</strong></p>
<div id="computation-1" class="section level3">
<h3>Computation</h3>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" tabindex="-1"></a>spe.rda <span class="ot">&lt;-</span> <span class="fu">rda</span>(varespec.hell<span class="sc">~</span>.,varechem.stand) </span>
<span id="cb95-2"><a href="#cb95-2" tabindex="-1"></a><span class="fu">summary</span> (spe.rda) <span class="co"># scaling 2 (default)</span></span></code></pre></div>
<pre><code>## 
## Call:
## rda(formula = varespec.hell ~ N + P + K + Ca + Mg + S + Al +      Fe + Mn + Zn + Mo + Baresoil + Humdepth + pH, data = varechem.stand) 
## 
## Partitioning of variance:
##               Inertia Proportion
## Total          0.3647     1.0000
## Constrained    0.2551     0.6995
## Unconstrained  0.1096     0.3005
## 
## Eigenvalues, and their contribution to the variance 
## 
## Importance of components:
##                         RDA1    RDA2    RDA3    RDA4    RDA5     RDA6     RDA7
## Eigenvalue            0.1115 0.06171 0.02137 0.01843 0.01370 0.007873 0.006766
## Proportion Explained  0.3056 0.16922 0.05859 0.05053 0.03758 0.021589 0.018554
## Cumulative Proportion 0.3056 0.47484 0.53342 0.58395 0.62153 0.643116 0.661670
##                           RDA8     RDA9    RDA10    RDA11    RDA12    RDA13
## Eigenvalue            0.004602 0.002458 0.002058 0.001542 0.001277 0.001237
## Proportion Explained  0.012621 0.006740 0.005643 0.004230 0.003502 0.003391
## Cumulative Proportion 0.674291 0.681031 0.686674 0.690904 0.694406 0.697797
##                           RDA14    PC1     PC2     PC3     PC4      PC5     PC6
## Eigenvalue            0.0006376 0.0483 0.02129 0.01089 0.01025 0.007383 0.00559
## Proportion Explained  0.0017483 0.1324 0.05837 0.02985 0.02810 0.020246 0.01533
## Cumulative Proportion 0.6995457 0.8320 0.89036 0.92022 0.94832 0.968562 0.98389
##                            PC7      PC8       PC9
## Eigenvalue            0.003041 0.001937 0.0008977
## Proportion Explained  0.008338 0.005310 0.0024616
## Cumulative Proportion 0.992228 0.997538 1.0000000
## 
## Accumulated constrained eigenvalues
## Importance of components:
##                         RDA1    RDA2    RDA3    RDA4    RDA5     RDA6     RDA7
## Eigenvalue            0.1115 0.06171 0.02137 0.01843 0.01370 0.007873 0.006766
## Proportion Explained  0.4369 0.24189 0.08375 0.07223 0.05372 0.030862 0.026523
## Cumulative Proportion 0.4369 0.67878 0.76253 0.83476 0.88847 0.919334 0.945857
##                           RDA8     RDA9    RDA10    RDA11    RDA12    RDA13
## Eigenvalue            0.004602 0.002458 0.002058 0.001542 0.001277 0.001237
## Proportion Explained  0.018041 0.009635 0.008067 0.006046 0.005006 0.004848
## Cumulative Proportion 0.963898 0.973533 0.981600 0.987646 0.992653 0.997501
##                           RDA14
## Eigenvalue            0.0006376
## Proportion Explained  0.0024993
## Cumulative Proportion 1.0000000
## 
## Scaling 2 for species and site scores
## * Species are scaled proportional to eigenvalues
## * Sites are unscaled: weighted dispersion equal on all dimensions
## * General scaling constant of scores:  1.701798 
## 
## 
## Species scores
## 
##                RDA1       RDA2       RDA3       RDA4       RDA5       RDA6
## Callvulg  0.0160159  0.0826907  0.2581366  1.009e-01 -6.217e-02 -0.0016558
## Empenigr -0.0797945 -0.0318913 -0.0009659 -2.068e-01  3.972e-02  0.0171542
## Rhodtome -0.0649940 -0.0036694  0.0099162 -5.521e-03  2.004e-02 -0.0369695
## Vaccmyrt -0.1960368 -0.0587967  0.0376640  3.073e-02  1.042e-01 -0.1341711
## Vaccviti -0.1030220 -0.0671526 -0.0359917 -1.917e-01 -7.543e-02  0.0266973
## Pinusylv  0.0054482 -0.0216357  0.0219564 -5.092e-03 -3.067e-02 -0.0186065
## Descflex -0.0585529 -0.0092884 -0.0093120  1.958e-02  3.876e-02  0.0137084
## Betupube -0.0060662  0.0010395 -0.0007285 -9.983e-03 -5.652e-05 -0.0132610
## Vacculig  0.0101729  0.0883246 -0.0453584 -3.014e-02  7.193e-02  0.0743936
## Diphcomp  0.0150549  0.0340487 -0.0150175 -3.386e-02  1.075e-02  0.0399392
## Dicrsp   -0.1139536 -0.0125829 -0.1278945  5.131e-02 -1.597e-01  0.0302947
## Dicrfusc -0.1841925  0.0864025  0.2259383 -9.122e-02  4.434e-02  0.0370906
## Dicrpoly -0.0167640 -0.0150841 -0.0394492 -7.599e-03 -5.551e-02 -0.0654525
## Hylosple -0.1293583 -0.0482427 -0.0402126  8.598e-02  7.241e-02  0.0201377
## Pleuschr -0.5391269 -0.2127296  0.0127947  1.052e-01 -7.460e-04  0.0609398
## Polypili -0.0002393  0.0079115 -0.0075790 -3.045e-03 -5.401e-03 -0.0087093
## Polyjuni -0.0405160 -0.0135278 -0.0531760 -4.854e-02  2.640e-02  0.0082722
## Polycomm -0.0163474 -0.0107698 -0.0084498 -1.321e-02  8.874e-03 -0.0142466
## Pohlnuta -0.0070166 -0.0130415  0.0018057 -1.324e-02 -2.660e-02 -0.0070774
## Ptilcili -0.0352700 -0.0091163 -0.0032319 -7.754e-02 -6.769e-03 -0.0897358
## Barbhatc -0.0164054  0.0004019 -0.0018254 -2.776e-02 -3.280e-03 -0.0563063
## Cladarbu  0.0847529  0.3321482  0.0601827 -3.323e-02 -1.974e-02  0.0434802
## Cladrang  0.2703377  0.3334293 -0.0656048  5.668e-02  1.995e-02 -0.0229181
## Cladstel  0.6095059 -0.4175626  0.0719799  6.319e-05  9.979e-03  0.0227190
## Cladunci -0.0491593 -0.0007364  0.0510752 -1.500e-02 -1.827e-01 -0.0320825
## Cladcocc  0.0100465  0.0105755  0.0129442 -6.232e-03  3.024e-03  0.0035279
## Cladcorn -0.0135770 -0.0019280 -0.0129992 -2.494e-02 -7.449e-05  0.0156006
## Cladgrac -0.0103700  0.0185140 -0.0032232 -1.195e-02 -1.991e-02 -0.0022603
## Cladfimb -0.0029992  0.0086924  0.0151756 -2.275e-02  8.835e-03 -0.0002672
## Cladcris -0.0069519 -0.0003240  0.0362857 -3.355e-02 -1.246e-02 -0.0081845
## Cladchlo  0.0140180 -0.0136312 -0.0105742 -1.403e-02 -8.729e-03 -0.0067112
## Cladbotr -0.0145513 -0.0015019 -0.0003707 -4.882e-03 -5.439e-03 -0.0152525
## Cladamau  0.0010772  0.0103110 -0.0060380 -3.817e-03  1.095e-03  0.0018814
## Cladsp    0.0028890  0.0012954  0.0110459  1.001e-03 -6.689e-03  0.0171827
## Cetreric  0.0118467  0.0127120 -0.0006807  1.796e-02 -5.022e-02  0.0004990
## Cetrisla  0.0094616 -0.0209747  0.0046985 -2.484e-03 -2.024e-02 -0.0282418
## Flavniva  0.0728301  0.0333792 -0.0124718  6.192e-02 -1.384e-02  0.0510826
## Nepharct -0.0132162  0.0069408 -0.0350123 -1.698e-02  3.911e-02  0.0352204
## Stersp    0.0265283  0.0968733 -0.0623228  1.703e-02  1.913e-02 -0.0428120
## Peltapht -0.0107622 -0.0019275 -0.0007184 -6.351e-03  5.430e-03  0.0097869
## Icmaeric  0.0027110  0.0150911 -0.0014810  1.665e-03  2.981e-03 -0.0101809
## Cladcerv  0.0045434 -0.0003724 -0.0006722  4.843e-03  1.054e-03  0.0055565
## Claddefo -0.0379867  0.0083803  0.0220566 -4.589e-02 -3.476e-02 -0.0203269
## Cladphyl  0.0171476 -0.0230933  0.0015490 -2.544e-03 -5.637e-03 -0.0003948
## 
## 
## Site scores (weighted sums of species scores)
## 
##         RDA1      RDA2      RDA3     RDA4     RDA5      RDA6
## 18  0.063547  0.376636 -0.104156 -0.47185  0.11742  0.446901
## 15 -0.411240  0.135628  0.273843  0.25414 -0.24911  0.295399
## 24 -0.411868 -0.085703 -0.658062  0.42715 -1.35085  0.163392
## 27 -0.467840 -0.285983 -0.152026  0.15129  0.71051  0.121111
## 23 -0.315381  0.141653 -0.186407 -0.64463 -0.04314  0.097545
## 19 -0.004261 -0.399878 -0.059006 -0.14275  0.28878 -0.002121
## 22 -0.462376  0.070743  0.822311 -0.09559  0.29920  0.106865
## 16 -0.362133  0.284168  0.654361  0.06059  0.08386 -0.023486
## 28 -0.681257 -0.394331 -0.296893  0.81467  0.68934 -0.396552
## 13  0.179225  0.295913  0.759287  0.43419 -0.19836 -0.087831
## 14 -0.268690  0.261510  0.758555 -0.24291 -0.78499  0.021648
## 20 -0.301031  0.197868 -0.234561 -0.20902 -0.41578  0.386947
## 25 -0.497264 -0.002898 -0.298710 -0.15410 -0.27959  0.822223
## 7   0.183035  0.776675 -0.444989 -0.16108  0.32012  0.237391
## 5   0.294006  0.765653 -0.533941  0.43349  0.20470 -0.572874
## 6   0.336722  0.459268 -0.026004 -0.17512 -0.15619 -0.073425
## 3   0.598903 -0.085259 -0.097912  0.05200  0.34220  0.106018
## 4   0.475554  0.104772  0.186388  0.61031 -0.02653  0.231377
## 2   0.559570 -0.440300 -0.138583 -0.02434  0.26990 -0.127091
## 9   0.416576 -0.714393 -0.017081 -0.15401  0.05445  0.012634
## 12  0.374595 -0.453514 -0.005886 -0.16715 -0.06860  0.123029
## 10  0.526130 -0.562440  0.009598 -0.20776  0.12627 -0.040189
## 11  0.224638 -0.119344  0.039537  0.36896 -0.20055 -0.073092
## 21 -0.049160 -0.326444 -0.249662 -0.75650  0.26694 -1.775819
## 
## 
## Site constraints (linear combinations of constraining variables)
## 
##        RDA1      RDA2     RDA3     RDA4       RDA5      RDA6
## 18 -0.21379  0.558461 -0.11727 -0.59446 -0.1030588  0.560664
## 15 -0.03060 -0.197524  0.16216 -0.09697  0.0046381 -0.184044
## 24 -0.24069 -0.048961 -0.65583  0.45567 -1.1760537  0.061603
## 27 -0.54468 -0.204033 -0.26284  0.31511  0.3497925  0.387774
## 23 -0.35644  0.026910 -0.01596 -0.49392  0.0689604  0.200855
## 19 -0.18585 -0.459134 -0.09984 -0.32297  0.1948144 -0.295013
## 22 -0.37857  0.186351  0.59820 -0.09808  0.0006994  0.391441
## 16 -0.08514  0.376485  0.42221 -0.01258  0.0435174 -0.373883
## 28 -0.67411 -0.328097 -0.10488  0.74028  0.6199817 -0.173171
## 13  0.05731  0.283086  0.89402  0.49623 -0.1044951 -0.007356
## 14 -0.09028 -0.110761  0.35629 -0.16882 -0.1965672 -0.317113
## 20 -0.28866  0.048365 -0.13748 -0.30326 -0.4317098  0.103730
## 25 -0.31881 -0.078802 -0.29691 -0.13108  0.3774984  0.389540
## 7   0.54824  0.649590 -0.38598 -0.16348  0.5457515  0.174917
## 5   0.07140  0.732257 -0.46679  0.32643  0.0365927 -0.522963
## 6   0.20025  0.204248  0.10080  0.01286 -0.0967437  0.121217
## 3   0.49206  0.006501 -0.33808  0.05614  0.3343959 -0.121481
## 4   0.35585  0.217950  0.08386  0.64441 -0.1829867  0.348402
## 2   0.57771 -0.328996  0.02187  0.01834  0.1253425  0.123114
## 9   0.46822 -0.575472  0.05032 -0.27148 -0.2660279  0.421621
## 12  0.12434 -0.158103  0.45698 -0.08925 -0.0469897 -0.044088
## 10  0.36368 -0.566018 -0.19959 -0.01007  0.1004688 -0.010500
## 11  0.30410 -0.267049  0.05138  0.20235 -0.0847382 -0.251980
## 21 -0.15554  0.032746 -0.11662 -0.51139 -0.1130826 -0.983286
## 
## 
## Biplot scores for constraining variables
## 
##              RDA1      RDA2     RDA3    RDA4     RDA5     RDA6
## N        -0.16243  0.540901 -0.13608  0.1950  0.35442 -0.15969
## P        -0.31687 -0.511904 -0.22625  0.4019 -0.18397  0.37035
## K        -0.36280 -0.365953  0.30169  0.4570 -0.11030  0.22278
## Ca       -0.46400 -0.458433 -0.05936  0.1576 -0.29432  0.14731
## Mg       -0.41675 -0.385411 -0.15504  0.1396 -0.40085  0.11282
## S        -0.07421 -0.430521  0.15893  0.3572 -0.42294  0.35883
## Al        0.80087 -0.004068  0.11376  0.3396 -0.09083  0.15112
## Fe        0.73577  0.073964 -0.03893  0.2036  0.12160  0.11746
## Mn       -0.72248 -0.196907 -0.03772  0.1501  0.25295  0.39429
## Zn       -0.35646 -0.333256 -0.20447  0.4652 -0.55826  0.11867
## Mo        0.20086  0.099318  0.04045  0.2649 -0.50666  0.29539
## Baresoil -0.57368  0.215740  0.08878 -0.4887 -0.19594 -0.17118
## Humdepth -0.70654 -0.257932  0.16605 -0.2668  0.14390  0.08604
## pH        0.57529 -0.075138 -0.33629  0.1969 -0.01625 -0.21160</code></pre>
<ul>
<li><p><strong>Partitioning of variance</strong>: variance of Y
explained by the X variables (constrained proportion, 72.71% here), the
unexplained variance of Y (unconstrained proportion, 27.29% here). This
R<sup>2</sup> is biased.</p></li>
<li><p><strong>Eigenvalues and their contribution</strong>: Summarize
the eigenvalues, the proportions explained and the cumulative proportion
of each canonical axis (each canonical axis = each constraining
variable, in this case, the environmental variables from env).
Cumulative proportion give the biased R<sup>2</sup>.</p></li>
<li><p><strong>Accumulated constrained eigenvalues</strong>: these are
cumulative amounts of variance expressed as proportions of the total
<em>explained</em> variance, as opposed to their contribution to the
<em>total</em> variance described before</p></li>
<li><p><strong>Species scores</strong>: coordinates of the tips of the
vector representing the response variables in the bi- or tri- plots.
Depending on the scaling chosen</p></li>
<li><p><strong>Site scores</strong>: coordinates of the sites as
expressed in the space of the response variables Y</p></li>
<li><p><strong>Site constraints</strong>: coordinates of the sites in
the space of the explanatory variable X. Fitted site scores</p></li>
<li><p><strong>Biplot scores</strong>: coordinates of the tips of the
vectors representing explanatory variables. Correlations based. For
factors, representation of the centroids of the levels is
preferable.</p></li>
<li><p><strong>Centroids for factor constraints</strong>: coordinates of
centroids of levels of factor variables, i.e. means of the scores of the
sites possessing state ‘1’ for a given level.</p></li>
</ul>
<p>In the <code>rda</code> output, an interesting information is
missing: the canonical coefficients, <em>i.e.</em> the
<strong>equivalent of regression coefficients for each explanatory
variable on each canonical axis</strong>. They can be retrieved using
<code>coef</code>:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" tabindex="-1"></a><span class="fu">coef</span>(spe.rda)</span></code></pre></div>
<pre><code>##                   RDA1        RDA2         RDA3         RDA4        RDA5
## N        -0.0200095029  0.10686796  0.001412512  0.031215826  0.05377349
## P        -0.0046939551 -0.07561755 -0.298179156  0.049062508  0.16413028
## K        -0.1562155347  0.01290271  0.238679149  0.385662555  0.01001576
## Ca       -0.0036642374  0.06195505  0.249319538 -0.135154112 -0.11442280
## Mg       -0.0281983554  0.20488155 -0.252433998  0.037338956  0.06591125
## S         0.1249939909 -0.22013268  0.208326547 -0.340847899 -0.20008085
## Al        0.1843771146  0.15639922 -0.182462988 -0.017275557  0.30941116
## Fe       -0.0301850701 -0.13100401  0.041572715 -0.002575433 -0.14591152
## Mn       -0.0203514434  0.13747102 -0.096849572 -0.042629499  0.06083472
## Zn       -0.0113242369 -0.13518423 -0.106106256  0.132458011 -0.07673058
## Mo       -0.0889160864  0.13726766  0.092767415  0.122362268 -0.17012492
## Baresoil -0.0227164417  0.05350988 -0.079863137 -0.102368985 -0.07097820
## Humdepth -0.0054703032 -0.32072381  0.041728240 -0.016218026  0.10802642
## pH       -0.0005299095 -0.18310285 -0.015542315  0.044285781 -0.05241717
##                 RDA6         RDA7          RDA8         RDA9       RDA10
## N         0.04411053 -0.067425581 -0.0098703598 -0.093291585  0.10971633
## P        -0.03173645  0.082113849 -0.2481019733 -0.227994711  0.03607520
## K        -0.37575460  0.159183593  0.0348740557  0.105792954  0.03256511
## Ca        0.25250501 -0.176562191  0.1030075250 -0.094289920 -0.23486829
## Mg        0.18376652  0.346802841  0.0525912834 -0.092508829  0.01860641
## S         0.20051887 -0.376094950  0.1652675158  0.005669273  0.45956859
## Al        0.22277028  0.346646509 -0.2540693449 -0.232529786 -0.44240650
## Fe       -0.13281390 -0.137033580  0.2287153190  0.197871174  0.09719871
## Mn        0.30943769  0.081094481  0.1160541895  0.137783918 -0.10781443
## Zn       -0.31499073 -0.089675806 -0.0364515941  0.124851066 -0.19455186
## Mo        0.08201240  0.032729419 -0.0003734787  0.181421892  0.07418855
## Baresoil -0.11681044  0.105952019  0.0051452182  0.006962492 -0.02028562
## Humdepth -0.23184879 -0.001689157 -0.1072145334  0.192882432  0.05373587
## pH       -0.25603181  0.018016292  0.0829668784  0.273984329  0.21018907
##                 RDA11        RDA12        RDA13       RDA14
## N        -0.003395027 -0.004076910  0.004017265 -0.19710752
## P         0.029560918  0.008646496 -0.121070098  0.08192076
## K        -0.058088816  0.096398667 -0.169386090  0.24290276
## Ca       -0.022504665 -0.073907557 -0.226312572 -0.32101009
## Mg       -0.266470872  0.037840997  0.238435675  0.09973565
## S         0.161047282  0.140410690  0.100202341 -0.25110249
## Al        0.040652310 -0.137297433  0.400530927 -0.17649452
## Fe        0.106782613 -0.215439426 -0.341612569  0.17833110
## Mn        0.058757136  0.067218769  0.188824801  0.02160508
## Zn        0.179683322 -0.275892572  0.060545492  0.09994007
## Mo       -0.131806710  0.146077495 -0.185167838  0.02084301
## Baresoil  0.203052386 -0.007949055 -0.024535003  0.06090536
## Humdepth  0.036581695 -0.099520263 -0.042713512 -0.10093597
## pH        0.073668899  0.249301946 -0.027551832 -0.04022100</code></pre>
<p>In addition like the ordinary R<sup>2</sup> from multiple regression
the R<sup>2</sup> is biased. It can be cure by adjusting the
R<sup>2</sup> using Ezekiel’s formula (Ezekiel 1930). An adjusted
R<sup>2</sup> near 0 indicates that X does not explain more of the
variation of Y than random normal variables would do. It can be
negative, indicating that the explanatory variables X do worse than
random normal variable would. The R<sup>2</sup> and
adjusted-R<sup>2</sup> can be computed using vegan’s function
<code>RsquareAdj</code></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" tabindex="-1"></a><span class="co">#Retrieval of the adjusted R2</span></span>
<span id="cb99-2"><a href="#cb99-2" tabindex="-1"></a><span class="co"># Unadjusted R2 retrieve from RDA results</span></span>
<span id="cb99-3"><a href="#cb99-3" tabindex="-1"></a>R2<span class="ot">&lt;-</span><span class="fu">RsquareAdj</span>(spe.rda)<span class="sc">$</span>r.squared</span>
<span id="cb99-4"><a href="#cb99-4" tabindex="-1"></a><span class="co"># Adjusted R2 retrieve from RDA object</span></span>
<span id="cb99-5"><a href="#cb99-5" tabindex="-1"></a>R2adj<span class="ot">&lt;-</span><span class="fu">RsquareAdj</span>(spe.rda)<span class="sc">$</span>adj.r.squared</span></code></pre></div>
</div>
<div id="tb-rda-plots" class="section level3">
<h3>tb-RDA plots</h3>
<p>We can call this a triplot since there are three different entities
in the plot: sites, response variables and explanatory variables. To
differentiate the latter two, it is good to draw arrowhead only on the
vector of the quantitative explanatory variables, not on the response
variable vectors</p>
<div class="sourceCode" id="cb100"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" tabindex="-1"></a><span class="co"># triplot of the rda results</span></span>
<span id="cb100-2"><a href="#cb100-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb100-3"><a href="#cb100-3" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" tabindex="-1"></a><span class="co"># site scores are weighted by sum of species</span></span>
<span id="cb100-5"><a href="#cb100-5" tabindex="-1"></a><span class="co"># scaling 1: distance triplot</span></span>
<span id="cb100-6"><a href="#cb100-6" tabindex="-1"></a><span class="fu">plot</span> (spe.rda, <span class="at">scaling=</span><span class="dv">1</span>, <span class="at">main=</span><span class="st">&#39;Triplot RDA spe.hel ~ env – scaling 1 – wa scores&#39;</span>)</span>
<span id="cb100-7"><a href="#cb100-7" tabindex="-1"></a>spe.sc <span class="ot">&lt;-</span> <span class="fu">scores</span> (spe.rda, <span class="at">choices=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">scaling=</span><span class="dv">1</span>, <span class="at">display=</span><span class="st">&#39;sp&#39;</span>) </span>
<span id="cb100-8"><a href="#cb100-8" tabindex="-1"></a><span class="fu">arrows</span> (<span class="dv">0</span>,<span class="dv">0</span>, spe.sc[,<span class="dv">1</span>],spe.sc[,<span class="dv">2</span>],<span class="at">length=</span><span class="dv">0</span>,<span class="at">lty=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;red&#39;</span>) </span>
<span id="cb100-9"><a href="#cb100-9" tabindex="-1"></a></span>
<span id="cb100-10"><a href="#cb100-10" tabindex="-1"></a><span class="co"># scaling 2 (default)</span></span>
<span id="cb100-11"><a href="#cb100-11" tabindex="-1"></a><span class="fu">plot</span> (spe.rda,<span class="at">main=</span><span class="st">&#39;Triplot RDA spe.hel ~ env – scaling 2 – wa scores&#39;</span>)</span>
<span id="cb100-12"><a href="#cb100-12" tabindex="-1"></a>spe2.sc <span class="ot">&lt;-</span> <span class="fu">scores</span> (spe.rda, <span class="at">choices=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">display=</span><span class="st">&#39;sp&#39;</span>)</span>
<span id="cb100-13"><a href="#cb100-13" tabindex="-1"></a><span class="fu">arrows</span> (<span class="dv">0</span>,<span class="dv">0</span>, spe2.sc[,<span class="dv">1</span>],spe2.sc[,<span class="dv">2</span>],<span class="at">length=</span><span class="dv">0</span>,<span class="at">lty=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb100-14"><a href="#cb100-14" tabindex="-1"></a></span>
<span id="cb100-15"><a href="#cb100-15" tabindex="-1"></a><span class="co"># site scores are linear combinations of the environmental variables</span></span>
<span id="cb100-16"><a href="#cb100-16" tabindex="-1"></a><span class="co"># scaling 1</span></span>
<span id="cb100-17"><a href="#cb100-17" tabindex="-1"></a><span class="fu">plot</span> (spe.rda,<span class="at">scaling=</span><span class="dv">1</span>,<span class="at">display=</span><span class="fu">c</span>(<span class="st">&#39;sp&#39;</span>,<span class="st">&#39;lc&#39;</span>,<span class="st">&#39;cn&#39;</span>),<span class="at">main=</span><span class="st">&#39;Triplot RDA spe.hel ~ env – scaling 1 – lc scores&#39;</span>)</span>
<span id="cb100-18"><a href="#cb100-18" tabindex="-1"></a><span class="fu">arrows</span> (<span class="dv">0</span>,<span class="dv">0</span>, spe.sc[,<span class="dv">1</span>],spe.sc[,<span class="dv">2</span>],<span class="at">length=</span><span class="dv">0</span>,<span class="at">lty=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb100-19"><a href="#cb100-19" tabindex="-1"></a><span class="co"># scaling 2</span></span>
<span id="cb100-20"><a href="#cb100-20" tabindex="-1"></a><span class="fu">plot</span> (spe.rda,<span class="at">display=</span><span class="fu">c</span>(<span class="st">&#39;sp&#39;</span>,<span class="st">&#39;lc&#39;</span>,<span class="st">&#39;cn&#39;</span>),<span class="at">main=</span><span class="st">&#39;Triplot RDA spe.hel ~ env – scaling 2 – lc scores&#39;</span>) <span class="co"># cn for centroids</span></span>
<span id="cb100-21"><a href="#cb100-21" tabindex="-1"></a><span class="fu">arrows</span> (<span class="dv">0</span>,<span class="dv">0</span>, spe2.sc[,<span class="dv">1</span>],spe2.sc[,<span class="dv">2</span>],<span class="at">length=</span><span class="dv">0</span>,<span class="at">lty=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
</div>
<div id="interpretation" class="section level3">
<h3>Interpretation</h3>
<p><strong>Ordination</strong></p>
<ul>
<li><p>Interpretation of the two scaling</p>
<ul>
<li><p>For the species and the sites the interpretation of the two
scalings are the same as in a PCA</p></li>
<li><p>Presence of vectors and centroids of explanatory variables call
for additional rules</p></li>
</ul></li>
<li><p>Let interpret our two last triplots:</p>
<ul>
<li><p>First two canonical axis alone explaining 58.3% of the total
variance of the data, the first axis alone explaining 47.6% (unadjusted
values)</p></li>
<li><p>Since R<sup>2</sup>-adj = 0.5320, the percentages of accumulated
constrained eigenvalues show that the first axis alone explains 0.5224 x
0.643 = 0.336 or 33.6% variance, and the two first 0.5224 x 0.788 =
0.412 or 41.2%</p></li>
<li><p>Major trends have been modelled in this analysis ! In ecology,
data are quite noisy, so you should never expect a very high value of R2
adj but there is a way to test for the overall significance of the model
and RDA axes.</p></li>
</ul></li>
</ul>
<p><strong>RDA model test</strong></p>
<p>The overall test function is called <code>anova.cca</code>. This name
is unfortunate, since it leads to confusion with the classical ANOVA
test, which it is not !</p>
<div class="sourceCode" id="cb101"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" tabindex="-1"></a><span class="co"># Global test of the RDA results</span></span>
<span id="cb101-2"><a href="#cb101-2" tabindex="-1"></a><span class="fu">anova.cca</span>(spe.rda,<span class="at">step=</span><span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## Permutation test for rda under reduced model
## Permutation: free
## Number of permutations: 999
## 
## Model: rda(formula = varespec.hell ~ N + P + K + Ca + Mg + S + Al + Fe + Mn + Zn + Mo + Baresoil + Humdepth + pH, data = varechem.stand)
##          Df Variance      F Pr(&gt;F)  
## Model    14  0.25511 1.4968  0.049 *
## Residual  9  0.10957                
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The test of the axes can only be run with the formula synthax. How
many canonical axes are significant?</p>
<div class="sourceCode" id="cb103"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" tabindex="-1"></a><span class="co"># Test of all canonical axes</span></span>
<span id="cb103-2"><a href="#cb103-2" tabindex="-1"></a><span class="fu">anova.cca</span>(spe.rda,<span class="at">by=</span><span class="st">&#39;axis&#39;</span>,<span class="at">step=</span><span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## Permutation test for rda under reduced model
## Forward tests for axes
## Permutation: free
## Number of permutations: 999
## 
## Model: rda(formula = varespec.hell ~ N + P + K + Ca + Mg + S + Al + Fe + Mn + Zn + Mo + Baresoil + Humdepth + pH, data = varechem.stand)
##          Df Variance      F Pr(&gt;F)  
## RDA1      1 0.111452 9.1548  0.095 .
## RDA2      1 0.061708 5.0688  0.401  
## RDA3      1 0.021365 1.7550  0.996  
## RDA4      1 0.018425 1.5135  0.999  
## RDA5      1 0.013704 1.1256  1.000  
## RDA6      1 0.007873 0.6467  1.000  
## RDA7      1 0.006766 0.5558  1.000  
## RDA8      1 0.004602 0.3780  1.000  
## RDA9      1 0.002458 0.2019  1.000  
## RDA10     1 0.002058 0.1690  1.000  
## RDA11     1 0.001542 0.1267  1.000  
## RDA12     1 0.001277 0.1049  1.000  
## RDA13     1 0.001237 0.1016  1.000  
## RDA14     1 0.000638 0.0524  1.000  
## Residual  9 0.109568                
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="variables-selection" class="section level3">
<h3>Variables selection</h3>
<p>It happens we wish to reduce the number of explanatory variables. The
reasons vary: search for parsimony, rich data set but poor at priori
hypotheses, or a method producing a large set of explanatory variables
which must be reduced afterwards.</p>
<p>Linear dependencies can be explored by computing the variables’
variance inflation factor. VIFs above 20 indicates strong collinearity.
Ideally, VIFs above 10 should be at least examined, and avoid if
possible. VIFs can be computed in <code>vegan</code> after
<code>rda</code> using the function <code>vif.cca</code></p>
<div class="sourceCode" id="cb105"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" tabindex="-1"></a><span class="fu">vif.cca</span>(spe.rda)</span></code></pre></div>
<pre><code>##         N         P         K        Ca        Mg         S        Al        Fe 
##  1.884049  6.184742 11.746873  9.825650  9.595203 18.460717 20.331905  8.849137 
##        Mn        Zn        Mo  Baresoil  Humdepth        pH 
##  5.168278  7.755110  4.575108  2.213443  5.638807  6.910118</code></pre>
<p>A reduction is justified to find a parsimonious RDA !!! To select the
significant explanatory variables, you can then perform a stepwise
selection (forward or backward), using the <code>ordistep</code> or
<code>ordiR2step</code> function (or using the <code>forward.sel</code>
function of package <code>packfor</code>)</p>
</div>
<div id="partial-rda" class="section level3">
<h3>Partial <code>rda</code></h3>
<p><strong>Partial canonical ordination</strong> is the multivariate
equivalent of partial linear regression: it is possible to run a RDA of
a (transformed) species data matrix <strong>Y</strong>, explained by a
matrix of environmental variables <strong>X</strong>, in the presence of
covariables <strong>W</strong> (e.g. Display the patterns of the species
data uniquely explained by a linear model of the env variables when the
effect of another variable is held constant).</p>
<p>See <a
href="https://r.qcbs.ca/workshop10/book-en/partial-redundancy-analysis.html">here</a>
for more details and example on <code>doubs</code> data.</p>
</div>
</div>
<div id="non-metric-multidimensional-scaling-nmds"
class="section level2">
<h2>non-metric Multidimensional Scaling (nMDS)</h2>
<p>nMDS is an indirect gradient analysis approach which produces an
ordination based on a distance or dissimilarity matrix.nMDS is a
rank-based approach. This means that the original distance data is
substituted with ranks.</p>
<ul>
<li><p>represent as well as possible the ordering relationship among
objects in a small and specified number of axes</p></li>
<li><p>nMDS (like PCoA - also called Metric Multidimensional Scaling)
can produce ordinations of objects from any distance matrix</p></li>
<li><p>nMDS can cope with missing distances, as long as there are enough
measures left to position each object with respect to each
other.</p></li>
</ul>
<p>nMDS is <strong>NOT</strong> a eigenvalue based ordination method
(unlike MDS), and does not maximize the variability associated with
individual axes of the ordination.</p>
<div id="procedure" class="section level3">
<h3>Procedure</h3>
<p>Quiet straightforward:</p>
<ul>
<li><p>specify the number m of axes (dimensions) – usually 2 !</p></li>
<li><p>construct an initial configuration of the objects in the m
dimensions, to be used as a starting point of an iterative adjustment
process. This is a tricky step, since the end-results may depend on the
starting configuration.</p></li>
<li><p>an iterative procedure tries to position the objects in the
requested number of dimensions in such was as to minimize a stress
function (scaled from 0 to 1), which measures how far the distances in
the reduced-space configuration are from being monotonic to the original
distance in the association matrix</p></li>
<li><p>the adjustment goes on until the stress value can no more be
lowered, or predetermined value (sometimes never reached)</p></li>
</ul>
</div>
<div id="computation-2" class="section level3">
<h3>Computation</h3>
<p>Functions:</p>
<ul>
<li><p><code>metaMDS</code> (library <code>vegan</code>) – advanced
function, composed of many sub-routine steps. Species points are added
to the ordination plot using <code>wascores</code></p></li>
<li><p><code>isoMDS</code> (library <code>MASS</code>) if missing values
in the distance matrix and <code>bestnmds</code> package
<code>labdsv</code></p></li>
</ul>
<div class="sourceCode" id="cb107"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" tabindex="-1"></a>spe.nmds<span class="ot">&lt;-</span><span class="fu">metaMDS</span>(varespec,<span class="at">distance=</span><span class="st">&#39;bray&#39;</span>,<span class="at">trymax=</span><span class="dv">999</span>)</span></code></pre></div>
<pre><code>## Run 0 stress 0.1040334 
## Run 1 stress 0.1568378 
## Run 2 stress 0.1040334 
## ... Procrustes: rmse 7.12778e-06  max resid 2.950097e-05 
## ... Similar to previous best
## Run 3 stress 0.1040334 
## ... New best solution
## ... Procrustes: rmse 8.42112e-06  max resid 3.636475e-05 
## ... Similar to previous best
## Run 4 stress 0.1146972 
## Run 5 stress 0.2285323 
## Run 6 stress 0.1040334 
## ... New best solution
## ... Procrustes: rmse 1.87765e-06  max resid 7.814528e-06 
## ... Similar to previous best
## Run 7 stress 0.1040334 
## ... New best solution
## ... Procrustes: rmse 3.57491e-06  max resid 1.509385e-05 
## ... Similar to previous best
## Run 8 stress 0.1678339 
## Run 9 stress 0.1040334 
## ... Procrustes: rmse 4.689869e-06  max resid 1.996176e-05 
## ... Similar to previous best
## Run 10 stress 0.1560845 
## Run 11 stress 0.1040334 
## ... Procrustes: rmse 5.947761e-06  max resid 2.538566e-05 
## ... Similar to previous best
## Run 12 stress 0.1678339 
## Run 13 stress 0.1040334 
## ... Procrustes: rmse 3.30755e-06  max resid 1.404608e-05 
## ... Similar to previous best
## Run 14 stress 0.1040334 
## ... Procrustes: rmse 7.252572e-06  max resid 2.66828e-05 
## ... Similar to previous best
## Run 15 stress 0.1040334 
## ... Procrustes: rmse 3.446204e-06  max resid 1.493985e-05 
## ... Similar to previous best
## Run 16 stress 0.1040334 
## ... Procrustes: rmse 5.268035e-06  max resid 2.241472e-05 
## ... Similar to previous best
## Run 17 stress 0.2265179 
## Run 18 stress 0.1678339 
## Run 19 stress 0.1556361 
## Run 20 stress 0.1040334 
## ... Procrustes: rmse 3.891521e-06  max resid 1.643339e-05 
## ... Similar to previous best
## *** Best solution repeated 8 times</code></pre>
<div class="sourceCode" id="cb109"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" tabindex="-1"></a>spe.nmds</span></code></pre></div>
<pre><code>## 
## Call:
## metaMDS(comm = varespec, distance = &quot;bray&quot;, trymax = 999) 
## 
## global Multidimensional Scaling using monoMDS
## 
## Data:     varespec 
## Distance: bray 
## 
## Dimensions: 2 
## Stress:     0.1040334 
## Stress type 1, weak ties
## Best solution was repeated 8 times in 20 tries
## The best solution was from try 7 (random start)
## Scaling: centring, PC rotation, halfchange scaling 
## Species: expanded scores based on &#39;varespec&#39;</code></pre>
<div class="sourceCode" id="cb111"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" tabindex="-1"></a>spe.nmds<span class="sc">$</span>stress</span></code></pre></div>
<pre><code>## [1] 0.1040334</code></pre>
<div class="sourceCode" id="cb113"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" tabindex="-1"></a><span class="fu">plot</span>(spe.nmds,<span class="at">type=</span><span class="st">&#39;t&#39;</span>,<span class="at">main=</span><span class="fu">paste</span>(<span class="st">&#39;NMDS/Bray–Stress =&#39;</span>,<span class="fu">round</span>(spe.nmds<span class="sc">$</span>stress,<span class="dv">3</span>)))</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
</div>
<div id="nmds-quality" class="section level3">
<h3>nMDS quality</h3>
<ul>
<li><p>A useful way to assess the appropriateness of an nMDS is to
compare, in a <em>Shepard diagram</em>, the distance among objects in
the ordination with the original distances.</p></li>
<li><p><code>stressplot()</code> – draws such a <em>Shepard stress</em>
plot, which is the relationship between real distances between samples
in resulting <em>m</em> dimensional ordination solution, and their
particular dissimilarities.</p></li>
</ul>
<div class="sourceCode" id="cb114"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" tabindex="-1"></a><span class="fu">stressplot</span>(spe.nmds, <span class="at">main=</span><span class="st">&#39;Shepard plot&#39;</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
<ul>
<li>In addition, the goodness-of-fit of the ordination is measured as
the R<sup>2</sup> of either a linear or a non-linear regression of the
NMDS distances on the original ones</li>
</ul>
<div class="sourceCode" id="cb115"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" tabindex="-1"></a><span class="co"># goodness of fit</span></span>
<span id="cb115-2"><a href="#cb115-2" tabindex="-1"></a>gof<span class="ot">&lt;-</span><span class="fu">goodness</span>(spe.nmds)</span>
<span id="cb115-3"><a href="#cb115-3" tabindex="-1"></a><span class="fu">plot</span>(spe.nmds,<span class="at">type=</span><span class="st">&#39;t&#39;</span>,<span class="at">main=</span><span class="st">&#39;Goodness of fit&#39;</span>)</span>
<span id="cb115-4"><a href="#cb115-4" tabindex="-1"></a><span class="fu">points</span>(spe.nmds, <span class="at">display=</span><span class="st">&#39;sites&#39;</span>, <span class="at">cex=</span>gof<span class="sc">*</span><span class="dv">90</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
</div>
<div id="adding-cluster" class="section level3">
<h3>Adding cluster</h3>
<div class="sourceCode" id="cb116"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" tabindex="-1"></a><span class="co"># UPGMA</span></span>
<span id="cb116-2"><a href="#cb116-2" tabindex="-1"></a>spe.bray.upgma <span class="ot">&lt;-</span> <span class="fu">hclust</span>(spe.bc,<span class="st">&#39;average&#39;</span>)</span>
<span id="cb116-3"><a href="#cb116-3" tabindex="-1"></a><span class="co"># nMDS with labels</span></span>
<span id="cb116-4"><a href="#cb116-4" tabindex="-1"></a><span class="fu">plot</span>(spe.nmds, <span class="at">display=</span><span class="st">&quot;sites&quot;</span>)</span>
<span id="cb116-5"><a href="#cb116-5" tabindex="-1"></a><span class="fu">orditorp</span>(spe.nmds, <span class="at">display=</span><span class="st">&quot;sites&quot;</span>) <span class="co"># add text / points to ordination</span></span>
<span id="cb116-6"><a href="#cb116-6" tabindex="-1"></a><span class="co"># add and prune tree</span></span>
<span id="cb116-7"><a href="#cb116-7" tabindex="-1"></a><span class="fu">ordicluster</span>(spe.nmds, spe.bray.upgma, <span class="at">prune=</span><span class="dv">5</span>, <span class="at">col =</span> <span class="fu">cutree</span>(spe.bray.upgma, <span class="dv">6</span>),<span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
</div>
<div id="ordisurf" class="section level3">
<h3><code>ordisurf</code></h3>
<p>Fits a smooth surface for given variable and plots the result on
ordination diagram (Generalized Additive Model)</p>
<div class="sourceCode" id="cb117"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" tabindex="-1"></a><span class="fu">ordisurf</span>(spe.nmds <span class="sc">~</span> Baresoil, varechem, <span class="at">bubble =</span> <span class="dv">5</span>, <span class="at">main=</span><span class="st">&quot;Baresoil GAM&quot;</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## y ~ s(x1, x2, k = 10, bs = &quot;tp&quot;, fx = FALSE)
## 
## Estimated degrees of freedom:
## 5.51  total = 6.51 
## 
## REML score: 93.62944</code></pre>
</div>
<div id="ordihull-ordispider" class="section level3">
<h3><code>ordihull</code> &amp; <code>ordispider</code></h3>
<div class="sourceCode" id="cb119"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" tabindex="-1"></a><span class="fu">data</span>(dune)</span>
<span id="cb119-2"><a href="#cb119-2" tabindex="-1"></a><span class="fu">data</span>(dune.env)</span>
<span id="cb119-3"><a href="#cb119-3" tabindex="-1"></a><span class="fu">attach</span>(dune.env)</span>
<span id="cb119-4"><a href="#cb119-4" tabindex="-1"></a>NMDS.dune<span class="ot">&lt;-</span><span class="fu">metaMDS</span>(dune,<span class="at">distance=</span><span class="st">&#39;bray&#39;</span>)</span></code></pre></div>
<pre><code>## Run 0 stress 0.1192678 
## Run 1 stress 0.1809579 
## Run 2 stress 0.1192678 
## ... Procrustes: rmse 1.53272e-05  max resid 4.494553e-05 
## ... Similar to previous best
## Run 3 stress 0.1192678 
## ... Procrustes: rmse 8.391757e-05  max resid 0.0002568254 
## ... Similar to previous best
## Run 4 stress 0.1192678 
## ... Procrustes: rmse 1.808787e-05  max resid 5.463833e-05 
## ... Similar to previous best
## Run 5 stress 0.1192678 
## ... Procrustes: rmse 2.346637e-05  max resid 7.103973e-05 
## ... Similar to previous best
## Run 6 stress 0.1809577 
## Run 7 stress 0.1192679 
## ... Procrustes: rmse 0.0001354525  max resid 0.0004089577 
## ... Similar to previous best
## Run 8 stress 0.1183186 
## ... New best solution
## ... Procrustes: rmse 0.02027066  max resid 0.06496363 
## Run 9 stress 0.1886532 
## Run 10 stress 0.1192678 
## Run 11 stress 0.1183186 
## ... Procrustes: rmse 5.932166e-06  max resid 1.816522e-05 
## ... Similar to previous best
## Run 12 stress 0.1192679 
## Run 13 stress 0.1192678 
## Run 14 stress 0.1183186 
## ... New best solution
## ... Procrustes: rmse 3.056713e-06  max resid 7.246983e-06 
## ... Similar to previous best
## Run 15 stress 0.1192679 
## Run 16 stress 0.2252534 
## Run 17 stress 0.1192678 
## Run 18 stress 0.1183186 
## ... Procrustes: rmse 1.763614e-05  max resid 5.952387e-05 
## ... Similar to previous best
## Run 19 stress 0.1192679 
## Run 20 stress 0.1192678 
## *** Best solution repeated 2 times</code></pre>
<div class="sourceCode" id="cb121"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" tabindex="-1"></a><span class="fu">plot</span>(NMDS.dune,<span class="at">type=</span><span class="st">&#39;t&#39;</span>,<span class="at">main=</span><span class="fu">paste</span>(<span class="st">&#39;NMDS/Bray – Stress =&#39;</span>,<span class="fu">round</span>(NMDS.dune<span class="sc">$</span>stress,<span class="dv">3</span>)))</span>
<span id="cb121-2"><a href="#cb121-2" tabindex="-1"></a>pl<span class="ot">&lt;-</span><span class="fu">ordihull</span>(NMDS.dune, Management, <span class="at">scaling =</span> <span class="dv">3</span>, <span class="at">draw=</span><span class="st">&#39;polygon&#39;</span>,<span class="at">col=</span><span class="st">&#39;grey&#39;</span>)</span>
<span id="cb121-3"><a href="#cb121-3" tabindex="-1"></a><span class="fu">ordispider</span>(pl, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">label =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="stat_3_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="hypothesis-testing" class="section level1">
<h1>Hypothesis testing</h1>
<div id="permanova" class="section level2">
<h2>PERMANOVA</h2>
<p>Analysis of variance using distance matrices — for partitioning
distance matrices among sources of variation and fitting linear models
(e.g., factors, polynomial regression) to distance matrices; uses a
permutation test with pseudo-F ratios.</p>
<p>Testing management effect:</p>
<div class="sourceCode" id="cb122"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" tabindex="-1"></a><span class="do">## default is overall (omnibus) test</span></span>
<span id="cb122-2"><a href="#cb122-2" tabindex="-1"></a><span class="fu">adonis2</span>(dune <span class="sc">~</span> Management<span class="sc">*</span>A1, <span class="at">method=</span><span class="st">&#39;bray&#39;</span>, <span class="at">data =</span> dune.env)</span></code></pre></div>
<pre><code>## Permutation test for adonis under reduced model
## Terms added sequentially (first to last)
## Permutation: free
## Number of permutations: 999
## 
## adonis2(formula = dune ~ Management * A1, data = dune.env, method = &quot;bray&quot;)
##               Df SumOfSqs      R2      F Pr(&gt;F)    
## Management     3   1.4686 0.34161 3.2629  0.001 ***
## A1             1   0.4409 0.10256 2.9387  0.021 *  
## Management:A1  3   0.5892 0.13705 1.3090  0.229    
## Residual      12   1.8004 0.41878                  
## Total         19   4.2990 1.00000                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb124"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" tabindex="-1"></a><span class="do">## sequential tests</span></span>
<span id="cb124-2"><a href="#cb124-2" tabindex="-1"></a><span class="fu">adonis2</span>(dune <span class="sc">~</span> Management<span class="sc">*</span>A1, <span class="at">method=</span><span class="st">&#39;bray&#39;</span>, <span class="at">data =</span> dune.env, <span class="at">by =</span> <span class="st">&quot;terms&quot;</span>)</span></code></pre></div>
<pre><code>## Permutation test for adonis under reduced model
## Terms added sequentially (first to last)
## Permutation: free
## Number of permutations: 999
## 
## adonis2(formula = dune ~ Management * A1, data = dune.env, method = &quot;bray&quot;, by = &quot;terms&quot;)
##               Df SumOfSqs      R2      F Pr(&gt;F)   
## Management     3   1.4686 0.34161 3.2629  0.002 **
## A1             1   0.4409 0.10256 2.9387  0.017 * 
## Management:A1  3   0.5892 0.13705 1.3090  0.222   
## Residual      12   1.8004 0.41878                 
## Total         19   4.2990 1.00000                 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>PERMANOVA is a robust alternative to both parametric MANOVA and to
ordination methods for describing how variation is attributed to
different experimental treatments or uncontrolled covariates. It is also
analogous to redundancy analysis.</p>
</div>
<div id="anosim" class="section level2">
<h2>ANOSIM</h2>
<p>Analysis of similarities (ANOSIM) provides a way to test
statistically whether there is a significant difference between two or
more groups of sampling units.</p>
<div class="sourceCode" id="cb126"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" tabindex="-1"></a>dune.dist <span class="ot">&lt;-</span> <span class="fu">vegdist</span>(dune)</span>
<span id="cb126-2"><a href="#cb126-2" tabindex="-1"></a>dune.ano <span class="ot">&lt;-</span> <span class="fu">with</span>(dune.env, <span class="fu">anosim</span>(dune.dist, Management))</span>
<span id="cb126-3"><a href="#cb126-3" tabindex="-1"></a><span class="fu">summary</span>(dune.ano)</span></code></pre></div>
<pre><code>## 
## Call:
## anosim(x = dune.dist, grouping = Management) 
## Dissimilarity: bray 
## 
## ANOSIM statistic R: 0.2579 
##       Significance: 0.012 
## 
## Permutation: free
## Number of permutations: 999
## 
## Upper quantiles of permutations (null model):
##   90%   95% 97.5%   99% 
## 0.117 0.169 0.205 0.266 
## 
## Dissimilarity ranks between and within classes:
##         0%   25%    50%     75%  100%   N
## Between  4 58.50 104.00 145.500 188.0 147
## BF       5 15.25  25.50  41.250  57.0   3
## HF       1  7.25  46.25  68.125  89.5  10
## NM       6 64.75 124.50 156.250 181.0  15
## SF       3 32.75  53.50  99.250 184.0  15</code></pre>
<div class="sourceCode" id="cb128"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" tabindex="-1"></a><span class="fu">plot</span>(dune.ano)</span></code></pre></div>
<pre><code>## Warning in (function (z, notch = FALSE, width = NULL, varwidth = FALSE, : some
## notches went outside hinges (&#39;box&#39;): maybe set notch=FALSE</code></pre>
<p><img src="stat_3_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
<p>Function <code>adonis2</code> is a more robust alternative that
should preferred.For comparing dissimilarities against continuous
variables, see <code>?vegan::mantel</code>.</p>
</div>
</div>
<div id="predictions-extra" class="section level1">
<h1>Predictions (extra)</h1>
<p>The process of constructing, evaluating, and validating
classification models, provides basis for machine learning models. Below
we explore and compare perfomance four algorithms to classify and
<strong>predict</strong> <code>iris</code> species (see
<code>caret</code> package).</p>
<p><strong>Key steps</strong>:</p>
<p>1- <strong>Validation Dataset</strong></p>
<p>The dataset is split into 80% training data (<code>idataset</code>)
and 20% validation data (<code>validation</code>).</p>
<div class="sourceCode" id="cb130"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" tabindex="-1"></a><span class="co"># create a list of 80% of the rows in the original dataset that we can use for training</span></span>
<span id="cb130-2"><a href="#cb130-2" tabindex="-1"></a>validation_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(iris<span class="sc">$</span>Species, <span class="at">p=</span><span class="fl">0.80</span>, <span class="at">list=</span><span class="cn">FALSE</span>)</span>
<span id="cb130-3"><a href="#cb130-3" tabindex="-1"></a><span class="co"># select 20% of the data for validation</span></span>
<span id="cb130-4"><a href="#cb130-4" tabindex="-1"></a>validation <span class="ot">&lt;-</span> iris[<span class="sc">-</span>validation_index,]</span>
<span id="cb130-5"><a href="#cb130-5" tabindex="-1"></a><span class="co"># use the remaining 80% of data to training and testing the models</span></span>
<span id="cb130-6"><a href="#cb130-6" tabindex="-1"></a>idataset <span class="ot">&lt;-</span> iris[validation_index,]</span></code></pre></div>
<p>You now have training data in the dataset variable and a validation
set we will use later in the validation variable.</p>
<p>2- <strong>Evaluation Method</strong></p>
<p>Set evaluation as 10-fold cross validation. This will split our
dataset into 10 parts, train in 9 and test on 1 and release for all
combinations of train-test splits. We will also repeat the process 3
times for each algorithm with different splits of the data into 10
groups, in an effort to get a more accurate estimate</p>
<div class="sourceCode" id="cb131"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" tabindex="-1"></a><span class="co"># Run algorithms using 10-fold cross validation</span></span>
<span id="cb131-2"><a href="#cb131-2" tabindex="-1"></a>control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method=</span><span class="st">&quot;cv&quot;</span>, <span class="at">number=</span><span class="dv">10</span>)</span>
<span id="cb131-3"><a href="#cb131-3" tabindex="-1"></a>metric <span class="ot">&lt;-</span> <span class="st">&quot;Accuracy&quot;</span></span></code></pre></div>
<p>We are using the metric of “Accuracy” to evaluate models. This will
be the ratio of the number of correctly predicted instances in divided
by the total number of instances in the dataset multiplied by 100 to
give a percentage (e.g. [XX]% accurate). We will be using the metric
variable when we run build and evaluate each model next.</p>
<p>3- <strong>Build Models</strong></p>
<p>We don’t know which algorithms would be good on this problem or what
configurations to use, let’s evaluate four different algorithms:</p>
<pre><code>* Classification and Regression Trees (CART)
* Random Forest
* Linear Discriminant Analysis (LDA) /supervised machine learning to solve multi-class classification problems
* k-Nearest Neighbors (kNN) / classification (or regression) algorithm </code></pre>
<p>Check this, before <code>species</code> was our predictor. We use
multiples predictor to model the response.</p>
<div class="sourceCode" id="cb133"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" tabindex="-1"></a><span class="co"># Random Forest</span></span>
<span id="cb133-2"><a href="#cb133-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb133-3"><a href="#cb133-3" tabindex="-1"></a>fit.rf <span class="ot">&lt;-</span> <span class="fu">train</span>(Species<span class="sc">~</span>., <span class="at">data=</span>idataset, <span class="at">method=</span><span class="st">&quot;rf&quot;</span>, <span class="at">metric=</span>metric, <span class="at">trControl=</span>control)</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;proxy&#39;:
##   method   from   
##   dim.dist ecodist</code></pre>
<div class="sourceCode" id="cb135"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" tabindex="-1"></a><span class="co"># CART</span></span>
<span id="cb135-2"><a href="#cb135-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb135-3"><a href="#cb135-3" tabindex="-1"></a>fit.cart <span class="ot">&lt;-</span> <span class="fu">train</span>(Species<span class="sc">~</span>., <span class="at">data=</span>idataset, <span class="at">method=</span><span class="st">&quot;rpart&quot;</span>, <span class="at">metric=</span>metric, <span class="at">trControl=</span>control)</span>
<span id="cb135-4"><a href="#cb135-4" tabindex="-1"></a><span class="co"># kNN</span></span>
<span id="cb135-5"><a href="#cb135-5" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb135-6"><a href="#cb135-6" tabindex="-1"></a>fit.knn <span class="ot">&lt;-</span> <span class="fu">train</span>(Species<span class="sc">~</span>., <span class="at">data=</span>idataset, <span class="at">method=</span><span class="st">&quot;knn&quot;</span>, <span class="at">metric=</span>metric, <span class="at">trControl=</span>control)</span>
<span id="cb135-7"><a href="#cb135-7" tabindex="-1"></a><span class="co"># lda</span></span>
<span id="cb135-8"><a href="#cb135-8" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb135-9"><a href="#cb135-9" tabindex="-1"></a>fit.lda <span class="ot">&lt;-</span> <span class="fu">train</span>(Species<span class="sc">~</span>., <span class="at">data=</span>idataset, <span class="at">method=</span><span class="st">&quot;lda&quot;</span>, <span class="at">metric=</span>metric, <span class="at">trControl=</span>control)</span></code></pre></div>
<p>4- <strong>Compare Models</strong></p>
<p>We now have 4 models and accuracy estimations for each. We need to
compare the models to each other and select the most accurate. We can
report on the accuracy of each model by first creating a list of the
created models and using the summary function.</p>
<div class="sourceCode" id="cb136"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" tabindex="-1"></a><span class="co"># summarize accuracy of models</span></span>
<span id="cb136-2"><a href="#cb136-2" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">resamples</span>(<span class="fu">list</span>(<span class="at">lda=</span>fit.lda, <span class="at">cart=</span>fit.cart, <span class="at">knn=</span>fit.knn, <span class="at">rf=</span>fit.rf))</span>
<span id="cb136-3"><a href="#cb136-3" tabindex="-1"></a><span class="fu">summary</span>(results)<span class="sc">$</span>statistics<span class="sc">$</span>Accuracy</span></code></pre></div>
<pre><code>##           Min.   1st Qu.    Median      Mean 3rd Qu. Max. NA&#39;s
## lda  0.9166667 0.9375000 1.0000000 0.9750000       1    1    0
## cart 0.8333333 0.9166667 0.9583333 0.9416667       1    1    0
## knn  0.9166667 0.9166667 0.9583333 0.9583333       1    1    0
## rf   0.8333333 0.9166667 0.9583333 0.9500000       1    1    0</code></pre>
<p>They are all very good, but We can see that the most accurate model
in this case is LDA and knn:</p>
<div class="sourceCode" id="cb138"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" tabindex="-1"></a><span class="co"># summarize Best Model</span></span>
<span id="cb138-2"><a href="#cb138-2" tabindex="-1"></a><span class="fu">print</span>(fit.lda)</span></code></pre></div>
<pre><code>## Linear Discriminant Analysis 
## 
## 120 samples
##   4 predictor
##   3 classes: &#39;setosa&#39;, &#39;versicolor&#39;, &#39;virginica&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 108, 108, 108, 108, 108, 108, ... 
## Resampling results:
## 
##   Accuracy  Kappa 
##   0.975     0.9625</code></pre>
<p>This gives a nice summary of what was used to train the model and the
mean and standard deviation (SD) accuracy achieved, specifically XX.X%
accuracy +/- X%</p>
<p>5- <strong>Make Prediction</strong></p>
<p>The LDA was the most accurate model. Now we want to get an idea of
the accuracy of the model on our validation set. This will give us an
independent final check on the accuracy of the best model. It is
valuable to keep a validation set just in case you made a slip during
such as overfitting to the training set or a data leak. Both will result
in an overly optimistic result.</p>
<p>We can run the LDA model directly on the validation set and summarize
the results in a confusion matrix.</p>
<div class="sourceCode" id="cb140"><pre
class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" tabindex="-1"></a><span class="co"># estimate skill of LDA on the validation dataset</span></span>
<span id="cb140-2"><a href="#cb140-2" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.lda, validation)</span>
<span id="cb140-3"><a href="#cb140-3" tabindex="-1"></a><span class="fu">confusionMatrix</span>(predictions, validation<span class="sc">$</span>Species)</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;proxy&#39;:
##   method   from   
##   dim.dist ecodist</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##             Reference
## Prediction   setosa versicolor virginica
##   setosa         10          0         0
##   versicolor      0         10         1
##   virginica       0          0         9
## 
## Overall Statistics
##                                           
##                Accuracy : 0.9667          
##                  95% CI : (0.8278, 0.9992)
##     No Information Rate : 0.3333          
##     P-Value [Acc &gt; NIR] : 2.963e-13       
##                                           
##                   Kappa : 0.95            
##                                           
##  Mcnemar&#39;s Test P-Value : NA              
## 
## Statistics by Class:
## 
##                      Class: setosa Class: versicolor Class: virginica
## Sensitivity                 1.0000            1.0000           0.9000
## Specificity                 1.0000            0.9500           1.0000
## Pos Pred Value              1.0000            0.9091           1.0000
## Neg Pred Value              1.0000            1.0000           0.9524
## Prevalence                  0.3333            0.3333           0.3333
## Detection Rate              0.3333            0.3333           0.3000
## Detection Prevalence        0.3333            0.3667           0.3000
## Balanced Accuracy           1.0000            0.9750           0.9500</code></pre>
<p>We can see that the accuracy is 100% but on a small validation
dataset (20%). 95% CI : (0.8843, 1) suggesting we may have an accurate
and a reliably accurate model. You have one <strong>neurone</strong> in
a network, but you are at one step toward Deep Learning.</p>
<div class="float">
<img src="illustrations/multi_MLDL.png"
alt="Machine Learning vs. Deep Learning" />
<div class="figcaption">Machine Learning vs. Deep Learning</div>
</div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>Charrad M., Ghazzali N., Boiteau V., &amp; Niknafs A. (2014).
NbClust: An R Package for Determining the Relevant Number of Clusters in
a Data Set. Journal of Statistical Software, 61(6), 1–36. <a
href="https://doi.org/10.18637/jss.v061.i06"
class="uri">https://doi.org/10.18637/jss.v061.i06</a></p>
<p>Johnson R.A., Wichern D.W. (2007) Applied Multivariate Statistical
Analysis. 6th ed. Upper Saddle River: Pearson.</p>
<p>QCBS R Workshop Series (2023) <a
href="https://r.qcbs.ca/workshop10/book-en/index.html"
class="uri">https://r.qcbs.ca/workshop10/book-en/index.html</a></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
